export default VirtualHuman=function(){"use strict";var t,e,n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},i=function(t){try{return!!t()}catch(t){return!0}},o=!i((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),s=Function.prototype,r=s.bind,a=s.call,l=r&&r.bind(a),c=r?function(t){return t&&l(a,t)}:function(t){return t&&function(){return a.apply(t,arguments)}},g=function(t){return t&&t.Math==Math&&t},d=g("object"==typeof globalThis&&globalThis)||g("object"==typeof window&&window)||g("object"==typeof self&&self)||g("object"==typeof n&&n)||function(){return this}()||Function("return this")(),h=d.TypeError,m=function(t){if(null==t)throw h("Can't call method on "+t);return t},I=m,u=d.Object,C=function(t){return u(I(t))},b=C,p=c({}.hasOwnProperty),y=Object.hasOwn||function(t,e){return p(b(t),e)},Z=o,J=y,G=Function.prototype,V=Z&&Object.getOwnPropertyDescriptor,S=J(G,"name"),B={EXISTS:S,PROPER:S&&"something"===function(){}.name,CONFIGURABLE:S&&(!Z||Z&&V(G,"name").configurable)},X={},v=function(t){return"function"==typeof t},f=v,R=function(t){return"object"==typeof t?null!==t:f(t)},W=R,A=d.document,w=W(A)&&W(A.createElement),Y=function(t){return w?A.createElement(t):{}},k=Y,F=!o&&!i((function(){return 7!=Object.defineProperty(k("div"),"a",{get:function(){return 7}}).a})),H=d,x=R,N=H.String,T=H.TypeError,M=function(t){if(x(t))return t;throw T(N(t)+" is not an object")},U=Function.prototype.call,K=U.bind?U.bind(U):function(){return U.apply(U,arguments)},E=d,L=v,D=function(t){return L(t)?t:void 0},Q=function(t,e){return arguments.length<2?D(E[t]):E[t]&&E[t][e]},z=c({}.isPrototypeOf),P=Q("navigator","userAgent")||"",_=d,O=P,j=_.process,q=_.Deno,$=j&&j.versions||q&&q.version,tt=$&&$.v8;tt&&(e=(t=tt.split("."))[0]>0&&t[0]<4?1:+(t[0]+t[1])),!e&&O&&(!(t=O.match(/Edge\/(\d+)/))||t[1]>=74)&&(t=O.match(/Chrome\/(\d+)/))&&(e=+t[1]);var et=e,nt=et,it=i,ot=!!Object.getOwnPropertySymbols&&!it((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&nt&&nt<41})),st=ot&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,rt=Q,at=v,lt=z,ct=st,gt=d.Object,dt=ct?function(t){return"symbol"==typeof t}:function(t){var e=rt("Symbol");return at(e)&&lt(e.prototype,gt(t))},ht=d.String,mt=function(t){try{return ht(t)}catch(t){return"Object"}},It=v,ut=mt,Ct=d.TypeError,bt=function(t){if(It(t))return t;throw Ct(ut(t)+" is not a function")},pt=bt,yt=function(t,e){var n=t[e];return null==n?void 0:pt(n)},Zt=K,Jt=v,Gt=R,Vt=d.TypeError,St={exports:{}},Bt=d,Xt=Object.defineProperty,vt=function(t,e){try{Xt(Bt,t,{value:e,configurable:!0,writable:!0})}catch(n){Bt[t]=e}return e},ft=vt,Rt="__core-js_shared__",Wt=d[Rt]||ft(Rt,{}),At=Wt;(St.exports=function(t,e){return At[t]||(At[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.19.2",mode:"global",copyright:"\xa9 2021 Denis Pushkarev (zloirock.ru)"});var wt=c,Yt=0,kt=Math.random(),Ft=wt(1..toString),Ht=function(t){return"Symbol("+(void 0===t?"":t)+")_"+Ft(++Yt+kt,36)},xt=d,Nt=St.exports,Tt=y,Mt=Ht,Ut=ot,Kt=st,Et=Nt("wks"),Lt=xt.Symbol,Dt=Lt&&Lt.for,Qt=Kt?Lt:Lt&&Lt.withoutSetter||Mt,zt=function(t){if(!Tt(Et,t)||!Ut&&"string"!=typeof Et[t]){var e="Symbol."+t;Ut&&Tt(Lt,t)?Et[t]=Lt[t]:Et[t]=Kt&&Dt?Dt(e):Qt(e)}return Et[t]},Pt=K,_t=R,Ot=dt,jt=yt,qt=function(t,e){var n,i;if("string"===e&&Jt(n=t.toString)&&!Gt(i=Zt(n,t)))return i;if(Jt(n=t.valueOf)&&!Gt(i=Zt(n,t)))return i;if("string"!==e&&Jt(n=t.toString)&&!Gt(i=Zt(n,t)))return i;throw Vt("Can't convert object to primitive value")},$t=zt,te=d.TypeError,ee=$t("toPrimitive"),ne=function(t,e){if(!_t(t)||Ot(t))return t;var n,i=jt(t,ee);if(i){if(void 0===e&&(e="default"),n=Pt(i,t,e),!_t(n)||Ot(n))return n;throw te("Can't convert object to primitive value")}return void 0===e&&(e="number"),qt(t,e)},ie=dt,oe=function(t){var e=ne(t,"string");return ie(e)?e:e+""},se=o,re=F,ae=M,le=oe,ce=d.TypeError,ge=Object.defineProperty;X.f=se?ge:function(t,e,n){if(ae(t),e=le(e),ae(n),re)try{return ge(t,e,n)}catch(t){}if("get"in n||"set"in n)throw ce("Accessors not supported");return"value"in n&&(t[e]=n.value),t};var de=o,he=B.EXISTS,me=c,Ie=X.f,ue=Function.prototype,Ce=me(ue.toString),be=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,pe=me(be.exec);de&&!he&&Ie(ue,"name",{configurable:!0,get:function(){try{return pe(be,Ce(this))[1]}catch(t){return""}}});var ye=function(t){return t&&t.Math==Math&&t},Ze=ye("object"==typeof globalThis&&globalThis)||ye("object"==typeof window&&window)||ye("object"==typeof self&&self)||ye("object"==typeof n&&n)||function(){return this}()||Function("return this")(),Je=Function.prototype,Ge=Je.apply,Ve=Je.bind,Se=Je.call,Be="object"==typeof Reflect&&Reflect.apply||(Ve?Se.bind(Ge):function(){return Se.apply(Ge,arguments)}),Xe=Function.prototype,ve=Xe.bind,fe=Xe.call,Re=ve&&ve.bind(fe),We=ve?function(t){return t&&Re(fe,t)}:function(t){return t&&function(){return fe.apply(t,arguments)}},Ae=function(t){return"function"==typeof t},we={},Ye=function(t){try{return!!t()}catch(t){return!0}},ke=!Ye((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),Fe=Function.prototype.call,He=Fe.bind?Fe.bind(Fe):function(){return Fe.apply(Fe,arguments)},xe={},Ne={}.propertyIsEnumerable,Te=Object.getOwnPropertyDescriptor,Me=Te&&!Ne.call({1:2},1);xe.f=Me?function(t){var e=Te(this,t);return!!e&&e.enumerable}:Ne;var Ue,Ke,Ee=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},Le=We,De=Le({}.toString),Qe=Le("".slice),ze=function(t){return Qe(De(t),8,-1)},Pe=We,_e=Ye,Oe=ze,je=Ze.Object,qe=Pe("".split),$e=_e((function(){return!je("z").propertyIsEnumerable(0)}))?function(t){return"String"==Oe(t)?qe(t,""):je(t)}:je,tn=Ze.TypeError,en=function(t){if(null==t)throw tn("Can't call method on "+t);return t},nn=$e,on=en,sn=function(t){return nn(on(t))},rn=Ae,an=function(t){return"object"==typeof t?null!==t:rn(t)},ln={},cn=ln,gn=Ze,dn=Ae,hn=function(t){return dn(t)?t:void 0},mn=function(t,e){return arguments.length<2?hn(cn[t])||hn(gn[t]):cn[t]&&cn[t][e]||gn[t]&&gn[t][e]},In=We({}.isPrototypeOf),un=mn("navigator","userAgent")||"",Cn=Ze,bn=un,pn=Cn.process,yn=Cn.Deno,Zn=pn&&pn.versions||yn&&yn.version,Jn=Zn&&Zn.v8;Jn&&(Ke=(Ue=Jn.split("."))[0]>0&&Ue[0]<4?1:+(Ue[0]+Ue[1])),!Ke&&bn&&(!(Ue=bn.match(/Edge\/(\d+)/))||Ue[1]>=74)&&(Ue=bn.match(/Chrome\/(\d+)/))&&(Ke=+Ue[1]);var Gn=Ke,Vn=Gn,Sn=Ye,Bn=!!Object.getOwnPropertySymbols&&!Sn((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&Vn&&Vn<41})),Xn=Bn&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,vn=mn,fn=Ae,Rn=In,Wn=Xn,An=Ze.Object,wn=Wn?function(t){return"symbol"==typeof t}:function(t){var e=vn("Symbol");return fn(e)&&Rn(e.prototype,An(t))},Yn=Ze.String,kn=function(t){try{return Yn(t)}catch(t){return"Object"}},Fn=Ae,Hn=kn,xn=Ze.TypeError,Nn=function(t){if(Fn(t))return t;throw xn(Hn(t)+" is not a function")},Tn=Nn,Mn=function(t,e){var n=t[e];return null==n?void 0:Tn(n)},Un=He,Kn=Ae,En=an,Ln=Ze.TypeError,Dn={exports:{}},Qn=Ze,zn=Object.defineProperty,Pn=function(t,e){try{zn(Qn,t,{value:e,configurable:!0,writable:!0})}catch(n){Qn[t]=e}return e},_n="__core-js_shared__",On=Ze[_n]||Pn(_n,{}),jn=On;(Dn.exports=function(t,e){return jn[t]||(jn[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.19.2",mode:"pure",copyright:"\xa9 2021 Denis Pushkarev (zloirock.ru)"});var qn=en,$n=Ze.Object,ti=function(t){return $n(qn(t))},ei=ti,ni=We({}.hasOwnProperty),ii=Object.hasOwn||function(t,e){return ni(ei(t),e)},oi=We,si=0,ri=Math.random(),ai=oi(1..toString),li=function(t){return"Symbol("+(void 0===t?"":t)+")_"+ai(++si+ri,36)},ci=Ze,gi=Dn.exports,di=ii,hi=li,mi=Bn,Ii=Xn,ui=gi("wks"),Ci=ci.Symbol,bi=Ci&&Ci.for,pi=Ii?Ci:Ci&&Ci.withoutSetter||hi,yi=function(t){if(!di(ui,t)||!mi&&"string"!=typeof ui[t]){var e="Symbol."+t;mi&&di(Ci,t)?ui[t]=Ci[t]:ui[t]=Ii&&bi?bi(e):pi(e)}return ui[t]},Zi=He,Ji=an,Gi=wn,Vi=Mn,Si=function(t,e){var n,i;if("string"===e&&Kn(n=t.toString)&&!En(i=Un(n,t)))return i;if(Kn(n=t.valueOf)&&!En(i=Un(n,t)))return i;if("string"!==e&&Kn(n=t.toString)&&!En(i=Un(n,t)))return i;throw Ln("Can't convert object to primitive value")},Bi=yi,Xi=Ze.TypeError,vi=Bi("toPrimitive"),fi=function(t,e){if(!Ji(t)||Gi(t))return t;var n,i=Vi(t,vi);if(i){if(void 0===e&&(e="default"),n=Zi(i,t,e),!Ji(n)||Gi(n))return n;throw Xi("Can't convert object to primitive value")}return void 0===e&&(e="number"),Si(t,e)},Ri=wn,Wi=function(t){var e=fi(t,"string");return Ri(e)?e:e+""},Ai=an,wi=Ze.document,Yi=Ai(wi)&&Ai(wi.createElement),ki=function(t){return Yi?wi.createElement(t):{}},Fi=ki,Hi=!ke&&!Ye((function(){return 7!=Object.defineProperty(Fi("div"),"a",{get:function(){return 7}}).a})),xi=ke,Ni=He,Ti=xe,Mi=Ee,Ui=sn,Ki=Wi,Ei=ii,Li=Hi,Di=Object.getOwnPropertyDescriptor;we.f=xi?Di:function(t,e){if(t=Ui(t),e=Ki(e),Li)try{return Di(t,e)}catch(t){}if(Ei(t,e))return Mi(!Ni(Ti.f,t,e),t[e])};var Qi=Ye,zi=Ae,Pi=/#|\.prototype\./,_i=function(t,e){var n=ji[Oi(t)];return n==$i||n!=qi&&(zi(e)?Qi(e):!!e)},Oi=_i.normalize=function(t){return String(t).replace(Pi,".").toLowerCase()},ji=_i.data={},qi=_i.NATIVE="N",$i=_i.POLYFILL="P",to=_i,eo=Nn,no=We(We.bind),io=function(t,e){return eo(t),void 0===e?t:no?no(t,e):function(){return t.apply(e,arguments)}},oo={},so=Ze,ro=an,ao=so.String,lo=so.TypeError,co=function(t){if(ro(t))return t;throw lo(ao(t)+" is not an object")},go=ke,ho=Hi,mo=co,Io=Wi,uo=Ze.TypeError,Co=Object.defineProperty;oo.f=go?Co:function(t,e,n){if(mo(t),e=Io(e),mo(n),ho)try{return Co(t,e,n)}catch(t){}if("get"in n||"set"in n)throw uo("Accessors not supported");return"value"in n&&(t[e]=n.value),t};var bo=oo,po=Ee,yo=ke?function(t,e,n){return bo.f(t,e,po(1,n))}:function(t,e,n){return t[e]=n,t},Zo=Ze,Jo=Be,Go=We,Vo=Ae,So=we.f,Bo=to,Xo=ln,vo=io,fo=yo,Ro=ii,Wo=function(t){var e=function(n,i,o){if(this instanceof e){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,i)}return new t(n,i,o)}return Jo(t,this,arguments)};return e.prototype=t.prototype,e},Ao=function(t,e){var n,i,o,s,r,a,l,c,g=t.target,d=t.global,h=t.stat,m=t.proto,I=d?Zo:h?Zo[g]:(Zo[g]||{}).prototype,u=d?Xo:Xo[g]||fo(Xo,g,{})[g],C=u.prototype;for(o in e)n=!Bo(d?o:g+(h?".":"#")+o,t.forced)&&I&&Ro(I,o),r=u[o],n&&(a=t.noTargetGet?(c=So(I,o))&&c.value:I[o]),s=n&&a?a:e[o],n&&typeof r==typeof s||(l=t.bind&&n?vo(s,Zo):t.wrap&&n?Wo(s):m&&Vo(s)?Go(s):s,(t.sham||s&&s.sham||r&&r.sham)&&fo(l,"sham",!0),fo(u,o,l),m&&(Ro(Xo,i=g+"Prototype")||fo(Xo,i,{}),fo(Xo[i],o,s),t.real&&C&&!C[o]&&fo(C,o,s)))},wo=Math.ceil,Yo=Math.floor,ko=function(t){var e=+t;return e!=e||0===e?0:(e>0?Yo:wo)(e)},Fo=ko,Ho=Math.max,xo=Math.min,No=function(t,e){var n=Fo(t);return n<0?Ho(n+e,0):xo(n,e)},To=ko,Mo=Math.min,Uo=function(t){return t>0?Mo(To(t),9007199254740991):0},Ko=function(t){return Uo(t.length)},Eo=sn,Lo=No,Do=Ko,Qo=function(t){return function(e,n,i){var o,s=Eo(e),r=Do(s),a=Lo(i,r);if(t&&n!=n){for(;r>a;)if((o=s[a++])!=o)return!0}else for(;r>a;a++)if((t||a in s)&&s[a]===n)return t||a||0;return!t&&-1}},zo={includes:Qo(!0),indexOf:Qo(!1)},Po={},_o=ii,Oo=sn,jo=zo.indexOf,qo=Po,$o=We([].push),ts=function(t,e){var n,i=Oo(t),o=0,s=[];for(n in i)!_o(qo,n)&&_o(i,n)&&$o(s,n);for(;e.length>o;)_o(i,n=e[o++])&&(~jo(s,n)||$o(s,n));return s},es=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],ns=ts,is=es,os=Object.keys||function(t){return ns(t,is)},ss={};ss.f=Object.getOwnPropertySymbols;var rs=ke,as=We,ls=He,cs=Ye,gs=os,ds=ss,hs=xe,ms=ti,Is=$e,us=Object.assign,Cs=Object.defineProperty,bs=as([].concat),ps=!us||cs((function(){if(rs&&1!==us({b:1},us(Cs({},"a",{enumerable:!0,get:function(){Cs(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},n=Symbol(),i="abcdefghijklmnopqrst";return t[n]=7,i.split("").forEach((function(t){e[t]=t})),7!=us({},t)[n]||gs(us({},e)).join("")!=i}))?function(t,e){for(var n=ms(t),i=arguments.length,o=1,s=ds.f,r=hs.f;i>o;)for(var a,l=Is(arguments[o++]),c=s?bs(gs(l),s(l)):gs(l),g=c.length,d=0;g>d;)a=c[d++],rs&&!ls(r,l,a)||(n[a]=l[a]);return n}:us,ys=ps;Ao({target:"Object",stat:!0,forced:Object.assign!==ys},{assign:ys});var Zs=ln.Object.assign,Js={},Gs=Ae,Vs=On,Ss=We(Function.toString);Gs(Vs.inspectSource)||(Vs.inspectSource=function(t){return Ss(t)});var Bs,Xs,vs,fs=Vs.inspectSource,Rs=Ae,Ws=fs,As=Ze.WeakMap,ws=Rs(As)&&/native code/.test(Ws(As)),Ys=Dn.exports,ks=li,Fs=Ys("keys"),Hs=function(t){return Fs[t]||(Fs[t]=ks(t))},xs=ws,Ns=Ze,Ts=We,Ms=an,Us=yo,Ks=ii,Es=On,Ls=Hs,Ds=Po,Qs="Object already initialized",zs=Ns.TypeError,Ps=Ns.WeakMap;if(xs||Es.state){var _s=Es.state||(Es.state=new Ps),Os=Ts(_s.get),js=Ts(_s.has),qs=Ts(_s.set);Bs=function(t,e){if(js(_s,t))throw new zs(Qs);return e.facade=t,qs(_s,t,e),e},Xs=function(t){return Os(_s,t)||{}},vs=function(t){return js(_s,t)}}else{var $s=Ls("state");Ds[$s]=!0,Bs=function(t,e){if(Ks(t,$s))throw new zs(Qs);return e.facade=t,Us(t,$s,e),e},Xs=function(t){return Ks(t,$s)?t[$s]:{}},vs=function(t){return Ks(t,$s)}}var tr,er={set:Bs,get:Xs,has:vs,enforce:function(t){return vs(t)?Xs(t):Bs(t,{})},getterFor:function(t){return function(e){var n;if(!Ms(e)||(n=Xs(e)).type!==t)throw zs("Incompatible receiver, "+t+" required");return n}}},nr=ke,ir=ii,or=Function.prototype,sr=nr&&Object.getOwnPropertyDescriptor,rr=ir(or,"name"),ar={EXISTS:rr,PROPER:rr&&"something"===function(){}.name,CONFIGURABLE:rr&&(!nr||nr&&sr(or,"name").configurable)},lr=oo,cr=co,gr=sn,dr=os,hr=ke?Object.defineProperties:function(t,e){cr(t);for(var n,i=gr(e),o=dr(e),s=o.length,r=0;s>r;)lr.f(t,n=o[r++],i[n]);return t},mr=mn("document","documentElement"),Ir=co,ur=hr,Cr=es,br=Po,pr=mr,yr=ki,Zr=Hs("IE_PROTO"),Jr=function(){},Gr=function(t){return"<script>"+t+"<\/script>"},Vr=function(t){t.write(Gr("")),t.close();var e=t.parentWindow.Object;return t=null,e},Sr=function(){try{tr=new ActiveXObject("htmlfile")}catch(t){}var t,e;Sr="undefined"!=typeof document?document.domain&&tr?Vr(tr):((e=yr("iframe")).style.display="none",pr.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(Gr("document.F=Object")),t.close(),t.F):Vr(tr);for(var n=Cr.length;n--;)delete Sr.prototype[Cr[n]];return Sr()};br[Zr]=!0;var Br,Xr,vr,fr=Object.create||function(t,e){var n;return null!==t?(Jr.prototype=Ir(t),n=new Jr,Jr.prototype=null,n[Zr]=t):n=Sr(),void 0===e?n:ur(n,e)},Rr=!Ye((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),Wr=Ze,Ar=ii,wr=Ae,Yr=ti,kr=Rr,Fr=Hs("IE_PROTO"),Hr=Wr.Object,xr=Hr.prototype,Nr=kr?Hr.getPrototypeOf:function(t){var e=Yr(t);if(Ar(e,Fr))return e[Fr];var n=e.constructor;return wr(n)&&e instanceof n?n.prototype:e instanceof Hr?xr:null},Tr=yo,Mr=function(t,e,n,i){i&&i.enumerable?t[e]=n:Tr(t,e,n)},Ur=Ye,Kr=Ae,Er=fr,Lr=Nr,Dr=Mr,Qr=yi("iterator"),zr=!1;[].keys&&("next"in(vr=[].keys())?(Xr=Lr(Lr(vr)))!==Object.prototype&&(Br=Xr):zr=!0);var Pr=null==Br||Ur((function(){var t={};return Br[Qr].call(t)!==t}));Kr((Br=Pr?{}:Er(Br))[Qr])||Dr(Br,Qr,(function(){return this}));var _r={IteratorPrototype:Br,BUGGY_SAFARI_ITERATORS:zr},Or={};Or[yi("toStringTag")]="z";var jr="[object z]"===String(Or),qr=Ze,$r=jr,ta=Ae,ea=ze,na=yi("toStringTag"),ia=qr.Object,oa="Arguments"==ea(function(){return arguments}()),sa=$r?ea:function(t){var e,n,i;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=ia(t),na))?n:oa?ea(e):"Object"==(i=ea(e))&&ta(e.callee)?"Arguments":i},ra=sa,aa=jr?{}.toString:function(){return"[object "+ra(this)+"]"},la=jr,ca=oo.f,ga=yo,da=ii,ha=aa,ma=yi("toStringTag"),Ia=function(t,e,n,i){if(t){var o=n?t:t.prototype;da(o,ma)||ca(o,ma,{configurable:!0,value:e}),i&&!la&&ga(o,"toString",ha)}},ua=_r.IteratorPrototype,Ca=fr,ba=Ee,pa=Ia,ya=Js,Za=function(){return this},Ja=Ze,Ga=Ae,Va=Ja.String,Sa=Ja.TypeError,Ba=We,Xa=co,va=function(t){if("object"==typeof t||Ga(t))return t;throw Sa("Can't set "+Va(t)+" as a prototype")},fa=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=Ba(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(n,[]),e=n instanceof Array}catch(t){}return function(n,i){return Xa(n),va(i),e?t(n,i):n.__proto__=i,n}}():void 0),Ra=Ao,Wa=He,Aa=function(t,e,n){var i=e+" Iterator";return t.prototype=Ca(ua,{next:ba(1,n)}),pa(t,i,!1,!0),ya[i]=Za,t},wa=Nr,Ya=Ia,ka=Mr,Fa=Js,Ha=ar.PROPER,xa=_r.BUGGY_SAFARI_ITERATORS,Na=yi("iterator"),Ta="keys",Ma="values",Ua="entries",Ka=function(){return this},Ea=function(t,e,n,i,o,s,r){Aa(n,e,i);var a,l,c,g=function(t){if(t===o&&u)return u;if(!xa&&t in m)return m[t];switch(t){case Ta:case Ma:case Ua:return function(){return new n(this,t)}}return function(){return new n(this)}},d=e+" Iterator",h=!1,m=t.prototype,I=m[Na]||m["@@iterator"]||o&&m[o],u=!xa&&I||g(o),C="Array"==e&&m.entries||I;if(C&&(a=wa(C.call(new t)))!==Object.prototype&&a.next&&(Ya(a,d,!0,!0),Fa[d]=Ka),Ha&&o==Ma&&I&&I.name!==Ma&&(h=!0,u=function(){return Wa(I,this)}),o)if(l={values:g(Ma),keys:s?u:g(Ta),entries:g(Ua)},r)for(c in l)(xa||h||!(c in m))&&ka(m,c,l[c]);else Ra({target:e,proto:!0,forced:xa||h},l);return r&&m[Na]!==u&&ka(m,Na,u,{name:o}),Fa[e]=u,l},La=sn,Da=Js,Qa=er,za=Ea,Pa="Array Iterator",_a=Qa.set,Oa=Qa.getterFor(Pa);za(Array,"Array",(function(t,e){_a(this,{type:Pa,target:La(t),index:0,kind:e})}),(function(){var t=Oa(this),e=t.target,n=t.kind,i=t.index++;return!e||i>=e.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:i,done:!1}:"values"==n?{value:e[i],done:!1}:{value:[i,e[i]],done:!1}}),"values"),Da.Arguments=Da.Array;var ja={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},qa=Ze,$a=sa,tl=yo,el=Js,nl=yi("toStringTag");for(var il in ja){var ol=qa[il],sl=ol&&ol.prototype;sl&&$a(sl)!==nl&&tl(sl,nl,il),el[il]=el.Array}var rl=ze,al=Array.isArray||function(t){return"Array"==rl(t)},ll=We,cl=Ye,gl=Ae,dl=sa,hl=fs,ml=function(){},Il=[],ul=mn("Reflect","construct"),Cl=/^\s*(?:class|function)\b/,bl=ll(Cl.exec),pl=!Cl.exec(ml),yl=function(t){if(!gl(t))return!1;try{return ul(ml,Il,t),!0}catch(t){return!1}},Zl=!ul||cl((function(){var t;return yl(yl.call)||!yl(Object)||!yl((function(){t=!0}))||t}))?function(t){if(!gl(t))return!1;switch(dl(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}return pl||!!bl(Cl,hl(t))}:yl,Jl=Ze,Gl=al,Vl=Zl,Sl=an,Bl=yi("species"),Xl=Jl.Array,vl=function(t){var e;return Gl(t)&&(e=t.constructor,(Vl(e)&&(e===Xl||Gl(e.prototype))||Sl(e)&&null===(e=e[Bl]))&&(e=void 0)),void 0===e?Xl:e},fl=function(t,e){return new(vl(t))(0===e?0:e)},Rl=io,Wl=$e,Al=ti,wl=Ko,Yl=fl,kl=We([].push),Fl=function(t){var e=1==t,n=2==t,i=3==t,o=4==t,s=6==t,r=7==t,a=5==t||s;return function(l,c,g,d){for(var h,m,I=Al(l),u=Wl(I),C=Rl(c,g),b=wl(u),p=0,y=d||Yl,Z=e?y(l,b):n||r?y(l,0):void 0;b>p;p++)if((a||p in u)&&(m=C(h=u[p],p,I),t))if(e)Z[p]=m;else if(m)switch(t){case 3:return!0;case 5:return h;case 6:return p;case 2:kl(Z,h)}else switch(t){case 4:return!1;case 7:kl(Z,h)}return s?-1:i||o?o:Z}},Hl={forEach:Fl(0),map:Fl(1),filter:Fl(2),some:Fl(3),every:Fl(4),find:Fl(5),findIndex:Fl(6),filterReject:Fl(7)},xl=Ye,Nl=function(t,e){var n=[][t];return!!n&&xl((function(){n.call(null,e||function(){throw 1},1)}))},Tl=Hl.forEach,Ml=Nl("forEach")?[].forEach:function(t){return Tl(this,t,arguments.length>1?arguments[1]:void 0)};Ao({target:"Array",proto:!0,forced:[].forEach!=Ml},{forEach:Ml});var Ul=ln,Kl=function(t){return Ul[t+"Prototype"]},El=Kl("Array").forEach,Ll=sa,Dl=ii,Ql=In,zl=El,Pl=Array.prototype,_l={DOMTokenList:!0,NodeList:!0},Ol=function(t){var e=t.forEach;return t===Pl||Ql(Pl,t)&&e===Pl.forEach||Dl(_l,Ll(t))?zl:e};const jl=0,ql=1,$l=2,tc=0,ec=1,nc=2,ic=3,oc=100,sc=1e3,rc=1001,ac=1002,lc=1003,cc=1004,gc=1005,dc=1006,hc=1008,mc=1009,Ic=1012,uc=1014,Cc=1015,bc=1016,pc=1020,yc=1022,Zc=1023,Jc=1026,Gc=1027,Vc=2200,Sc=2300,Bc=2301,Xc=2302,vc=2400,fc=2401,Rc=2402,Wc=2500,Ac=3e3,wc=3001,Yc=7680,kc=35044,Fc=35048,Hc="300 es";class xc{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const n=this._listeners[t];if(void 0!==n){const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const n=e.slice(0);for(let e=0,i=n.length;e<i;e++)n[e].call(this,t);t.target=null}}}const Nc=[];for(let jL=0;jL<256;jL++)Nc[jL]=(jL<16?"0":"")+jL.toString(16);let Tc=1234567;const Mc=Math.PI/180,Uc=180/Math.PI;function Kc(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Nc[255&t]+Nc[t>>8&255]+Nc[t>>16&255]+Nc[t>>24&255]+"-"+Nc[255&e]+Nc[e>>8&255]+"-"+Nc[e>>16&15|64]+Nc[e>>24&255]+"-"+Nc[63&n|128]+Nc[n>>8&255]+"-"+Nc[n>>16&255]+Nc[n>>24&255]+Nc[255&i]+Nc[i>>8&255]+Nc[i>>16&255]+Nc[i>>24&255]).toUpperCase()}function Ec(t,e,n){return Math.max(e,Math.min(n,t))}function Lc(t,e){return(t%e+e)%e}function Dc(t,e,n){return(1-n)*t+n*e}function Qc(t){return 0==(t&t-1)&&0!==t}function zc(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Pc(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}var _c=Object.freeze({__proto__:null,DEG2RAD:Mc,RAD2DEG:Uc,generateUUID:Kc,clamp:Ec,euclideanModulo:Lc,mapLinear:function(t,e,n,i,o){return i+(t-e)*(o-i)/(n-e)},inverseLerp:function(t,e,n){return t!==e?(n-t)/(e-t):0},lerp:Dc,damp:function(t,e,n,i){return Dc(t,e,1-Math.exp(-n*i))},pingpong:function(t,e=1){return e-Math.abs(Lc(t,2*e)-e)},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){return void 0!==t&&(Tc=t%2147483647),Tc=16807*Tc%2147483647,(Tc-1)/2147483646},degToRad:function(t){return t*Mc},radToDeg:function(t){return t*Uc},isPowerOfTwo:Qc,ceilPowerOfTwo:zc,floorPowerOfTwo:Pc,setQuaternionFromProperEuler:function(t,e,n,i,o){const s=Math.cos,r=Math.sin,a=s(n/2),l=r(n/2),c=s((e+i)/2),g=r((e+i)/2),d=s((e-i)/2),h=r((e-i)/2),m=s((i-e)/2),I=r((i-e)/2);switch(o){case"XYX":t.set(a*g,l*d,l*h,a*c);break;case"YZY":t.set(l*h,a*g,l*d,a*c);break;case"ZXZ":t.set(l*d,l*h,a*g,a*c);break;case"XZX":t.set(a*g,l*I,l*m,a*c);break;case"YXY":t.set(l*m,a*g,l*I,a*c);break;case"ZYZ":t.set(l*I,l*m,a*g,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+o)}}});class Oc{constructor(t=0,e=0){this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6],this.y=i[1]*e+i[4]*n+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),i=Math.sin(e),o=this.x-t.x,s=this.y-t.y;return this.x=o*n-s*i+t.x,this.y=o*i+s*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}Oc.prototype.isVector2=!0;class jc{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,i,o,s,r,a,l){const c=this.elements;return c[0]=t,c[1]=i,c[2]=r,c[3]=e,c[4]=o,c[5]=a,c[6]=n,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,o=this.elements,s=n[0],r=n[3],a=n[6],l=n[1],c=n[4],g=n[7],d=n[2],h=n[5],m=n[8],I=i[0],u=i[3],C=i[6],b=i[1],p=i[4],y=i[7],Z=i[2],J=i[5],G=i[8];return o[0]=s*I+r*b+a*Z,o[3]=s*u+r*p+a*J,o[6]=s*C+r*y+a*G,o[1]=l*I+c*b+g*Z,o[4]=l*u+c*p+g*J,o[7]=l*C+c*y+g*G,o[2]=d*I+h*b+m*Z,o[5]=d*u+h*p+m*J,o[8]=d*C+h*y+m*G,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],i=t[2],o=t[3],s=t[4],r=t[5],a=t[6],l=t[7],c=t[8];return e*s*c-e*r*l-n*o*c+n*r*a+i*o*l-i*s*a}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],o=t[3],s=t[4],r=t[5],a=t[6],l=t[7],c=t[8],g=c*s-r*l,d=r*a-c*o,h=l*o-s*a,m=e*g+n*d+i*h;if(0===m)return this.set(0,0,0,0,0,0,0,0,0);const I=1/m;return t[0]=g*I,t[1]=(i*l-c*n)*I,t[2]=(r*n-i*s)*I,t[3]=d*I,t[4]=(c*e-i*a)*I,t[5]=(i*o-r*e)*I,t[6]=h*I,t[7]=(n*a-l*e)*I,t[8]=(s*e-n*o)*I,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,i,o,s,r){const a=Math.cos(o),l=Math.sin(o);return this.set(n*a,n*l,-n*(a*s+l*r)+s+t,-i*l,i*a,-i*(-l*s+a*r)+r+e,0,0,1),this}scale(t,e){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this}rotate(t){const e=Math.cos(t),n=Math.sin(t),i=this.elements,o=i[0],s=i[3],r=i[6],a=i[1],l=i[4],c=i[7];return i[0]=e*o+n*a,i[3]=e*s+n*l,i[6]=e*r+n*c,i[1]=-n*o+e*a,i[4]=-n*s+e*l,i[7]=-n*r+e*c,this}translate(t,e){const n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this}equals(t){const e=this.elements,n=t.elements;for(let i=0;i<9;i++)if(e[i]!==n[i])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}let qc;jc.prototype.isMatrix3=!0;class $c{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===qc&&(qc=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),qc.width=t.width,qc.height=t.height;const n=qc.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=qc}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}}let tg=0;class eg extends xc{constructor(t=eg.DEFAULT_IMAGE,e=eg.DEFAULT_MAPPING,n=1001,i=1001,o=1006,s=1008,r=1023,a=1009,l=1,c=3e3){super(),Object.defineProperty(this,"id",{value:tg++}),this.uuid=Kc(),this.name="",this.image=t,this.mipmaps=[],this.mapping=e,this.wrapS=n,this.wrapT=i,this.magFilter=o,this.minFilter=s,this.anisotropy=l,this.format=r,this.internalFormat=null,this.type=a,this.offset=new Oc(0,0),this.repeat=new Oc(1,1),this.center=new Oc(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new jc,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.version=0,this.onUpdate=null}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const i=this.image;if(void 0===i.uuid&&(i.uuid=Kc()),!e&&void 0===t.images[i.uuid]){let e;if(Array.isArray(i)){e=[];for(let t=0,n=i.length;t<n;t++)i[t].isDataTexture?e.push(ng(i[t].image)):e.push(ng(i[t]))}else e=ng(i);t.images[i.uuid]={uuid:i.uuid,url:e}}n.image=i.uuid}return e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case sc:t.x=t.x-Math.floor(t.x);break;case rc:t.x=t.x<0?0:1;break;case ac:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case sc:t.y=t.y-Math.floor(t.y);break;case rc:t.y=t.y<0?0:1;break;case ac:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&this.version++}}function ng(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?$c.getDataURL(t):t.data?{data:Array.prototype.slice.call(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}eg.DEFAULT_IMAGE=void 0,eg.DEFAULT_MAPPING=300,eg.prototype.isTexture=!0;class ig{constructor(t=0,e=0,n=0,i=1){this.x=t,this.y=e,this.z=n,this.w=i}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,o=this.w,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*i+s[12]*o,this.y=s[1]*e+s[5]*n+s[9]*i+s[13]*o,this.z=s[2]*e+s[6]*n+s[10]*i+s[14]*o,this.w=s[3]*e+s[7]*n+s[11]*i+s[15]*o,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,i,o;const s=.01,r=.1,a=t.elements,l=a[0],c=a[4],g=a[8],d=a[1],h=a[5],m=a[9],I=a[2],u=a[6],C=a[10];if(Math.abs(c-d)<s&&Math.abs(g-I)<s&&Math.abs(m-u)<s){if(Math.abs(c+d)<r&&Math.abs(g+I)<r&&Math.abs(m+u)<r&&Math.abs(l+h+C-3)<r)return this.set(1,0,0,0),this;e=Math.PI;const t=(l+1)/2,a=(h+1)/2,b=(C+1)/2,p=(c+d)/4,y=(g+I)/4,Z=(m+u)/4;return t>a&&t>b?t<s?(n=0,i=.707106781,o=.707106781):(n=Math.sqrt(t),i=p/n,o=y/n):a>b?a<s?(n=.707106781,i=0,o=.707106781):(i=Math.sqrt(a),n=p/i,o=Z/i):b<s?(n=.707106781,i=.707106781,o=0):(o=Math.sqrt(b),n=y/o,i=Z/o),this.set(n,i,o,e),this}let b=Math.sqrt((u-m)*(u-m)+(g-I)*(g-I)+(d-c)*(d-c));return Math.abs(b)<.001&&(b=1),this.x=(u-m)/b,this.y=(g-I)/b,this.z=(d-c)/b,this.w=Math.acos((l+h+C-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}ig.prototype.isVector4=!0;class og extends xc{constructor(t,e,n={}){super(),this.width=t,this.height=e,this.depth=1,this.scissor=new ig(0,0,t,e),this.scissorTest=!1,this.viewport=new ig(0,0,t,e),this.texture=new eg(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={width:t,height:e,depth:1},this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:dc,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}setTexture(t){t.image={width:this.width,height:this.height,depth:this.depth},this.texture=t}setSize(t,e,n=1){this.width===t&&this.height===e&&this.depth===n||(this.width=t,this.height=e,this.depth=n,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}og.prototype.isWebGLRenderTarget=!0,class extends og{constructor(t,e,n){super(t,e);const i=this.texture;this.texture=[];for(let o=0;o<n;o++)this.texture[o]=i.clone()}setSize(t,e,n=1){if(this.width!==t||this.height!==e||this.depth!==n){this.width=t,this.height=e,this.depth=n;for(let i=0,o=this.texture.length;i<o;i++)this.texture[i].image.width=t,this.texture[i].image.height=e,this.texture[i].image.depth=n;this.dispose()}return this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e),this}copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this.texture.length=0;for(let e=0,n=t.texture.length;e<n;e++)this.texture[e]=t.texture[e].clone();return this}}.prototype.isWebGLMultipleRenderTargets=!0;class sg extends og{constructor(t,e,n){super(t,e,n),this.samples=4}copy(t){return super.copy.call(this,t),this.samples=t.samples,this}}sg.prototype.isWebGLMultisampleRenderTarget=!0;class rg{constructor(t=0,e=0,n=0,i=1){this._x=t,this._y=e,this._z=n,this._w=i}static slerp(t,e,n,i){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(t,e,i)}static slerpFlat(t,e,n,i,o,s,r){let a=n[i+0],l=n[i+1],c=n[i+2],g=n[i+3];const d=o[s+0],h=o[s+1],m=o[s+2],I=o[s+3];if(0===r)return t[e+0]=a,t[e+1]=l,t[e+2]=c,void(t[e+3]=g);if(1===r)return t[e+0]=d,t[e+1]=h,t[e+2]=m,void(t[e+3]=I);if(g!==I||a!==d||l!==h||c!==m){let t=1-r;const e=a*d+l*h+c*m+g*I,n=e>=0?1:-1,i=1-e*e;if(i>Number.EPSILON){const o=Math.sqrt(i),s=Math.atan2(o,e*n);t=Math.sin(t*s)/o,r=Math.sin(r*s)/o}const o=r*n;if(a=a*t+d*o,l=l*t+h*o,c=c*t+m*o,g=g*t+I*o,t===1-r){const t=1/Math.sqrt(a*a+l*l+c*c+g*g);a*=t,l*=t,c*=t,g*=t}}t[e]=a,t[e+1]=l,t[e+2]=c,t[e+3]=g}static multiplyQuaternionsFlat(t,e,n,i,o,s){const r=n[i],a=n[i+1],l=n[i+2],c=n[i+3],g=o[s],d=o[s+1],h=o[s+2],m=o[s+3];return t[e]=r*m+c*g+a*h-l*d,t[e+1]=a*m+c*d+l*g-r*h,t[e+2]=l*m+c*h+r*d-a*g,t[e+3]=c*m-r*g-a*d-l*h,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,i){return this._x=t,this._y=e,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=t._x,i=t._y,o=t._z,s=t._order,r=Math.cos,a=Math.sin,l=r(n/2),c=r(i/2),g=r(o/2),d=a(n/2),h=a(i/2),m=a(o/2);switch(s){case"XYZ":this._x=d*c*g+l*h*m,this._y=l*h*g-d*c*m,this._z=l*c*m+d*h*g,this._w=l*c*g-d*h*m;break;case"YXZ":this._x=d*c*g+l*h*m,this._y=l*h*g-d*c*m,this._z=l*c*m-d*h*g,this._w=l*c*g+d*h*m;break;case"ZXY":this._x=d*c*g-l*h*m,this._y=l*h*g+d*c*m,this._z=l*c*m+d*h*g,this._w=l*c*g-d*h*m;break;case"ZYX":this._x=d*c*g-l*h*m,this._y=l*h*g+d*c*m,this._z=l*c*m-d*h*g,this._w=l*c*g+d*h*m;break;case"YZX":this._x=d*c*g+l*h*m,this._y=l*h*g+d*c*m,this._z=l*c*m-d*h*g,this._w=l*c*g-d*h*m;break;case"XZY":this._x=d*c*g-l*h*m,this._y=l*h*g-d*c*m,this._z=l*c*m+d*h*g,this._w=l*c*g+d*h*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,i=Math.sin(n);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],i=e[4],o=e[8],s=e[1],r=e[5],a=e[9],l=e[2],c=e[6],g=e[10],d=n+r+g;if(d>0){const t=.5/Math.sqrt(d+1);this._w=.25/t,this._x=(c-a)*t,this._y=(o-l)*t,this._z=(s-i)*t}else if(n>r&&n>g){const t=2*Math.sqrt(1+n-r-g);this._w=(c-a)/t,this._x=.25*t,this._y=(i+s)/t,this._z=(o+l)/t}else if(r>g){const t=2*Math.sqrt(1+r-n-g);this._w=(o-l)/t,this._x=(i+s)/t,this._y=.25*t,this._z=(a+c)/t}else{const t=2*Math.sqrt(1+g-n-r);this._w=(s-i)/t,this._x=(o+l)/t,this._y=(a+c)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Ec(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(0===n)return this;const i=Math.min(1,e/n);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,i=t._y,o=t._z,s=t._w,r=e._x,a=e._y,l=e._z,c=e._w;return this._x=n*c+s*r+i*l-o*a,this._y=i*c+s*a+o*r-n*l,this._z=o*c+s*l+n*a-i*r,this._w=s*c-n*r-i*a-o*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const n=this._x,i=this._y,o=this._z,s=this._w;let r=s*t._w+n*t._x+i*t._y+o*t._z;if(r<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,r=-r):this.copy(t),r>=1)return this._w=s,this._x=n,this._y=i,this._z=o,this;const a=1-r*r;if(a<=Number.EPSILON){const t=1-e;return this._w=t*s+e*this._w,this._x=t*n+e*this._x,this._y=t*i+e*this._y,this._z=t*o+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),c=Math.atan2(l,r),g=Math.sin((1-e)*c)/l,d=Math.sin(e*c)/l;return this._w=s*g+this._w*d,this._x=n*g+this._x*d,this._y=i*g+this._y*d,this._z=o*g+this._z*d,this._onChangeCallback(),this}slerpQuaternions(t,e,n){this.copy(t).slerp(e,n)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}rg.prototype.isQuaternion=!0;class ag{constructor(t=0,e=0,n=0){this.x=t,this.y=e,this.z=n}set(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(cg.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(cg.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,i=this.z,o=t.elements;return this.x=o[0]*e+o[3]*n+o[6]*i,this.y=o[1]*e+o[4]*n+o[7]*i,this.z=o[2]*e+o[5]*n+o[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,o=t.elements,s=1/(o[3]*e+o[7]*n+o[11]*i+o[15]);return this.x=(o[0]*e+o[4]*n+o[8]*i+o[12])*s,this.y=(o[1]*e+o[5]*n+o[9]*i+o[13])*s,this.z=(o[2]*e+o[6]*n+o[10]*i+o[14])*s,this}applyQuaternion(t){const e=this.x,n=this.y,i=this.z,o=t.x,s=t.y,r=t.z,a=t.w,l=a*e+s*i-r*n,c=a*n+r*e-o*i,g=a*i+o*n-s*e,d=-o*e-s*n-r*i;return this.x=l*a+d*-o+c*-r-g*-s,this.y=c*a+d*-s+g*-o-l*-r,this.z=g*a+d*-r+l*-s-c*-o,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,i=this.z,o=t.elements;return this.x=o[0]*e+o[4]*n+o[8]*i,this.y=o[1]*e+o[5]*n+o[9]*i,this.z=o[2]*e+o[6]*n+o[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,i=t.y,o=t.z,s=e.x,r=e.y,a=e.z;return this.x=i*a-o*r,this.y=o*s-n*a,this.z=n*r-i*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return lg.copy(this).projectOnVector(t),this.sub(lg)}reflect(t){return this.sub(lg.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(Ec(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return e*e+n*n+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const i=Math.sin(e)*t;return this.x=i*Math.sin(n),this.y=Math.cos(e)*t,this.z=i*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}ag.prototype.isVector3=!0;const lg=new ag,cg=new rg;class gg{constructor(t=new ag(1/0,1/0,1/0),e=new ag(-1/0,-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,n=1/0,i=1/0,o=-1/0,s=-1/0,r=-1/0;for(let a=0,l=t.length;a<l;a+=3){const l=t[a],c=t[a+1],g=t[a+2];l<e&&(e=l),c<n&&(n=c),g<i&&(i=g),l>o&&(o=l),c>s&&(s=c),g>r&&(r=g)}return this.min.set(e,n,i),this.max.set(o,s,r),this}setFromBufferAttribute(t){let e=1/0,n=1/0,i=1/0,o=-1/0,s=-1/0,r=-1/0;for(let a=0,l=t.count;a<l;a++){const l=t.getX(a),c=t.getY(a),g=t.getZ(a);l<e&&(e=l),c<n&&(n=c),g<i&&(i=g),l>o&&(o=l),c>s&&(s=c),g>r&&(r=g)}return this.min.set(e,n,i),this.max.set(o,s,r),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=hg.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t){return this.makeEmpty(),this.expandByObject(t)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t){t.updateWorldMatrix(!1,!1);const e=t.geometry;void 0!==e&&(null===e.boundingBox&&e.computeBoundingBox(),mg.copy(e.boundingBox),mg.applyMatrix4(t.matrixWorld),this.union(mg));const n=t.children;for(let i=0,o=n.length;i<o;i++)this.expandByObject(n[i]);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,hg),hg.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Zg),Jg.subVectors(this.max,Zg),Ig.subVectors(t.a,Zg),ug.subVectors(t.b,Zg),Cg.subVectors(t.c,Zg),bg.subVectors(ug,Ig),pg.subVectors(Cg,ug),yg.subVectors(Ig,Cg);let e=[0,-bg.z,bg.y,0,-pg.z,pg.y,0,-yg.z,yg.y,bg.z,0,-bg.x,pg.z,0,-pg.x,yg.z,0,-yg.x,-bg.y,bg.x,0,-pg.y,pg.x,0,-yg.y,yg.x,0];return!!Sg(e,Ig,ug,Cg,Jg)&&(e=[1,0,0,0,1,0,0,0,1],!!Sg(e,Ig,ug,Cg,Jg)&&(Gg.crossVectors(bg,pg),e=[Gg.x,Gg.y,Gg.z],Sg(e,Ig,ug,Cg,Jg)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return hg.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=.5*this.getSize(hg).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(dg[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),dg[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),dg[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),dg[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),dg[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),dg[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),dg[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),dg[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(dg)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}gg.prototype.isBox3=!0;const dg=[new ag,new ag,new ag,new ag,new ag,new ag,new ag,new ag],hg=new ag,mg=new gg,Ig=new ag,ug=new ag,Cg=new ag,bg=new ag,pg=new ag,yg=new ag,Zg=new ag,Jg=new ag,Gg=new ag,Vg=new ag;function Sg(t,e,n,i,o){for(let s=0,r=t.length-3;s<=r;s+=3){Vg.fromArray(t,s);const r=o.x*Math.abs(Vg.x)+o.y*Math.abs(Vg.y)+o.z*Math.abs(Vg.z),a=e.dot(Vg),l=n.dot(Vg),c=i.dot(Vg);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>r)return!1}return!0}const Bg=new gg,Xg=new ag,vg=new ag,fg=new ag;class Rg{constructor(t=new ag,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const n=this.center;void 0!==e?n.copy(e):Bg.setFromPoints(t).getCenter(n);let i=0;for(let o=0,s=t.length;o<s;o++)i=Math.max(i,n.distanceToSquared(t[o]));return this.radius=Math.sqrt(i),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){fg.subVectors(t,this.center);const e=fg.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),n=.5*(t-this.radius);this.center.add(fg.multiplyScalar(n/t)),this.radius+=n}return this}union(t){return vg.subVectors(t.center,this.center).normalize().multiplyScalar(t.radius),this.expandByPoint(Xg.copy(t.center).add(vg)),this.expandByPoint(Xg.copy(t.center).sub(vg)),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Wg=new ag,Ag=new ag,wg=new ag,Yg=new ag,kg=new ag,Fg=new ag,Hg=new ag;class xg{constructor(t=new ag,e=new ag(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Wg)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=Wg.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Wg.copy(this.direction).multiplyScalar(e).add(this.origin),Wg.distanceToSquared(t))}distanceSqToSegment(t,e,n,i){Ag.copy(t).add(e).multiplyScalar(.5),wg.copy(e).sub(t).normalize(),Yg.copy(this.origin).sub(Ag);const o=.5*t.distanceTo(e),s=-this.direction.dot(wg),r=Yg.dot(this.direction),a=-Yg.dot(wg),l=Yg.lengthSq(),c=Math.abs(1-s*s);let g,d,h,m;if(c>0)if(g=s*a-r,d=s*r-a,m=o*c,g>=0)if(d>=-m)if(d<=m){const t=1/c;g*=t,d*=t,h=g*(g+s*d+2*r)+d*(s*g+d+2*a)+l}else d=o,g=Math.max(0,-(s*d+r)),h=-g*g+d*(d+2*a)+l;else d=-o,g=Math.max(0,-(s*d+r)),h=-g*g+d*(d+2*a)+l;else d<=-m?(g=Math.max(0,-(-s*o+r)),d=g>0?-o:Math.min(Math.max(-o,-a),o),h=-g*g+d*(d+2*a)+l):d<=m?(g=0,d=Math.min(Math.max(-o,-a),o),h=d*(d+2*a)+l):(g=Math.max(0,-(s*o+r)),d=g>0?o:Math.min(Math.max(-o,-a),o),h=-g*g+d*(d+2*a)+l);else d=s>0?-o:o,g=Math.max(0,-(s*d+r)),h=-g*g+d*(d+2*a)+l;return n&&n.copy(this.direction).multiplyScalar(g).add(this.origin),i&&i.copy(wg).multiplyScalar(d).add(Ag),h}intersectSphere(t,e){Wg.subVectors(t.center,this.origin);const n=Wg.dot(this.direction),i=Wg.dot(Wg)-n*n,o=t.radius*t.radius;if(i>o)return null;const s=Math.sqrt(o-i),r=n-s,a=n+s;return r<0&&a<0?null:r<0?this.at(a,e):this.at(r,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){const n=this.distanceToPlane(t);return null===n?null:this.at(n,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,i,o,s,r,a;const l=1/this.direction.x,c=1/this.direction.y,g=1/this.direction.z,d=this.origin;return l>=0?(n=(t.min.x-d.x)*l,i=(t.max.x-d.x)*l):(n=(t.max.x-d.x)*l,i=(t.min.x-d.x)*l),c>=0?(o=(t.min.y-d.y)*c,s=(t.max.y-d.y)*c):(o=(t.max.y-d.y)*c,s=(t.min.y-d.y)*c),n>s||o>i?null:((o>n||n!=n)&&(n=o),(s<i||i!=i)&&(i=s),g>=0?(r=(t.min.z-d.z)*g,a=(t.max.z-d.z)*g):(r=(t.max.z-d.z)*g,a=(t.min.z-d.z)*g),n>a||r>i?null:((r>n||n!=n)&&(n=r),(a<i||i!=i)&&(i=a),i<0?null:this.at(n>=0?n:i,e)))}intersectsBox(t){return null!==this.intersectBox(t,Wg)}intersectTriangle(t,e,n,i,o){kg.subVectors(e,t),Fg.subVectors(n,t),Hg.crossVectors(kg,Fg);let s,r=this.direction.dot(Hg);if(r>0){if(i)return null;s=1}else{if(!(r<0))return null;s=-1,r=-r}Yg.subVectors(this.origin,t);const a=s*this.direction.dot(Fg.crossVectors(Yg,Fg));if(a<0)return null;const l=s*this.direction.dot(kg.cross(Yg));if(l<0)return null;if(a+l>r)return null;const c=-s*Yg.dot(Hg);return c<0?null:this.at(c/r,o)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Ng{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,i,o,s,r,a,l,c,g,d,h,m,I,u){const C=this.elements;return C[0]=t,C[4]=e,C[8]=n,C[12]=i,C[1]=o,C[5]=s,C[9]=r,C[13]=a,C[2]=l,C[6]=c,C[10]=g,C[14]=d,C[3]=h,C[7]=m,C[11]=I,C[15]=u,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Ng).fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,i=1/Tg.setFromMatrixColumn(t,0).length(),o=1/Tg.setFromMatrixColumn(t,1).length(),s=1/Tg.setFromMatrixColumn(t,2).length();return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=0,e[4]=n[4]*o,e[5]=n[5]*o,e[6]=n[6]*o,e[7]=0,e[8]=n[8]*s,e[9]=n[9]*s,e[10]=n[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,n=t.x,i=t.y,o=t.z,s=Math.cos(n),r=Math.sin(n),a=Math.cos(i),l=Math.sin(i),c=Math.cos(o),g=Math.sin(o);if("XYZ"===t.order){const t=s*c,n=s*g,i=r*c,o=r*g;e[0]=a*c,e[4]=-a*g,e[8]=l,e[1]=n+i*l,e[5]=t-o*l,e[9]=-r*a,e[2]=o-t*l,e[6]=i+n*l,e[10]=s*a}else if("YXZ"===t.order){const t=a*c,n=a*g,i=l*c,o=l*g;e[0]=t+o*r,e[4]=i*r-n,e[8]=s*l,e[1]=s*g,e[5]=s*c,e[9]=-r,e[2]=n*r-i,e[6]=o+t*r,e[10]=s*a}else if("ZXY"===t.order){const t=a*c,n=a*g,i=l*c,o=l*g;e[0]=t-o*r,e[4]=-s*g,e[8]=i+n*r,e[1]=n+i*r,e[5]=s*c,e[9]=o-t*r,e[2]=-s*l,e[6]=r,e[10]=s*a}else if("ZYX"===t.order){const t=s*c,n=s*g,i=r*c,o=r*g;e[0]=a*c,e[4]=i*l-n,e[8]=t*l+o,e[1]=a*g,e[5]=o*l+t,e[9]=n*l-i,e[2]=-l,e[6]=r*a,e[10]=s*a}else if("YZX"===t.order){const t=s*a,n=s*l,i=r*a,o=r*l;e[0]=a*c,e[4]=o-t*g,e[8]=i*g+n,e[1]=g,e[5]=s*c,e[9]=-r*c,e[2]=-l*c,e[6]=n*g+i,e[10]=t-o*g}else if("XZY"===t.order){const t=s*a,n=s*l,i=r*a,o=r*l;e[0]=a*c,e[4]=-g,e[8]=l*c,e[1]=t*g+o,e[5]=s*c,e[9]=n*g-i,e[2]=i*g-n,e[6]=r*c,e[10]=o*g+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Ug,t,Kg)}lookAt(t,e,n){const i=this.elements;return Dg.subVectors(t,e),0===Dg.lengthSq()&&(Dg.z=1),Dg.normalize(),Eg.crossVectors(n,Dg),0===Eg.lengthSq()&&(1===Math.abs(n.z)?Dg.x+=1e-4:Dg.z+=1e-4,Dg.normalize(),Eg.crossVectors(n,Dg)),Eg.normalize(),Lg.crossVectors(Dg,Eg),i[0]=Eg.x,i[4]=Lg.x,i[8]=Dg.x,i[1]=Eg.y,i[5]=Lg.y,i[9]=Dg.y,i[2]=Eg.z,i[6]=Lg.z,i[10]=Dg.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,o=this.elements,s=n[0],r=n[4],a=n[8],l=n[12],c=n[1],g=n[5],d=n[9],h=n[13],m=n[2],I=n[6],u=n[10],C=n[14],b=n[3],p=n[7],y=n[11],Z=n[15],J=i[0],G=i[4],V=i[8],S=i[12],B=i[1],X=i[5],v=i[9],f=i[13],R=i[2],W=i[6],A=i[10],w=i[14],Y=i[3],k=i[7],F=i[11],H=i[15];return o[0]=s*J+r*B+a*R+l*Y,o[4]=s*G+r*X+a*W+l*k,o[8]=s*V+r*v+a*A+l*F,o[12]=s*S+r*f+a*w+l*H,o[1]=c*J+g*B+d*R+h*Y,o[5]=c*G+g*X+d*W+h*k,o[9]=c*V+g*v+d*A+h*F,o[13]=c*S+g*f+d*w+h*H,o[2]=m*J+I*B+u*R+C*Y,o[6]=m*G+I*X+u*W+C*k,o[10]=m*V+I*v+u*A+C*F,o[14]=m*S+I*f+u*w+C*H,o[3]=b*J+p*B+y*R+Z*Y,o[7]=b*G+p*X+y*W+Z*k,o[11]=b*V+p*v+y*A+Z*F,o[15]=b*S+p*f+y*w+Z*H,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],i=t[8],o=t[12],s=t[1],r=t[5],a=t[9],l=t[13],c=t[2],g=t[6],d=t[10],h=t[14];return t[3]*(+o*a*g-i*l*g-o*r*d+n*l*d+i*r*h-n*a*h)+t[7]*(+e*a*h-e*l*d+o*s*d-i*s*h+i*l*c-o*a*c)+t[11]*(+e*l*g-e*r*h-o*s*g+n*s*h+o*r*c-n*l*c)+t[15]*(-i*r*c-e*a*g+e*r*d+i*s*g-n*s*d+n*a*c)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],o=t[3],s=t[4],r=t[5],a=t[6],l=t[7],c=t[8],g=t[9],d=t[10],h=t[11],m=t[12],I=t[13],u=t[14],C=t[15],b=g*u*l-I*d*l+I*a*h-r*u*h-g*a*C+r*d*C,p=m*d*l-c*u*l-m*a*h+s*u*h+c*a*C-s*d*C,y=c*I*l-m*g*l+m*r*h-s*I*h-c*r*C+s*g*C,Z=m*g*a-c*I*a-m*r*d+s*I*d+c*r*u-s*g*u,J=e*b+n*p+i*y+o*Z;if(0===J)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const G=1/J;return t[0]=b*G,t[1]=(I*d*o-g*u*o-I*i*h+n*u*h+g*i*C-n*d*C)*G,t[2]=(r*u*o-I*a*o+I*i*l-n*u*l-r*i*C+n*a*C)*G,t[3]=(g*a*o-r*d*o-g*i*l+n*d*l+r*i*h-n*a*h)*G,t[4]=p*G,t[5]=(c*u*o-m*d*o+m*i*h-e*u*h-c*i*C+e*d*C)*G,t[6]=(m*a*o-s*u*o-m*i*l+e*u*l+s*i*C-e*a*C)*G,t[7]=(s*d*o-c*a*o+c*i*l-e*d*l-s*i*h+e*a*h)*G,t[8]=y*G,t[9]=(m*g*o-c*I*o-m*n*h+e*I*h+c*n*C-e*g*C)*G,t[10]=(s*I*o-m*r*o+m*n*l-e*I*l-s*n*C+e*r*C)*G,t[11]=(c*r*o-s*g*o-c*n*l+e*g*l+s*n*h-e*r*h)*G,t[12]=Z*G,t[13]=(c*I*i-m*g*i+m*n*d-e*I*d-c*n*u+e*g*u)*G,t[14]=(m*r*i-s*I*i-m*n*a+e*I*a+s*n*u-e*r*u)*G,t[15]=(s*g*i-c*r*i+c*n*a-e*g*a-s*n*d+e*r*d)*G,this}scale(t){const e=this.elements,n=t.x,i=t.y,o=t.z;return e[0]*=n,e[4]*=i,e[8]*=o,e[1]*=n,e[5]*=i,e[9]*=o,e[2]*=n,e[6]*=i,e[10]*=o,e[3]*=n,e[7]*=i,e[11]*=o,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,i))}makeTranslation(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),i=Math.sin(e),o=1-n,s=t.x,r=t.y,a=t.z,l=o*s,c=o*r;return this.set(l*s+n,l*r-i*a,l*a+i*r,0,l*r+i*a,c*r+n,c*a-i*s,0,l*a-i*r,c*a+i*s,o*a*a+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,i,o,s){return this.set(1,n,o,0,t,1,s,0,e,i,1,0,0,0,0,1),this}compose(t,e,n){const i=this.elements,o=e._x,s=e._y,r=e._z,a=e._w,l=o+o,c=s+s,g=r+r,d=o*l,h=o*c,m=o*g,I=s*c,u=s*g,C=r*g,b=a*l,p=a*c,y=a*g,Z=n.x,J=n.y,G=n.z;return i[0]=(1-(I+C))*Z,i[1]=(h+y)*Z,i[2]=(m-p)*Z,i[3]=0,i[4]=(h-y)*J,i[5]=(1-(d+C))*J,i[6]=(u+b)*J,i[7]=0,i[8]=(m+p)*G,i[9]=(u-b)*G,i[10]=(1-(d+I))*G,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,n){const i=this.elements;let o=Tg.set(i[0],i[1],i[2]).length();const s=Tg.set(i[4],i[5],i[6]).length(),r=Tg.set(i[8],i[9],i[10]).length();this.determinant()<0&&(o=-o),t.x=i[12],t.y=i[13],t.z=i[14],Mg.copy(this);const a=1/o,l=1/s,c=1/r;return Mg.elements[0]*=a,Mg.elements[1]*=a,Mg.elements[2]*=a,Mg.elements[4]*=l,Mg.elements[5]*=l,Mg.elements[6]*=l,Mg.elements[8]*=c,Mg.elements[9]*=c,Mg.elements[10]*=c,e.setFromRotationMatrix(Mg),n.x=o,n.y=s,n.z=r,this}makePerspective(t,e,n,i,o,s){void 0===s&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const r=this.elements,a=2*o/(e-t),l=2*o/(n-i),c=(e+t)/(e-t),g=(n+i)/(n-i),d=-(s+o)/(s-o),h=-2*s*o/(s-o);return r[0]=a,r[4]=0,r[8]=c,r[12]=0,r[1]=0,r[5]=l,r[9]=g,r[13]=0,r[2]=0,r[6]=0,r[10]=d,r[14]=h,r[3]=0,r[7]=0,r[11]=-1,r[15]=0,this}makeOrthographic(t,e,n,i,o,s){const r=this.elements,a=1/(e-t),l=1/(n-i),c=1/(s-o),g=(e+t)*a,d=(n+i)*l,h=(s+o)*c;return r[0]=2*a,r[4]=0,r[8]=0,r[12]=-g,r[1]=0,r[5]=2*l,r[9]=0,r[13]=-d,r[2]=0,r[6]=0,r[10]=-2*c,r[14]=-h,r[3]=0,r[7]=0,r[11]=0,r[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let i=0;i<16;i++)if(e[i]!==n[i])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}Ng.prototype.isMatrix4=!0;const Tg=new ag,Mg=new Ng,Ug=new ag(0,0,0),Kg=new ag(1,1,1),Eg=new ag,Lg=new ag,Dg=new ag,Qg=new Ng,zg=new rg;class Pg{constructor(t=0,e=0,n=0,i=Pg.DefaultOrder){this._x=t,this._y=e,this._z=n,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,i=this._order){return this._x=t,this._y=e,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,n=!0){const i=t.elements,o=i[0],s=i[4],r=i[8],a=i[1],l=i[5],c=i[9],g=i[2],d=i[6],h=i[10];switch(e){case"XYZ":this._y=Math.asin(Ec(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(-c,h),this._z=Math.atan2(-s,o)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Ec(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(r,h),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-g,o),this._z=0);break;case"ZXY":this._x=Math.asin(Ec(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-g,h),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(a,o));break;case"ZYX":this._y=Math.asin(-Ec(g,-1,1)),Math.abs(g)<.9999999?(this._x=Math.atan2(d,h),this._z=Math.atan2(a,o)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(Ec(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-g,o)):(this._x=0,this._y=Math.atan2(r,h));break;case"XZY":this._z=Math.asin(-Ec(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(d,l),this._y=Math.atan2(r,o)):(this._x=Math.atan2(-c,h),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===n&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return Qg.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Qg,e,n)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return zg.setFromEuler(this),this.setFromQuaternion(zg,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}toVector3(t){return t?t.set(this._x,this._y,this._z):new ag(this._x,this._y,this._z)}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}Pg.prototype.isEuler=!0,Pg.DefaultOrder="XYZ",Pg.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class _g{constructor(){this.mask=1}set(t){this.mask=1<<t|0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}}let Og=0;const jg=new ag,qg=new rg,$g=new Ng,td=new ag,ed=new ag,nd=new ag,id=new rg,od=new ag(1,0,0),sd=new ag(0,1,0),rd=new ag(0,0,1),ad={type:"added"},ld={type:"removed"};class cd extends xc{constructor(){super(),Object.defineProperty(this,"id",{value:Og++}),this.uuid=Kc(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=cd.DefaultUp.clone();const t=new ag,e=new Pg,n=new rg,i=new ag(1,1,1);e._onChange((function(){n.setFromEuler(e,!1)})),n._onChange((function(){e.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Ng},normalMatrix:{value:new jc}}),this.matrix=new Ng,this.matrixWorld=new Ng,this.matrixAutoUpdate=cd.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new _g,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return qg.setFromAxisAngle(t,e),this.quaternion.multiply(qg),this}rotateOnWorldAxis(t,e){return qg.setFromAxisAngle(t,e),this.quaternion.premultiply(qg),this}rotateX(t){return this.rotateOnAxis(od,t)}rotateY(t){return this.rotateOnAxis(sd,t)}rotateZ(t){return this.rotateOnAxis(rd,t)}translateOnAxis(t,e){return jg.copy(t).applyQuaternion(this.quaternion),this.position.add(jg.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(od,t)}translateY(t){return this.translateOnAxis(sd,t)}translateZ(t){return this.translateOnAxis(rd,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4($g.copy(this.matrixWorld).invert())}lookAt(t,e,n){t.isVector3?td.copy(t):td.set(t,e,n);const i=this.parent;this.updateWorldMatrix(!0,!1),ed.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?$g.lookAt(ed,td,this.up):$g.lookAt(td,ed,this.up),this.quaternion.setFromRotationMatrix($g),i&&($g.extractRotation(i.matrixWorld),qg.setFromRotationMatrix($g),this.quaternion.premultiply(qg.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(ad)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(ld)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(ld)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),$g.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),$g.multiply(t.parent.matrixWorld)),t.applyMatrix4($g),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(t,e);if(void 0!==i)return i}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ed,t,nd),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ed,id,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].updateMatrixWorld(t)}updateWorldMatrix(t,e){const n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,n=t.length;e<n;e++)t[e].updateWorldMatrix(!1,!0)}}toJSON(t){const e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const i={};function o(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&(i.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=o(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const n=e.shapes;if(Array.isArray(n))for(let e=0,i=n.length;e<i;e++){const i=n[e];o(t.shapes,i)}else o(t.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(o(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let n=0,i=this.material.length;n<i;n++)e.push(o(t.materials,this.material[n]));i.material=e}else i.material=o(t.materials,this.material);if(this.children.length>0){i.children=[];for(let e=0;e<this.children.length;e++)i.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){i.animations=[];for(let e=0;e<this.animations.length;e++){const n=this.animations[e];i.animations.push(o(t.animations,n))}}if(e){const e=s(t.geometries),i=s(t.materials),o=s(t.textures),r=s(t.images),a=s(t.shapes),l=s(t.skeletons),c=s(t.animations);e.length>0&&(n.geometries=e),i.length>0&&(n.materials=i),o.length>0&&(n.textures=o),r.length>0&&(n.images=r),a.length>0&&(n.shapes=a),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c)}return n.object=i,n;function s(t){const e=[];for(const n in t){const i=t[n];delete i.metadata,e.push(i)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let n=0;n<t.children.length;n++){const e=t.children[n];this.add(e.clone())}return this}}cd.DefaultUp=new ag(0,1,0),cd.DefaultMatrixAutoUpdate=!0,cd.prototype.isObject3D=!0;const gd=new ag,dd=new ag,hd=new ag,md=new ag,Id=new ag,ud=new ag,Cd=new ag,bd=new ag,pd=new ag,yd=new ag;class Zd{constructor(t=new ag,e=new ag,n=new ag){this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,i){i.subVectors(n,e),gd.subVectors(t,e),i.cross(gd);const o=i.lengthSq();return o>0?i.multiplyScalar(1/Math.sqrt(o)):i.set(0,0,0)}static getBarycoord(t,e,n,i,o){gd.subVectors(i,e),dd.subVectors(n,e),hd.subVectors(t,e);const s=gd.dot(gd),r=gd.dot(dd),a=gd.dot(hd),l=dd.dot(dd),c=dd.dot(hd),g=s*l-r*r;if(0===g)return o.set(-2,-1,-1);const d=1/g,h=(l*a-r*c)*d,m=(s*c-r*a)*d;return o.set(1-h-m,m,h)}static containsPoint(t,e,n,i){return this.getBarycoord(t,e,n,i,md),md.x>=0&&md.y>=0&&md.x+md.y<=1}static getUV(t,e,n,i,o,s,r,a){return this.getBarycoord(t,e,n,i,md),a.set(0,0),a.addScaledVector(o,md.x),a.addScaledVector(s,md.y),a.addScaledVector(r,md.z),a}static isFrontFacing(t,e,n,i){return gd.subVectors(n,e),dd.subVectors(t,e),gd.cross(dd).dot(i)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,i){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[i]),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return gd.subVectors(this.c,this.b),dd.subVectors(this.a,this.b),.5*gd.cross(dd).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Zd.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return Zd.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,n,i,o){return Zd.getUV(t,this.a,this.b,this.c,e,n,i,o)}containsPoint(t){return Zd.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Zd.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const n=this.a,i=this.b,o=this.c;let s,r;Id.subVectors(i,n),ud.subVectors(o,n),bd.subVectors(t,n);const a=Id.dot(bd),l=ud.dot(bd);if(a<=0&&l<=0)return e.copy(n);pd.subVectors(t,i);const c=Id.dot(pd),g=ud.dot(pd);if(c>=0&&g<=c)return e.copy(i);const d=a*g-c*l;if(d<=0&&a>=0&&c<=0)return s=a/(a-c),e.copy(n).addScaledVector(Id,s);yd.subVectors(t,o);const h=Id.dot(yd),m=ud.dot(yd);if(m>=0&&h<=m)return e.copy(o);const I=h*l-a*m;if(I<=0&&l>=0&&m<=0)return r=l/(l-m),e.copy(n).addScaledVector(ud,r);const u=c*m-h*g;if(u<=0&&g-c>=0&&h-m>=0)return Cd.subVectors(o,i),r=(g-c)/(g-c+(h-m)),e.copy(i).addScaledVector(Cd,r);const C=1/(u+I+d);return s=I*C,r=d*C,e.copy(n).addScaledVector(Id,s).addScaledVector(ud,r)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let Jd=0;class Gd extends xc{constructor(){super(),Object.defineProperty(this,"id",{value:Jd++}),this.uuid=Kc(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=oc,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Yc,this.stencilZFail=Yc,this.stencilZPass=Yc,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}onBuild(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const n=t[e];if(void 0===n){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if("shading"===e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;continue}const i=this[e];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[e]=n:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(t){const e=[];for(const n in t){const i=t[n];delete i.metadata,e.push(i)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e){const e=i(t.textures),o=i(t.images);e.length>0&&(n.textures=e),o.length>0&&(n.images=o)}return n}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(null!==e){const t=e.length;n=new Array(t);for(let i=0;i!==t;++i)n[i]=e[i].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}Gd.prototype.isMaterial=!0;const Vd={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Sd={h:0,s:0,l:0},Bd={h:0,s:0,l:0};function Xd(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}function vd(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function fd(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}class Rd{constructor(t,e,n){return void 0===e&&void 0===n?this.set(t):this.setRGB(t,e,n)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this}setRGB(t,e,n){return this.r=t,this.g=e,this.b=n,this}setHSL(t,e,n){if(t=Lc(t,1),e=Ec(e,0,1),n=Ec(n,0,1),0===e)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+e):n+e-n*e,o=2*n-i;this.r=Xd(o,i,t+1/3),this.g=Xd(o,i,t),this.b=Xd(o,i,t-1/3)}return this}setStyle(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let t;const i=n[1],o=n[2];switch(i){case"rgb":case"rgba":if(t=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,e(t[4]),this;if(t=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,e(t[4]),this;break;case"hsl":case"hsla":if(t=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){const n=parseFloat(t[1])/360,i=parseInt(t[2],10)/100,o=parseInt(t[3],10)/100;return e(t[4]),this.setHSL(n,i,o)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){const t=n[1],e=t.length;if(3===e)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,this;if(6===e)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this}setColorName(t){const e=Vd[t.toLowerCase()];return void 0!==e?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copyGammaToLinear(t,e=2){return this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this}copyLinearToGamma(t,e=2){const n=e>0?1/e:1;return this.r=Math.pow(t.r,n),this.g=Math.pow(t.g,n),this.b=Math.pow(t.b,n),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.r=vd(t.r),this.g=vd(t.g),this.b=vd(t.b),this}copyLinearToSRGB(t){return this.r=fd(t.r),this.g=fd(t.g),this.b=fd(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(t){const e=this.r,n=this.g,i=this.b,o=Math.max(e,n,i),s=Math.min(e,n,i);let r,a;const l=(s+o)/2;if(s===o)r=0,a=0;else{const t=o-s;switch(a=l<=.5?t/(o+s):t/(2-o-s),o){case e:r=(n-i)/t+(n<i?6:0);break;case n:r=(i-e)/t+2;break;case i:r=(e-n)/t+4}r/=6}return t.h=r,t.s=a,t.l=l,t}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(t,e,n){return this.getHSL(Sd),Sd.h+=t,Sd.s+=e,Sd.l+=n,this.setHSL(Sd.h,Sd.s,Sd.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(Sd),t.getHSL(Bd);const n=Dc(Sd.h,Bd.h,e),i=Dc(Sd.s,Bd.s,e),o=Dc(Sd.l,Bd.l,e);return this.setHSL(n,i,o),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}Rd.NAMES=Vd,Rd.prototype.isColor=!0,Rd.prototype.r=1,Rd.prototype.g=1,Rd.prototype.b=1;class Wd extends Gd{constructor(t){super(),this.type="MeshBasicMaterial",this.color=new Rd(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.morphTargets=t.morphTargets,this}}Wd.prototype.isMeshBasicMaterial=!0;const Ad=new ag,wd=new Oc;class Yd{constructor(t,e,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===n,this.usage=kc,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let i=0,o=this.itemSize;i<o;i++)this.array[t+i]=e.array[n+i];return this}copyArray(t){return this.array.set(t),this}copyColorsArray(t){const e=this.array;let n=0;for(let i=0,o=t.length;i<o;i++){let o=t[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),o=new Rd),e[n++]=o.r,e[n++]=o.g,e[n++]=o.b}return this}copyVector2sArray(t){const e=this.array;let n=0;for(let i=0,o=t.length;i<o;i++){let o=t[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),o=new Oc),e[n++]=o.x,e[n++]=o.y}return this}copyVector3sArray(t){const e=this.array;let n=0;for(let i=0,o=t.length;i<o;i++){let o=t[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),o=new ag),e[n++]=o.x,e[n++]=o.y,e[n++]=o.z}return this}copyVector4sArray(t){const e=this.array;let n=0;for(let i=0,o=t.length;i<o;i++){let o=t[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),o=new ig),e[n++]=o.x,e[n++]=o.y,e[n++]=o.z,e[n++]=o.w}return this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,n=this.count;e<n;e++)wd.fromBufferAttribute(this,e),wd.applyMatrix3(t),this.setXY(e,wd.x,wd.y);else if(3===this.itemSize)for(let e=0,n=this.count;e<n;e++)Ad.fromBufferAttribute(this,e),Ad.applyMatrix3(t),this.setXYZ(e,Ad.x,Ad.y,Ad.z);return this}applyMatrix4(t){for(let e=0,n=this.count;e<n;e++)Ad.x=this.getX(e),Ad.y=this.getY(e),Ad.z=this.getZ(e),Ad.applyMatrix4(t),this.setXYZ(e,Ad.x,Ad.y,Ad.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)Ad.x=this.getX(e),Ad.y=this.getY(e),Ad.z=this.getZ(e),Ad.applyNormalMatrix(t),this.setXYZ(e,Ad.x,Ad.y,Ad.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)Ad.x=this.getX(e),Ad.y=this.getY(e),Ad.z=this.getZ(e),Ad.transformDirection(t),this.setXYZ(e,Ad.x,Ad.y,Ad.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){return this.array[t*this.itemSize]}setX(t,e){return this.array[t*this.itemSize]=e,this}getY(t){return this.array[t*this.itemSize+1]}setY(t,e){return this.array[t*this.itemSize+1]=e,this}getZ(t){return this.array[t*this.itemSize+2]}setZ(t,e){return this.array[t*this.itemSize+2]=e,this}getW(t){return this.array[t*this.itemSize+3]}setW(t,e){return this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this}setXYZW(t,e,n,i,o){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this.array[t+3]=o,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==kc&&(t.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(t.updateRange=this.updateRange),t}}Yd.prototype.isBufferAttribute=!0;class kd extends Yd{constructor(t,e,n){super(new Uint16Array(t),e,n)}}class Fd extends Yd{constructor(t,e,n){super(new Uint32Array(t),e,n)}}(class extends Yd{constructor(t,e,n){super(new Uint16Array(t),e,n)}}).prototype.isFloat16BufferAttribute=!0;class Hd extends Yd{constructor(t,e,n){super(new Float32Array(t),e,n)}}function xd(t){if(0===t.length)return-1/0;let e=t[0];for(let n=1,i=t.length;n<i;++n)t[n]>e&&(e=t[n]);return e}let Nd=0;const Td=new Ng,Md=new cd,Ud=new ag,Kd=new gg,Ed=new gg,Ld=new ag;class Dd extends xc{constructor(){super(),Object.defineProperty(this,"id",{value:Nd++}),this.uuid=Kc(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(xd(t)>65535?Fd:kd)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,n=0){this.groups.push({start:t,count:e,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const e=(new jc).getNormalMatrix(t);n.applyNormalMatrix(e),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(t),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return Td.makeRotationFromQuaternion(t),this.applyMatrix4(Td),this}rotateX(t){return Td.makeRotationX(t),this.applyMatrix4(Td),this}rotateY(t){return Td.makeRotationY(t),this.applyMatrix4(Td),this}rotateZ(t){return Td.makeRotationZ(t),this.applyMatrix4(Td),this}translate(t,e,n){return Td.makeTranslation(t,e,n),this.applyMatrix4(Td),this}scale(t,e,n){return Td.makeScale(t,e,n),this.applyMatrix4(Td),this}lookAt(t){return Md.lookAt(t),Md.updateMatrix(),this.applyMatrix4(Md.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ud).negate(),this.translate(Ud.x,Ud.y,Ud.z),this}setFromPoints(t){const e=[];for(let n=0,i=t.length;n<i;n++){const i=t[n];e.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new Hd(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new gg);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new ag(-1/0,-1/0,-1/0),new ag(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let n=0,i=e.length;n<i;n++){const t=e[n];Kd.setFromBufferAttribute(t),this.morphTargetsRelative?(Ld.addVectors(this.boundingBox.min,Kd.min),this.boundingBox.expandByPoint(Ld),Ld.addVectors(this.boundingBox.max,Kd.max),this.boundingBox.expandByPoint(Ld)):(this.boundingBox.expandByPoint(Kd.min),this.boundingBox.expandByPoint(Kd.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Rg);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new ag,1/0);if(t){const n=this.boundingSphere.center;if(Kd.setFromBufferAttribute(t),e)for(let t=0,o=e.length;t<o;t++){const n=e[t];Ed.setFromBufferAttribute(n),this.morphTargetsRelative?(Ld.addVectors(Kd.min,Ed.min),Kd.expandByPoint(Ld),Ld.addVectors(Kd.max,Ed.max),Kd.expandByPoint(Ld)):(Kd.expandByPoint(Ed.min),Kd.expandByPoint(Ed.max))}Kd.getCenter(n);let i=0;for(let e=0,o=t.count;e<o;e++)Ld.fromBufferAttribute(t,e),i=Math.max(i,n.distanceToSquared(Ld));if(e)for(let o=0,s=e.length;o<s;o++){const s=e[o],r=this.morphTargetsRelative;for(let e=0,o=s.count;e<o;e++)Ld.fromBufferAttribute(s,e),r&&(Ud.fromBufferAttribute(t,e),Ld.add(Ud)),i=Math.max(i,n.distanceToSquared(Ld))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeFaceNormals(){}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=t.array,i=e.position.array,o=e.normal.array,s=e.uv.array,r=i.length/3;void 0===e.tangent&&this.setAttribute("tangent",new Yd(new Float32Array(4*r),4));const a=e.tangent.array,l=[],c=[];for(let B=0;B<r;B++)l[B]=new ag,c[B]=new ag;const g=new ag,d=new ag,h=new ag,m=new Oc,I=new Oc,u=new Oc,C=new ag,b=new ag;function p(t,e,n){g.fromArray(i,3*t),d.fromArray(i,3*e),h.fromArray(i,3*n),m.fromArray(s,2*t),I.fromArray(s,2*e),u.fromArray(s,2*n),d.sub(g),h.sub(g),I.sub(m),u.sub(m);const o=1/(I.x*u.y-u.x*I.y);isFinite(o)&&(C.copy(d).multiplyScalar(u.y).addScaledVector(h,-I.y).multiplyScalar(o),b.copy(h).multiplyScalar(I.x).addScaledVector(d,-u.x).multiplyScalar(o),l[t].add(C),l[e].add(C),l[n].add(C),c[t].add(b),c[e].add(b),c[n].add(b))}let y=this.groups;0===y.length&&(y=[{start:0,count:n.length}]);for(let B=0,X=y.length;B<X;++B){const t=y[B],e=t.start;for(let i=e,o=e+t.count;i<o;i+=3)p(n[i+0],n[i+1],n[i+2])}const Z=new ag,J=new ag,G=new ag,V=new ag;function S(t){G.fromArray(o,3*t),V.copy(G);const e=l[t];Z.copy(e),Z.sub(G.multiplyScalar(G.dot(e))).normalize(),J.crossVectors(V,e);const n=J.dot(c[t])<0?-1:1;a[4*t]=Z.x,a[4*t+1]=Z.y,a[4*t+2]=Z.z,a[4*t+3]=n}for(let B=0,X=y.length;B<X;++B){const t=y[B],e=t.start;for(let i=e,o=e+t.count;i<o;i+=3)S(n[i+0]),S(n[i+1]),S(n[i+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let n=this.getAttribute("normal");if(void 0===n)n=new Yd(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(let t=0,e=n.count;t<e;t++)n.setXYZ(t,0,0,0);const i=new ag,o=new ag,s=new ag,r=new ag,a=new ag,l=new ag,c=new ag,g=new ag;if(t)for(let d=0,h=t.count;d<h;d+=3){const h=t.getX(d+0),m=t.getX(d+1),I=t.getX(d+2);i.fromBufferAttribute(e,h),o.fromBufferAttribute(e,m),s.fromBufferAttribute(e,I),c.subVectors(s,o),g.subVectors(i,o),c.cross(g),r.fromBufferAttribute(n,h),a.fromBufferAttribute(n,m),l.fromBufferAttribute(n,I),r.add(c),a.add(c),l.add(c),n.setXYZ(h,r.x,r.y,r.z),n.setXYZ(m,a.x,a.y,a.z),n.setXYZ(I,l.x,l.y,l.z)}else for(let t=0,d=e.count;t<d;t+=3)i.fromBufferAttribute(e,t+0),o.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),c.subVectors(s,o),g.subVectors(i,o),c.cross(g),n.setXYZ(t+0,c.x,c.y,c.z),n.setXYZ(t+1,c.x,c.y,c.z),n.setXYZ(t+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(t,e){if(!t||!t.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const i in n){if(void 0===t.attributes[i])continue;const o=n[i].array,s=t.attributes[i],r=s.array,a=s.itemSize*e,l=Math.min(r.length,o.length-a);for(let t=0,e=a;t<l;t++,e++)o[e]=r[t]}return this}normalizeNormals(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)Ld.fromBufferAttribute(t,e),Ld.normalize(),t.setXYZ(e,Ld.x,Ld.y,Ld.z)}toNonIndexed(){function t(t,e){const n=t.array,i=t.itemSize,o=t.normalized,s=new n.constructor(e.length*i);let r=0,a=0;for(let l=0,c=e.length;l<c;l++){r=t.isInterleavedBufferAttribute?e[l]*t.data.stride+t.offset:e[l]*i;for(let t=0;t<i;t++)s[a++]=n[r++]}return new Yd(s,i,o)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new Dd,n=this.index.array,i=this.attributes;for(const r in i){const o=t(i[r],n);e.setAttribute(r,o)}const o=this.morphAttributes;for(const r in o){const i=[],s=o[r];for(let e=0,o=s.length;e<o;e++){const o=t(s[e],n);i.push(o)}e.morphAttributes[r]=i}e.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let r=0,a=s.length;r<a;r++){const t=s[r];e.addGroup(t.start,t.count,t.materialIndex)}return e}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const a in n){const e=n[a];t.data.attributes[a]=e.toJSON(t.data)}const i={};let o=!1;for(const a in this.morphAttributes){const e=this.morphAttributes[a],n=[];for(let i=0,o=e.length;i<o;i++){const o=e[i];n.push(o.toJSON(t.data))}n.length>0&&(i[a]=n,o=!0)}o&&(t.data.morphAttributes=i,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const r=this.boundingSphere;return null!==r&&(t.data.boundingSphere={center:r.center.toArray(),radius:r.radius}),t}clone(){return(new Dd).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;null!==n&&this.setIndex(n.clone(e));const i=t.attributes;for(const l in i){const t=i[l];this.setAttribute(l,t.clone(e))}const o=t.morphAttributes;for(const l in o){const t=[],n=o[l];for(let i=0,o=n.length;i<o;i++)t.push(n[i].clone(e));this.morphAttributes[l]=t}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let l=0,c=s.length;l<c;l++){const t=s[l];this.addGroup(t.start,t.count,t.materialIndex)}const r=t.boundingBox;null!==r&&(this.boundingBox=r.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}Dd.prototype.isBufferGeometry=!0;const Qd=new Ng,zd=new xg,Pd=new Rg,_d=new ag,Od=new ag,jd=new ag,qd=new ag,$d=new ag,th=new ag,eh=new ag,nh=new ag,ih=new ag,oh=new Oc,sh=new Oc,rh=new Oc,ah=new ag,lh=new ag;class ch extends cd{constructor(t=new Dd,e=new Wd){super(),this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(t,e){const n=this.geometry,i=this.material,o=this.matrixWorld;if(void 0===i)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),Pd.copy(n.boundingSphere),Pd.applyMatrix4(o),!1===t.ray.intersectsSphere(Pd))return;if(Qd.copy(o).invert(),zd.copy(t.ray).applyMatrix4(Qd),null!==n.boundingBox&&!1===zd.intersectsBox(n.boundingBox))return;let s;if(n.isBufferGeometry){const o=n.index,r=n.attributes.position,a=n.morphAttributes.position,l=n.morphTargetsRelative,c=n.attributes.uv,g=n.attributes.uv2,d=n.groups,h=n.drawRange;if(null!==o)if(Array.isArray(i))for(let n=0,m=d.length;n<m;n++){const m=d[n],I=i[m.materialIndex];for(let n=Math.max(m.start,h.start),i=Math.min(m.start+m.count,h.start+h.count);n<i;n+=3){const i=o.getX(n),d=o.getX(n+1),h=o.getX(n+2);s=gh(this,I,t,zd,r,a,l,c,g,i,d,h),s&&(s.faceIndex=Math.floor(n/3),s.face.materialIndex=m.materialIndex,e.push(s))}}else for(let n=Math.max(0,h.start),m=Math.min(o.count,h.start+h.count);n<m;n+=3){const d=o.getX(n),h=o.getX(n+1),m=o.getX(n+2);s=gh(this,i,t,zd,r,a,l,c,g,d,h,m),s&&(s.faceIndex=Math.floor(n/3),e.push(s))}else if(void 0!==r)if(Array.isArray(i))for(let n=0,m=d.length;n<m;n++){const o=d[n],m=i[o.materialIndex];for(let n=Math.max(o.start,h.start),i=Math.min(o.start+o.count,h.start+h.count);n<i;n+=3)s=gh(this,m,t,zd,r,a,l,c,g,n,n+1,n+2),s&&(s.faceIndex=Math.floor(n/3),s.face.materialIndex=o.materialIndex,e.push(s))}else for(let n=Math.max(0,h.start),m=Math.min(r.count,h.start+h.count);n<m;n+=3)s=gh(this,i,t,zd,r,a,l,c,g,n,n+1,n+2),s&&(s.faceIndex=Math.floor(n/3),e.push(s))}else n.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function gh(t,e,n,i,o,s,r,a,l,c,g,d){_d.fromBufferAttribute(o,c),Od.fromBufferAttribute(o,g),jd.fromBufferAttribute(o,d);const h=t.morphTargetInfluences;if(e.morphTargets&&s&&h){eh.set(0,0,0),nh.set(0,0,0),ih.set(0,0,0);for(let t=0,e=s.length;t<e;t++){const e=h[t],n=s[t];0!==e&&(qd.fromBufferAttribute(n,c),$d.fromBufferAttribute(n,g),th.fromBufferAttribute(n,d),r?(eh.addScaledVector(qd,e),nh.addScaledVector($d,e),ih.addScaledVector(th,e)):(eh.addScaledVector(qd.sub(_d),e),nh.addScaledVector($d.sub(Od),e),ih.addScaledVector(th.sub(jd),e)))}_d.add(eh),Od.add(nh),jd.add(ih)}t.isSkinnedMesh&&(t.boneTransform(c,_d),t.boneTransform(g,Od),t.boneTransform(d,jd));const m=function(t,e,n,i,o,s,r,a){let l;if(l=1===e.side?i.intersectTriangle(r,s,o,!0,a):i.intersectTriangle(o,s,r,2!==e.side,a),null===l)return null;lh.copy(a),lh.applyMatrix4(t.matrixWorld);const c=n.ray.origin.distanceTo(lh);return c<n.near||c>n.far?null:{distance:c,point:lh.clone(),object:t}}(t,e,n,i,_d,Od,jd,ah);if(m){a&&(oh.fromBufferAttribute(a,c),sh.fromBufferAttribute(a,g),rh.fromBufferAttribute(a,d),m.uv=Zd.getUV(ah,_d,Od,jd,oh,sh,rh,new Oc)),l&&(oh.fromBufferAttribute(l,c),sh.fromBufferAttribute(l,g),rh.fromBufferAttribute(l,d),m.uv2=Zd.getUV(ah,_d,Od,jd,oh,sh,rh,new Oc));const t={a:c,b:g,c:d,normal:new ag,materialIndex:0};Zd.getNormal(_d,Od,jd,t.normal),m.face=t}return m}ch.prototype.isMesh=!0;class dh extends Dd{constructor(t=1,e=1,n=1,i=1,o=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:i,heightSegments:o,depthSegments:s};const r=this;i=Math.floor(i),o=Math.floor(o),s=Math.floor(s);const a=[],l=[],c=[],g=[];let d=0,h=0;function m(t,e,n,i,o,s,m,I,u,C,b){const p=s/u,y=m/C,Z=s/2,J=m/2,G=I/2,V=u+1,S=C+1;let B=0,X=0;const v=new ag;for(let r=0;r<S;r++){const s=r*y-J;for(let a=0;a<V;a++){const d=a*p-Z;v[t]=d*i,v[e]=s*o,v[n]=G,l.push(v.x,v.y,v.z),v[t]=0,v[e]=0,v[n]=I>0?1:-1,c.push(v.x,v.y,v.z),g.push(a/u),g.push(1-r/C),B+=1}}for(let r=0;r<C;r++)for(let t=0;t<u;t++){const e=d+t+V*r,n=d+t+V*(r+1),i=d+(t+1)+V*(r+1),o=d+(t+1)+V*r;a.push(e,n,o),a.push(n,i,o),X+=6}r.addGroup(h,X,b),h+=X,d+=B}m("z","y","x",-1,-1,n,e,t,s,o,0),m("z","y","x",1,-1,n,e,-t,s,o,1),m("x","z","y",1,1,t,n,e,i,s,2),m("x","z","y",1,-1,t,n,-e,i,s,3),m("x","y","z",1,-1,t,e,n,i,o,4),m("x","y","z",-1,-1,t,e,-n,i,o,5),this.setIndex(a),this.setAttribute("position",new Hd(l,3)),this.setAttribute("normal",new Hd(c,3)),this.setAttribute("uv",new Hd(g,2))}static fromJSON(t){return new dh(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function hh(t){const e={};for(const n in t){e[n]={};for(const i in t[n]){const o=t[n][i];o&&(o.isColor||o.isMatrix3||o.isMatrix4||o.isVector2||o.isVector3||o.isVector4||o.isTexture||o.isQuaternion)?e[n][i]=o.clone():Array.isArray(o)?e[n][i]=o.slice():e[n][i]=o}}return e}function mh(t){const e={};for(let n=0;n<t.length;n++){const i=hh(t[n]);for(const t in i)e[t]=i[t]}return e}const Ih={clone:hh,merge:mh};class uh extends Gd{constructor(t){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=hh(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?e.uniforms[i]={type:"t",value:n.toJSON(t).uuid}:n&&n.isColor?e.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?e.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?e.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?e.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?e.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?e.uniforms[i]={type:"m4",value:n.toArray()}:e.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const n={};for(const i in this.extensions)!0===this.extensions[i]&&(n[i]=!0);return Object.keys(n).length>0&&(e.extensions=n),e}}uh.prototype.isShaderMaterial=!0;class Ch extends cd{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new Ng,this.projectionMatrix=new Ng,this.projectionMatrixInverse=new Ng}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}Ch.prototype.isCamera=!0;class bh extends Ch{constructor(t=50,e=1,n=.1,i=2e3){super(),this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*Uc*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*Mc*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*Uc*Math.atan(Math.tan(.5*Mc*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,n,i,o,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=o,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*Mc*this.fov)/this.zoom,n=2*e,i=this.aspect*n,o=-.5*i;const s=this.view;if(null!==this.view&&this.view.enabled){const t=s.fullWidth,r=s.fullHeight;o+=s.offsetX*i/t,e-=s.offsetY*n/r,i*=s.width/t,n*=s.height/r}const r=this.filmOffset;0!==r&&(o+=t*r/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+i,e,e-n,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}bh.prototype.isPerspectiveCamera=!0;const ph=90;class yh extends cd{constructor(t,e,n){if(super(),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;const i=new bh(ph,1,t,e);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new ag(1,0,0)),this.add(i);const o=new bh(ph,1,t,e);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new ag(-1,0,0)),this.add(o);const s=new bh(ph,1,t,e);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new ag(0,1,0)),this.add(s);const r=new bh(ph,1,t,e);r.layers=this.layers,r.up.set(0,0,-1),r.lookAt(new ag(0,-1,0)),this.add(r);const a=new bh(ph,1,t,e);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new ag(0,0,1)),this.add(a);const l=new bh(ph,1,t,e);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new ag(0,0,-1)),this.add(l)}update(t,e){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget,[i,o,s,r,a,l]=this.children,c=t.xr.enabled,g=t.getRenderTarget();t.xr.enabled=!1;const d=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0),t.render(e,i),t.setRenderTarget(n,1),t.render(e,o),t.setRenderTarget(n,2),t.render(e,s),t.setRenderTarget(n,3),t.render(e,r),t.setRenderTarget(n,4),t.render(e,a),n.texture.generateMipmaps=d,t.setRenderTarget(n,5),t.render(e,l),t.setRenderTarget(g),t.xr.enabled=c}}class Zh extends eg{constructor(t,e,n,i,o,s,r,a,l,c){super(t=void 0!==t?t:[],e=void 0!==e?e:301,n,i,o,s,r=void 0!==r?r:yc,a,l,c),this._needsFlipEnvMap=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}Zh.prototype.isCubeTexture=!0;class Jh extends og{constructor(t,e,n){Number.isInteger(e)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),e=n),super(t,t,e),e=e||{},this.texture=new Zh(void 0,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:dc,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.format=Zc,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},i=new dh(5,5,5),o=new uh({name:"CubemapFromEquirect",uniforms:hh(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:1,blending:0});o.uniforms.tEquirect.value=e;const s=new ch(i,o),r=e.minFilter;return e.minFilter===hc&&(e.minFilter=dc),new yh(1,10,this).update(t,s),e.minFilter=r,s.geometry.dispose(),s.material.dispose(),this}clear(t,e,n,i){const o=t.getRenderTarget();for(let s=0;s<6;s++)t.setRenderTarget(this,s),t.clear(e,n,i);t.setRenderTarget(o)}}Jh.prototype.isWebGLCubeRenderTarget=!0;const Gh=new ag,Vh=new ag,Sh=new jc;class Bh{constructor(t=new ag(1,0,0),e=0){this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,i){return this.normal.set(t,e,n),this.constant=i,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){const i=Gh.subVectors(n,e).cross(Vh.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){const n=t.delta(Gh),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const o=-(t.start.dot(this.normal)+this.constant)/i;return o<0||o>1?null:e.copy(n).multiplyScalar(o).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const n=e||Sh.getNormalMatrix(t),i=this.coplanarPoint(Gh).applyMatrix4(t),o=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(o),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}Bh.prototype.isPlane=!0;const Xh=new Rg,vh=new ag;class fh{constructor(t=new Bh,e=new Bh,n=new Bh,i=new Bh,o=new Bh,s=new Bh){this.planes=[t,e,n,i,o,s]}set(t,e,n,i,o,s){const r=this.planes;return r[0].copy(t),r[1].copy(e),r[2].copy(n),r[3].copy(i),r[4].copy(o),r[5].copy(s),this}copy(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t){const e=this.planes,n=t.elements,i=n[0],o=n[1],s=n[2],r=n[3],a=n[4],l=n[5],c=n[6],g=n[7],d=n[8],h=n[9],m=n[10],I=n[11],u=n[12],C=n[13],b=n[14],p=n[15];return e[0].setComponents(r-i,g-a,I-d,p-u).normalize(),e[1].setComponents(r+i,g+a,I+d,p+u).normalize(),e[2].setComponents(r+o,g+l,I+h,p+C).normalize(),e[3].setComponents(r-o,g-l,I-h,p-C).normalize(),e[4].setComponents(r-s,g-c,I-m,p-b).normalize(),e[5].setComponents(r+s,g+c,I+m,p+b).normalize(),this}intersectsObject(t){const e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),Xh.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(Xh)}intersectsSprite(t){return Xh.center.set(0,0,0),Xh.radius=.7071067811865476,Xh.applyMatrix4(t.matrixWorld),this.intersectsSphere(Xh)}intersectsSphere(t){const e=this.planes,n=t.center,i=-t.radius;for(let o=0;o<6;o++)if(e[o].distanceToPoint(n)<i)return!1;return!0}intersectsBox(t){const e=this.planes;for(let n=0;n<6;n++){const i=e[n];if(vh.x=i.normal.x>0?t.max.x:t.min.x,vh.y=i.normal.y>0?t.max.y:t.min.y,vh.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(vh)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function Rh(){let t=null,e=!1,n=null,i=null;function o(e,s){n(e,s),i=t.requestAnimationFrame(o)}return{start:function(){!0!==e&&null!==n&&(i=t.requestAnimationFrame(o),e=!0)},stop:function(){t.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(t){n=t},setContext:function(e){t=e}}}function Wh(t,e){const n=e.isWebGL2,i=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),i.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);const n=i.get(e);n&&(t.deleteBuffer(n.buffer),i.delete(e))},update:function(e,o){if(e.isGLBufferAttribute){const t=i.get(e);return void((!t||t.version<e.version)&&i.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}))}e.isInterleavedBufferAttribute&&(e=e.data);const s=i.get(e);void 0===s?i.set(e,function(e,i){const o=e.array,s=e.usage,r=t.createBuffer();t.bindBuffer(i,r),t.bufferData(i,o,s),e.onUploadCallback();let a=5126;return o instanceof Float32Array?a=5126:o instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):o instanceof Uint16Array?e.isFloat16BufferAttribute?n?a=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):a=5123:o instanceof Int16Array?a=5122:o instanceof Uint32Array?a=5125:o instanceof Int32Array?a=5124:o instanceof Int8Array?a=5120:(o instanceof Uint8Array||o instanceof Uint8ClampedArray)&&(a=5121),{buffer:r,type:a,bytesPerElement:o.BYTES_PER_ELEMENT,version:e.version}}(e,o)):s.version<e.version&&(function(e,i,o){const s=i.array,r=i.updateRange;t.bindBuffer(o,e),-1===r.count?t.bufferSubData(o,0,s):(n?t.bufferSubData(o,r.offset*s.BYTES_PER_ELEMENT,s,r.offset,r.count):t.bufferSubData(o,r.offset*s.BYTES_PER_ELEMENT,s.subarray(r.offset,r.offset+r.count)),r.count=-1)}(s.buffer,e,o),s.version=e.version)}}}class Ah extends Dd{constructor(t=1,e=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:i};const o=t/2,s=e/2,r=Math.floor(n),a=Math.floor(i),l=r+1,c=a+1,g=t/r,d=e/a,h=[],m=[],I=[],u=[];for(let C=0;C<c;C++){const t=C*d-s;for(let e=0;e<l;e++){const n=e*g-o;m.push(n,-t,0),I.push(0,0,1),u.push(e/r),u.push(1-C/a)}}for(let C=0;C<a;C++)for(let t=0;t<r;t++){const e=t+l*C,n=t+l*(C+1),i=t+1+l*(C+1),o=t+1+l*C;h.push(e,n,o),h.push(n,i,o)}this.setIndex(h),this.setAttribute("position",new Hd(m,3)),this.setAttribute("normal",new Hd(I,3)),this.setAttribute("uv",new Hd(u,2))}static fromJSON(t){return new Ah(t.width,t.height,t.widthSegments,t.heightSegments)}}const wh={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotVH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSNMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition.xyz / vWorldPosition.w;\n\tvec3 v = normalize( cameraPosition - pos );\n\tfloat ior = ( 1.0 + 0.4 * reflectivity ) / ( 1.0 - 0.4 * reflectivity );\n\tvec3 transmission = transmissionFactor * getIBLVolumeRefraction(\n\t\tnormal, v, roughnessFactor, material.diffuseColor, totalSpecular,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec4 vWorldPosition;\n\tvec3 getVolumeTransmissionRay(vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix) {\n\t\tvec3 refractionVector = refract(-v, normalize(n), 1.0 / ior);\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length(vec3(modelMatrix[0].xyz));\n\t\tmodelScale.y = length(vec3(modelMatrix[1].xyz));\n\t\tmodelScale.z = length(vec3(modelMatrix[2].xyz));\n\t\treturn normalize(refractionVector) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness(float roughness, float ior) {\n\t\treturn roughness * clamp(ior * 2.0 - 2.0, 0.0, 1.0);\n\t}\n\tvec3 getTransmissionSample(vec2 fragCoord, float roughness, float ior) {\n\t\tfloat framebufferLod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness, ior);\n\t\treturn texture2DLodEXT(transmissionSamplerMap, fragCoord.xy, framebufferLod).rgb;\n\t}\n\tvec3 applyVolumeAttenuation(vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance) {\n\t\tif (attenuationDistance == 0.0) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log(attenuationColor) / attenuationDistance;\n\t\t\tvec3 transmittance = exp(-attenuationCoefficient * transmissionDistance);\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec3 getIBLVolumeRefraction(vec3 n, vec3 v, float perceptualRoughness, vec3 baseColor, vec3 specularColor,\n\t\tvec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,\n\t\tvec3 attenuationColor, float attenuationDistance) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay(n, v, thickness, ior, modelMatrix);\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4(refractedRayExit, 1.0);\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec3 transmittedLight = getTransmissionSample(refractionCoords, perceptualRoughness, ior);\n\t\tvec3 attenuatedColor = applyVolumeAttenuation(transmittedLight, length(transmissionRay), attenuationColor, attenuationDistance);\n\t\treturn (1.0 - specularColor) * attenuatedColor * baseColor;\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform vec3 attenuationColor;\n\tuniform float attenuationDistance;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <transmission_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#ifdef USE_TRANSMISSION\n\tvarying vec4 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition;\n#endif\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},Yh={common:{diffuse:{value:new Rd(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new jc},uv2Transform:{value:new jc},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Oc(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Rd(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Rd(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new jc}},sprite:{diffuse:{value:new Rd(16777215)},opacity:{value:1},center:{value:new Oc(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new jc}}},kh={basic:{uniforms:mh([Yh.common,Yh.specularmap,Yh.envmap,Yh.aomap,Yh.lightmap,Yh.fog]),vertexShader:wh.meshbasic_vert,fragmentShader:wh.meshbasic_frag},lambert:{uniforms:mh([Yh.common,Yh.specularmap,Yh.envmap,Yh.aomap,Yh.lightmap,Yh.emissivemap,Yh.fog,Yh.lights,{emissive:{value:new Rd(0)}}]),vertexShader:wh.meshlambert_vert,fragmentShader:wh.meshlambert_frag},phong:{uniforms:mh([Yh.common,Yh.specularmap,Yh.envmap,Yh.aomap,Yh.lightmap,Yh.emissivemap,Yh.bumpmap,Yh.normalmap,Yh.displacementmap,Yh.fog,Yh.lights,{emissive:{value:new Rd(0)},specular:{value:new Rd(1118481)},shininess:{value:30}}]),vertexShader:wh.meshphong_vert,fragmentShader:wh.meshphong_frag},standard:{uniforms:mh([Yh.common,Yh.envmap,Yh.aomap,Yh.lightmap,Yh.emissivemap,Yh.bumpmap,Yh.normalmap,Yh.displacementmap,Yh.roughnessmap,Yh.metalnessmap,Yh.fog,Yh.lights,{emissive:{value:new Rd(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:wh.meshphysical_vert,fragmentShader:wh.meshphysical_frag},toon:{uniforms:mh([Yh.common,Yh.aomap,Yh.lightmap,Yh.emissivemap,Yh.bumpmap,Yh.normalmap,Yh.displacementmap,Yh.gradientmap,Yh.fog,Yh.lights,{emissive:{value:new Rd(0)}}]),vertexShader:wh.meshtoon_vert,fragmentShader:wh.meshtoon_frag},matcap:{uniforms:mh([Yh.common,Yh.bumpmap,Yh.normalmap,Yh.displacementmap,Yh.fog,{matcap:{value:null}}]),vertexShader:wh.meshmatcap_vert,fragmentShader:wh.meshmatcap_frag},points:{uniforms:mh([Yh.points,Yh.fog]),vertexShader:wh.points_vert,fragmentShader:wh.points_frag},dashed:{uniforms:mh([Yh.common,Yh.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:wh.linedashed_vert,fragmentShader:wh.linedashed_frag},depth:{uniforms:mh([Yh.common,Yh.displacementmap]),vertexShader:wh.depth_vert,fragmentShader:wh.depth_frag},normal:{uniforms:mh([Yh.common,Yh.bumpmap,Yh.normalmap,Yh.displacementmap,{opacity:{value:1}}]),vertexShader:wh.normal_vert,fragmentShader:wh.normal_frag},sprite:{uniforms:mh([Yh.sprite,Yh.fog]),vertexShader:wh.sprite_vert,fragmentShader:wh.sprite_frag},background:{uniforms:{uvTransform:{value:new jc},t2D:{value:null}},vertexShader:wh.background_vert,fragmentShader:wh.background_frag},cube:{uniforms:mh([Yh.envmap,{opacity:{value:1}}]),vertexShader:wh.cube_vert,fragmentShader:wh.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:wh.equirect_vert,fragmentShader:wh.equirect_frag},distanceRGBA:{uniforms:mh([Yh.common,Yh.displacementmap,{referencePosition:{value:new ag},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:wh.distanceRGBA_vert,fragmentShader:wh.distanceRGBA_frag},shadow:{uniforms:mh([Yh.lights,Yh.fog,{color:{value:new Rd(0)},opacity:{value:1}}]),vertexShader:wh.shadow_vert,fragmentShader:wh.shadow_frag}};function Fh(t,e,n,i,o){const s=new Rd(0);let r,a,l=0,c=null,g=0,d=null;function h(t,e){n.buffers.color.setClear(t.r,t.g,t.b,e,o)}return{getClearColor:function(){return s},setClearColor:function(t,e=1){s.set(t),l=e,h(s,l)},getClearAlpha:function(){return l},setClearAlpha:function(t){l=t,h(s,l)},render:function(n,o){let m=!1,I=!0===o.isScene?o.background:null;I&&I.isTexture&&(I=e.get(I));const u=t.xr,C=u.getSession&&u.getSession();C&&"additive"===C.environmentBlendMode&&(I=null),null===I?h(s,l):I&&I.isColor&&(h(I,1),m=!0),(t.autoClear||m)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),I&&(I.isCubeTexture||306===I.mapping)?(void 0===a&&(a=new ch(new dh(1,1,1),new uh({name:"BackgroundCubeMaterial",uniforms:hh(kh.cube.uniforms),vertexShader:kh.cube.vertexShader,fragmentShader:kh.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),a.geometry.deleteAttribute("uv"),a.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(a.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(a)),a.material.uniforms.envMap.value=I,a.material.uniforms.flipEnvMap.value=I.isCubeTexture&&I._needsFlipEnvMap?-1:1,c===I&&g===I.version&&d===t.toneMapping||(a.material.needsUpdate=!0,c=I,g=I.version,d=t.toneMapping),n.unshift(a,a.geometry,a.material,0,0,null)):I&&I.isTexture&&(void 0===r&&(r=new ch(new Ah(2,2),new uh({name:"BackgroundMaterial",uniforms:hh(kh.background.uniforms),vertexShader:kh.background.vertexShader,fragmentShader:kh.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),r.geometry.deleteAttribute("normal"),Object.defineProperty(r.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(r)),r.material.uniforms.t2D.value=I,!0===I.matrixAutoUpdate&&I.updateMatrix(),r.material.uniforms.uvTransform.value.copy(I.matrix),c===I&&g===I.version&&d===t.toneMapping||(r.material.needsUpdate=!0,c=I,g=I.version,d=t.toneMapping),n.unshift(r,r.geometry,r.material,0,0,null))}}}function Hh(t,e,n,i){const o=t.getParameter(34921),s=i.isWebGL2?null:e.get("OES_vertex_array_object"),r=i.isWebGL2||null!==s,a={},l=h(null);let c=l;function g(e){return i.isWebGL2?t.bindVertexArray(e):s.bindVertexArrayOES(e)}function d(e){return i.isWebGL2?t.deleteVertexArray(e):s.deleteVertexArrayOES(e)}function h(t){const e=[],n=[],i=[];for(let s=0;s<o;s++)e[s]=0,n[s]=0,i[s]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:n,attributeDivisors:i,object:t,attributes:{},index:null}}function m(){const t=c.newAttributes;for(let e=0,n=t.length;e<n;e++)t[e]=0}function I(t){u(t,0)}function u(n,o){const s=c.newAttributes,r=c.enabledAttributes,a=c.attributeDivisors;s[n]=1,0===r[n]&&(t.enableVertexAttribArray(n),r[n]=1),a[n]!==o&&((i.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,o),a[n]=o)}function C(){const e=c.newAttributes,n=c.enabledAttributes;for(let i=0,o=n.length;i<o;i++)n[i]!==e[i]&&(t.disableVertexAttribArray(i),n[i]=0)}function b(e,n,o,s,r,a){!0!==i.isWebGL2||5124!==o&&5125!==o?t.vertexAttribPointer(e,n,o,s,r,a):t.vertexAttribIPointer(e,n,o,r,a)}function p(){y(),c!==l&&(c=l,g(c.object))}function y(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(o,l,d,p,y){let Z=!1;if(r){const e=function(e,n,o){const r=!0===o.wireframe;let l=a[e.id];void 0===l&&(l={},a[e.id]=l);let c=l[n.id];void 0===c&&(c={},l[n.id]=c);let g=c[r];return void 0===g&&(g=h(i.isWebGL2?t.createVertexArray():s.createVertexArrayOES()),c[r]=g),g}(p,d,l);c!==e&&(c=e,g(c.object)),Z=function(t,e){const n=c.attributes,i=t.attributes;let o=0;for(const s in i){const t=n[s],e=i[s];if(void 0===t)return!0;if(t.attribute!==e)return!0;if(t.data!==e.data)return!0;o++}return c.attributesNum!==o||c.index!==e}(p,y),Z&&function(t,e){const n={},i=t.attributes;let o=0;for(const s in i){const t=i[s],e={};e.attribute=t,t.data&&(e.data=t.data),n[s]=e,o++}c.attributes=n,c.attributesNum=o,c.index=e}(p,y)}else{const t=!0===l.wireframe;c.geometry===p.id&&c.program===d.id&&c.wireframe===t||(c.geometry=p.id,c.program=d.id,c.wireframe=t,Z=!0)}!0===o.isInstancedMesh&&(Z=!0),null!==y&&n.update(y,34963),Z&&(function(o,s,r,a){if(!1===i.isWebGL2&&(o.isInstancedMesh||a.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;m();const l=a.attributes,c=r.getAttributes(),g=s.defaultAttributeValues;for(const e in c){const i=c[e];if(i>=0){const s=l[e];if(void 0!==s){const e=s.normalized,o=s.itemSize,r=n.get(s);if(void 0===r)continue;const l=r.buffer,c=r.type,g=r.bytesPerElement;if(s.isInterleavedBufferAttribute){const n=s.data,r=n.stride,d=s.offset;n&&n.isInstancedInterleavedBuffer?(u(i,n.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=n.meshPerAttribute*n.count)):I(i),t.bindBuffer(34962,l),b(i,o,c,e,r*g,d*g)}else s.isInstancedBufferAttribute?(u(i,s.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=s.meshPerAttribute*s.count)):I(i),t.bindBuffer(34962,l),b(i,o,c,e,0,0)}else if("instanceMatrix"===e){const e=n.get(o.instanceMatrix);if(void 0===e)continue;const s=e.buffer,r=e.type;u(i+0,1),u(i+1,1),u(i+2,1),u(i+3,1),t.bindBuffer(34962,s),t.vertexAttribPointer(i+0,4,r,!1,64,0),t.vertexAttribPointer(i+1,4,r,!1,64,16),t.vertexAttribPointer(i+2,4,r,!1,64,32),t.vertexAttribPointer(i+3,4,r,!1,64,48)}else if("instanceColor"===e){const e=n.get(o.instanceColor);if(void 0===e)continue;const s=e.buffer,r=e.type;u(i,1),t.bindBuffer(34962,s),t.vertexAttribPointer(i,3,r,!1,12,0)}else if(void 0!==g){const n=g[e];if(void 0!==n)switch(n.length){case 2:t.vertexAttrib2fv(i,n);break;case 3:t.vertexAttrib3fv(i,n);break;case 4:t.vertexAttrib4fv(i,n);break;default:t.vertexAttrib1fv(i,n)}}}}C()}(o,l,d,p),null!==y&&t.bindBuffer(34963,n.get(y).buffer))},reset:p,resetDefaultState:y,dispose:function(){p();for(const t in a){const e=a[t];for(const t in e){const n=e[t];for(const t in n)d(n[t].object),delete n[t];delete e[t]}delete a[t]}},releaseStatesOfGeometry:function(t){if(void 0===a[t.id])return;const e=a[t.id];for(const n in e){const t=e[n];for(const e in t)d(t[e].object),delete t[e];delete e[n]}delete a[t.id]},releaseStatesOfProgram:function(t){for(const e in a){const n=a[e];if(void 0===n[t.id])continue;const i=n[t.id];for(const t in i)d(i[t].object),delete i[t];delete n[t.id]}},initAttributes:m,enableAttribute:I,disableUnusedAttributes:C}}function xh(t,e,n,i){const o=i.isWebGL2;let s;this.setMode=function(t){s=t},this.render=function(e,i){t.drawArrays(s,e,i),n.update(i,s,1)},this.renderInstances=function(i,r,a){if(0===a)return;let l,c;if(o)l=t,c="drawArraysInstanced";else if(l=e.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](s,i,r,a),n.update(r,s,a)}}function Nh(t,e,n){let i;function o(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const s="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let r=void 0!==n.precision?n.precision:"highp";const a=o(r);a!==r&&(console.warn("THREE.WebGLRenderer:",r,"not supported, using",a,"instead."),r=a);const l=s||e.has("WEBGL_draw_buffers"),c=!0===n.logarithmicDepthBuffer,g=t.getParameter(34930),d=t.getParameter(35660),h=t.getParameter(3379),m=t.getParameter(34076),I=t.getParameter(34921),u=t.getParameter(36347),C=t.getParameter(36348),b=t.getParameter(36349),p=d>0,y=s||e.has("OES_texture_float");return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===e.has("EXT_texture_filter_anisotropic")){const n=e.get("EXT_texture_filter_anisotropic");i=t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:o,precision:r,logarithmicDepthBuffer:c,maxTextures:g,maxVertexTextures:d,maxTextureSize:h,maxCubemapSize:m,maxAttributes:I,maxVertexUniforms:u,maxVaryings:C,maxFragmentUniforms:b,vertexTextures:p,floatFragmentTextures:y,floatVertexTextures:p&&y,maxSamples:s?t.getParameter(36183):0}}function Th(t){const e=this;let n=null,i=0,o=!1,s=!1;const r=new Bh,a=new jc,l={value:null,needsUpdate:!1};function c(){l.value!==n&&(l.value=n,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function g(t,n,i,o){const s=null!==t?t.length:0;let c=null;if(0!==s){if(c=l.value,!0!==o||null===c){const e=i+4*s,o=n.matrixWorldInverse;a.getNormalMatrix(o),(null===c||c.length<e)&&(c=new Float32Array(e));for(let n=0,l=i;n!==s;++n,l+=4)r.copy(t[n]).applyMatrix4(o,a),r.normal.toArray(c,l),c[l+3]=r.constant}l.value=c,l.needsUpdate=!0}return e.numPlanes=s,e.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,s){const r=0!==t.length||e||0!==i||o;return o=e,n=g(t,s,0),i=t.length,r},this.beginShadows=function(){s=!0,g(null)},this.endShadows=function(){s=!1,c()},this.setState=function(e,r,a){const d=e.clippingPlanes,h=e.clipIntersection,m=e.clipShadows,I=t.get(e);if(!o||null===d||0===d.length||s&&!m)s?g(null):c();else{const t=s?0:i,e=4*t;let o=I.clippingState||null;l.value=o,o=g(d,r,e,a);for(let i=0;i!==e;++i)o[i]=n[i];I.clippingState=o,this.numIntersection=h?this.numPlanes:0,this.numPlanes+=t}}}function Mh(t){let e=new WeakMap;function n(t,e){return 303===e?t.mapping=301:304===e&&(t.mapping=302),t}function i(t){const n=t.target;n.removeEventListener("dispose",i);const o=e.get(n);void 0!==o&&(e.delete(n),o.dispose())}return{get:function(o){if(o&&o.isTexture){const s=o.mapping;if(303===s||304===s){if(e.has(o))return n(e.get(o).texture,o.mapping);{const s=o.image;if(s&&s.height>0){const r=t.getRenderTarget(),a=new Jh(s.height/2);return a.fromEquirectangularTexture(t,o),e.set(o,a),t.setRenderTarget(r),o.addEventListener("dispose",i),n(a.texture,o.mapping)}return null}}}return o},dispose:function(){e=new WeakMap}}}function Uh(t){const e={};function n(n){if(void 0!==e[n])return e[n];let i;switch(n){case"WEBGL_depth_texture":i=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=t.getExtension(n)}return e[n]=i,i}return{has:function(t){return null!==n(t)},init:function(t){t.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float")},get:function(t){const e=n(t);return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function Kh(t,e,n,i){const o={},s=new WeakMap;function r(t){const a=t.target;null!==a.index&&e.remove(a.index);for(const n in a.attributes)e.remove(a.attributes[n]);a.removeEventListener("dispose",r),delete o[a.id];const l=s.get(a);l&&(e.remove(l),s.delete(a)),i.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,n.memory.geometries--}function a(t){const n=[],i=t.index,o=t.attributes.position;let r=0;if(null!==i){const t=i.array;r=i.version;for(let e=0,i=t.length;e<i;e+=3){const i=t[e+0],o=t[e+1],s=t[e+2];n.push(i,o,o,s,s,i)}}else{const t=o.array;r=o.version;for(let e=0,i=t.length/3-1;e<i;e+=3){const t=e+0,i=e+1,o=e+2;n.push(t,i,i,o,o,t)}}const a=new(xd(n)>65535?Fd:kd)(n,1);a.version=r;const l=s.get(t);l&&e.remove(l),s.set(t,a)}return{get:function(t,e){return!0===o[e.id]||(e.addEventListener("dispose",r),o[e.id]=!0,n.memory.geometries++),e},update:function(t){const n=t.attributes;for(const o in n)e.update(n[o],34962);const i=t.morphAttributes;for(const o in i){const t=i[o];for(let n=0,i=t.length;n<i;n++)e.update(t[n],34962)}},getWireframeAttribute:function(t){const e=s.get(t);if(e){const n=t.index;null!==n&&e.version<n.version&&a(t)}else a(t);return s.get(t)}}}function Eh(t,e,n,i){const o=i.isWebGL2;let s,r,a;this.setMode=function(t){s=t},this.setIndex=function(t){r=t.type,a=t.bytesPerElement},this.render=function(e,i){t.drawElements(s,i,r,e*a),n.update(i,s,1)},this.renderInstances=function(i,l,c){if(0===c)return;let g,d;if(o)g=t,d="drawElementsInstanced";else if(g=e.get("ANGLE_instanced_arrays"),d="drawElementsInstancedANGLE",null===g)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");g[d](s,l,r,i*a,c),n.update(l,s,c)}}function Lh(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,n,i){switch(e.calls++,n){case 4:e.triangles+=i*(t/3);break;case 1:e.lines+=i*(t/2);break;case 3:e.lines+=i*(t-1);break;case 2:e.lines+=i*t;break;case 0:e.points+=i*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function Dh(t,e){return t[0]-e[0]}function Qh(t,e){return Math.abs(e[1])-Math.abs(t[1])}function zh(t){const e={},n=new Float32Array(8),i=[];for(let o=0;o<8;o++)i[o]=[o,0];return{update:function(o,s,r,a){const l=o.morphTargetInfluences,c=void 0===l?0:l.length;let g=e[s.id];if(void 0===g||g.length!==c){g=[];for(let t=0;t<c;t++)g[t]=[t,0];e[s.id]=g}for(let t=0;t<c;t++){const e=g[t];e[0]=t,e[1]=l[t]}g.sort(Qh);for(let t=0;t<8;t++)t<c&&g[t][1]?(i[t][0]=g[t][0],i[t][1]=g[t][1]):(i[t][0]=Number.MAX_SAFE_INTEGER,i[t][1]=0);i.sort(Dh);const d=r.morphTargets&&s.morphAttributes.position,h=r.morphNormals&&s.morphAttributes.normal;let m=0;for(let t=0;t<8;t++){const e=i[t],o=e[0],r=e[1];o!==Number.MAX_SAFE_INTEGER&&r?(d&&s.getAttribute("morphTarget"+t)!==d[o]&&s.setAttribute("morphTarget"+t,d[o]),h&&s.getAttribute("morphNormal"+t)!==h[o]&&s.setAttribute("morphNormal"+t,h[o]),n[t]=r,m+=r):(d&&!0===s.hasAttribute("morphTarget"+t)&&s.deleteAttribute("morphTarget"+t),h&&!0===s.hasAttribute("morphNormal"+t)&&s.deleteAttribute("morphNormal"+t),n[t]=0)}const I=s.morphTargetsRelative?1:1-m;a.getUniforms().setValue(t,"morphTargetBaseInfluence",I),a.getUniforms().setValue(t,"morphTargetInfluences",n)}}}function Ph(t,e,n,i){let o=new WeakMap;function s(t){const e=t.target;e.removeEventListener("dispose",s),n.remove(e.instanceMatrix),null!==e.instanceColor&&n.remove(e.instanceColor)}return{update:function(t){const r=i.render.frame,a=t.geometry,l=e.get(t,a);return o.get(l)!==r&&(e.update(l),o.set(l,r)),t.isInstancedMesh&&(!1===t.hasEventListener("dispose",s)&&t.addEventListener("dispose",s),n.update(t.instanceMatrix,34962),null!==t.instanceColor&&n.update(t.instanceColor,34962)),l},dispose:function(){o=new WeakMap}}}kh.physical={uniforms:mh([kh.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Oc(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new Rd(0)},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Oc},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Rd(0)}}]),vertexShader:wh.meshphysical_vert,fragmentShader:wh.meshphysical_frag};class _h extends eg{constructor(t=null,e=1,n=1,i=1){super(null),this.image={data:t,width:e,height:n,depth:i},this.magFilter=lc,this.minFilter=lc,this.wrapR=rc,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}_h.prototype.isDataTexture2DArray=!0;class Oh extends eg{constructor(t=null,e=1,n=1,i=1){super(null),this.image={data:t,width:e,height:n,depth:i},this.magFilter=lc,this.minFilter=lc,this.wrapR=rc,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}Oh.prototype.isDataTexture3D=!0;const jh=new eg,qh=new _h,$h=new Oh,tm=new Zh,em=[],nm=[],im=new Float32Array(16),om=new Float32Array(9),sm=new Float32Array(4);function rm(t,e,n){const i=t[0];if(i<=0||i>0)return t;const o=e*n;let s=em[o];if(void 0===s&&(s=new Float32Array(o),em[o]=s),0!==e){i.toArray(s,0);for(let i=1,o=0;i!==e;++i)o+=n,t[i].toArray(s,o)}return s}function am(t,e){if(t.length!==e.length)return!1;for(let n=0,i=t.length;n<i;n++)if(t[n]!==e[n])return!1;return!0}function lm(t,e){for(let n=0,i=e.length;n<i;n++)t[n]=e[n]}function cm(t,e){let n=nm[e];void 0===n&&(n=new Int32Array(e),nm[e]=n);for(let i=0;i!==e;++i)n[i]=t.allocateTextureUnit();return n}function gm(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function dm(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(am(n,e))return;t.uniform2fv(this.addr,e),lm(n,e)}}function hm(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(void 0!==e.r)n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(am(n,e))return;t.uniform3fv(this.addr,e),lm(n,e)}}function mm(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(am(n,e))return;t.uniform4fv(this.addr,e),lm(n,e)}}function Im(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(am(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),lm(n,e)}else{if(am(n,i))return;sm.set(i),t.uniformMatrix2fv(this.addr,!1,sm),lm(n,i)}}function um(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(am(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),lm(n,e)}else{if(am(n,i))return;om.set(i),t.uniformMatrix3fv(this.addr,!1,om),lm(n,i)}}function Cm(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(am(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),lm(n,e)}else{if(am(n,i))return;im.set(i),t.uniformMatrix4fv(this.addr,!1,im),lm(n,i)}}function bm(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function pm(t,e){const n=this.cache;am(n,e)||(t.uniform2iv(this.addr,e),lm(n,e))}function ym(t,e){const n=this.cache;am(n,e)||(t.uniform3iv(this.addr,e),lm(n,e))}function Zm(t,e){const n=this.cache;am(n,e)||(t.uniform4iv(this.addr,e),lm(n,e))}function Jm(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function Gm(t,e){const n=this.cache;am(n,e)||(t.uniform2uiv(this.addr,e),lm(n,e))}function Vm(t,e){const n=this.cache;am(n,e)||(t.uniform3uiv(this.addr,e),lm(n,e))}function Sm(t,e){const n=this.cache;am(n,e)||(t.uniform4uiv(this.addr,e),lm(n,e))}function Bm(t,e,n){const i=this.cache,o=n.allocateTextureUnit();i[0]!==o&&(t.uniform1i(this.addr,o),i[0]=o),n.safeSetTexture2D(e||jh,o)}function Xm(t,e,n){const i=this.cache,o=n.allocateTextureUnit();i[0]!==o&&(t.uniform1i(this.addr,o),i[0]=o),n.setTexture3D(e||$h,o)}function vm(t,e,n){const i=this.cache,o=n.allocateTextureUnit();i[0]!==o&&(t.uniform1i(this.addr,o),i[0]=o),n.safeSetTextureCube(e||tm,o)}function fm(t,e,n){const i=this.cache,o=n.allocateTextureUnit();i[0]!==o&&(t.uniform1i(this.addr,o),i[0]=o),n.setTexture2DArray(e||qh,o)}function Rm(t,e){t.uniform1fv(this.addr,e)}function Wm(t,e){const n=rm(e,this.size,2);t.uniform2fv(this.addr,n)}function Am(t,e){const n=rm(e,this.size,3);t.uniform3fv(this.addr,n)}function wm(t,e){const n=rm(e,this.size,4);t.uniform4fv(this.addr,n)}function Ym(t,e){const n=rm(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function km(t,e){const n=rm(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function Fm(t,e){const n=rm(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function Hm(t,e){t.uniform1iv(this.addr,e)}function xm(t,e){t.uniform2iv(this.addr,e)}function Nm(t,e){t.uniform3iv(this.addr,e)}function Tm(t,e){t.uniform4iv(this.addr,e)}function Mm(t,e){t.uniform1uiv(this.addr,e)}function Um(t,e){t.uniform2uiv(this.addr,e)}function Km(t,e){t.uniform3uiv(this.addr,e)}function Em(t,e){t.uniform4uiv(this.addr,e)}function Lm(t,e,n){const i=e.length,o=cm(n,i);t.uniform1iv(this.addr,o);for(let s=0;s!==i;++s)n.safeSetTexture2D(e[s]||jh,o[s])}function Dm(t,e,n){const i=e.length,o=cm(n,i);t.uniform1iv(this.addr,o);for(let s=0;s!==i;++s)n.safeSetTextureCube(e[s]||tm,o[s])}function Qm(t,e,n){this.id=t,this.addr=n,this.cache=[],this.setValue=function(t){switch(t){case 5126:return gm;case 35664:return dm;case 35665:return hm;case 35666:return mm;case 35674:return Im;case 35675:return um;case 35676:return Cm;case 5124:case 35670:return bm;case 35667:case 35671:return pm;case 35668:case 35672:return ym;case 35669:case 35673:return Zm;case 5125:return Jm;case 36294:return Gm;case 36295:return Vm;case 36296:return Sm;case 35678:case 36198:case 36298:case 36306:case 35682:return Bm;case 35679:case 36299:case 36307:return Xm;case 35680:case 36300:case 36308:case 36293:return vm;case 36289:case 36303:case 36311:case 36292:return fm}}(e.type)}function zm(t,e,n){this.id=t,this.addr=n,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return Rm;case 35664:return Wm;case 35665:return Am;case 35666:return wm;case 35674:return Ym;case 35675:return km;case 35676:return Fm;case 5124:case 35670:return Hm;case 35667:case 35671:return xm;case 35668:case 35672:return Nm;case 35669:case 35673:return Tm;case 5125:return Mm;case 36294:return Um;case 36295:return Km;case 36296:return Em;case 35678:case 36198:case 36298:case 36306:case 35682:return Lm;case 35680:case 36300:case 36308:case 36293:return Dm}}(e.type)}function Pm(t){this.id=t,this.seq=[],this.map={}}zm.prototype.updateCache=function(t){const e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),lm(e,t)},Pm.prototype.setValue=function(t,e,n){const i=this.seq;for(let o=0,s=i.length;o!==s;++o){const s=i[o];s.setValue(t,e[s.id],n)}};const _m=/(\w+)(\])?(\[|\.)?/g;function Om(t,e){t.seq.push(e),t.map[e.id]=e}function jm(t,e,n){const i=t.name,o=i.length;for(_m.lastIndex=0;;){const s=_m.exec(i),r=_m.lastIndex;let a=s[1];const l="]"===s[2],c=s[3];if(l&&(a|=0),void 0===c||"["===c&&r+2===o){Om(n,void 0===c?new Qm(a,t,e):new zm(a,t,e));break}{let t=n.map[a];void 0===t&&(t=new Pm(a),Om(n,t)),n=t}}}function qm(t,e){this.seq=[],this.map={};const n=t.getProgramParameter(e,35718);for(let i=0;i<n;++i){const n=t.getActiveUniform(e,i);jm(n,t.getUniformLocation(e,n.name),this)}}function $m(t,e,n){const i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),i}qm.prototype.setValue=function(t,e,n,i){const o=this.map[e];void 0!==o&&o.setValue(t,n,i)},qm.prototype.setOptional=function(t,e,n){const i=e[n];void 0!==i&&this.setValue(t,n,i)},qm.upload=function(t,e,n,i){for(let o=0,s=e.length;o!==s;++o){const s=e[o],r=n[s.id];!1!==r.needsUpdate&&s.setValue(t,r.value,i)}},qm.seqWithValue=function(t,e){const n=[];for(let i=0,o=t.length;i!==o;++i){const o=t[i];o.id in e&&n.push(o)}return n};let tI=0;function eI(t){switch(t){case Ac:return["Linear","( value )"];case wc:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}function nI(t,e,n){const i=t.getShaderParameter(e,35713),o=t.getShaderInfoLog(e).trim();return i&&""===o?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+o+function(t){const e=t.split("\n");for(let n=0;n<e.length;n++)e[n]=n+1+": "+e[n];return e.join("\n")}(t.getShaderSource(e))}function iI(t,e){const n=eI(e);return"vec4 "+t+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function oI(t,e){const n=eI(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function sI(t,e){let n;switch(e){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function rI(t){return""!==t}function aI(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function lI(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const cI=/^[ \t]*#include +<([\w\d./]+)>/gm;function gI(t){return t.replace(cI,dI)}function dI(t,e){const n=wh[e];if(void 0===n)throw new Error("Can not resolve #include <"+e+">");return gI(n)}const hI=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,mI=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function II(t){return t.replace(mI,CI).replace(hI,uI)}function uI(t,e,n,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),CI(t,e,n,i)}function CI(t,e,n,i){let o="";for(let s=parseInt(e);s<parseInt(n);s++)o+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return o}function bI(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function pI(t,e,n,i){const o=t.getContext(),s=n.defines;let r=n.vertexShader,a=n.fragmentShader;const l=function(t){let e="SHADOWMAP_TYPE_BASIC";return 1===t.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===t.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===t.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(n),c=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case 301:case 302:e="ENVMAP_TYPE_CUBE";break;case 306:case 307:e="ENVMAP_TYPE_CUBE_UV"}return e}(n),g=function(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case 302:case 307:e="ENVMAP_MODE_REFRACTION"}return e}(n),d=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(n),h=t.gammaFactor>0?t.gammaFactor:1,m=n.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission>0)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(rI).join("\n")}(n),I=function(t){const e=[];for(const n in t){const i=t[n];!1!==i&&e.push("#define "+n+" "+i)}return e.join("\n")}(s),u=o.createProgram();let C,b,p=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(C=[I].filter(rI).join("\n"),C.length>0&&(C+="\n"),b=[m,I].filter(rI).join("\n"),b.length>0&&(b+="\n")):(C=[bI(n),"#define SHADER_NAME "+n.shaderName,I,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+h,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+g:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(rI).join("\n"),b=[m,bI(n),"#define SHADER_NAME "+n.shaderName,I,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+h,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+g:"",n.envMap?"#define "+d:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?wh.tonemapping_pars_fragment:"",0!==n.toneMapping?sI("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",wh.encodings_pars_fragment,n.map?iI("mapTexelToLinear",n.mapEncoding):"",n.matcap?iI("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?iI("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?iI("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMap?iI("lightMapTexelToLinear",n.lightMapEncoding):"",oI("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(rI).join("\n")),r=gI(r),r=aI(r,n),r=lI(r,n),a=gI(a),a=aI(a,n),a=lI(a,n),r=II(r),a=II(a),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(p="#version 300 es\n",C=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+C,b=["#define varying in",n.glslVersion===Hc?"":"out highp vec4 pc_fragColor;",n.glslVersion===Hc?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+b);const y=p+b+a,Z=$m(o,35633,p+C+r),J=$m(o,35632,y);if(o.attachShader(u,Z),o.attachShader(u,J),void 0!==n.index0AttributeName?o.bindAttribLocation(u,0,n.index0AttributeName):!0===n.morphTargets&&o.bindAttribLocation(u,0,"position"),o.linkProgram(u),t.debug.checkShaderErrors){const t=o.getProgramInfoLog(u).trim(),e=o.getShaderInfoLog(Z).trim(),n=o.getShaderInfoLog(J).trim();let i=!0,s=!0;if(!1===o.getProgramParameter(u,35714)){i=!1;const e=nI(o,Z,"vertex"),n=nI(o,J,"fragment");console.error("THREE.WebGLProgram: shader error: ",o.getError(),"35715",o.getProgramParameter(u,35715),"gl.getProgramInfoLog",t,e,n)}else""!==t?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",t):""!==e&&""!==n||(s=!1);s&&(this.diagnostics={runnable:i,programLog:t,vertexShader:{log:e,prefix:C},fragmentShader:{log:n,prefix:b}})}let G,V;return o.deleteShader(Z),o.deleteShader(J),this.getUniforms=function(){return void 0===G&&(G=new qm(o,u)),G},this.getAttributes=function(){return void 0===V&&(V=function(t,e){const n={},i=t.getProgramParameter(e,35721);for(let o=0;o<i;o++){const i=t.getActiveAttrib(e,o).name;n[i]=t.getAttribLocation(e,i)}return n}(o,u)),V},this.destroy=function(){i.releaseStatesOfProgram(this),o.deleteProgram(u),this.program=void 0},this.name=n.shaderName,this.id=tI++,this.cacheKey=e,this.usedTimes=1,this.program=u,this.vertexShader=Z,this.fragmentShader=J,this}function yI(t,e,n,i,o,s){const r=[],a=i.isWebGL2,l=i.logarithmicDepthBuffer,c=i.floatVertexTextures,g=i.maxVertexUniforms,d=i.vertexTextures;let h=i.precision;const m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},I=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmission","transmissionMap","thicknessMap"];function u(t){let e;return t&&t.isTexture?e=t.encoding:t&&t.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e=t.texture.encoding):e=Ac,e}return{getParameters:function(o,r,I,C,b){const p=C.fog,y=o.isMeshStandardMaterial?C.environment:null,Z=e.get(o.envMap||y),J=m[o.type],G=b.isSkinnedMesh?function(t){const e=t.skeleton.bones;if(c)return 1024;{const t=g,n=Math.floor((t-20)/4),i=Math.min(n,e.length);return i<e.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+e.length+" bones. This GPU supports "+i+"."),0):i}}(b):0;let V,S;if(null!==o.precision&&(h=i.getMaxPrecision(o.precision),h!==o.precision&&console.warn("THREE.WebGLProgram.getParameters:",o.precision,"not supported, using",h,"instead.")),J){const t=kh[J];V=t.vertexShader,S=t.fragmentShader}else V=o.vertexShader,S=o.fragmentShader;const B=t.getRenderTarget();return{isWebGL2:a,shaderID:J,shaderName:o.type,vertexShader:V,fragmentShader:S,defines:o.defines,isRawShaderMaterial:!0===o.isRawShaderMaterial,glslVersion:o.glslVersion,precision:h,instancing:!0===b.isInstancedMesh,instancingColor:!0===b.isInstancedMesh&&null!==b.instanceColor,supportsVertexTextures:d,outputEncoding:null!==B?u(B.texture):t.outputEncoding,map:!!o.map,mapEncoding:u(o.map),matcap:!!o.matcap,matcapEncoding:u(o.matcap),envMap:!!Z,envMapMode:Z&&Z.mapping,envMapEncoding:u(Z),envMapCubeUV:!!Z&&(306===Z.mapping||307===Z.mapping),lightMap:!!o.lightMap,lightMapEncoding:u(o.lightMap),aoMap:!!o.aoMap,emissiveMap:!!o.emissiveMap,emissiveMapEncoding:u(o.emissiveMap),bumpMap:!!o.bumpMap,normalMap:!!o.normalMap,objectSpaceNormalMap:1===o.normalMapType,tangentSpaceNormalMap:0===o.normalMapType,clearcoatMap:!!o.clearcoatMap,clearcoatRoughnessMap:!!o.clearcoatRoughnessMap,clearcoatNormalMap:!!o.clearcoatNormalMap,displacementMap:!!o.displacementMap,roughnessMap:!!o.roughnessMap,metalnessMap:!!o.metalnessMap,specularMap:!!o.specularMap,alphaMap:!!o.alphaMap,gradientMap:!!o.gradientMap,sheen:!!o.sheen,transmission:!!o.transmission,transmissionMap:!!o.transmissionMap,thicknessMap:!!o.thicknessMap,combine:o.combine,vertexTangents:o.normalMap&&o.vertexTangents,vertexColors:o.vertexColors,vertexAlphas:!0===o.vertexColors&&b.geometry&&b.geometry.attributes.color&&4===b.geometry.attributes.color.itemSize,vertexUvs:!!(o.map||o.bumpMap||o.normalMap||o.specularMap||o.alphaMap||o.emissiveMap||o.roughnessMap||o.metalnessMap||o.clearcoatMap||o.clearcoatRoughnessMap||o.clearcoatNormalMap||o.displacementMap||o.transmissionMap||o.thicknessMap),uvsVertexOnly:!(o.map||o.bumpMap||o.normalMap||o.specularMap||o.alphaMap||o.emissiveMap||o.roughnessMap||o.metalnessMap||o.clearcoatNormalMap||o.transmission||o.transmissionMap||o.thicknessMap||!o.displacementMap),fog:!!p,useFog:o.fog,fogExp2:p&&p.isFogExp2,flatShading:!!o.flatShading,sizeAttenuation:o.sizeAttenuation,logarithmicDepthBuffer:l,skinning:!0===b.isSkinnedMesh&&G>0,maxBones:G,useVertexTexture:c,morphTargets:o.morphTargets,morphNormals:o.morphNormals,numDirLights:r.directional.length,numPointLights:r.point.length,numSpotLights:r.spot.length,numRectAreaLights:r.rectArea.length,numHemiLights:r.hemi.length,numDirLightShadows:r.directionalShadowMap.length,numPointLightShadows:r.pointShadowMap.length,numSpotLightShadows:r.spotShadowMap.length,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:o.dithering,shadowMapEnabled:t.shadowMap.enabled&&I.length>0,shadowMapType:t.shadowMap.type,toneMapping:o.toneMapped?t.toneMapping:0,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:o.premultipliedAlpha,alphaTest:o.alphaTest,doubleSided:2===o.side,flipSided:1===o.side,depthPacking:void 0!==o.depthPacking&&o.depthPacking,index0AttributeName:o.index0AttributeName,extensionDerivatives:o.extensions&&o.extensions.derivatives,extensionFragDepth:o.extensions&&o.extensions.fragDepth,extensionDrawBuffers:o.extensions&&o.extensions.drawBuffers,extensionShaderTextureLOD:o.extensions&&o.extensions.shaderTextureLOD,rendererExtensionFragDepth:a||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:a||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:a||n.has("EXT_shader_texture_lod"),customProgramCacheKey:o.customProgramCacheKey()}},getProgramCacheKey:function(e){const n=[];if(e.shaderID?n.push(e.shaderID):(n.push(e.fragmentShader),n.push(e.vertexShader)),void 0!==e.defines)for(const t in e.defines)n.push(t),n.push(e.defines[t]);if(!1===e.isRawShaderMaterial){for(let t=0;t<I.length;t++)n.push(e[I[t]]);n.push(t.outputEncoding),n.push(t.gammaFactor)}return n.push(e.customProgramCacheKey),n.join()},getUniforms:function(t){const e=m[t.type];let n;if(e){const t=kh[e];n=Ih.clone(t.uniforms)}else n=t.uniforms;return n},acquireProgram:function(e,n){let i;for(let t=0,o=r.length;t<o;t++){const e=r[t];if(e.cacheKey===n){i=e,++i.usedTimes;break}}return void 0===i&&(i=new pI(t,n,e,o),r.push(i)),i},releaseProgram:function(t){if(0==--t.usedTimes){const e=r.indexOf(t);r[e]=r[r.length-1],r.pop(),t.destroy()}},programs:r}}function ZI(){let t=new WeakMap;return{get:function(e){let n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n},remove:function(e){t.delete(e)},update:function(e,n,i){t.get(e)[n]=i},dispose:function(){t=new WeakMap}}}function JI(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function GI(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function VI(t){const e=[];let n=0;const i=[],o=[],s=[],r={id:-1};function a(i,o,s,a,l,c){let g=e[n];const d=t.get(s);return void 0===g?(g={id:i.id,object:i,geometry:o,material:s,program:d.program||r,groupOrder:a,renderOrder:i.renderOrder,z:l,group:c},e[n]=g):(g.id=i.id,g.object=i,g.geometry=o,g.material=s,g.program=d.program||r,g.groupOrder=a,g.renderOrder=i.renderOrder,g.z=l,g.group=c),n++,g}return{opaque:i,transmissive:o,transparent:s,init:function(){n=0,i.length=0,o.length=0,s.length=0},push:function(t,e,n,r,l,c){const g=a(t,e,n,r,l,c);n.transmission>0?o.push(g):!0===n.transparent?s.push(g):i.push(g)},unshift:function(t,e,n,r,l,c){const g=a(t,e,n,r,l,c);n.transmission>0?o.unshift(g):!0===n.transparent?s.unshift(g):i.unshift(g)},finish:function(){for(let t=n,i=e.length;t<i;t++){const n=e[t];if(null===n.id)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.program=null,n.group=null}},sort:function(t,e){i.length>1&&i.sort(t||JI),o.length>1&&o.sort(e||GI),s.length>1&&s.sort(e||GI)}}}function SI(t){let e=new WeakMap;return{get:function(n,i){let o;return!1===e.has(n)?(o=new VI(t),e.set(n,[o])):i>=e.get(n).length?(o=new VI(t),e.get(n).push(o)):o=e.get(n)[i],o},dispose:function(){e=new WeakMap}}}function BI(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new ag,color:new Rd};break;case"SpotLight":n={position:new ag,direction:new ag,color:new Rd,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new ag,color:new Rd,distance:0,decay:0};break;case"HemisphereLight":n={direction:new ag,skyColor:new Rd,groundColor:new Rd};break;case"RectAreaLight":n={color:new Rd,position:new ag,halfWidth:new ag,halfHeight:new ag}}return t[e.id]=n,n}}}let XI=0;function vI(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function fI(t,e){const n=new BI,i=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Oc};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Oc,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=n,n}}}(),o={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let l=0;l<9;l++)o.probe.push(new ag);const s=new ag,r=new Ng,a=new Ng;return{setup:function(s){let r=0,a=0,l=0;for(let t=0;t<9;t++)o.probe[t].set(0,0,0);let c=0,g=0,d=0,h=0,m=0,I=0,u=0,C=0;s.sort(vI);for(let t=0,e=s.length;t<e;t++){const e=s[t],b=e.color,p=e.intensity,y=e.distance,Z=e.shadow&&e.shadow.map?e.shadow.map.texture:null;if(e.isAmbientLight)r+=b.r*p,a+=b.g*p,l+=b.b*p;else if(e.isLightProbe)for(let t=0;t<9;t++)o.probe[t].addScaledVector(e.sh.coefficients[t],p);else if(e.isDirectionalLight){const t=n.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity),e.castShadow){const t=e.shadow,n=i.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,o.directionalShadow[c]=n,o.directionalShadowMap[c]=Z,o.directionalShadowMatrix[c]=e.shadow.matrix,I++}o.directional[c]=t,c++}else if(e.isSpotLight){const t=n.get(e);if(t.position.setFromMatrixPosition(e.matrixWorld),t.color.copy(b).multiplyScalar(p),t.distance=y,t.coneCos=Math.cos(e.angle),t.penumbraCos=Math.cos(e.angle*(1-e.penumbra)),t.decay=e.decay,e.castShadow){const t=e.shadow,n=i.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,o.spotShadow[d]=n,o.spotShadowMap[d]=Z,o.spotShadowMatrix[d]=e.shadow.matrix,C++}o.spot[d]=t,d++}else if(e.isRectAreaLight){const t=n.get(e);t.color.copy(b).multiplyScalar(p),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),o.rectArea[h]=t,h++}else if(e.isPointLight){const t=n.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity),t.distance=e.distance,t.decay=e.decay,e.castShadow){const t=e.shadow,n=i.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,n.shadowCameraNear=t.camera.near,n.shadowCameraFar=t.camera.far,o.pointShadow[g]=n,o.pointShadowMap[g]=Z,o.pointShadowMatrix[g]=e.shadow.matrix,u++}o.point[g]=t,g++}else if(e.isHemisphereLight){const t=n.get(e);t.skyColor.copy(e.color).multiplyScalar(p),t.groundColor.copy(e.groundColor).multiplyScalar(p),o.hemi[m]=t,m++}}h>0&&(e.isWebGL2||!0===t.has("OES_texture_float_linear")?(o.rectAreaLTC1=Yh.LTC_FLOAT_1,o.rectAreaLTC2=Yh.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(o.rectAreaLTC1=Yh.LTC_HALF_1,o.rectAreaLTC2=Yh.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),o.ambient[0]=r,o.ambient[1]=a,o.ambient[2]=l;const b=o.hash;b.directionalLength===c&&b.pointLength===g&&b.spotLength===d&&b.rectAreaLength===h&&b.hemiLength===m&&b.numDirectionalShadows===I&&b.numPointShadows===u&&b.numSpotShadows===C||(o.directional.length=c,o.spot.length=d,o.rectArea.length=h,o.point.length=g,o.hemi.length=m,o.directionalShadow.length=I,o.directionalShadowMap.length=I,o.pointShadow.length=u,o.pointShadowMap.length=u,o.spotShadow.length=C,o.spotShadowMap.length=C,o.directionalShadowMatrix.length=I,o.pointShadowMatrix.length=u,o.spotShadowMatrix.length=C,b.directionalLength=c,b.pointLength=g,b.spotLength=d,b.rectAreaLength=h,b.hemiLength=m,b.numDirectionalShadows=I,b.numPointShadows=u,b.numSpotShadows=C,o.version=XI++)},setupView:function(t,e){let n=0,i=0,l=0,c=0,g=0;const d=e.matrixWorldInverse;for(let h=0,m=t.length;h<m;h++){const e=t[h];if(e.isDirectionalLight){const t=o.directional[n];t.direction.setFromMatrixPosition(e.matrixWorld),s.setFromMatrixPosition(e.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(d),n++}else if(e.isSpotLight){const t=o.spot[l];t.position.setFromMatrixPosition(e.matrixWorld),t.position.applyMatrix4(d),t.direction.setFromMatrixPosition(e.matrixWorld),s.setFromMatrixPosition(e.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(d),l++}else if(e.isRectAreaLight){const t=o.rectArea[c];t.position.setFromMatrixPosition(e.matrixWorld),t.position.applyMatrix4(d),a.identity(),r.copy(e.matrixWorld),r.premultiply(d),a.extractRotation(r),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),t.halfWidth.applyMatrix4(a),t.halfHeight.applyMatrix4(a),c++}else if(e.isPointLight){const t=o.point[i];t.position.setFromMatrixPosition(e.matrixWorld),t.position.applyMatrix4(d),i++}else if(e.isHemisphereLight){const t=o.hemi[g];t.direction.setFromMatrixPosition(e.matrixWorld),t.direction.transformDirection(d),t.direction.normalize(),g++}}},state:o}}function RI(t,e){const n=new fI(t,e),i=[],o=[];return{init:function(){i.length=0,o.length=0},state:{lightsArray:i,shadowsArray:o,lights:n},setupLights:function(){n.setup(i)},setupLightsView:function(t){n.setupView(i,t)},pushLight:function(t){i.push(t)},pushShadow:function(t){o.push(t)}}}function WI(t,e){let n=new WeakMap;return{get:function(i,o=0){let s;return!1===n.has(i)?(s=new RI(t,e),n.set(i,[s])):o>=n.get(i).length?(s=new RI(t,e),n.get(i).push(s)):s=n.get(i)[o],s},dispose:function(){n=new WeakMap}}}class AI extends Gd{constructor(t){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}AI.prototype.isMeshDepthMaterial=!0;class wI extends Gd{constructor(t){super(),this.type="MeshDistanceMaterial",this.referencePosition=new ag,this.nearDistance=1,this.farDistance=1e3,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}function YI(t,e,n){let i=new fh;const o=new Oc,s=new Oc,r=new ig,a=[],l=[],c={},g=n.maxTextureSize,d={0:1,1:0,2:2},h=new uh({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Oc},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),m=h.clone();m.defines.HORIZONTAL_PASS=1;const I=new Dd;I.setAttribute("position",new Yd(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const u=new ch(I,h),C=this;function b(n,i){const o=e.update(u);h.uniforms.shadow_pass.value=n.map.texture,h.uniforms.resolution.value=n.mapSize,h.uniforms.radius.value=n.radius,t.setRenderTarget(n.mapPass),t.clear(),t.renderBufferDirect(i,null,o,h,u,null),m.uniforms.shadow_pass.value=n.mapPass.texture,m.uniforms.resolution.value=n.mapSize,m.uniforms.radius.value=n.radius,t.setRenderTarget(n.map),t.clear(),t.renderBufferDirect(i,null,o,m,u,null)}function p(t){const e=t<<0;let n=a[e];return void 0===n&&(n=new AI({depthPacking:3201,morphTargets:t}),a[e]=n),n}function y(t){const e=t<<0;let n=l[e];return void 0===n&&(n=new wI({morphTargets:t}),l[e]=n),n}function Z(e,n,i,o,s,r,a){let l=null,g=p,h=e.customDepthMaterial;if(!0===o.isPointLight&&(g=y,h=e.customDistanceMaterial),void 0===h){let t=!1;!0===i.morphTargets&&(t=n.morphAttributes&&n.morphAttributes.position&&n.morphAttributes.position.length>0),l=g(t)}else l=h;if(t.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length){const t=l.uuid,e=i.uuid;let n=c[t];void 0===n&&(n={},c[t]=n);let o=n[e];void 0===o&&(o=l.clone(),n[e]=o),l=o}return l.visible=i.visible,l.wireframe=i.wireframe,l.side=3===a?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:d[i.side],l.clipShadows=i.clipShadows,l.clippingPlanes=i.clippingPlanes,l.clipIntersection=i.clipIntersection,l.wireframeLinewidth=i.wireframeLinewidth,l.linewidth=i.linewidth,!0===o.isPointLight&&!0===l.isMeshDistanceMaterial&&(l.referencePosition.setFromMatrixPosition(o.matrixWorld),l.nearDistance=s,l.farDistance=r),l}function J(n,o,s,r,a){if(!1===n.visible)return;if(n.layers.test(o.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===a)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,n.matrixWorld);const i=e.update(n),o=n.material;if(Array.isArray(o)){const e=i.groups;for(let l=0,c=e.length;l<c;l++){const c=e[l],g=o[c.materialIndex];if(g&&g.visible){const e=Z(n,i,g,r,s.near,s.far,a);t.renderBufferDirect(s,null,i,e,n,c)}}}else if(o.visible){const e=Z(n,i,o,r,s.near,s.far,a);t.renderBufferDirect(s,null,i,e,n,null)}}const l=n.children;for(let t=0,e=l.length;t<e;t++)J(l[t],o,s,r,a)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(e,n,a){if(!1===C.enabled)return;if(!1===C.autoUpdate&&!1===C.needsUpdate)return;if(0===e.length)return;const l=t.getRenderTarget(),c=t.getActiveCubeFace(),d=t.getActiveMipmapLevel(),h=t.state;h.setBlending(0),h.buffers.color.setClear(1,1,1,1),h.buffers.depth.setTest(!0),h.setScissorTest(!1);for(let m=0,I=e.length;m<I;m++){const l=e[m],c=l.shadow;if(void 0===c){console.warn("THREE.WebGLShadowMap:",l,"has no shadow.");continue}if(!1===c.autoUpdate&&!1===c.needsUpdate)continue;o.copy(c.mapSize);const d=c.getFrameExtents();if(o.multiply(d),s.copy(c.mapSize),(o.x>g||o.y>g)&&(o.x>g&&(s.x=Math.floor(g/d.x),o.x=s.x*d.x,c.mapSize.x=s.x),o.y>g&&(s.y=Math.floor(g/d.y),o.y=s.y*d.y,c.mapSize.y=s.y)),null===c.map&&!c.isPointLightShadow&&3===this.type){const t={minFilter:dc,magFilter:dc,format:Zc};c.map=new og(o.x,o.y,t),c.map.texture.name=l.name+".shadowMap",c.mapPass=new og(o.x,o.y,t),c.camera.updateProjectionMatrix()}if(null===c.map){const t={minFilter:lc,magFilter:lc,format:Zc};c.map=new og(o.x,o.y,t),c.map.texture.name=l.name+".shadowMap",c.camera.updateProjectionMatrix()}t.setRenderTarget(c.map),t.clear();const I=c.getViewportCount();for(let t=0;t<I;t++){const e=c.getViewport(t);r.set(s.x*e.x,s.y*e.y,s.x*e.z,s.y*e.w),h.viewport(r),c.updateMatrices(l,t),i=c.getFrustum(),J(n,a,c.camera,l,this.type)}c.isPointLightShadow||3!==this.type||b(c,a),c.needsUpdate=!1}C.needsUpdate=!1,t.setRenderTarget(l,c,d)}}function kI(t,e,n){const i=n.isWebGL2,o=new function(){let e=!1;const n=new ig;let i=null;const o=new ig(0,0,0,0);return{setMask:function(n){i===n||e||(t.colorMask(n,n,n,n),i=n)},setLocked:function(t){e=t},setClear:function(e,i,s,r,a){!0===a&&(e*=r,i*=r,s*=r),n.set(e,i,s,r),!1===o.equals(n)&&(t.clearColor(e,i,s,r),o.copy(n))},reset:function(){e=!1,i=null,o.set(-1,0,0,0)}}},s=new function(){let e=!1,n=null,i=null,o=null;return{setTest:function(t){t?x(2929):N(2929)},setMask:function(i){n===i||e||(t.depthMask(i),n=i)},setFunc:function(e){if(i!==e){if(e)switch(e){case 0:t.depthFunc(512);break;case 1:t.depthFunc(519);break;case 2:t.depthFunc(513);break;case 3:default:t.depthFunc(515);break;case 4:t.depthFunc(514);break;case 5:t.depthFunc(518);break;case 6:t.depthFunc(516);break;case 7:t.depthFunc(517)}else t.depthFunc(515);i=e}},setLocked:function(t){e=t},setClear:function(e){o!==e&&(t.clearDepth(e),o=e)},reset:function(){e=!1,n=null,i=null,o=null}}},r=new function(){let e=!1,n=null,i=null,o=null,s=null,r=null,a=null,l=null,c=null;return{setTest:function(t){e||(t?x(2960):N(2960))},setMask:function(i){n===i||e||(t.stencilMask(i),n=i)},setFunc:function(e,n,r){i===e&&o===n&&s===r||(t.stencilFunc(e,n,r),i=e,o=n,s=r)},setOp:function(e,n,i){r===e&&a===n&&l===i||(t.stencilOp(e,n,i),r=e,a=n,l=i)},setLocked:function(t){e=t},setClear:function(e){c!==e&&(t.clearStencil(e),c=e)},reset:function(){e=!1,n=null,i=null,o=null,s=null,r=null,a=null,l=null,c=null}}};let a={},l=null,c={},g=null,d=!1,h=null,m=null,I=null,u=null,C=null,b=null,p=null,y=!1,Z=null,J=null,G=null,V=null,S=null;const B=t.getParameter(35661);let X=!1,v=0;const f=t.getParameter(7938);-1!==f.indexOf("WebGL")?(v=parseFloat(/^WebGL (\d)/.exec(f)[1]),X=v>=1):-1!==f.indexOf("OpenGL ES")&&(v=parseFloat(/^OpenGL ES (\d)/.exec(f)[1]),X=v>=2);let R=null,W={};const A=t.getParameter(3088),w=t.getParameter(2978),Y=(new ig).fromArray(A),k=(new ig).fromArray(w);function F(e,n,i){const o=new Uint8Array(4),s=t.createTexture();t.bindTexture(e,s),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(let r=0;r<i;r++)t.texImage2D(n+r,0,6408,1,1,0,6408,5121,o);return s}const H={};function x(e){!0!==a[e]&&(t.enable(e),a[e]=!0)}function N(e){!1!==a[e]&&(t.disable(e),a[e]=!1)}H[3553]=F(3553,3553,1),H[34067]=F(34067,34069,6),o.setClear(0,0,0,1),s.setClear(1),r.setClear(0),x(2929),s.setFunc(3),K(!1),E(1),x(2884),U(0);const T={[oc]:32774,101:32778,102:32779};if(i)T[103]=32775,T[104]=32776;else{const t=e.get("EXT_blend_minmax");null!==t&&(T[103]=t.MIN_EXT,T[104]=t.MAX_EXT)}const M={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function U(e,n,i,o,s,r,a,l){if(0!==e){if(!1===d&&(x(3042),d=!0),5===e)s=s||n,r=r||i,a=a||o,n===m&&s===C||(t.blendEquationSeparate(T[n],T[s]),m=n,C=s),i===I&&o===u&&r===b&&a===p||(t.blendFuncSeparate(M[i],M[o],M[r],M[a]),I=i,u=o,b=r,p=a),h=e,y=null;else if(e!==h||l!==y){if(m===oc&&C===oc||(t.blendEquation(32774),m=oc,C=oc),l)switch(e){case 1:t.blendFuncSeparate(1,771,1,771);break;case 2:t.blendFunc(1,1);break;case 3:t.blendFuncSeparate(0,0,769,771);break;case 4:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case 1:t.blendFuncSeparate(770,771,1,771);break;case 2:t.blendFunc(770,1);break;case 3:t.blendFunc(0,769);break;case 4:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}I=null,u=null,b=null,p=null,h=e,y=l}}else!0===d&&(N(3042),d=!1)}function K(e){Z!==e&&(e?t.frontFace(2304):t.frontFace(2305),Z=e)}function E(e){0!==e?(x(2884),e!==J&&(1===e?t.cullFace(1029):2===e?t.cullFace(1028):t.cullFace(1032))):N(2884),J=e}function L(e,n,i){e?(x(32823),V===n&&S===i||(t.polygonOffset(n,i),V=n,S=i)):N(32823)}function D(e){void 0===e&&(e=33984+B-1),R!==e&&(t.activeTexture(e),R=e)}return{buffers:{color:o,depth:s,stencil:r},enable:x,disable:N,bindFramebuffer:function(e,n){return null===n&&null!==l&&(n=l),c[e]!==n&&(t.bindFramebuffer(e,n),c[e]=n,i&&(36009===e&&(c[36160]=n),36160===e&&(c[36009]=n)),!0)},bindXRFramebuffer:function(e){e!==l&&(t.bindFramebuffer(36160,e),l=e)},useProgram:function(e){return g!==e&&(t.useProgram(e),g=e,!0)},setBlending:U,setMaterial:function(t,e){2===t.side?N(2884):x(2884);let n=1===t.side;e&&(n=!n),K(n),1===t.blending&&!1===t.transparent?U(0):U(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),s.setFunc(t.depthFunc),s.setTest(t.depthTest),s.setMask(t.depthWrite),o.setMask(t.colorWrite);const i=t.stencilWrite;r.setTest(i),i&&(r.setMask(t.stencilWriteMask),r.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),r.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),L(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?x(32926):N(32926)},setFlipSided:K,setCullFace:E,setLineWidth:function(e){e!==G&&(X&&t.lineWidth(e),G=e)},setPolygonOffset:L,setScissorTest:function(t){t?x(3089):N(3089)},activeTexture:D,bindTexture:function(e,n){null===R&&D();let i=W[R];void 0===i&&(i={type:void 0,texture:void 0},W[R]=i),i.type===e&&i.texture===n||(t.bindTexture(e,n||H[e]),i.type=e,i.texture=n)},unbindTexture:function(){const e=W[R];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===Y.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),Y.copy(e))},viewport:function(e){!1===k.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),k.copy(e))},reset:function(){t.disable(3042),t.disable(2884),t.disable(2929),t.disable(32823),t.disable(3089),t.disable(2960),t.disable(32926),t.blendEquation(32774),t.blendFunc(1,0),t.blendFuncSeparate(1,0,1,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(513),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(519,0,4294967295),t.stencilOp(7680,7680,7680),t.clearStencil(0),t.cullFace(1029),t.frontFace(2305),t.polygonOffset(0,0),t.activeTexture(33984),t.bindFramebuffer(36160,null),!0===i&&(t.bindFramebuffer(36009,null),t.bindFramebuffer(36008,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),a={},R=null,W={},l=null,c={},g=null,d=!1,h=null,m=null,I=null,u=null,C=null,b=null,p=null,y=!1,Z=null,J=null,G=null,V=null,S=null,Y.set(0,0,t.canvas.width,t.canvas.height),k.set(0,0,t.canvas.width,t.canvas.height),o.reset(),s.reset(),r.reset()}}}function FI(t,e,n,i,o,s,r){const a=o.isWebGL2,l=o.maxTextures,c=o.maxCubemapSize,g=o.maxTextureSize,d=o.maxSamples,h=new WeakMap;let m,I=!1;try{I="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function u(t,e){return I?new OffscreenCanvas(t,e):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function C(t,e,n,i){let o=1;if((t.width>i||t.height>i)&&(o=i/Math.max(t.width,t.height)),o<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const i=e?Pc:Math.floor,s=i(o*t.width),r=i(o*t.height);void 0===m&&(m=u(s,r));const a=n?u(s,r):m;return a.width=s,a.height=r,a.getContext("2d").drawImage(t,0,0,s,r),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+s+"x"+r+")."),a}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function b(t){return Qc(t.width)&&Qc(t.height)}function p(t,e){return t.generateMipmaps&&e&&t.minFilter!==lc&&t.minFilter!==dc}function y(e,n,o,s,r=1){t.generateMipmap(e),i.get(n).__maxMipLevel=Math.log2(Math.max(o,s,r))}function Z(n,i,o){if(!1===a)return i;if(null!==n){if(void 0!==t[n])return t[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let s=i;return 6403===i&&(5126===o&&(s=33326),5131===o&&(s=33325),5121===o&&(s=33321)),6407===i&&(5126===o&&(s=34837),5131===o&&(s=34843),5121===o&&(s=32849)),6408===i&&(5126===o&&(s=34836),5131===o&&(s=34842),5121===o&&(s=32856)),33325!==s&&33326!==s&&34842!==s&&34836!==s||e.get("EXT_color_buffer_float"),s}function J(t){return t===lc||t===cc||t===gc?9728:9729}function G(e){const n=e.target;n.removeEventListener("dispose",G),function(e){const n=i.get(e);void 0!==n.__webglInit&&(t.deleteTexture(n.__webglTexture),i.remove(e))}(n),n.isVideoTexture&&h.delete(n),r.memory.textures--}function V(e){const n=e.target;n.removeEventListener("dispose",V),function(e){const n=e.texture,o=i.get(e),s=i.get(n);if(e){if(void 0!==s.__webglTexture&&(t.deleteTexture(s.__webglTexture),r.memory.textures--),e.depthTexture&&e.depthTexture.dispose(),e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++)t.deleteFramebuffer(o.__webglFramebuffer[e]),o.__webglDepthbuffer&&t.deleteRenderbuffer(o.__webglDepthbuffer[e]);else t.deleteFramebuffer(o.__webglFramebuffer),o.__webglDepthbuffer&&t.deleteRenderbuffer(o.__webglDepthbuffer),o.__webglMultisampledFramebuffer&&t.deleteFramebuffer(o.__webglMultisampledFramebuffer),o.__webglColorRenderbuffer&&t.deleteRenderbuffer(o.__webglColorRenderbuffer),o.__webglDepthRenderbuffer&&t.deleteRenderbuffer(o.__webglDepthRenderbuffer);if(e.isWebGLMultipleRenderTargets)for(let e=0,o=n.length;e<o;e++){const o=i.get(n[e]);o.__webglTexture&&(t.deleteTexture(o.__webglTexture),r.memory.textures--),i.remove(n[e])}i.remove(n),i.remove(e)}}(n)}let S=0;function B(t,e){const o=i.get(t);if(t.isVideoTexture&&function(t){const e=r.render.frame;h.get(t)!==e&&(h.set(t,e),t.update())}(t),t.version>0&&o.__version!==t.version){const n=t.image;if(void 0===n)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==n.complete)return void A(o,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+e),n.bindTexture(3553,o.__webglTexture)}function X(e,o){const r=i.get(e);e.version>0&&r.__version!==e.version?function(e,i,o){if(6!==i.image.length)return;W(e,i),n.activeTexture(33984+o),n.bindTexture(34067,e.__webglTexture),t.pixelStorei(37440,i.flipY),t.pixelStorei(37441,i.premultiplyAlpha),t.pixelStorei(3317,i.unpackAlignment),t.pixelStorei(37443,0);const r=i&&(i.isCompressedTexture||i.image[0].isCompressedTexture),l=i.image[0]&&i.image[0].isDataTexture,g=[];for(let t=0;t<6;t++)g[t]=r||l?l?i.image[t].image:i.image[t]:C(i.image[t],!1,!0,c);const d=g[0],h=b(d)||a,m=s.convert(i.format),I=s.convert(i.type),u=Z(i.internalFormat,m,I);let J;if(R(34067,i,h),r){for(let t=0;t<6;t++){J=g[t].mipmaps;for(let e=0;e<J.length;e++){const o=J[e];i.format!==Zc&&i.format!==yc?null!==m?n.compressedTexImage2D(34069+t,e,u,o.width,o.height,0,o.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+t,e,u,o.width,o.height,0,m,I,o.data)}}e.__maxMipLevel=J.length-1}else{J=i.mipmaps;for(let t=0;t<6;t++)if(l){n.texImage2D(34069+t,0,u,g[t].width,g[t].height,0,m,I,g[t].data);for(let e=0;e<J.length;e++){const i=J[e].image[t].image;n.texImage2D(34069+t,e+1,u,i.width,i.height,0,m,I,i.data)}}else{n.texImage2D(34069+t,0,u,m,I,g[t]);for(let e=0;e<J.length;e++){const i=J[e];n.texImage2D(34069+t,e+1,u,m,I,i.image[t])}}e.__maxMipLevel=J.length}p(i,h)&&y(34067,i,d.width,d.height),e.__version=i.version,i.onUpdate&&i.onUpdate(i)}(r,e,o):(n.activeTexture(33984+o),n.bindTexture(34067,r.__webglTexture))}const v={[sc]:10497,[rc]:33071,[ac]:33648},f={[lc]:9728,[cc]:9984,[gc]:9986,[dc]:9729,1007:9985,[hc]:9987};function R(n,s,r){if(r?(t.texParameteri(n,10242,v[s.wrapS]),t.texParameteri(n,10243,v[s.wrapT]),32879!==n&&35866!==n||t.texParameteri(n,32882,v[s.wrapR]),t.texParameteri(n,10240,f[s.magFilter]),t.texParameteri(n,10241,f[s.minFilter])):(t.texParameteri(n,10242,33071),t.texParameteri(n,10243,33071),32879!==n&&35866!==n||t.texParameteri(n,32882,33071),s.wrapS===rc&&s.wrapT===rc||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(n,10240,J(s.magFilter)),t.texParameteri(n,10241,J(s.minFilter)),s.minFilter!==lc&&s.minFilter!==dc&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===e.has("EXT_texture_filter_anisotropic")){const r=e.get("EXT_texture_filter_anisotropic");if(s.type===Cc&&!1===e.has("OES_texture_float_linear"))return;if(!1===a&&s.type===bc&&!1===e.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||i.get(s).__currentAnisotropy)&&(t.texParameterf(n,r.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,o.getMaxAnisotropy())),i.get(s).__currentAnisotropy=s.anisotropy)}}function W(e,n){void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",G),e.__webglTexture=t.createTexture(),r.memory.textures++)}function A(e,i,o){let r=3553;i.isDataTexture2DArray&&(r=35866),i.isDataTexture3D&&(r=32879),W(e,i),n.activeTexture(33984+o),n.bindTexture(r,e.__webglTexture),t.pixelStorei(37440,i.flipY),t.pixelStorei(37441,i.premultiplyAlpha),t.pixelStorei(3317,i.unpackAlignment),t.pixelStorei(37443,0);const l=function(t){return!a&&(t.wrapS!==rc||t.wrapT!==rc||t.minFilter!==lc&&t.minFilter!==dc)}(i)&&!1===b(i.image),c=C(i.image,l,!1,g),d=b(c)||a,h=s.convert(i.format);let m,I=s.convert(i.type),u=Z(i.internalFormat,h,I);R(r,i,d);const J=i.mipmaps;if(i.isDepthTexture)u=6402,a?u=i.type===Cc?36012:i.type===uc?33190:i.type===pc?35056:33189:i.type===Cc&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),i.format===Jc&&6402===u&&i.type!==Ic&&i.type!==uc&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=Ic,I=s.convert(i.type)),i.format===Gc&&6402===u&&(u=34041,i.type!==pc&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=pc,I=s.convert(i.type))),n.texImage2D(3553,0,u,c.width,c.height,0,h,I,null);else if(i.isDataTexture)if(J.length>0&&d){for(let t=0,e=J.length;t<e;t++)m=J[t],n.texImage2D(3553,t,u,m.width,m.height,0,h,I,m.data);i.generateMipmaps=!1,e.__maxMipLevel=J.length-1}else n.texImage2D(3553,0,u,c.width,c.height,0,h,I,c.data),e.__maxMipLevel=0;else if(i.isCompressedTexture){for(let t=0,e=J.length;t<e;t++)m=J[t],i.format!==Zc&&i.format!==yc?null!==h?n.compressedTexImage2D(3553,t,u,m.width,m.height,0,m.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,t,u,m.width,m.height,0,h,I,m.data);e.__maxMipLevel=J.length-1}else if(i.isDataTexture2DArray)n.texImage3D(35866,0,u,c.width,c.height,c.depth,0,h,I,c.data),e.__maxMipLevel=0;else if(i.isDataTexture3D)n.texImage3D(32879,0,u,c.width,c.height,c.depth,0,h,I,c.data),e.__maxMipLevel=0;else if(J.length>0&&d){for(let t=0,e=J.length;t<e;t++)m=J[t],n.texImage2D(3553,t,u,h,I,m);i.generateMipmaps=!1,e.__maxMipLevel=J.length-1}else n.texImage2D(3553,0,u,h,I,c),e.__maxMipLevel=0;p(i,d)&&y(r,i,c.width,c.height),e.__version=i.version,i.onUpdate&&i.onUpdate(i)}function w(e,o,r,a,l){const c=s.convert(r.format),g=s.convert(r.type),d=Z(r.internalFormat,c,g);32879===l||35866===l?n.texImage3D(l,0,d,o.width,o.height,o.depth,0,c,g,null):n.texImage2D(l,0,d,o.width,o.height,0,c,g,null),n.bindFramebuffer(36160,e),t.framebufferTexture2D(36160,a,l,i.get(r).__webglTexture,0),n.bindFramebuffer(36160,null)}function Y(e,n,i){if(t.bindRenderbuffer(36161,e),n.depthBuffer&&!n.stencilBuffer){let o=33189;if(i){const e=n.depthTexture;e&&e.isDepthTexture&&(e.type===Cc?o=36012:e.type===uc&&(o=33190));const i=F(n);t.renderbufferStorageMultisample(36161,i,o,n.width,n.height)}else t.renderbufferStorage(36161,o,n.width,n.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(n.depthBuffer&&n.stencilBuffer){if(i){const e=F(n);t.renderbufferStorageMultisample(36161,e,35056,n.width,n.height)}else t.renderbufferStorage(36161,34041,n.width,n.height);t.framebufferRenderbuffer(36160,33306,36161,e)}else{const e=!0===n.isWebGLMultipleRenderTargets?n.texture[0]:n.texture,o=s.convert(e.format),r=s.convert(e.type),a=Z(e.internalFormat,o,r);if(i){const e=F(n);t.renderbufferStorageMultisample(36161,e,a,n.width,n.height)}else t.renderbufferStorage(36161,a,n.width,n.height)}t.bindRenderbuffer(36161,null)}function k(e){const o=i.get(e),s=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,o){if(o&&o.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,e),!o.depthTexture||!o.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(o.depthTexture).__webglTexture&&o.depthTexture.image.width===o.width&&o.depthTexture.image.height===o.height||(o.depthTexture.image.width=o.width,o.depthTexture.image.height=o.height,o.depthTexture.needsUpdate=!0),B(o.depthTexture,0);const s=i.get(o.depthTexture).__webglTexture;if(o.depthTexture.format===Jc)t.framebufferTexture2D(36160,36096,3553,s,0);else{if(o.depthTexture.format!==Gc)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(36160,33306,3553,s,0)}}(o.__webglFramebuffer,e)}else if(s){o.__webglDepthbuffer=[];for(let i=0;i<6;i++)n.bindFramebuffer(36160,o.__webglFramebuffer[i]),o.__webglDepthbuffer[i]=t.createRenderbuffer(),Y(o.__webglDepthbuffer[i],e,!1)}else n.bindFramebuffer(36160,o.__webglFramebuffer),o.__webglDepthbuffer=t.createRenderbuffer(),Y(o.__webglDepthbuffer,e,!1);n.bindFramebuffer(36160,null)}function F(t){return a&&t.isWebGLMultisampleRenderTarget?Math.min(d,t.samples):0}let H=!1,x=!1;this.allocateTextureUnit=function(){const t=S;return t>=l&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+l),S+=1,t},this.resetTextureUnits=function(){S=0},this.setTexture2D=B,this.setTexture2DArray=function(t,e){const o=i.get(t);t.version>0&&o.__version!==t.version?A(o,t,e):(n.activeTexture(33984+e),n.bindTexture(35866,o.__webglTexture))},this.setTexture3D=function(t,e){const o=i.get(t);t.version>0&&o.__version!==t.version?A(o,t,e):(n.activeTexture(33984+e),n.bindTexture(32879,o.__webglTexture))},this.setTextureCube=X,this.setupRenderTarget=function(e){const l=e.texture,c=i.get(e),g=i.get(l);e.addEventListener("dispose",V),!0!==e.isWebGLMultipleRenderTargets&&(g.__webglTexture=t.createTexture(),g.__version=l.version,r.memory.textures++);const d=!0===e.isWebGLCubeRenderTarget,h=!0===e.isWebGLMultipleRenderTargets,m=!0===e.isWebGLMultisampleRenderTarget,I=l.isDataTexture3D||l.isDataTexture2DArray,u=b(e)||a;if(!a||l.format!==yc||l.type!==Cc&&l.type!==bc||(l.format=Zc,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),d){c.__webglFramebuffer=[];for(let e=0;e<6;e++)c.__webglFramebuffer[e]=t.createFramebuffer()}else if(c.__webglFramebuffer=t.createFramebuffer(),h)if(o.drawBuffers){const n=e.texture;for(let e=0,o=n.length;e<o;e++){const o=i.get(n[e]);void 0===o.__webglTexture&&(o.__webglTexture=t.createTexture(),r.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(m)if(a){c.__webglMultisampledFramebuffer=t.createFramebuffer(),c.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,c.__webglColorRenderbuffer);const i=s.convert(l.format),o=s.convert(l.type),r=Z(l.internalFormat,i,o),a=F(e);t.renderbufferStorageMultisample(36161,a,r,e.width,e.height),n.bindFramebuffer(36160,c.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,c.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),e.depthBuffer&&(c.__webglDepthRenderbuffer=t.createRenderbuffer(),Y(c.__webglDepthRenderbuffer,e,!0)),n.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(d){n.bindTexture(34067,g.__webglTexture),R(34067,l,u);for(let t=0;t<6;t++)w(c.__webglFramebuffer[t],e,l,36064,34069+t);p(l,u)&&y(34067,l,e.width,e.height),n.bindTexture(34067,null)}else if(h){const t=e.texture;for(let o=0,s=t.length;o<s;o++){const s=t[o],r=i.get(s);n.bindTexture(3553,r.__webglTexture),R(3553,s,u),w(c.__webglFramebuffer,e,s,36064+o,3553),p(s,u)&&y(3553,s,e.width,e.height)}n.bindTexture(3553,null)}else{let t=3553;I&&(a?t=l.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),n.bindTexture(t,g.__webglTexture),R(t,l,u),w(c.__webglFramebuffer,e,l,36064,t),p(l,u)&&y(t,l,e.width,e.height,e.depth),n.bindTexture(t,null)}e.depthBuffer&&k(e)},this.updateRenderTargetMipmap=function(t){const e=b(t)||a,o=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture];for(let s=0,r=o.length;s<r;s++){const r=o[s];if(p(r,e)){const e=t.isWebGLCubeRenderTarget?34067:3553,o=i.get(r).__webglTexture;n.bindTexture(e,o),y(e,r,t.width,t.height),n.bindTexture(e,null)}}},this.updateMultisampleRenderTarget=function(e){if(e.isWebGLMultisampleRenderTarget)if(a){const o=e.width,s=e.height;let r=16384;e.depthBuffer&&(r|=256),e.stencilBuffer&&(r|=1024);const a=i.get(e);n.bindFramebuffer(36008,a.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,a.__webglFramebuffer),t.blitFramebuffer(0,0,o,s,0,0,o,s,r,9728),n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,a.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(t,e){t&&t.isWebGLRenderTarget&&(!1===H&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),H=!0),t=t.texture),B(t,e)},this.safeSetTextureCube=function(t,e){t&&t.isWebGLCubeRenderTarget&&(!1===x&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),x=!0),t=t.texture),X(t,e)}}function HI(t,e,n){const i=n.isWebGL2;return{convert:function(t){let n;if(t===mc)return 5121;if(1017===t)return 32819;if(1018===t)return 32820;if(1019===t)return 33635;if(1010===t)return 5120;if(1011===t)return 5122;if(t===Ic)return 5123;if(1013===t)return 5124;if(t===uc)return 5125;if(t===Cc)return 5126;if(t===bc)return i?5131:(n=e.get("OES_texture_half_float"),null!==n?n.HALF_FLOAT_OES:null);if(1021===t)return 6406;if(t===yc)return 6407;if(t===Zc)return 6408;if(1024===t)return 6409;if(1025===t)return 6410;if(t===Jc)return 6402;if(t===Gc)return 34041;if(1028===t)return 6403;if(1029===t)return 36244;if(1030===t)return 33319;if(1031===t)return 33320;if(1032===t)return 36248;if(1033===t)return 36249;if(33776===t||33777===t||33778===t||33779===t){if(n=e.get("WEBGL_compressed_texture_s3tc"),null===n)return null;if(33776===t)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===t)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===t)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===t)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===t||35841===t||35842===t||35843===t){if(n=e.get("WEBGL_compressed_texture_pvrtc"),null===n)return null;if(35840===t)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===t)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===t)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===t)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===t)return n=e.get("WEBGL_compressed_texture_etc1"),null!==n?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((37492===t||37496===t)&&(n=e.get("WEBGL_compressed_texture_etc"),null!==n)){if(37492===t)return n.COMPRESSED_RGB8_ETC2;if(37496===t)return n.COMPRESSED_RGBA8_ETC2_EAC}return 37808===t||37809===t||37810===t||37811===t||37812===t||37813===t||37814===t||37815===t||37816===t||37817===t||37818===t||37819===t||37820===t||37821===t||37840===t||37841===t||37842===t||37843===t||37844===t||37845===t||37846===t||37847===t||37848===t||37849===t||37850===t||37851===t||37852===t||37853===t?(n=e.get("WEBGL_compressed_texture_astc"),null!==n?t:null):36492===t?(n=e.get("EXT_texture_compression_bptc"),null!==n?t:null):t===pc?i?34042:(n=e.get("WEBGL_depth_texture"),null!==n?n.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}wI.prototype.isMeshDistanceMaterial=!0;class xI extends bh{constructor(t=[]){super(),this.cameras=t}}xI.prototype.isArrayCamera=!0;class NI extends cd{constructor(){super(),this.type="Group"}}NI.prototype.isGroup=!0;const TI={type:"move"};class MI{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new NI,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new NI,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ag,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ag),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new NI,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ag,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ag),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,n){let i=null,o=null,s=null;const r=this._targetRay,a=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState)if(null!==r&&(i=e.getPose(t.targetRaySpace,n),null!==i&&(r.matrix.fromArray(i.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),i.linearVelocity?(r.hasLinearVelocity=!0,r.linearVelocity.copy(i.linearVelocity)):r.hasLinearVelocity=!1,i.angularVelocity?(r.hasAngularVelocity=!0,r.angularVelocity.copy(i.angularVelocity)):r.hasAngularVelocity=!1,this.dispatchEvent(TI))),l&&t.hand){s=!0;for(const s of t.hand.values()){const t=e.getJointPose(s,n);if(void 0===l.joints[s.jointName]){const t=new NI;t.matrixAutoUpdate=!1,t.visible=!1,l.joints[s.jointName]=t,l.add(t)}const i=l.joints[s.jointName];null!==t&&(i.matrix.fromArray(t.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.jointRadius=t.radius),i.visible=null!==t}const i=l.joints["index-finger-tip"],o=l.joints["thumb-tip"],r=i.position.distanceTo(o.position),a=.02,c=.005;l.inputState.pinching&&r>a+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&r<=a-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==a&&t.gripSpace&&(o=e.getPose(t.gripSpace,n),null!==o&&(a.matrix.fromArray(o.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),o.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(o.linearVelocity)):a.hasLinearVelocity=!1,o.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(o.angularVelocity)):a.hasAngularVelocity=!1));return null!==r&&(r.visible=null!==i),null!==a&&(a.visible=null!==o),null!==l&&(l.visible=null!==s),this}}class UI extends xc{constructor(t,e){super();const n=this,i=t.state;let o=null,s=1,r=null,a="local-floor",l=null,c=null,g=null,d=null;const h=[],m=new Map,I=new bh;I.layers.enable(1),I.viewport=new ig;const u=new bh;u.layers.enable(2),u.viewport=new ig;const C=[I,u],b=new xI;b.layers.enable(1),b.layers.enable(2);let p=null,y=null;function Z(t){const e=m.get(t.inputSource);e&&e.dispatchEvent({type:t.type,data:t.inputSource})}function J(){m.forEach((function(t,e){t.disconnect(e)})),m.clear(),p=null,y=null,i.bindXRFramebuffer(null),t.setRenderTarget(t.getRenderTarget()),v.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function G(t){const e=o.inputSources;for(let n=0;n<h.length;n++)m.set(e[n],h[n]);for(let n=0;n<t.removed.length;n++){const e=t.removed[n],i=m.get(e);i&&(i.dispatchEvent({type:"disconnected",data:e}),m.delete(e))}for(let n=0;n<t.added.length;n++){const e=t.added[n],i=m.get(e);i&&i.dispatchEvent({type:"connected",data:e})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=h[t];return void 0===e&&(e=new MI,h[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=h[t];return void 0===e&&(e=new MI,h[t]=e),e.getGripSpace()},this.getHand=function(t){let e=h[t];return void 0===e&&(e=new MI,h[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){s=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){a=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return r},this.getSession=function(){return o},this.setSession=async function(t){if(o=t,null!==o){o.addEventListener("select",Z),o.addEventListener("selectstart",Z),o.addEventListener("selectend",Z),o.addEventListener("squeeze",Z),o.addEventListener("squeezestart",Z),o.addEventListener("squeezeend",Z),o.addEventListener("end",J),o.addEventListener("inputsourceschange",G);const t=e.getContextAttributes();if(!0!==t.xrCompatible&&await e.makeXRCompatible(),void 0===o.renderState.layers){const n={antialias:t.antialias,alpha:t.alpha,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:s},i=new XRWebGLLayer(o,e,n);o.updateRenderState({baseLayer:i})}else{let n=0;t.depth&&(n=t.stencil?34041:6402);const i={colorFormat:t.alpha?6408:6407,depthFormat:n,scaleFactor:s};c=new XRWebGLBinding(o,e),d=c.createProjectionLayer(i),g=e.createFramebuffer(),o.updateRenderState({layers:[d]})}r=await o.requestReferenceSpace(a),v.setContext(o),v.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};const V=new ag,S=new ag;function B(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===o)return;b.near=u.near=I.near=t.near,b.far=u.far=I.far=t.far,p===b.near&&y===b.far||(o.updateRenderState({depthNear:b.near,depthFar:b.far}),p=b.near,y=b.far);const e=t.parent,n=b.cameras;B(b,e);for(let o=0;o<n.length;o++)B(n[o],e);b.matrixWorld.decompose(b.position,b.quaternion,b.scale),t.position.copy(b.position),t.quaternion.copy(b.quaternion),t.scale.copy(b.scale),t.matrix.copy(b.matrix),t.matrixWorld.copy(b.matrixWorld);const i=t.children;for(let o=0,s=i.length;o<s;o++)i[o].updateMatrixWorld(!0);2===n.length?function(t,e,n){V.setFromMatrixPosition(e.matrixWorld),S.setFromMatrixPosition(n.matrixWorld);const i=V.distanceTo(S),o=e.projectionMatrix.elements,s=n.projectionMatrix.elements,r=o[14]/(o[10]-1),a=o[14]/(o[10]+1),l=(o[9]+1)/o[5],c=(o[9]-1)/o[5],g=(o[8]-1)/o[0],d=(s[8]+1)/s[0],h=r*g,m=r*d,I=i/(-g+d),u=I*-g;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(u),t.translateZ(I),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const C=r+I,b=a+I,p=h-u,y=m+(i-u),Z=l*a/b*C,J=c*a/b*C;t.projectionMatrix.makePerspective(p,y,Z,J,C,b)}(b,I,u):b.projectionMatrix.copy(I.projectionMatrix)},this.getCamera=function(){return b};let X=null;const v=new Rh;v.setAnimationLoop((function(t,n){if(l=n.getViewerPose(r),null!==l){const t=l.views,n=o.renderState.baseLayer;void 0===o.renderState.layers&&i.bindXRFramebuffer(n.framebuffer);let s=!1;t.length!==b.cameras.length&&(b.cameras.length=0,s=!0);for(let r=0;r<t.length;r++){const a=t[r];let l=null;if(void 0===o.renderState.layers)l=n.getViewport(a);else{const t=c.getViewSubImage(d,a);i.bindXRFramebuffer(g),e.framebufferTexture2D(36160,36064,3553,t.colorTexture,0),void 0!==t.depthStencilTexture&&e.framebufferTexture2D(36160,36096,3553,t.depthStencilTexture,0),l=t.viewport}const h=C[r];h.matrix.fromArray(a.transform.matrix),h.projectionMatrix.fromArray(a.projectionMatrix),h.viewport.set(l.x,l.y,l.width,l.height),0===r&&b.matrix.copy(h.matrix),!0===s&&b.cameras.push(h)}}const s=o.inputSources;for(let e=0;e<h.length;e++){const t=h[e],i=s[e];t.update(i,n,r)}X&&X(t,n)})),this.setAnimationLoop=function(t){X=t},this.dispose=function(){}}}function KI(t){function e(e,n){e.opacity.value=n.opacity,n.color&&e.diffuse.value.copy(n.color),n.emissive&&e.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(e.map.value=n.map),n.alphaMap&&(e.alphaMap.value=n.alphaMap),n.specularMap&&(e.specularMap.value=n.specularMap);const i=t.get(n).envMap;if(i){e.envMap.value=i,e.flipEnvMap.value=i.isCubeTexture&&i._needsFlipEnvMap?-1:1,e.reflectivity.value=n.reflectivity,e.refractionRatio.value=n.refractionRatio;const o=t.get(i).__maxMipLevel;void 0!==o&&(e.maxMipLevel.value=o)}let o,s;n.lightMap&&(e.lightMap.value=n.lightMap,e.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(e.aoMap.value=n.aoMap,e.aoMapIntensity.value=n.aoMapIntensity),n.map?o=n.map:n.specularMap?o=n.specularMap:n.displacementMap?o=n.displacementMap:n.normalMap?o=n.normalMap:n.bumpMap?o=n.bumpMap:n.roughnessMap?o=n.roughnessMap:n.metalnessMap?o=n.metalnessMap:n.alphaMap?o=n.alphaMap:n.emissiveMap?o=n.emissiveMap:n.clearcoatMap?o=n.clearcoatMap:n.clearcoatNormalMap?o=n.clearcoatNormalMap:n.clearcoatRoughnessMap&&(o=n.clearcoatRoughnessMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),e.uvTransform.value.copy(o.matrix)),n.aoMap?s=n.aoMap:n.lightMap&&(s=n.lightMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),e.uv2Transform.value.copy(s.matrix))}function n(e,n){e.roughness.value=n.roughness,e.metalness.value=n.metalness,n.roughnessMap&&(e.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(e.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(e.emissiveMap.value=n.emissiveMap),n.bumpMap&&(e.bumpMap.value=n.bumpMap,e.bumpScale.value=n.bumpScale,1===n.side&&(e.bumpScale.value*=-1)),n.normalMap&&(e.normalMap.value=n.normalMap,e.normalScale.value.copy(n.normalScale),1===n.side&&e.normalScale.value.negate()),n.displacementMap&&(e.displacementMap.value=n.displacementMap,e.displacementScale.value=n.displacementScale,e.displacementBias.value=n.displacementBias),t.get(n).envMap&&(e.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,i,o,s,r){i.isMeshBasicMaterial?e(t,i):i.isMeshLambertMaterial?(e(t,i),function(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}(t,i)):i.isMeshToonMaterial?(e(t,i),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isMeshPhongMaterial?(e(t,i),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isMeshStandardMaterial?(e(t,i),i.isMeshPhysicalMaterial?function(t,e,i){n(t,e),t.reflectivity.value=e.reflectivity,t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.sheen&&t.sheen.value.copy(e.sheen),e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap),e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,1===e.side&&t.clearcoatNormalScale.value.negate()),t.transmission.value=e.transmission,e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap),e.transmission>0&&(t.transmissionSamplerMap.value=i.texture,t.transmissionSamplerSize.value.set(i.width,i.height)),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor)}(t,i,r):n(t,i)):i.isMeshMatcapMaterial?(e(t,i),function(t,e){e.matcap&&(t.matcap.value=e.matcap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isMeshDepthMaterial?(e(t,i),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isMeshDistanceMaterial?(e(t,i),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,i)):i.isMeshNormalMaterial?(e(t,i),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,i),i.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,i)):i.isPointsMaterial?function(t,e,n,i){let o;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*n,t.scale.value=.5*i,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.map?o=e.map:e.alphaMap&&(o=e.alphaMap),void 0!==o&&(!0===o.matrixAutoUpdate&&o.updateMatrix(),t.uvTransform.value.copy(o.matrix))}(t,i,o,s):i.isSpriteMaterial?function(t,e){let n;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.map?n=e.map:e.alphaMap&&(n=e.alphaMap),void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),t.uvTransform.value.copy(n.matrix))}(t,i):i.isShadowMaterial?(t.color.value.copy(i.color),t.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function EI(t={}){const e=void 0!==t.canvas?t.canvas:function(){const t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return t.style.display="block",t}(),n=void 0!==t.context?t.context:null,i=void 0!==t.alpha&&t.alpha,o=void 0===t.depth||t.depth,s=void 0===t.stencil||t.stencil,r=void 0!==t.antialias&&t.antialias,a=void 0===t.premultipliedAlpha||t.premultipliedAlpha,l=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,c=void 0!==t.powerPreference?t.powerPreference:"default",g=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;let d=null,h=null;const m=[],I=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Ac,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const u=this;let C=!1,b=0,p=0,y=null,Z=-1,J=null;const G=new ig,V=new ig;let S=null,B=e.width,X=e.height,v=1,f=null,R=null;const W=new ig(0,0,B,X),A=new ig(0,0,B,X);let w=!1;const Y=[],k=new fh;let F=!1,H=!1,x=null;const N=new Ng,T=new ag,M={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function U(){return null===y?v:1}let K,E,L,D,Q,z,P,_,O,j,q,$,tt,et,nt,it,ot,st,rt,at,lt,ct,gt=n;function dt(t,n){for(let i=0;i<t.length;i++){const o=t[i],s=e.getContext(o,n);if(null!==s)return s}return null}try{const t={alpha:i,depth:o,stencil:s,antialias:r,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:g};if(e.addEventListener("webglcontextlost",It,!1),e.addEventListener("webglcontextrestored",ut,!1),null===gt){const e=["webgl2","webgl","experimental-webgl"];if(!0===u.isWebGL1Renderer&&e.shift(),gt=dt(e,t),null===gt)throw dt(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===gt.getShaderPrecisionFormat&&(gt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function ht(){K=new Uh(gt),E=new Nh(gt,K,t),K.init(E),lt=new HI(gt,K,E),L=new kI(gt,K,E),Y[0]=1029,D=new Lh(gt),Q=new ZI,z=new FI(gt,K,L,Q,E,lt,D),P=new Mh(u),_=new Wh(gt,E),ct=new Hh(gt,K,_,E),O=new Kh(gt,_,D,ct),j=new Ph(gt,O,_,D),st=new zh(gt),nt=new Th(Q),q=new yI(u,P,K,E,ct,nt),$=new KI(Q),tt=new SI(Q),et=new WI(K,E),ot=new Fh(u,P,L,j,a),it=new YI(u,j,E),rt=new xh(gt,K,D,E),at=new Eh(gt,K,D,E),D.programs=q.programs,u.capabilities=E,u.extensions=K,u.properties=Q,u.renderLists=tt,u.shadowMap=it,u.state=L,u.info=D}ht();const mt=new UI(u,gt);function It(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),C=!0}function ut(){console.log("THREE.WebGLRenderer: Context Restored."),C=!1;const t=D.autoReset,e=it.enabled,n=it.autoUpdate,i=it.needsUpdate,o=it.type;ht(),D.autoReset=t,it.enabled=e,it.autoUpdate=n,it.needsUpdate=i,it.type=o}function Ct(t){const e=t.target;e.removeEventListener("dispose",Ct),function(t){(function(t){const e=Q.get(t).programs;void 0!==e&&e.forEach((function(t){q.releaseProgram(t)}))})(t),Q.remove(t)}(e)}this.xr=mt,this.getContext=function(){return gt},this.getContextAttributes=function(){return gt.getContextAttributes()},this.forceContextLoss=function(){const t=K.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=K.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return v},this.setPixelRatio=function(t){void 0!==t&&(v=t,this.setSize(B,X,!1))},this.getSize=function(t){return t.set(B,X)},this.setSize=function(t,n,i){mt.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(B=t,X=n,e.width=Math.floor(t*v),e.height=Math.floor(n*v),!1!==i&&(e.style.width=t+"px",e.style.height=n+"px"),this.setViewport(0,0,t,n))},this.getDrawingBufferSize=function(t){return t.set(B*v,X*v).floor()},this.setDrawingBufferSize=function(t,n,i){B=t,X=n,v=i,e.width=Math.floor(t*i),e.height=Math.floor(n*i),this.setViewport(0,0,t,n)},this.getCurrentViewport=function(t){return t.copy(G)},this.getViewport=function(t){return t.copy(W)},this.setViewport=function(t,e,n,i){t.isVector4?W.set(t.x,t.y,t.z,t.w):W.set(t,e,n,i),L.viewport(G.copy(W).multiplyScalar(v).floor())},this.getScissor=function(t){return t.copy(A)},this.setScissor=function(t,e,n,i){t.isVector4?A.set(t.x,t.y,t.z,t.w):A.set(t,e,n,i),L.scissor(V.copy(A).multiplyScalar(v).floor())},this.getScissorTest=function(){return w},this.setScissorTest=function(t){L.setScissorTest(w=t)},this.setOpaqueSort=function(t){f=t},this.setTransparentSort=function(t){R=t},this.getClearColor=function(t){return t.copy(ot.getClearColor())},this.setClearColor=function(){ot.setClearColor.apply(ot,arguments)},this.getClearAlpha=function(){return ot.getClearAlpha()},this.setClearAlpha=function(){ot.setClearAlpha.apply(ot,arguments)},this.clear=function(t,e,n){let i=0;(void 0===t||t)&&(i|=16384),(void 0===e||e)&&(i|=256),(void 0===n||n)&&(i|=1024),gt.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",It,!1),e.removeEventListener("webglcontextrestored",ut,!1),tt.dispose(),et.dispose(),Q.dispose(),P.dispose(),j.dispose(),ct.dispose(),mt.dispose(),mt.removeEventListener("sessionstart",pt),mt.removeEventListener("sessionend",yt),x&&(x.dispose(),x=null),Zt.stop()},this.renderBufferImmediate=function(t,e){ct.initAttributes();const n=Q.get(t);t.hasPositions&&!n.position&&(n.position=gt.createBuffer()),t.hasNormals&&!n.normal&&(n.normal=gt.createBuffer()),t.hasUvs&&!n.uv&&(n.uv=gt.createBuffer()),t.hasColors&&!n.color&&(n.color=gt.createBuffer());const i=e.getAttributes();t.hasPositions&&(gt.bindBuffer(34962,n.position),gt.bufferData(34962,t.positionArray,35048),ct.enableAttribute(i.position),gt.vertexAttribPointer(i.position,3,5126,!1,0,0)),t.hasNormals&&(gt.bindBuffer(34962,n.normal),gt.bufferData(34962,t.normalArray,35048),ct.enableAttribute(i.normal),gt.vertexAttribPointer(i.normal,3,5126,!1,0,0)),t.hasUvs&&(gt.bindBuffer(34962,n.uv),gt.bufferData(34962,t.uvArray,35048),ct.enableAttribute(i.uv),gt.vertexAttribPointer(i.uv,2,5126,!1,0,0)),t.hasColors&&(gt.bindBuffer(34962,n.color),gt.bufferData(34962,t.colorArray,35048),ct.enableAttribute(i.color),gt.vertexAttribPointer(i.color,3,5126,!1,0,0)),ct.disableUnusedAttributes(),gt.drawArrays(4,0,t.count),t.count=0},this.renderBufferDirect=function(t,e,n,i,o,s){null===e&&(e=M);const r=o.isMesh&&o.matrixWorld.determinant()<0,a=Xt(t,e,i,o);L.setMaterial(i,r);let l=n.index;const c=n.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;let g,d=1;!0===i.wireframe&&(l=O.getWireframeAttribute(n),d=2),(i.morphTargets||i.morphNormals)&&st.update(o,n,i,a),ct.setup(o,i,a,n,l);let h=rt;null!==l&&(g=_.get(l),h=at,h.setIndex(g));const m=null!==l?l.count:c.count,I=n.drawRange.start*d,u=n.drawRange.count*d,C=null!==s?s.start*d:0,b=null!==s?s.count*d:1/0,p=Math.max(I,C),y=Math.min(m,I+u,C+b)-1,Z=Math.max(0,y-p+1);if(0!==Z){if(o.isMesh)!0===i.wireframe?(L.setLineWidth(i.wireframeLinewidth*U()),h.setMode(1)):h.setMode(4);else if(o.isLine){let t=i.linewidth;void 0===t&&(t=1),L.setLineWidth(t*U()),o.isLineSegments?h.setMode(1):o.isLineLoop?h.setMode(2):h.setMode(3)}else o.isPoints?h.setMode(0):o.isSprite&&h.setMode(4);if(o.isInstancedMesh)h.renderInstances(p,Z,o.count);else if(n.isInstancedBufferGeometry){const t=Math.min(n.instanceCount,n._maxInstanceCount);h.renderInstances(p,Z,t)}else h.render(p,Z)}},this.compile=function(t,e){h=et.get(t),h.init(),t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(h.pushLight(t),t.castShadow&&h.pushShadow(t))})),h.setupLights(),t.traverse((function(e){const n=e.material;if(n)if(Array.isArray(n))for(let i=0;i<n.length;i++)St(n[i],t,e);else St(n,t,e)}))};let bt=null;function pt(){Zt.stop()}function yt(){Zt.start()}const Zt=new Rh;function Jt(t,e,n,i){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)h.pushLight(t),t.castShadow&&h.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||k.intersectsSprite(t)){i&&T.setFromMatrixPosition(t.matrixWorld).applyMatrix4(N);const e=j.update(t),o=t.material;o.visible&&d.push(t,e,o,n,T.z,null)}}else if(t.isImmediateRenderObject)i&&T.setFromMatrixPosition(t.matrixWorld).applyMatrix4(N),d.push(t,null,t.material,n,T.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==D.render.frame&&(t.skeleton.update(),t.skeleton.frame=D.render.frame),!t.frustumCulled||k.intersectsObject(t))){i&&T.setFromMatrixPosition(t.matrixWorld).applyMatrix4(N);const e=j.update(t),o=t.material;if(Array.isArray(o)){const i=e.groups;for(let s=0,r=i.length;s<r;s++){const r=i[s],a=o[r.materialIndex];a&&a.visible&&d.push(t,e,a,n,T.z,r)}}else o.visible&&d.push(t,e,o,n,T.z,null)}const o=t.children;for(let s=0,r=o.length;s<r;s++)Jt(o[s],e,n,i)}function Gt(t,e,n){const i=!0===e.isScene?e.overrideMaterial:null;for(let o=0,s=t.length;o<s;o++){const s=t[o],r=s.object,a=s.geometry,l=null===i?s.material:i,c=s.group;if(n.isArrayCamera){const t=n.cameras;for(let n=0,i=t.length;n<i;n++){const i=t[n];r.layers.test(i.layers)&&(L.viewport(G.copy(i.viewport)),h.setupLightsView(i),Vt(r,e,i,a,l,c))}}else Vt(r,e,n,a,l,c)}}function Vt(t,e,n,i,o,s){if(t.onBeforeRender(u,e,n,i,o,s),t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){const i=Xt(n,e,o,t);L.setMaterial(o),ct.reset(),function(t,e){t.render((function(t){u.renderBufferImmediate(t,e)}))}(t,i)}else!0===o.transparent&&2===o.side?(o.side=1,o.needsUpdate=!0,u.renderBufferDirect(n,e,i,o,t,s),o.side=0,o.needsUpdate=!0,u.renderBufferDirect(n,e,i,o,t,s),o.side=2):u.renderBufferDirect(n,e,i,o,t,s);t.onAfterRender(u,e,n,i,o,s)}function St(t,e,n){!0!==e.isScene&&(e=M);const i=Q.get(t),o=h.state.lights,s=h.state.shadowsArray,r=o.state.version,a=q.getParameters(t,o.state,s,e,n),l=q.getProgramCacheKey(a);let c=i.programs;i.environment=t.isMeshStandardMaterial?e.environment:null,i.fog=e.fog,i.envMap=P.get(t.envMap||i.environment),void 0===c&&(t.addEventListener("dispose",Ct),c=new Map,i.programs=c);let g=c.get(l);if(void 0!==g){if(i.currentProgram===g&&i.lightsStateVersion===r)return Bt(t,a),g}else a.uniforms=q.getUniforms(t),t.onBuild(a,u),t.onBeforeCompile(a,u),g=q.acquireProgram(a,l),c.set(l,g),i.uniforms=a.uniforms;const d=i.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(d.clippingPlanes=nt.uniform),Bt(t,a),i.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),i.lightsStateVersion=r,i.needsLights&&(d.ambientLightColor.value=o.state.ambient,d.lightProbe.value=o.state.probe,d.directionalLights.value=o.state.directional,d.directionalLightShadows.value=o.state.directionalShadow,d.spotLights.value=o.state.spot,d.spotLightShadows.value=o.state.spotShadow,d.rectAreaLights.value=o.state.rectArea,d.ltc_1.value=o.state.rectAreaLTC1,d.ltc_2.value=o.state.rectAreaLTC2,d.pointLights.value=o.state.point,d.pointLightShadows.value=o.state.pointShadow,d.hemisphereLights.value=o.state.hemi,d.directionalShadowMap.value=o.state.directionalShadowMap,d.directionalShadowMatrix.value=o.state.directionalShadowMatrix,d.spotShadowMap.value=o.state.spotShadowMap,d.spotShadowMatrix.value=o.state.spotShadowMatrix,d.pointShadowMap.value=o.state.pointShadowMap,d.pointShadowMatrix.value=o.state.pointShadowMatrix);const m=g.getUniforms(),I=qm.seqWithValue(m.seq,d);return i.currentProgram=g,i.uniformsList=I,g}function Bt(t,e){const n=Q.get(t);n.outputEncoding=e.outputEncoding,n.instancing=e.instancing,n.skinning=e.skinning,n.numClippingPlanes=e.numClippingPlanes,n.numIntersection=e.numClipIntersection,n.vertexAlphas=e.vertexAlphas}function Xt(t,e,n,i){!0!==e.isScene&&(e=M),z.resetTextureUnits();const o=e.fog,s=n.isMeshStandardMaterial?e.environment:null,r=null===y?u.outputEncoding:y.texture.encoding,a=P.get(n.envMap||s),l=!0===n.vertexColors&&i.geometry&&i.geometry.attributes.color&&4===i.geometry.attributes.color.itemSize,c=Q.get(n),g=h.state.lights;if(!0===F&&(!0===H||t!==J)){const e=t===J&&n.id===Z;nt.setState(n,t,e)}let d=!1;n.version===c.__version?c.needsLights&&c.lightsStateVersion!==g.state.version||c.outputEncoding!==r||i.isInstancedMesh&&!1===c.instancing?d=!0:i.isInstancedMesh||!0!==c.instancing?i.isSkinnedMesh&&!1===c.skinning?d=!0:i.isSkinnedMesh||!0!==c.skinning?c.envMap!==a||n.fog&&c.fog!==o?d=!0:void 0===c.numClippingPlanes||c.numClippingPlanes===nt.numPlanes&&c.numIntersection===nt.numIntersection?c.vertexAlphas!==l&&(d=!0):d=!0:d=!0:d=!0:(d=!0,c.__version=n.version);let m=c.currentProgram;!0===d&&(m=St(n,e,i));let I=!1,C=!1,b=!1;const p=m.getUniforms(),G=c.uniforms;if(L.useProgram(m.program)&&(I=!0,C=!0,b=!0),n.id!==Z&&(Z=n.id,C=!0),I||J!==t){if(p.setValue(gt,"projectionMatrix",t.projectionMatrix),E.logarithmicDepthBuffer&&p.setValue(gt,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),J!==t&&(J=t,C=!0,b=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const e=p.map.cameraPosition;void 0!==e&&e.setValue(gt,T.setFromMatrixPosition(t.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&p.setValue(gt,"isOrthographic",!0===t.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||i.isSkinnedMesh)&&p.setValue(gt,"viewMatrix",t.matrixWorldInverse)}if(i.isSkinnedMesh){p.setOptional(gt,i,"bindMatrix"),p.setOptional(gt,i,"bindMatrixInverse");const t=i.skeleton;t&&(E.floatVertexTextures?(null===t.boneTexture&&t.computeBoneTexture(),p.setValue(gt,"boneTexture",t.boneTexture,z),p.setValue(gt,"boneTextureSize",t.boneTextureSize)):p.setOptional(gt,t,"boneMatrices"))}var V,S;return(C||c.receiveShadow!==i.receiveShadow)&&(c.receiveShadow=i.receiveShadow,p.setValue(gt,"receiveShadow",i.receiveShadow)),C&&(p.setValue(gt,"toneMappingExposure",u.toneMappingExposure),c.needsLights&&(S=b,(V=G).ambientLightColor.needsUpdate=S,V.lightProbe.needsUpdate=S,V.directionalLights.needsUpdate=S,V.directionalLightShadows.needsUpdate=S,V.pointLights.needsUpdate=S,V.pointLightShadows.needsUpdate=S,V.spotLights.needsUpdate=S,V.spotLightShadows.needsUpdate=S,V.rectAreaLights.needsUpdate=S,V.hemisphereLights.needsUpdate=S),o&&n.fog&&$.refreshFogUniforms(G,o),$.refreshMaterialUniforms(G,n,v,X,x),qm.upload(gt,c.uniformsList,G,z)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(qm.upload(gt,c.uniformsList,G,z),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&p.setValue(gt,"center",i.center),p.setValue(gt,"modelViewMatrix",i.modelViewMatrix),p.setValue(gt,"normalMatrix",i.normalMatrix),p.setValue(gt,"modelMatrix",i.matrixWorld),m}Zt.setAnimationLoop((function(t){bt&&bt(t)})),"undefined"!=typeof window&&Zt.setContext(window),this.setAnimationLoop=function(t){bt=t,mt.setAnimationLoop(t),null===t?Zt.stop():Zt.start()},mt.addEventListener("sessionstart",pt),mt.addEventListener("sessionend",yt),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===C)return;!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===mt.enabled&&!0===mt.isPresenting&&(!0===mt.cameraAutoUpdate&&mt.updateCamera(e),e=mt.getCamera()),!0===t.isScene&&t.onBeforeRender(u,t,e,y),h=et.get(t,I.length),h.init(),I.push(h),N.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),k.setFromProjectionMatrix(N),H=this.localClippingEnabled,F=nt.init(this.clippingPlanes,H,e),d=tt.get(t,m.length),d.init(),m.push(d),Jt(t,e,0,u.sortObjects),d.finish(),!0===u.sortObjects&&d.sort(f,R),!0===F&&nt.beginShadows();const n=h.state.shadowsArray;it.render(n,t,e),h.setupLights(),h.setupLightsView(e),!0===F&&nt.endShadows(),!0===this.info.autoReset&&this.info.reset(),ot.render(d,t);const i=d.opaque,o=d.transmissive,s=d.transparent;i.length>0&&Gt(i,t,e),o.length>0&&function(t,e,n,i){if(null===x){const t=!0===r&&!0===E.isWebGL2;x=new(t?sg:og)(1024,1024,{generateMipmaps:!0,type:null!==lt.convert(bc)?bc:mc,minFilter:hc,magFilter:lc,wrapS:rc,wrapT:rc})}const o=u.getRenderTarget();u.setRenderTarget(x),u.clear();const s=u.toneMapping;u.toneMapping=0,Gt(t,n,i),u.toneMapping=s,z.updateMultisampleRenderTarget(x),z.updateRenderTargetMipmap(x),u.setRenderTarget(o),Gt(e,n,i)}(i,o,t,e),s.length>0&&Gt(s,t,e),null!==y&&(z.updateMultisampleRenderTarget(y),z.updateRenderTargetMipmap(y)),!0===t.isScene&&t.onAfterRender(u,t,e),L.buffers.depth.setTest(!0),L.buffers.depth.setMask(!0),L.buffers.color.setMask(!0),L.setPolygonOffset(!1),ct.resetDefaultState(),Z=-1,J=null,I.pop(),h=I.length>0?I[I.length-1]:null,m.pop(),d=m.length>0?m[m.length-1]:null},this.getActiveCubeFace=function(){return b},this.getActiveMipmapLevel=function(){return p},this.getRenderTarget=function(){return y},this.setRenderTarget=function(t,e=0,n=0){y=t,b=e,p=n,t&&void 0===Q.get(t).__webglFramebuffer&&z.setupRenderTarget(t);let i=null,o=!1,s=!1;if(t){const n=t.texture;(n.isDataTexture3D||n.isDataTexture2DArray)&&(s=!0);const r=Q.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(i=r[e],o=!0):i=t.isWebGLMultisampleRenderTarget?Q.get(t).__webglMultisampledFramebuffer:r,G.copy(t.viewport),V.copy(t.scissor),S=t.scissorTest}else G.copy(W).multiplyScalar(v).floor(),V.copy(A).multiplyScalar(v).floor(),S=w;if(L.bindFramebuffer(36160,i)&&E.drawBuffers){let e=!1;if(t)if(t.isWebGLMultipleRenderTargets){const n=t.texture;if(Y.length!==n.length||36064!==Y[0]){for(let t=0,e=n.length;t<e;t++)Y[t]=36064+t;Y.length=n.length,e=!0}}else 1===Y.length&&36064===Y[0]||(Y[0]=36064,Y.length=1,e=!0);else 1===Y.length&&1029===Y[0]||(Y[0]=1029,Y.length=1,e=!0);e&&(E.isWebGL2?gt.drawBuffers(Y):K.get("WEBGL_draw_buffers").drawBuffersWEBGL(Y))}if(L.viewport(G),L.scissor(V),L.setScissorTest(S),o){const i=Q.get(t.texture);gt.framebufferTexture2D(36160,36064,34069+e,i.__webglTexture,n)}else if(s){const i=Q.get(t.texture),o=e||0;gt.framebufferTextureLayer(36160,36064,i.__webglTexture,n||0,o)}},this.readRenderTargetPixels=function(t,e,n,i,o,s,r){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=Q.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==r&&(a=a[r]),a){L.bindFramebuffer(36160,a);try{const r=t.texture,a=r.format,l=r.type;if(a!==Zc&&lt.convert(a)!==gt.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=l===bc&&(K.has("EXT_color_buffer_half_float")||E.isWebGL2&&K.has("EXT_color_buffer_float"));if(!(l===mc||lt.convert(l)===gt.getParameter(35738)||l===Cc&&(E.isWebGL2||K.has("OES_texture_float")||K.has("WEBGL_color_buffer_float"))||c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===gt.checkFramebufferStatus(36160)?e>=0&&e<=t.width-i&&n>=0&&n<=t.height-o&&gt.readPixels(e,n,i,o,lt.convert(a),lt.convert(l),s):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const t=null!==y?Q.get(y).__webglFramebuffer:null;L.bindFramebuffer(36160,t)}}},this.copyFramebufferToTexture=function(t,e,n=0){const i=Math.pow(2,-n),o=Math.floor(e.image.width*i),s=Math.floor(e.image.height*i);let r=lt.convert(e.format);E.isWebGL2&&(6407===r&&(r=32849),6408===r&&(r=32856)),z.setTexture2D(e,0),gt.copyTexImage2D(3553,n,r,t.x,t.y,o,s,0),L.unbindTexture()},this.copyTextureToTexture=function(t,e,n,i=0){const o=e.image.width,s=e.image.height,r=lt.convert(n.format),a=lt.convert(n.type);z.setTexture2D(n,0),gt.pixelStorei(37440,n.flipY),gt.pixelStorei(37441,n.premultiplyAlpha),gt.pixelStorei(3317,n.unpackAlignment),e.isDataTexture?gt.texSubImage2D(3553,i,t.x,t.y,o,s,r,a,e.image.data):e.isCompressedTexture?gt.compressedTexSubImage2D(3553,i,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,r,e.mipmaps[0].data):gt.texSubImage2D(3553,i,t.x,t.y,r,a,e.image),0===i&&n.generateMipmaps&&gt.generateMipmap(3553),L.unbindTexture()},this.copyTextureToTexture3D=function(t,e,n,i,o=0){if(u.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const s=t.max.x-t.min.x+1,r=t.max.y-t.min.y+1,a=t.max.z-t.min.z+1,l=lt.convert(i.format),c=lt.convert(i.type);let g;if(i.isDataTexture3D)z.setTexture3D(i,0),g=32879;else{if(!i.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");z.setTexture2DArray(i,0),g=35866}gt.pixelStorei(37440,i.flipY),gt.pixelStorei(37441,i.premultiplyAlpha),gt.pixelStorei(3317,i.unpackAlignment);const d=gt.getParameter(3314),h=gt.getParameter(32878),m=gt.getParameter(3316),I=gt.getParameter(3315),C=gt.getParameter(32877),b=n.isCompressedTexture?n.mipmaps[0]:n.image;gt.pixelStorei(3314,b.width),gt.pixelStorei(32878,b.height),gt.pixelStorei(3316,t.min.x),gt.pixelStorei(3315,t.min.y),gt.pixelStorei(32877,t.min.z),n.isDataTexture||n.isDataTexture3D?gt.texSubImage3D(g,o,e.x,e.y,e.z,s,r,a,l,c,b.data):n.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),gt.compressedTexSubImage3D(g,o,e.x,e.y,e.z,s,r,a,l,b.data)):gt.texSubImage3D(g,o,e.x,e.y,e.z,s,r,a,l,c,b),gt.pixelStorei(3314,d),gt.pixelStorei(32878,h),gt.pixelStorei(3316,m),gt.pixelStorei(3315,I),gt.pixelStorei(32877,C),0===o&&i.generateMipmaps&&gt.generateMipmap(g),L.unbindTexture()},this.initTexture=function(t){z.setTexture2D(t,0),L.unbindTexture()},this.resetState=function(){b=0,p=0,y=null,L.reset(),ct.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}(class extends EI{}).prototype.isWebGL1Renderer=!0;class LI extends cd{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}LI.prototype.isScene=!0;class DI{constructor(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=kc,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Kc()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,n){t*=this.stride,n*=e.stride;for(let i=0,o=this.stride;i<o;i++)this.array[t+i]=e.array[n+i];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Kc()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(e,this.stride);return n.setUsage(this.usage),n}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Kc()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}DI.prototype.isInterleavedBuffer=!0;const QI=new ag;class zI{constructor(t,e,n,i=!1){this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=!0===i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,n=this.data.count;e<n;e++)QI.x=this.getX(e),QI.y=this.getY(e),QI.z=this.getZ(e),QI.applyMatrix4(t),this.setXYZ(e,QI.x,QI.y,QI.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)QI.x=this.getX(e),QI.y=this.getY(e),QI.z=this.getZ(e),QI.applyNormalMatrix(t),this.setXYZ(e,QI.x,QI.y,QI.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)QI.x=this.getX(e),QI.y=this.getY(e),QI.z=this.getZ(e),QI.transformDirection(t),this.setXYZ(e,QI.x,QI.y,QI.z);return this}setX(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){return this.data.array[t*this.data.stride+this.offset]}getY(t){return this.data.array[t*this.data.stride+this.offset+1]}getZ(t){return this.data.array[t*this.data.stride+this.offset+2]}getW(t){return this.data.array[t*this.data.stride+this.offset+3]}setXY(t,e,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this}setXYZ(t,e,n,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this}setXYZW(t,e,n,i,o){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this.data.array[t+3]=o,this}clone(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return new Yd(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new zI(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}zI.prototype.isInterleavedBufferAttribute=!0;class PI extends Gd{constructor(t){super(),this.type="SpriteMaterial",this.color=new Rd(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this}}let _I;PI.prototype.isSpriteMaterial=!0;const OI=new ag,jI=new ag,qI=new ag,$I=new Oc,tu=new Oc,eu=new Ng,nu=new ag,iu=new ag,ou=new ag,su=new Oc,ru=new Oc,au=new Oc;function lu(t,e,n,i,o,s){$I.subVectors(t,n).addScalar(.5).multiply(i),void 0!==o?(tu.x=s*$I.x-o*$I.y,tu.y=o*$I.x+s*$I.y):tu.copy($I),t.copy(e),t.x+=tu.x,t.y+=tu.y,t.applyMatrix4(eu)}(class extends cd{constructor(t){if(super(),this.type="Sprite",void 0===_I){_I=new Dd;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new DI(t,5);_I.setIndex([0,1,2,0,2,3]),_I.setAttribute("position",new zI(e,3,0,!1)),_I.setAttribute("uv",new zI(e,2,3,!1))}this.geometry=_I,this.material=void 0!==t?t:new PI,this.center=new Oc(.5,.5)}raycast(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),jI.setFromMatrixScale(this.matrixWorld),eu.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),qI.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&jI.multiplyScalar(-qI.z);const n=this.material.rotation;let i,o;0!==n&&(o=Math.cos(n),i=Math.sin(n));const s=this.center;lu(nu.set(-.5,-.5,0),qI,s,jI,i,o),lu(iu.set(.5,-.5,0),qI,s,jI,i,o),lu(ou.set(.5,.5,0),qI,s,jI,i,o),su.set(0,0),ru.set(1,0),au.set(1,1);let r=t.ray.intersectTriangle(nu,iu,ou,!1,OI);if(null===r&&(lu(iu.set(-.5,.5,0),qI,s,jI,i,o),ru.set(0,1),r=t.ray.intersectTriangle(nu,ou,iu,!1,OI),null===r))return;const a=t.ray.origin.distanceTo(OI);a<t.near||a>t.far||e.push({distance:a,point:OI.clone(),uv:Zd.getUV(OI,nu,iu,ou,su,ru,au,new Oc),face:null,object:this})}copy(t){return super.copy(t),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}}).prototype.isSprite=!0;const cu=new ag,gu=new ig,du=new ig,hu=new ag,mu=new Ng;class Iu extends ch{constructor(t,e){super(t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Ng,this.bindMatrixInverse=new Ng}copy(t){return super.copy(t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new ig,e=this.geometry.attributes.skinWeight;for(let n=0,i=e.count;n<i;n++){t.x=e.getX(n),t.y=e.getY(n),t.z=e.getZ(n),t.w=e.getW(n);const i=1/t.manhattanLength();i!==1/0?t.multiplyScalar(i):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(t,e){const n=this.skeleton,i=this.geometry;gu.fromBufferAttribute(i.attributes.skinIndex,t),du.fromBufferAttribute(i.attributes.skinWeight,t),cu.fromBufferAttribute(i.attributes.position,t).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let o=0;o<4;o++){const t=du.getComponent(o);if(0!==t){const i=gu.getComponent(o);mu.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),e.addScaledVector(hu.copy(cu).applyMatrix4(mu),t)}}return e.applyMatrix4(this.bindMatrixInverse)}}Iu.prototype.isSkinnedMesh=!0;class uu extends cd{constructor(){super(),this.type="Bone"}}uu.prototype.isBone=!0;class Cu extends eg{constructor(t=null,e=1,n=1,i,o,s,r,a,l=1003,c=1003,g,d){super(null,s,r,a,l,c,i,o,g,d),this.image={data:t,width:e,height:n},this.magFilter=l,this.minFilter=c,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}Cu.prototype.isDataTexture=!0;const bu=new Ng,pu=new Ng;class yu{constructor(t=[],e=[]){this.uuid=Kc(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new Ng)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const e=new Ng;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}update(){const t=this.bones,e=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let o=0,s=t.length;o<s;o++){const i=t[o]?t[o].matrixWorld:pu;bu.multiplyMatrices(i,e[o]),bu.toArray(n,16*o)}null!==i&&(i.needsUpdate=!0)}clone(){return new yu(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(4*this.bones.length);t=zc(t),t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const n=new Cu(e,t,t,Zc,Cc);return this.boneMatrices=e,this.boneTexture=n,this.boneTextureSize=t,this}getBoneByName(t){for(let e=0,n=this.bones.length;e<n;e++){const n=this.bones[e];if(n.name===t)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let n=0,i=t.bones.length;n<i;n++){const i=t.bones[n];let o=e[i];void 0===o&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),o=new uu),this.bones.push(o),this.boneInverses.push((new Ng).fromArray(t.boneInverses[n]))}return this.init(),this}toJSON(){const t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,n=this.boneInverses;for(let i=0,o=e.length;i<o;i++){const o=e[i];t.bones.push(o.uuid);const s=n[i];t.boneInverses.push(s.toArray())}return t}}const Zu=new Ng,Ju=new Ng,Gu=[],Vu=new ch;(class extends ch{constructor(t,e,n){super(t,e),this.instanceMatrix=new Yd(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(t){return super.copy(t),this.instanceMatrix.copy(t.instanceMatrix),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}raycast(t,e){const n=this.matrixWorld,i=this.count;if(Vu.geometry=this.geometry,Vu.material=this.material,void 0!==Vu.material)for(let o=0;o<i;o++){this.getMatrixAt(o,Zu),Ju.multiplyMatrices(n,Zu),Vu.matrixWorld=Ju,Vu.raycast(t,Gu);for(let t=0,n=Gu.length;t<n;t++){const n=Gu[t];n.instanceId=o,n.object=this,e.push(n)}Gu.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new Yd(new Float32Array(3*this.count),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}).prototype.isInstancedMesh=!0;class Su extends Gd{constructor(t){super(),this.type="LineBasicMaterial",this.color=new Rd(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.morphTargets=t.morphTargets,this}}Su.prototype.isLineBasicMaterial=!0;const Bu=new ag,Xu=new ag,vu=new Ng,fu=new xg,Ru=new Rg;class Wu extends cd{constructor(t=new Dd,e=new Su){super(),this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,n=[0];for(let t=1,i=e.count;t<i;t++)Bu.fromBufferAttribute(e,t-1),Xu.fromBufferAttribute(e,t),n[t]=n[t-1],n[t]+=Bu.distanceTo(Xu);t.setAttribute("lineDistance",new Hd(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(t,e){const n=this.geometry,i=this.matrixWorld,o=t.params.Line.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Ru.copy(n.boundingSphere),Ru.applyMatrix4(i),Ru.radius+=o,!1===t.ray.intersectsSphere(Ru))return;vu.copy(i).invert(),fu.copy(t.ray).applyMatrix4(vu);const r=o/((this.scale.x+this.scale.y+this.scale.z)/3),a=r*r,l=new ag,c=new ag,g=new ag,d=new ag,h=this.isLineSegments?2:1;if(n.isBufferGeometry){const i=n.index,o=n.attributes.position;if(null!==i)for(let n=Math.max(0,s.start),r=Math.min(i.count,s.start+s.count)-1;n<r;n+=h){const s=i.getX(n),r=i.getX(n+1);if(l.fromBufferAttribute(o,s),c.fromBufferAttribute(o,r),fu.distanceSqToSegment(l,c,d,g)>a)continue;d.applyMatrix4(this.matrixWorld);const h=t.ray.origin.distanceTo(d);h<t.near||h>t.far||e.push({distance:h,point:g.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}else for(let n=Math.max(0,s.start),r=Math.min(o.count,s.start+s.count)-1;n<r;n+=h){if(l.fromBufferAttribute(o,n),c.fromBufferAttribute(o,n+1),fu.distanceSqToSegment(l,c,d,g)>a)continue;d.applyMatrix4(this.matrixWorld);const i=t.ray.origin.distanceTo(d);i<t.near||i>t.far||e.push({distance:i,point:g.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Wu.prototype.isLine=!0;const Au=new ag,wu=new ag;class Yu extends Wu{constructor(t,e){super(t,e),this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,n=[];for(let t=0,i=e.count;t<i;t+=2)Au.fromBufferAttribute(e,t),wu.fromBufferAttribute(e,t+1),n[t]=0===t?0:n[t-1],n[t+1]=n[t]+Au.distanceTo(wu);t.setAttribute("lineDistance",new Hd(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}Yu.prototype.isLineSegments=!0;class ku extends Wu{constructor(t,e){super(t,e),this.type="LineLoop"}}ku.prototype.isLineLoop=!0;class Fu extends Gd{constructor(t){super(),this.type="PointsMaterial",this.color=new Rd(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.morphTargets=t.morphTargets,this}}Fu.prototype.isPointsMaterial=!0;const Hu=new Ng,xu=new xg,Nu=new Rg,Tu=new ag;class Mu extends cd{constructor(t=new Dd,e=new Fu){super(),this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}raycast(t,e){const n=this.geometry,i=this.matrixWorld,o=t.params.Points.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Nu.copy(n.boundingSphere),Nu.applyMatrix4(i),Nu.radius+=o,!1===t.ray.intersectsSphere(Nu))return;Hu.copy(i).invert(),xu.copy(t.ray).applyMatrix4(Hu);const r=o/((this.scale.x+this.scale.y+this.scale.z)/3),a=r*r;if(n.isBufferGeometry){const o=n.index,r=n.attributes.position;if(null!==o)for(let n=Math.max(0,s.start),l=Math.min(o.count,s.start+s.count);n<l;n++){const s=o.getX(n);Tu.fromBufferAttribute(r,s),Uu(Tu,s,a,i,t,e,this)}else for(let n=Math.max(0,s.start),l=Math.min(r.count,s.start+s.count);n<l;n++)Tu.fromBufferAttribute(r,n),Uu(Tu,n,a,i,t,e,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function Uu(t,e,n,i,o,s,r){const a=xu.distanceSqToPoint(t);if(a<n){const n=new ag;xu.closestPointToPoint(t,n),n.applyMatrix4(i);const l=o.ray.origin.distanceTo(n);if(l<o.near||l>o.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:n,index:e,face:null,object:r})}}Mu.prototype.isPoints=!0,class extends eg{constructor(t,e,n,i,o,s,r,a,l){super(t,e,n,i,o,s,r,a,l),this.format=void 0!==r?r:yc,this.minFilter=void 0!==s?s:dc,this.magFilter=void 0!==o?o:dc,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback((function e(){c.needsUpdate=!0,t.requestVideoFrameCallback(e)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;!1==="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}.prototype.isVideoTexture=!0,class extends eg{constructor(t,e,n,i,o,s,r,a,l,c,g,d){super(null,s,r,a,l,c,i,o,g,d),this.image={width:e,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}.prototype.isCompressedTexture=!0,class extends eg{constructor(t,e,n,i,o,s,r,a,l){super(t,e,n,i,o,s,r,a,l),this.needsUpdate=!0}}.prototype.isCanvasTexture=!0,class extends eg{constructor(t,e,n,i,o,s,r,a,l,c){if((c=void 0!==c?c:Jc)!==Jc&&c!==Gc)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===Jc&&(n=Ic),void 0===n&&c===Gc&&(n=pc),super(null,i,o,s,r,a,c,n,l),this.image={width:t,height:e},this.magFilter=void 0!==r?r:lc,this.minFilter=void 0!==a?a:lc,this.flipY=!1,this.generateMipmaps=!1}}.prototype.isDepthTexture=!0,new ag,new ag,new ag,new Zd;class Ku{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const n=this.getUtoTmapping(t);return this.getPoint(n,e)}getPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e}getSpacedPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let n,i=this.getPoint(0),o=0;e.push(0);for(let s=1;s<=t;s++)n=this.getPoint(s/t),o+=n.distanceTo(i),e.push(o),i=n;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const n=this.getLengths();let i=0;const o=n.length;let s;s=e||t*n[o-1];let r,a=0,l=o-1;for(;a<=l;)if(i=Math.floor(a+(l-a)/2),r=n[i]-s,r<0)a=i+1;else{if(!(r>0)){l=i;break}l=i-1}if(i=l,n[i]===s)return i/(o-1);const c=n[i];return(i+(s-c)/(n[i+1]-c))/(o-1)}getTangent(t,e){const n=1e-4;let i=t-n,o=t+n;i<0&&(i=0),o>1&&(o=1);const s=this.getPoint(i),r=this.getPoint(o),a=e||(s.isVector2?new Oc:new ag);return a.copy(r).sub(s).normalize(),a}getTangentAt(t,e){const n=this.getUtoTmapping(t);return this.getTangent(n,e)}computeFrenetFrames(t,e){const n=new ag,i=[],o=[],s=[],r=new ag,a=new Ng;for(let h=0;h<=t;h++){const e=h/t;i[h]=this.getTangentAt(e,new ag),i[h].normalize()}o[0]=new ag,s[0]=new ag;let l=Number.MAX_VALUE;const c=Math.abs(i[0].x),g=Math.abs(i[0].y),d=Math.abs(i[0].z);c<=l&&(l=c,n.set(1,0,0)),g<=l&&(l=g,n.set(0,1,0)),d<=l&&n.set(0,0,1),r.crossVectors(i[0],n).normalize(),o[0].crossVectors(i[0],r),s[0].crossVectors(i[0],o[0]);for(let h=1;h<=t;h++){if(o[h]=o[h-1].clone(),s[h]=s[h-1].clone(),r.crossVectors(i[h-1],i[h]),r.length()>Number.EPSILON){r.normalize();const t=Math.acos(Ec(i[h-1].dot(i[h]),-1,1));o[h].applyMatrix4(a.makeRotationAxis(r,t))}s[h].crossVectors(i[h],o[h])}if(!0===e){let e=Math.acos(Ec(o[0].dot(o[t]),-1,1));e/=t,i[0].dot(r.crossVectors(o[0],o[t]))>0&&(e=-e);for(let n=1;n<=t;n++)o[n].applyMatrix4(a.makeRotationAxis(i[n],e*n)),s[n].crossVectors(i[n],o[n])}return{tangents:i,normals:o,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class Eu extends Ku{constructor(t=0,e=0,n=1,i=1,o=0,s=2*Math.PI,r=!1,a=0){super(),this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=n,this.yRadius=i,this.aStartAngle=o,this.aEndAngle=s,this.aClockwise=r,this.aRotation=a}getPoint(t,e){const n=e||new Oc,i=2*Math.PI;let o=this.aEndAngle-this.aStartAngle;const s=Math.abs(o)<Number.EPSILON;for(;o<0;)o+=i;for(;o>i;)o-=i;o<Number.EPSILON&&(o=s?0:i),!0!==this.aClockwise||s||(o===i?o=-i:o-=i);const r=this.aStartAngle+t*o;let a=this.aX+this.xRadius*Math.cos(r),l=this.aY+this.yRadius*Math.sin(r);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),n=a-this.aX,i=l-this.aY;a=n*t-i*e+this.aX,l=n*e+i*t+this.aY}return n.set(a,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}Eu.prototype.isEllipseCurve=!0;class Lu extends Eu{constructor(t,e,n,i,o,s){super(t,e,n,n,i,o,s),this.type="ArcCurve"}}function Du(){let t=0,e=0,n=0,i=0;function o(o,s,r,a){t=o,e=r,n=-3*o+3*s-2*r-a,i=2*o-2*s+r+a}return{initCatmullRom:function(t,e,n,i,s){o(e,n,s*(n-t),s*(i-e))},initNonuniformCatmullRom:function(t,e,n,i,s,r,a){let l=(e-t)/s-(n-t)/(s+r)+(n-e)/r,c=(n-e)/r-(i-e)/(r+a)+(i-n)/a;l*=r,c*=r,o(e,n,l,c)},calc:function(o){const s=o*o;return t+e*o+n*s+i*(s*o)}}}Lu.prototype.isArcCurve=!0;const Qu=new ag,zu=new Du,Pu=new Du,_u=new Du;class Ou extends Ku{constructor(t=[],e=!1,n="centripetal",i=.5){super(),this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=n,this.tension=i}getPoint(t,e=new ag){const n=e,i=this.points,o=i.length,s=(o-(this.closed?0:1))*t;let r,a,l=Math.floor(s),c=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/o)+1)*o:0===c&&l===o-1&&(l=o-2,c=1),this.closed||l>0?r=i[(l-1)%o]:(Qu.subVectors(i[0],i[1]).add(i[0]),r=Qu);const g=i[l%o],d=i[(l+1)%o];if(this.closed||l+2<o?a=i[(l+2)%o]:(Qu.subVectors(i[o-1],i[o-2]).add(i[o-1]),a=Qu),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(r.distanceToSquared(g),t),n=Math.pow(g.distanceToSquared(d),t),i=Math.pow(d.distanceToSquared(a),t);n<1e-4&&(n=1),e<1e-4&&(e=n),i<1e-4&&(i=n),zu.initNonuniformCatmullRom(r.x,g.x,d.x,a.x,e,n,i),Pu.initNonuniformCatmullRom(r.y,g.y,d.y,a.y,e,n,i),_u.initNonuniformCatmullRom(r.z,g.z,d.z,a.z,e,n,i)}else"catmullrom"===this.curveType&&(zu.initCatmullRom(r.x,g.x,d.x,a.x,this.tension),Pu.initCatmullRom(r.y,g.y,d.y,a.y,this.tension),_u.initCatmullRom(r.z,g.z,d.z,a.z,this.tension));return n.set(zu.calc(c),Pu.calc(c),_u.calc(c)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new ag).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function ju(t,e,n,i,o){const s=.5*(i-e),r=.5*(o-n),a=t*t;return(2*n-2*i+s+r)*(t*a)+(-3*n+3*i-2*s-r)*a+s*t+n}function qu(t,e,n,i){return function(t,e){const n=1-t;return n*n*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,n)+function(t,e){return t*t*e}(t,i)}function $u(t,e,n,i,o){return function(t,e){const n=1-t;return n*n*n*e}(t,e)+function(t,e){const n=1-t;return 3*n*n*t*e}(t,n)+function(t,e){return 3*(1-t)*t*t*e}(t,i)+function(t,e){return t*t*t*e}(t,o)}Ou.prototype.isCatmullRomCurve3=!0;class tC extends Ku{constructor(t=new Oc,e=new Oc,n=new Oc,i=new Oc){super(),this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=n,this.v3=i}getPoint(t,e=new Oc){const n=e,i=this.v0,o=this.v1,s=this.v2,r=this.v3;return n.set($u(t,i.x,o.x,s.x,r.x),$u(t,i.y,o.y,s.y,r.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}tC.prototype.isCubicBezierCurve=!0;class eC extends Ku{constructor(t=new ag,e=new ag,n=new ag,i=new ag){super(),this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=n,this.v3=i}getPoint(t,e=new ag){const n=e,i=this.v0,o=this.v1,s=this.v2,r=this.v3;return n.set($u(t,i.x,o.x,s.x,r.x),$u(t,i.y,o.y,s.y,r.y),$u(t,i.z,o.z,s.z,r.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}eC.prototype.isCubicBezierCurve3=!0;class nC extends Ku{constructor(t=new Oc,e=new Oc){super(),this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new Oc){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e){const n=e||new Oc;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}nC.prototype.isLineCurve=!0;class iC extends Ku{constructor(t=new Oc,e=new Oc,n=new Oc){super(),this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new Oc){const n=e,i=this.v0,o=this.v1,s=this.v2;return n.set(qu(t,i.x,o.x,s.x),qu(t,i.y,o.y,s.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}iC.prototype.isQuadraticBezierCurve=!0;class oC extends Ku{constructor(t=new ag,e=new ag,n=new ag){super(),this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new ag){const n=e,i=this.v0,o=this.v1,s=this.v2;return n.set(qu(t,i.x,o.x,s.x),qu(t,i.y,o.y,s.y),qu(t,i.z,o.z,s.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}oC.prototype.isQuadraticBezierCurve3=!0;class sC extends Ku{constructor(t=[]){super(),this.type="SplineCurve",this.points=t}getPoint(t,e=new Oc){const n=e,i=this.points,o=(i.length-1)*t,s=Math.floor(o),r=o-s,a=i[0===s?s:s-1],l=i[s],c=i[s>i.length-2?i.length-1:s+1],g=i[s>i.length-3?i.length-1:s+2];return n.set(ju(r,a.x,l.x,c.x,g.x),ju(r,a.y,l.y,c.y,g.y)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new Oc).fromArray(n))}return this}}sC.prototype.isSplineCurve=!0;var rC=Object.freeze({__proto__:null,ArcCurve:Lu,CatmullRomCurve3:Ou,CubicBezierCurve:tC,CubicBezierCurve3:eC,EllipseCurve:Eu,LineCurve:nC,LineCurve3:class extends Ku{constructor(t=new ag,e=new ag){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=t,this.v2=e}getPoint(t,e=new ag){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},QuadraticBezierCurve:iC,QuadraticBezierCurve3:oC,SplineCurve:sC});const aC=function(t,e,n=2){const i=e&&e.length,o=i?e[0]*n:t.length;let s=lC(t,0,o,n,!0);const r=[];if(!s||s.next===s.prev)return r;let a,l,c,g,d,h,m;if(i&&(s=function(t,e,n,i){const o=[];let s,r,a,l,c;for(s=0,r=e.length;s<r;s++)a=e[s]*i,l=s<r-1?e[s+1]*i:t.length,c=lC(t,a,l,i,!1),c===c.next&&(c.steiner=!0),o.push(yC(c));for(o.sort(uC),s=0;s<o.length;s++)CC(o[s],n),n=cC(n,n.next);return n}(t,e,s,n)),t.length>80*n){a=c=t[0],l=g=t[1];for(let e=n;e<o;e+=n)d=t[e],h=t[e+1],d<a&&(a=d),h<l&&(l=h),d>c&&(c=d),h>g&&(g=h);m=Math.max(c-a,g-l),m=0!==m?1/m:0}return gC(s,r,n,a,l,m),r};function lC(t,e,n,i,o){let s,r;if(o===function(t,e,n,i){let o=0;for(let s=e,r=n-i;s<n;s+=i)o+=(t[r]-t[s])*(t[s+1]+t[r+1]),r=s;return o}(t,e,n,i)>0)for(s=e;s<n;s+=i)r=RC(s,t[s],t[s+1],r);else for(s=n-i;s>=e;s-=i)r=RC(s,t[s],t[s+1],r);return r&&VC(r,r.next)&&(WC(r),r=r.next),r}function cC(t,e){if(!t)return t;e||(e=t);let n,i=t;do{if(n=!1,i.steiner||!VC(i,i.next)&&0!==GC(i.prev,i,i.next))i=i.next;else{if(WC(i),i=e=i.prev,i===i.next)break;n=!0}}while(n||i!==e);return e}function gC(t,e,n,i,o,s,r){if(!t)return;!r&&s&&function(t,e,n,i){let o=t;do{null===o.z&&(o.z=pC(o.x,o.y,e,n,i)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==t);o.prevZ.nextZ=null,o.prevZ=null,function(t){let e,n,i,o,s,r,a,l,c=1;do{for(n=t,t=null,s=null,r=0;n;){for(r++,i=n,a=0,e=0;e<c&&(a++,i=i.nextZ,i);e++);for(l=c;a>0||l>0&&i;)0!==a&&(0===l||!i||n.z<=i.z)?(o=n,n=n.nextZ,a--):(o=i,i=i.nextZ,l--),s?s.nextZ=o:t=o,o.prevZ=s,s=o;n=i}s.nextZ=null,c*=2}while(r>1)}(o)}(t,i,o,s);let a,l,c=t;for(;t.prev!==t.next;)if(a=t.prev,l=t.next,s?hC(t,i,o,s):dC(t))e.push(a.i/n),e.push(t.i/n),e.push(l.i/n),WC(t),t=l.next,c=l.next;else if((t=l)===c){r?1===r?gC(t=mC(cC(t),e,n),e,n,i,o,s,2):2===r&&IC(t,e,n,i,o,s):gC(cC(t),e,n,i,o,s,1);break}}function dC(t){const e=t.prev,n=t,i=t.next;if(GC(e,n,i)>=0)return!1;let o=t.next.next;for(;o!==t.prev;){if(ZC(e.x,e.y,n.x,n.y,i.x,i.y,o.x,o.y)&&GC(o.prev,o,o.next)>=0)return!1;o=o.next}return!0}function hC(t,e,n,i){const o=t.prev,s=t,r=t.next;if(GC(o,s,r)>=0)return!1;const a=o.x<s.x?o.x<r.x?o.x:r.x:s.x<r.x?s.x:r.x,l=o.y<s.y?o.y<r.y?o.y:r.y:s.y<r.y?s.y:r.y,c=o.x>s.x?o.x>r.x?o.x:r.x:s.x>r.x?s.x:r.x,g=o.y>s.y?o.y>r.y?o.y:r.y:s.y>r.y?s.y:r.y,d=pC(a,l,e,n,i),h=pC(c,g,e,n,i);let m=t.prevZ,I=t.nextZ;for(;m&&m.z>=d&&I&&I.z<=h;){if(m!==t.prev&&m!==t.next&&ZC(o.x,o.y,s.x,s.y,r.x,r.y,m.x,m.y)&&GC(m.prev,m,m.next)>=0)return!1;if(m=m.prevZ,I!==t.prev&&I!==t.next&&ZC(o.x,o.y,s.x,s.y,r.x,r.y,I.x,I.y)&&GC(I.prev,I,I.next)>=0)return!1;I=I.nextZ}for(;m&&m.z>=d;){if(m!==t.prev&&m!==t.next&&ZC(o.x,o.y,s.x,s.y,r.x,r.y,m.x,m.y)&&GC(m.prev,m,m.next)>=0)return!1;m=m.prevZ}for(;I&&I.z<=h;){if(I!==t.prev&&I!==t.next&&ZC(o.x,o.y,s.x,s.y,r.x,r.y,I.x,I.y)&&GC(I.prev,I,I.next)>=0)return!1;I=I.nextZ}return!0}function mC(t,e,n){let i=t;do{const o=i.prev,s=i.next.next;!VC(o,s)&&SC(o,i,i.next,s)&&vC(o,s)&&vC(s,o)&&(e.push(o.i/n),e.push(i.i/n),e.push(s.i/n),WC(i),WC(i.next),i=t=s),i=i.next}while(i!==t);return cC(i)}function IC(t,e,n,i,o,s){let r=t;do{let t=r.next.next;for(;t!==r.prev;){if(r.i!==t.i&&JC(r,t)){let a=fC(r,t);return r=cC(r,r.next),a=cC(a,a.next),gC(r,e,n,i,o,s),void gC(a,e,n,i,o,s)}t=t.next}r=r.next}while(r!==t)}function uC(t,e){return t.x-e.x}function CC(t,e){if(e=function(t,e){let n=e;const i=t.x,o=t.y;let s,r=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){const t=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(t<=i&&t>r){if(r=t,t===i){if(o===n.y)return n;if(o===n.next.y)return n.next}s=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!s)return null;if(i===r)return s;const a=s,l=s.x,c=s.y;let g,d=1/0;n=s;do{i>=n.x&&n.x>=l&&i!==n.x&&ZC(o<c?i:r,o,l,c,o<c?r:i,o,n.x,n.y)&&(g=Math.abs(o-n.y)/(i-n.x),vC(n,t)&&(g<d||g===d&&(n.x>s.x||n.x===s.x&&bC(s,n)))&&(s=n,d=g)),n=n.next}while(n!==a);return s}(t,e),e){const n=fC(e,t);cC(e,e.next),cC(n,n.next)}}function bC(t,e){return GC(t.prev,t,e.prev)<0&&GC(e.next,t,t.next)<0}function pC(t,e,n,i,o){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*o)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*o)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function yC(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function ZC(t,e,n,i,o,s,r,a){return(o-r)*(e-a)-(t-r)*(s-a)>=0&&(t-r)*(i-a)-(n-r)*(e-a)>=0&&(n-r)*(s-a)-(o-r)*(i-a)>=0}function JC(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&SC(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(vC(t,e)&&vC(e,t)&&function(t,e){let n=t,i=!1;const o=(t.x+e.x)/2,s=(t.y+e.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&o<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)&&(GC(t.prev,t,e.prev)||GC(t,e.prev,e))||VC(t,e)&&GC(t.prev,t,t.next)>0&&GC(e.prev,e,e.next)>0)}function GC(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function VC(t,e){return t.x===e.x&&t.y===e.y}function SC(t,e,n,i){const o=XC(GC(t,e,n)),s=XC(GC(t,e,i)),r=XC(GC(n,i,t)),a=XC(GC(n,i,e));return o!==s&&r!==a||!(0!==o||!BC(t,n,e))||!(0!==s||!BC(t,i,e))||!(0!==r||!BC(n,t,i))||!(0!==a||!BC(n,e,i))}function BC(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function XC(t){return t>0?1:t<0?-1:0}function vC(t,e){return GC(t.prev,t,t.next)<0?GC(t,e,t.next)>=0&&GC(t,t.prev,e)>=0:GC(t,e,t.prev)<0||GC(t,t.next,e)<0}function fC(t,e){const n=new AC(t.i,t.x,t.y),i=new AC(e.i,e.x,e.y),o=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=o,o.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function RC(t,e,n,i){const o=new AC(t,e,n);return i?(o.next=i.next,o.prev=i,i.next.prev=o,i.next=o):(o.prev=o,o.next=o),o}function WC(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function AC(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class wC{static area(t){const e=t.length;let n=0;for(let i=e-1,o=0;o<e;i=o++)n+=t[i].x*t[o].y-t[o].x*t[i].y;return.5*n}static isClockWise(t){return wC.area(t)<0}static triangulateShape(t,e){const n=[],i=[],o=[];YC(t),kC(n,t);let s=t.length;e.forEach(YC);for(let a=0;a<e.length;a++)i.push(s),s+=e[a].length,kC(n,e[a]);const r=aC(n,i);for(let a=0;a<r.length;a+=3)o.push(r.slice(a,a+3));return o}}function YC(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function kC(t,e){for(let n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}class FC extends Dd{constructor(t,e){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const n=this,i=[],o=[];for(let r=0,a=t.length;r<a;r++)s(t[r]);function s(t){const s=[],r=void 0!==e.curveSegments?e.curveSegments:12,a=void 0!==e.steps?e.steps:1;let l=void 0!==e.depth?e.depth:100,c=void 0===e.bevelEnabled||e.bevelEnabled,g=void 0!==e.bevelThickness?e.bevelThickness:6,d=void 0!==e.bevelSize?e.bevelSize:g-2,h=void 0!==e.bevelOffset?e.bevelOffset:0,m=void 0!==e.bevelSegments?e.bevelSegments:3;const I=e.extrudePath,u=void 0!==e.UVGenerator?e.UVGenerator:HC;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=e.amount);let C,b,p,y,Z,J=!1;I&&(C=I.getSpacedPoints(a),J=!0,c=!1,b=I.computeFrenetFrames(a,!1),p=new ag,y=new ag,Z=new ag),c||(m=0,g=0,d=0,h=0);const G=t.extractPoints(r);let V=G.shape;const S=G.holes;if(!wC.isClockWise(V)){V=V.reverse();for(let t=0,e=S.length;t<e;t++){const e=S[t];wC.isClockWise(e)&&(S[t]=e.reverse())}}const B=wC.triangulateShape(V,S),X=V;for(let e=0,n=S.length;e<n;e++){const t=S[e];V=V.concat(t)}function v(t,e,n){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(n).add(t)}const f=V.length,R=B.length;function W(t,e,n){let i,o,s;const r=t.x-e.x,a=t.y-e.y,l=n.x-t.x,c=n.y-t.y,g=r*r+a*a,d=r*c-a*l;if(Math.abs(d)>Number.EPSILON){const d=Math.sqrt(g),h=Math.sqrt(l*l+c*c),m=e.x-a/d,I=e.y+r/d,u=((n.x-c/h-m)*c-(n.y+l/h-I)*l)/(r*c-a*l);i=m+r*u-t.x,o=I+a*u-t.y;const C=i*i+o*o;if(C<=2)return new Oc(i,o);s=Math.sqrt(C/2)}else{let t=!1;r>Number.EPSILON?l>Number.EPSILON&&(t=!0):r<-Number.EPSILON?l<-Number.EPSILON&&(t=!0):Math.sign(a)===Math.sign(c)&&(t=!0),t?(i=-a,o=r,s=Math.sqrt(g)):(i=r,o=a,s=Math.sqrt(g/2))}return new Oc(i/s,o/s)}const A=[];for(let e=0,n=X.length,i=n-1,o=e+1;e<n;e++,i++,o++)i===n&&(i=0),o===n&&(o=0),A[e]=W(X[e],X[i],X[o]);const w=[];let Y,k=A.concat();for(let e=0,n=S.length;e<n;e++){const t=S[e];Y=[];for(let e=0,n=t.length,i=n-1,o=e+1;e<n;e++,i++,o++)i===n&&(i=0),o===n&&(o=0),Y[e]=W(t[e],t[i],t[o]);w.push(Y),k=k.concat(Y)}for(let e=0;e<m;e++){const t=e/m,n=g*Math.cos(t*Math.PI/2),i=d*Math.sin(t*Math.PI/2)+h;for(let e=0,o=X.length;e<o;e++){const t=v(X[e],A[e],i);x(t.x,t.y,-n)}for(let e=0,o=S.length;e<o;e++){const t=S[e];Y=w[e];for(let e=0,o=t.length;e<o;e++){const o=v(t[e],Y[e],i);x(o.x,o.y,-n)}}}const F=d+h;for(let e=0;e<f;e++){const t=c?v(V[e],k[e],F):V[e];J?(y.copy(b.normals[0]).multiplyScalar(t.x),p.copy(b.binormals[0]).multiplyScalar(t.y),Z.copy(C[0]).add(y).add(p),x(Z.x,Z.y,Z.z)):x(t.x,t.y,0)}for(let e=1;e<=a;e++)for(let t=0;t<f;t++){const n=c?v(V[t],k[t],F):V[t];J?(y.copy(b.normals[e]).multiplyScalar(n.x),p.copy(b.binormals[e]).multiplyScalar(n.y),Z.copy(C[e]).add(y).add(p),x(Z.x,Z.y,Z.z)):x(n.x,n.y,l/a*e)}for(let e=m-1;e>=0;e--){const t=e/m,n=g*Math.cos(t*Math.PI/2),i=d*Math.sin(t*Math.PI/2)+h;for(let e=0,o=X.length;e<o;e++){const t=v(X[e],A[e],i);x(t.x,t.y,l+n)}for(let e=0,o=S.length;e<o;e++){const t=S[e];Y=w[e];for(let e=0,o=t.length;e<o;e++){const o=v(t[e],Y[e],i);J?x(o.x,o.y+C[a-1].y,C[a-1].x+n):x(o.x,o.y,l+n)}}}function H(t,e){let n=t.length;for(;--n>=0;){const i=n;let o=n-1;o<0&&(o=t.length-1);for(let t=0,n=a+2*m;t<n;t++){const n=f*t,s=f*(t+1);T(e+i+n,e+o+n,e+o+s,e+i+s)}}}function x(t,e,n){s.push(t),s.push(e),s.push(n)}function N(t,e,o){M(t),M(e),M(o);const s=i.length/3,r=u.generateTopUV(n,i,s-3,s-2,s-1);U(r[0]),U(r[1]),U(r[2])}function T(t,e,o,s){M(t),M(e),M(s),M(e),M(o),M(s);const r=i.length/3,a=u.generateSideWallUV(n,i,r-6,r-3,r-2,r-1);U(a[0]),U(a[1]),U(a[3]),U(a[1]),U(a[2]),U(a[3])}function M(t){i.push(s[3*t+0]),i.push(s[3*t+1]),i.push(s[3*t+2])}function U(t){o.push(t.x),o.push(t.y)}!function(){const t=i.length/3;if(c){let t=0,e=f*t;for(let n=0;n<R;n++){const t=B[n];N(t[2]+e,t[1]+e,t[0]+e)}t=a+2*m,e=f*t;for(let n=0;n<R;n++){const t=B[n];N(t[0]+e,t[1]+e,t[2]+e)}}else{for(let t=0;t<R;t++){const e=B[t];N(e[2],e[1],e[0])}for(let t=0;t<R;t++){const e=B[t];N(e[0]+f*a,e[1]+f*a,e[2]+f*a)}}n.addGroup(t,i.length/3-t,0)}(),function(){const t=i.length/3;let e=0;H(X,e),e+=X.length;for(let n=0,i=S.length;n<i;n++){const t=S[n];H(t,e),e+=t.length}n.addGroup(t,i.length/3-t,1)}()}this.setAttribute("position",new Hd(i,3)),this.setAttribute("uv",new Hd(o,2)),this.computeVertexNormals()}toJSON(){const t=super.toJSON();return function(t,e,n){if(n.shapes=[],Array.isArray(t))for(let i=0,o=t.length;i<o;i++){const e=t[i];n.shapes.push(e.uuid)}else n.shapes.push(t.uuid);return void 0!==e.extrudePath&&(n.options.extrudePath=e.extrudePath.toJSON()),n}(this.parameters.shapes,this.parameters.options,t)}static fromJSON(t,e){const n=[];for(let o=0,s=t.shapes.length;o<s;o++){const i=e[t.shapes[o]];n.push(i)}const i=t.options.extrudePath;return void 0!==i&&(t.options.extrudePath=(new rC[i.type]).fromJSON(i)),new FC(n,t.options)}}const HC={generateTopUV:function(t,e,n,i,o){const s=e[3*n],r=e[3*n+1],a=e[3*i],l=e[3*i+1],c=e[3*o],g=e[3*o+1];return[new Oc(s,r),new Oc(a,l),new Oc(c,g)]},generateSideWallUV:function(t,e,n,i,o,s){const r=e[3*n],a=e[3*n+1],l=e[3*n+2],c=e[3*i],g=e[3*i+1],d=e[3*i+2],h=e[3*o],m=e[3*o+1],I=e[3*o+2],u=e[3*s],C=e[3*s+1],b=e[3*s+2];return Math.abs(a-g)<Math.abs(r-c)?[new Oc(r,1-l),new Oc(c,1-d),new Oc(h,1-I),new Oc(u,1-b)]:[new Oc(a,1-l),new Oc(g,1-d),new Oc(m,1-I),new Oc(C,1-b)]}};class xC extends Dd{constructor(t,e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const n=[],i=[],o=[],s=[];let r=0,a=0;if(!1===Array.isArray(t))l(t);else for(let c=0;c<t.length;c++)l(t[c]),this.addGroup(r,a,c),r+=a,a=0;function l(t){const r=i.length/3,l=t.extractPoints(e);let c=l.shape;const g=l.holes;!1===wC.isClockWise(c)&&(c=c.reverse());for(let e=0,n=g.length;e<n;e++){const t=g[e];!0===wC.isClockWise(t)&&(g[e]=t.reverse())}const d=wC.triangulateShape(c,g);for(let e=0,n=g.length;e<n;e++){const t=g[e];c=c.concat(t)}for(let e=0,n=c.length;e<n;e++){const t=c[e];i.push(t.x,t.y,0),o.push(0,0,1),s.push(t.x,t.y)}for(let e=0,i=d.length;e<i;e++){const t=d[e],i=t[0]+r,o=t[1]+r,s=t[2]+r;n.push(i,o,s),a+=3}}this.setIndex(n),this.setAttribute("position",new Hd(i,3)),this.setAttribute("normal",new Hd(o,3)),this.setAttribute("uv",new Hd(s,2))}toJSON(){const t=super.toJSON();return function(t,e){if(e.shapes=[],Array.isArray(t))for(let n=0,i=t.length;n<i;n++){const i=t[n];e.shapes.push(i.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}static fromJSON(t,e){const n=[];for(let i=0,o=t.shapes.length;i<o;i++){const o=e[t.shapes[i]];n.push(o)}return new xC(n,t.curveSegments)}}(class extends Gd{constructor(t){super(),this.type="ShadowMaterial",this.color=new Rd(0),this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this}}).prototype.isShadowMaterial=!0,class extends uh{constructor(t){super(t),this.type="RawShaderMaterial"}}.prototype.isRawShaderMaterial=!0;class NC extends Gd{constructor(t){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Rd(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Rd(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Oc(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.vertexTangents=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.flatShading=t.flatShading,this.vertexTangents=t.vertexTangents,this}}NC.prototype.isMeshStandardMaterial=!0;class TC extends NC{constructor(t){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Oc(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(t){this.reflectivity=Ec(2.5*(t-1)/(t+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new Rd(1,1,1),this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.reflectivity=t.reflectivity,t.sheen?this.sheen=(this.sheen||new Rd).copy(t.sheen):this.sheen=null,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this}}TC.prototype.isMeshPhysicalMaterial=!0,class extends Gd{constructor(t){super(),this.type="MeshPhongMaterial",this.color=new Rd(16777215),this.specular=new Rd(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Rd(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Oc(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.flatShading=t.flatShading,this}}.prototype.isMeshPhongMaterial=!0,class extends Gd{constructor(t){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Rd(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Rd(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Oc(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this}}.prototype.isMeshToonMaterial=!0,class extends Gd{constructor(t){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Oc(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.flatShading=t.flatShading,this}}.prototype.isMeshNormalMaterial=!0,class extends Gd{constructor(t){super(),this.type="MeshLambertMaterial",this.color=new Rd(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Rd(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this}}.prototype.isMeshLambertMaterial=!0,class extends Gd{constructor(t){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Rd(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Oc(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.flatShading=t.flatShading,this}}.prototype.isMeshMatcapMaterial=!0,class extends Su{constructor(t){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}.prototype.isLineDashedMaterial=!0;const MC={arraySlice:function(t,e,n){return MC.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==n?n:t.length)):t.slice(e,n)},convertArray:function(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){const e=t.length,n=new Array(e);for(let i=0;i!==e;++i)n[i]=i;return n.sort((function(e,n){return t[e]-t[n]})),n},sortedArray:function(t,e,n){const i=t.length,o=new t.constructor(i);for(let s=0,r=0;r!==i;++s){const i=n[s]*e;for(let n=0;n!==e;++n)o[r++]=t[i+n]}return o},flattenJSON:function(t,e,n,i){let o=1,s=t[0];for(;void 0!==s&&void 0===s[i];)s=t[o++];if(void 0===s)return;let r=s[i];if(void 0!==r)if(Array.isArray(r))do{r=s[i],void 0!==r&&(e.push(s.time),n.push.apply(n,r)),s=t[o++]}while(void 0!==s);else if(void 0!==r.toArray)do{r=s[i],void 0!==r&&(e.push(s.time),r.toArray(n,n.length)),s=t[o++]}while(void 0!==s);else do{r=s[i],void 0!==r&&(e.push(s.time),n.push(r)),s=t[o++]}while(void 0!==s)},subclip:function(t,e,n,i,o=30){const s=t.clone();s.name=e;const r=[];for(let l=0;l<s.tracks.length;++l){const t=s.tracks[l],e=t.getValueSize(),a=[],c=[];for(let s=0;s<t.times.length;++s){const r=t.times[s]*o;if(!(r<n||r>=i)){a.push(t.times[s]);for(let n=0;n<e;++n)c.push(t.values[s*e+n])}}0!==a.length&&(t.times=MC.convertArray(a,t.times.constructor),t.values=MC.convertArray(c,t.values.constructor),r.push(t))}s.tracks=r;let a=1/0;for(let l=0;l<s.tracks.length;++l)a>s.tracks[l].times[0]&&(a=s.tracks[l].times[0]);for(let l=0;l<s.tracks.length;++l)s.tracks[l].shift(-1*a);return s.resetDuration(),s},makeClipAdditive:function(t,e=0,n=t,i=30){i<=0&&(i=30);const o=n.tracks.length,s=e/i;for(let r=0;r<o;++r){const e=n.tracks[r],i=e.ValueTypeName;if("bool"===i||"string"===i)continue;const o=t.tracks.find((function(t){return t.name===e.name&&t.ValueTypeName===i}));if(void 0===o)continue;let a=0;const l=e.getValueSize();e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=l/3);let c=0;const g=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=g/3);const d=e.times.length-1;let h;if(s<=e.times[0]){const t=a,n=l-a;h=MC.arraySlice(e.values,t,n)}else if(s>=e.times[d]){const t=d*l+a,n=t+l-a;h=MC.arraySlice(e.values,t,n)}else{const t=e.createInterpolant(),n=a,i=l-a;t.evaluate(s),h=MC.arraySlice(t.resultBuffer,n,i)}"quaternion"===i&&(new rg).fromArray(h).normalize().conjugate().toArray(h);const m=o.times.length;for(let t=0;t<m;++t){const e=t*g+c;if("quaternion"===i)rg.multiplyQuaternionsFlat(o.values,e,h,0,o.values,e);else{const t=g-2*c;for(let n=0;n<t;++n)o.values[e+n]-=h[n]}}}return t.blendMode=2501,t}};class UC{constructor(t,e,n,i){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new e.constructor(n),this.sampleValues=e,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let n=this._cachedIndex,i=e[n],o=e[n-1];t:{e:{let s;n:{i:if(!(t<i)){for(let s=n+2;;){if(void 0===i){if(t<o)break i;return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,t,o)}if(n===s)break;if(o=i,i=e[++n],t<i)break e}s=e.length;break n}if(t>=o)break t;{const r=e[1];t<r&&(n=2,o=r);for(let s=n-2;;){if(void 0===o)return this._cachedIndex=0,this.beforeStart_(0,t,i);if(n===s)break;if(i=o,o=e[--n-1],t>=o)break e}s=n,n=0}}for(;n<s;){const i=n+s>>>1;t<e[i]?s=i:n=i+1}if(i=e[n],o=e[n-1],void 0===o)return this._cachedIndex=0,this.beforeStart_(0,t,i);if(void 0===i)return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,o,t)}this._cachedIndex=n,this.intervalChanged_(n,o,i)}return this.interpolate_(n,o,t,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,o=t*i;for(let s=0;s!==i;++s)e[s]=n[o+s];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}UC.prototype.beforeStart_=UC.prototype.copySampleValue_,UC.prototype.afterEnd_=UC.prototype.copySampleValue_;class KC extends UC{constructor(t,e,n,i){super(t,e,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:vc,endingEnd:vc}}intervalChanged_(t,e,n){const i=this.parameterPositions;let o=t-2,s=t+1,r=i[o],a=i[s];if(void 0===r)switch(this.getSettings_().endingStart){case fc:o=t,r=2*e-n;break;case Rc:o=i.length-2,r=e+i[o]-i[o+1];break;default:o=t,r=n}if(void 0===a)switch(this.getSettings_().endingEnd){case fc:s=t,a=2*n-e;break;case Rc:s=1,a=n+i[1]-i[0];break;default:s=t-1,a=e}const l=.5*(n-e),c=this.valueSize;this._weightPrev=l/(e-r),this._weightNext=l/(a-n),this._offsetPrev=o*c,this._offsetNext=s*c}interpolate_(t,e,n,i){const o=this.resultBuffer,s=this.sampleValues,r=this.valueSize,a=t*r,l=a-r,c=this._offsetPrev,g=this._offsetNext,d=this._weightPrev,h=this._weightNext,m=(n-e)/(i-e),I=m*m,u=I*m,C=-d*u+2*d*I-d*m,b=(1+d)*u+(-1.5-2*d)*I+(-.5+d)*m+1,p=(-1-h)*u+(1.5+h)*I+.5*m,y=h*u-h*I;for(let Z=0;Z!==r;++Z)o[Z]=C*s[c+Z]+b*s[l+Z]+p*s[a+Z]+y*s[g+Z];return o}}class EC extends UC{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){const o=this.resultBuffer,s=this.sampleValues,r=this.valueSize,a=t*r,l=a-r,c=(n-e)/(i-e),g=1-c;for(let d=0;d!==r;++d)o[d]=s[l+d]*g+s[a+d]*c;return o}}class LC extends UC{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t){return this.copySampleValue_(t-1)}}class DC{constructor(t,e,n,i){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=MC.convertArray(e,this.TimeBufferType),this.values=MC.convertArray(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let n;if(e.toJSON!==this.toJSON)n=e.toJSON(t);else{n={name:t.name,times:MC.convertArray(t.times,Array),values:MC.convertArray(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(n.interpolation=e)}return n.type=t.ValueTypeName,n}InterpolantFactoryMethodDiscrete(t){return new LC(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new EC(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new KC(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case Sc:e=this.InterpolantFactoryMethodDiscrete;break;case Bc:e=this.InterpolantFactoryMethodLinear;break;case Xc:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Sc;case this.InterpolantFactoryMethodLinear:return Bc;case this.InterpolantFactoryMethodSmooth:return Xc}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]*=t}return this}trim(t,e){const n=this.times,i=n.length;let o=0,s=i-1;for(;o!==i&&n[o]<t;)++o;for(;-1!==s&&n[s]>e;)--s;if(++s,0!==o||s!==i){o>=s&&(s=Math.max(s,1),o=s-1);const t=this.getValueSize();this.times=MC.arraySlice(n,o,s),this.values=MC.arraySlice(this.values,o*t,s*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const n=this.times,i=this.values,o=n.length;0===o&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let r=0;r!==o;r++){const e=n[r];if("number"==typeof e&&isNaN(e)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,r,e),t=!1;break}if(null!==s&&s>e){console.error("THREE.KeyframeTrack: Out of order keys.",this,r,e,s),t=!1;break}s=e}if(void 0!==i&&MC.isTypedArray(i))for(let r=0,a=i.length;r!==a;++r){const e=i[r];if(isNaN(e)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,r,e),t=!1;break}}return t}optimize(){const t=MC.arraySlice(this.times),e=MC.arraySlice(this.values),n=this.getValueSize(),i=this.getInterpolation()===Xc,o=t.length-1;let s=1;for(let r=1;r<o;++r){let o=!1;const a=t[r];if(a!==t[r+1]&&(1!==r||a!==t[0]))if(i)o=!0;else{const t=r*n,i=t-n,s=t+n;for(let r=0;r!==n;++r){const n=e[t+r];if(n!==e[i+r]||n!==e[s+r]){o=!0;break}}}if(o){if(r!==s){t[s]=t[r];const i=r*n,o=s*n;for(let t=0;t!==n;++t)e[o+t]=e[i+t]}++s}}if(o>0){t[s]=t[o];for(let t=o*n,i=s*n,r=0;r!==n;++r)e[i+r]=e[t+r];++s}return s!==t.length?(this.times=MC.arraySlice(t,0,s),this.values=MC.arraySlice(e,0,s*n)):(this.times=t,this.values=e),this}clone(){const t=MC.arraySlice(this.times,0),e=MC.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}}DC.prototype.TimeBufferType=Float32Array,DC.prototype.ValueBufferType=Float32Array,DC.prototype.DefaultInterpolation=Bc;class QC extends DC{}QC.prototype.ValueTypeName="bool",QC.prototype.ValueBufferType=Array,QC.prototype.DefaultInterpolation=Sc,QC.prototype.InterpolantFactoryMethodLinear=void 0,QC.prototype.InterpolantFactoryMethodSmooth=void 0;class zC extends DC{}zC.prototype.ValueTypeName="color";class PC extends DC{}PC.prototype.ValueTypeName="number";class _C extends UC{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){const o=this.resultBuffer,s=this.sampleValues,r=this.valueSize,a=(n-e)/(i-e);let l=t*r;for(let c=l+r;l!==c;l+=4)rg.slerpFlat(o,0,s,l-r,s,l,a);return o}}class OC extends DC{InterpolantFactoryMethodLinear(t){return new _C(this.times,this.values,this.getValueSize(),t)}}OC.prototype.ValueTypeName="quaternion",OC.prototype.DefaultInterpolation=Bc,OC.prototype.InterpolantFactoryMethodSmooth=void 0;class jC extends DC{}jC.prototype.ValueTypeName="string",jC.prototype.ValueBufferType=Array,jC.prototype.DefaultInterpolation=Sc,jC.prototype.InterpolantFactoryMethodLinear=void 0,jC.prototype.InterpolantFactoryMethodSmooth=void 0;class qC extends DC{}qC.prototype.ValueTypeName="vector";class $C{constructor(t,e=-1,n,i=2500){this.name=t,this.tracks=n,this.duration=e,this.blendMode=i,this.uuid=Kc(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],n=t.tracks,i=1/(t.fps||1);for(let s=0,r=n.length;s!==r;++s)e.push(tb(n[s]).scale(i));const o=new this(t.name,t.duration,e,t.blendMode);return o.uuid=t.uuid,o}static toJSON(t){const e=[],n=t.tracks,i={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let o=0,s=n.length;o!==s;++o)e.push(DC.toJSON(n[o]));return i}static CreateFromMorphTargetSequence(t,e,n,i){const o=e.length,s=[];for(let r=0;r<o;r++){let t=[],a=[];t.push((r+o-1)%o,r,(r+1)%o),a.push(0,1,0);const l=MC.getKeyframeOrder(t);t=MC.sortedArray(t,1,l),a=MC.sortedArray(a,1,l),i||0!==t[0]||(t.push(o),a.push(a[0])),s.push(new PC(".morphTargetInfluences["+e[r].name+"]",t,a).scale(1/n))}return new this(t,-1,s)}static findByName(t,e){let n=t;if(!Array.isArray(t)){const e=t;n=e.geometry&&e.geometry.animations||e.animations}for(let i=0;i<n.length;i++)if(n[i].name===e)return n[i];return null}static CreateClipsFromMorphTargetSequences(t,e,n){const i={},o=/^([\w-]*?)([\d]+)$/;for(let r=0,a=t.length;r<a;r++){const e=t[r],n=e.name.match(o);if(n&&n.length>1){const t=n[1];let o=i[t];o||(i[t]=o=[]),o.push(e)}}const s=[];for(const r in i)s.push(this.CreateFromMorphTargetSequence(r,i[r],e,n));return s}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(t,e,n,i,o){if(0!==n.length){const s=[],r=[];MC.flattenJSON(n,s,r,i),0!==s.length&&o.push(new t(e,s,r))}},i=[],o=t.name||"default",s=t.fps||30,r=t.blendMode;let a=t.length||-1;const l=t.hierarchy||[];for(let c=0;c<l.length;c++){const t=l[c].keys;if(t&&0!==t.length)if(t[0].morphTargets){const e={};let n;for(n=0;n<t.length;n++)if(t[n].morphTargets)for(let i=0;i<t[n].morphTargets.length;i++)e[t[n].morphTargets[i]]=-1;for(const o in e){const e=[],s=[];for(let i=0;i!==t[n].morphTargets.length;++i){const i=t[n];e.push(i.time),s.push(i.morphTarget===o?1:0)}i.push(new PC(".morphTargetInfluence["+o+"]",e,s))}a=e.length*(s||1)}else{const o=".bones["+e[c].name+"]";n(qC,o+".position",t,"pos",i),n(OC,o+".quaternion",t,"rot",i),n(qC,o+".scale",t,"scl",i)}}return 0===i.length?null:new this(o,a,i,r)}resetDuration(){let t=0;for(let e=0,n=this.tracks.length;e!==n;++e){const n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function tb(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return PC;case"vector":case"vector2":case"vector3":case"vector4":return qC;case"color":return zC;case"quaternion":return OC;case"bool":case"boolean":return QC;case"string":return jC}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],n=[];MC.flattenJSON(t.keys,e,n,"value"),t.times=e,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const eb={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}},nb=new class{constructor(t,e,n){const i=this;let o,s=!1,r=0,a=0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){a++,!1===s&&void 0!==i.onStart&&i.onStart(t,r,a),s=!0},this.itemEnd=function(t){r++,void 0!==i.onProgress&&i.onProgress(t,r,a),r===a&&(s=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(t){void 0!==i.onError&&i.onError(t)},this.resolveURL=function(t){return o?o(t):t},this.setURLModifier=function(t){return o=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,n=l.length;e<n;e+=2){const n=l[e],i=l[e+1];if(n.global&&(n.lastIndex=0),n.test(t))return i}return null}}};class ib{constructor(t){this.manager=void 0!==t?t:nb,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const n=this;return new Promise((function(i,o){n.load(t,i,e,o)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}const ob={};class sb extends ib{constructor(t){super(t)}load(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const o=this,s=eb.get(t);if(void 0!==s)return o.manager.itemStart(t),setTimeout((function(){e&&e(s),o.manager.itemEnd(t)}),0),s;if(void 0!==ob[t])return void ob[t].push({onLoad:e,onProgress:n,onError:i});const r=t.match(/^data:(.*?)(;base64)?,(.*)$/);let a;if(r){const n=r[1],s=!!r[2];let a=r[3];a=decodeURIComponent(a),s&&(a=atob(a));try{let i;const s=(this.responseType||"").toLowerCase();switch(s){case"arraybuffer":case"blob":const t=new Uint8Array(a.length);for(let n=0;n<a.length;n++)t[n]=a.charCodeAt(n);i="blob"===s?new Blob([t.buffer],{type:n}):t.buffer;break;case"document":const e=new DOMParser;i=e.parseFromString(a,n);break;case"json":i=JSON.parse(a);break;default:i=a}setTimeout((function(){e&&e(i),o.manager.itemEnd(t)}),0)}catch(e){setTimeout((function(){i&&i(e),o.manager.itemError(t),o.manager.itemEnd(t)}),0)}}else{ob[t]=[],ob[t].push({onLoad:e,onProgress:n,onError:i}),a=new XMLHttpRequest,a.open("GET",t,!0),a.addEventListener("load",(function(e){const n=this.response,i=ob[t];if(delete ob[t],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),eb.add(t,n);for(let t=0,e=i.length;t<e;t++){const e=i[t];e.onLoad&&e.onLoad(n)}o.manager.itemEnd(t)}else{for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onError&&n.onError(e)}o.manager.itemError(t),o.manager.itemEnd(t)}}),!1),a.addEventListener("progress",(function(e){const n=ob[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onProgress&&i.onProgress(e)}}),!1),a.addEventListener("error",(function(e){const n=ob[t];delete ob[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onError&&i.onError(e)}o.manager.itemError(t),o.manager.itemEnd(t)}),!1),a.addEventListener("abort",(function(e){const n=ob[t];delete ob[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onError&&i.onError(e)}o.manager.itemError(t),o.manager.itemEnd(t)}),!1),void 0!==this.responseType&&(a.responseType=this.responseType),void 0!==this.withCredentials&&(a.withCredentials=this.withCredentials),a.overrideMimeType&&a.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const t in this.requestHeader)a.setRequestHeader(t,this.requestHeader[t]);a.send(null)}return o.manager.itemStart(t),a}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class rb extends ib{constructor(t){super(t)}load(t,e,n,i){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const o=this,s=eb.get(t);if(void 0!==s)return o.manager.itemStart(t),setTimeout((function(){e&&e(s),o.manager.itemEnd(t)}),0),s;const r=document.createElementNS("http://www.w3.org/1999/xhtml","img");function a(){r.removeEventListener("load",a,!1),r.removeEventListener("error",l,!1),eb.add(t,this),e&&e(this),o.manager.itemEnd(t)}function l(e){r.removeEventListener("load",a,!1),r.removeEventListener("error",l,!1),i&&i(e),o.manager.itemError(t),o.manager.itemEnd(t)}return r.addEventListener("load",a,!1),r.addEventListener("error",l,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(r.crossOrigin=this.crossOrigin),o.manager.itemStart(t),r.src=t,r}}class ab extends ib{constructor(t){super(t)}load(t,e,n,i){const o=new Zh,s=new rb(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let r=0;function a(n){s.load(t[n],(function(t){o.images[n]=t,r++,6===r&&(o.needsUpdate=!0,e&&e(o))}),void 0,i)}for(let l=0;l<t.length;++l)a(l);return o}}class lb extends ib{constructor(t){super(t)}load(t,e,n,i){const o=new eg,s=new rb(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,(function(n){o.image=n;const i=t.search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/);o.format=i?yc:Zc,o.needsUpdate=!0,void 0!==e&&e(o)}),n,i),o}}class cb extends Ku{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new nC(e,t))}getPoint(t){const e=t*this.getLength(),n=this.getCurveLengths();let i=0;for(;i<n.length;){if(n[i]>=e){const t=n[i]-e,o=this.curves[i],s=o.getLength(),r=0===s?0:1-t/s;return o.getPointAt(r)}i++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let n=0,i=this.curves.length;n<i;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let n;for(let i=0,o=this.curves;i<o.length;i++){const s=o[i],r=s&&s.isEllipseCurve?2*t:s&&(s.isLineCurve||s.isLineCurve3)?1:s&&s.isSplineCurve?t*s.points.length:t,a=s.getPoints(r);for(let t=0;t<a.length;t++){const i=a[t];n&&n.equals(i)||(e.push(i),n=i)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,n=this.curves.length;e<n;e++){const n=this.curves[e];t.curves.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push((new rC[n.type]).fromJSON(n))}return this}}class gb extends cb{constructor(t){super(),this.type="Path",this.currentPoint=new Oc,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const n=new nC(this.currentPoint.clone(),new Oc(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,n,i){const o=new iC(this.currentPoint.clone(),new Oc(t,e),new Oc(n,i));return this.curves.push(o),this.currentPoint.set(n,i),this}bezierCurveTo(t,e,n,i,o,s){const r=new tC(this.currentPoint.clone(),new Oc(t,e),new Oc(n,i),new Oc(o,s));return this.curves.push(r),this.currentPoint.set(o,s),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),n=new sC(e);return this.curves.push(n),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,n,i,o,s){const r=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(t+r,e+a,n,i,o,s),this}absarc(t,e,n,i,o,s){return this.absellipse(t,e,n,n,i,o,s),this}ellipse(t,e,n,i,o,s,r,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+l,e+c,n,i,o,s,r,a),this}absellipse(t,e,n,i,o,s,r,a){const l=new Eu(t,e,n,i,o,s,r,a);if(this.curves.length>0){const t=l.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class db extends gb{constructor(t){super(t),this.uuid=Kc(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let n=0,i=this.holes.length;n<i;n++)e[n]=this.holes[n].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,n=this.holes.length;e<n;e++){const n=this.holes[e];t.holes.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push((new gb).fromJSON(n))}return this}}class hb extends cd{constructor(t,e=1){super(),this.type="Light",this.color=new Rd(t),this.intensity=e}dispose(){}copy(t){return super.copy(t),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}hb.prototype.isLight=!0;class mb extends hb{constructor(t,e,n){super(t,n),this.type="HemisphereLight",this.position.copy(cd.DefaultUp),this.updateMatrix(),this.groundColor=new Rd(e)}copy(t){return hb.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}mb.prototype.isHemisphereLight=!0;const Ib=new Ng,ub=new ag,Cb=new ag;class bb{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Oc(512,512),this.map=null,this.mapPass=null,this.matrix=new Ng,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new fh,this._frameExtents=new Oc(1,1),this._viewportCount=1,this._viewports=[new ig(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,n=this.matrix;ub.setFromMatrixPosition(t.matrixWorld),e.position.copy(ub),Cb.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(Cb),e.updateMatrixWorld(),Ib.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ib),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(e.projectionMatrix),n.multiply(e.matrixWorldInverse)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class pb extends bb{constructor(){super(new bh(50,1,.5,500)),this.focus=1}updateMatrices(t){const e=this.camera,n=2*Uc*t.angle*this.focus,i=this.mapSize.width/this.mapSize.height,o=t.distance||e.far;n===e.fov&&i===e.aspect&&o===e.far||(e.fov=n,e.aspect=i,e.far=o,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}pb.prototype.isSpotLightShadow=!0;class yb extends hb{constructor(t,e,n=0,i=Math.PI/3,o=0,s=1){super(t,e),this.type="SpotLight",this.position.copy(cd.DefaultUp),this.updateMatrix(),this.target=new cd,this.distance=n,this.angle=i,this.penumbra=o,this.decay=s,this.shadow=new pb}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}yb.prototype.isSpotLight=!0;const Zb=new Ng,Jb=new ag,Gb=new ag;class Vb extends bb{constructor(){super(new bh(90,1,.5,500)),this._frameExtents=new Oc(4,2),this._viewportCount=6,this._viewports=[new ig(2,1,1,1),new ig(0,1,1,1),new ig(3,1,1,1),new ig(1,1,1,1),new ig(3,0,1,1),new ig(1,0,1,1)],this._cubeDirections=[new ag(1,0,0),new ag(-1,0,0),new ag(0,0,1),new ag(0,0,-1),new ag(0,1,0),new ag(0,-1,0)],this._cubeUps=[new ag(0,1,0),new ag(0,1,0),new ag(0,1,0),new ag(0,1,0),new ag(0,0,1),new ag(0,0,-1)]}updateMatrices(t,e=0){const n=this.camera,i=this.matrix,o=t.distance||n.far;o!==n.far&&(n.far=o,n.updateProjectionMatrix()),Jb.setFromMatrixPosition(t.matrixWorld),n.position.copy(Jb),Gb.copy(n.position),Gb.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(Gb),n.updateMatrixWorld(),i.makeTranslation(-Jb.x,-Jb.y,-Jb.z),Zb.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Zb)}}Vb.prototype.isPointLightShadow=!0;class Sb extends hb{constructor(t,e,n=0,i=1){super(t,e),this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new Vb}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}Sb.prototype.isPointLight=!0;class Bb extends Ch{constructor(t=-1,e=1,n=1,i=-1,o=.1,s=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=i,this.near=o,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,n,i,o,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=o,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let o=n-t,s=n+t,r=i+e,a=i-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o+=t*this.view.offsetX,s=o+t*this.view.width,r-=e*this.view.offsetY,a=r-e*this.view.height}this.projectionMatrix.makeOrthographic(o,s,r,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}Bb.prototype.isOrthographicCamera=!0;class Xb extends bb{constructor(){super(new Bb(-5,5,5,-5,.5,500))}}Xb.prototype.isDirectionalLightShadow=!0;class vb extends hb{constructor(t,e){super(t,e),this.type="DirectionalLight",this.position.copy(cd.DefaultUp),this.updateMatrix(),this.target=new cd,this.shadow=new Xb}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}vb.prototype.isDirectionalLight=!0,class extends hb{constructor(t,e){super(t,e),this.type="AmbientLight"}}.prototype.isAmbientLight=!0,class extends hb{constructor(t,e,n=10,i=10){super(t,e),this.type="RectAreaLight",this.width=n,this.height=i}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}.prototype.isRectAreaLight=!0;class fb{constructor(){this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new ag)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const n=t.x,i=t.y,o=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.282095),e.addScaledVector(s[1],.488603*i),e.addScaledVector(s[2],.488603*o),e.addScaledVector(s[3],.488603*n),e.addScaledVector(s[4],n*i*1.092548),e.addScaledVector(s[5],i*o*1.092548),e.addScaledVector(s[6],.315392*(3*o*o-1)),e.addScaledVector(s[7],n*o*1.092548),e.addScaledVector(s[8],.546274*(n*n-i*i)),e}getIrradianceAt(t,e){const n=t.x,i=t.y,o=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.886227),e.addScaledVector(s[1],1.023328*i),e.addScaledVector(s[2],1.023328*o),e.addScaledVector(s[3],1.023328*n),e.addScaledVector(s[4],.858086*n*i),e.addScaledVector(s[5],.858086*i*o),e.addScaledVector(s[6],.743125*o*o-.247708),e.addScaledVector(s[7],.858086*n*o),e.addScaledVector(s[8],.429043*(n*n-i*i)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(t,e+3*i);return this}toArray(t=[],e=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(t,e+3*i);return t}static getBasisAt(t,e){const n=t.x,i=t.y,o=t.z;e[0]=.282095,e[1]=.488603*i,e[2]=.488603*o,e[3]=.488603*n,e[4]=1.092548*n*i,e[5]=1.092548*i*o,e[6]=.315392*(3*o*o-1),e[7]=1.092548*n*o,e[8]=.546274*(n*n-i*i)}}fb.prototype.isSphericalHarmonics3=!0;class Rb extends hb{constructor(t=new fb,e=1){super(void 0,e),this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}Rb.prototype.isLightProbe=!0;class Wb{static decodeText(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let n=0,i=t.length;n<i;n++)e+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(e))}catch(t){return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)}}(class extends Dd{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const t=super.toJSON(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}).prototype.isInstancedBufferGeometry=!0,class extends Yd{constructor(t,e,n,i=1){"number"==typeof n&&(i=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(t,e,n),this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}.prototype.isInstancedBufferAttribute=!0;class Ab extends ib{constructor(t){super(t),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const o=this,s=eb.get(t);if(void 0!==s)return o.manager.itemStart(t),setTimeout((function(){e&&e(s),o.manager.itemEnd(t)}),0),s;const r={};r.credentials="anonymous"===this.crossOrigin?"same-origin":"include",r.headers=this.requestHeader,fetch(t,r).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,Object.assign(o.options,{colorSpaceConversion:"none"}))})).then((function(n){eb.add(t,n),e&&e(n),o.manager.itemEnd(t)})).catch((function(e){i&&i(e),o.manager.itemError(t),o.manager.itemEnd(t)})),o.manager.itemStart(t)}}let wb;Ab.prototype.isImageBitmapLoader=!0;const Yb=function(){return void 0===wb&&(wb=new(window.AudioContext||window.webkitAudioContext)),wb};class kb extends ib{constructor(t){super(t)}load(t,e,n,i){const o=this,s=new sb(this.manager);s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(n){try{const t=n.slice(0);Yb().decodeAudioData(t,(function(t){e(t)}))}catch(e){i?i(e):console.error(e),o.manager.itemError(t)}}),n,i)}}(class extends Rb{constructor(t,e,n=1){super(void 0,n);const i=(new Rd).set(t),o=(new Rd).set(e),s=new ag(i.r,i.g,i.b),r=new ag(o.r,o.g,o.b),a=Math.sqrt(Math.PI),l=a*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(r).multiplyScalar(a),this.sh.coefficients[1].copy(s).sub(r).multiplyScalar(l)}}).prototype.isHemisphereLightProbe=!0,class extends Rb{constructor(t,e=1){super(void 0,e);const n=(new Rd).set(t);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}}.prototype.isAmbientLightProbe=!0;class Fb{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Hb(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=Hb();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function Hb(){return("undefined"==typeof performance?Date:performance).now()}class xb{constructor(t,e,n){let i,o,s;switch(this.binding=t,this.valueSize=n,e){case"quaternion":i=this._slerp,o=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,o=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,o=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=o,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const n=this.buffer,i=this.valueSize,o=t*i+i;let s=this.cumulativeWeight;if(0===s){for(let t=0;t!==i;++t)n[o+t]=n[t];s=e}else{s+=e;const t=e/s;this._mixBufferRegion(n,o,0,t,i)}this.cumulativeWeight=s}accumulateAdditive(t){const e=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,i,0,t,n),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,n=this.buffer,i=t*e+e,o=this.cumulativeWeight,s=this.cumulativeWeightAdditive,r=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,o<1){const t=e*this._origIndex;this._mixBufferRegion(n,i,t,1-o,e)}s>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*e,1,e);for(let a=e,l=e+e;a!==l;++a)if(n[a]!==n[a+e]){r.setValue(n,i);break}}saveOriginalState(){const t=this.binding,e=this.buffer,n=this.valueSize,i=n*this._origIndex;t.getValue(e,i);for(let o=n,s=i;o!==s;++o)e[o]=e[i+o%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let n=t;n<e;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[e+n]=this.buffer[t+n]}_select(t,e,n,i,o){if(i>=.5)for(let s=0;s!==o;++s)t[e+s]=t[n+s]}_slerp(t,e,n,i){rg.slerpFlat(t,e,t,e,t,n,i)}_slerpAdditive(t,e,n,i,o){const s=this._workIndex*o;rg.multiplyQuaternionsFlat(t,s,t,e,t,n),rg.slerpFlat(t,e,t,e,t,s,i)}_lerp(t,e,n,i,o){const s=1-i;for(let r=0;r!==o;++r){const o=e+r;t[o]=t[o]*s+t[n+r]*i}}_lerpAdditive(t,e,n,i,o){for(let s=0;s!==o;++s){const o=e+s;t[o]=t[o]+t[n+s]*i}}}const Nb="\\[\\]\\.:\\/",Tb=new RegExp("[\\[\\]\\.:\\/]","g"),Mb="[^\\[\\]\\.:\\/]",Ub="[^"+Nb.replace("\\.","")+"]",Kb=/((?:WC+[\/:])*)/.source.replace("WC",Mb),Eb=/(WCOD+)?/.source.replace("WCOD",Ub),Lb=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Mb),Db=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Mb),Qb=new RegExp("^"+Kb+Eb+Lb+Db+"$"),zb=["material","materials","bones"];class Pb{constructor(t,e,n){this.path=e,this.parsedPath=n||Pb.parseTrackName(e),this.node=Pb.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,n){return t&&t.isAnimationObjectGroup?new Pb.Composite(t,e,n):new Pb(t,e,n)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(Tb,"")}static parseTrackName(t){const e=Qb.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const t=n.nodeName.substring(i+1);-1!==zb.indexOf(t)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=t)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n}static findNode(t,e){if(!e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){const n=function(t){for(let i=0;i<t.length;i++){const o=t[i];if(o.name===e||o.uuid===e)return o;const s=n(o.children);if(s)return s}return null},i=n(t.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.node[this.propertyName]}_getValue_array(t,e){const n=this.resolvedProperty;for(let i=0,o=n.length;i!==o;++i)t[e++]=n[i]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const n=this.resolvedProperty;for(let i=0,o=n.length;i!==o;++i)n[i]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const n=this.resolvedProperty;for(let i=0,o=n.length;i!==o;++i)n[i]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const n=this.resolvedProperty;for(let i=0,o=n.length;i!==o;++i)n[i]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,n=e.objectName,i=e.propertyName;let o=e.propertyIndex;if(t||(t=Pb.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let i=e.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===i){i=e;break}break;default:if(void 0===t[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n]}if(void 0!==i){if(void 0===t[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[i]}}const s=t[i];if(void 0===s){const n=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",t)}let r=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?r=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(r=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==o){if("morphTargetInfluences"===i){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[o]&&(o=t.morphTargetDictionary[o])}a=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=o}else void 0!==s.fromArray&&void 0!==s.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(a=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][r]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Pb.Composite=class{constructor(t,e,n){const i=n||Pb.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,i)}getValue(t,e){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(t,e)}setValue(t,e){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,o=n.length;i!==o;++i)n[i].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}},Pb.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Pb.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Pb.prototype.GetterByBindingType=[Pb.prototype._getValue_direct,Pb.prototype._getValue_array,Pb.prototype._getValue_arrayElement,Pb.prototype._getValue_toArray],Pb.prototype.SetterByBindingTypeAndVersioning=[[Pb.prototype._setValue_direct,Pb.prototype._setValue_direct_setNeedsUpdate,Pb.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Pb.prototype._setValue_array,Pb.prototype._setValue_array_setNeedsUpdate,Pb.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Pb.prototype._setValue_arrayElement,Pb.prototype._setValue_arrayElement_setNeedsUpdate,Pb.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Pb.prototype._setValue_fromArray,Pb.prototype._setValue_fromArray_setNeedsUpdate,Pb.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class _b{constructor(t,e,n=null,i=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=n,this.blendMode=i;const o=e.tracks,s=o.length,r=new Array(s),a={endingStart:vc,endingEnd:vc};for(let l=0;l!==s;++l){const t=o[l].createInterpolant(null);r[l]=t,t.settings=a}this._interpolantSettings=a,this._interpolants=r,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){const n=this._clip.duration,i=t._clip.duration,o=i/n,s=n/i;t.warp(1,o,e),this.warp(s,1,e)}return this}crossFadeTo(t,e,n){return t.crossFadeFrom(this,e,n)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,n){const i=this._mixer,o=i.time,s=this.timeScale;let r=this._timeScaleInterpolant;null===r&&(r=i._lendControlInterpolant(),this._timeScaleInterpolant=r);const a=r.parameterPositions,l=r.sampleValues;return a[0]=o,a[1]=o+n,l[0]=t/s,l[1]=e/s,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,n,i){if(!this.enabled)return void this._updateWeight(t);const o=this._startTime;if(null!==o){const i=(t-o)*n;if(i<0||0===n)return;this._startTime=null,e=n*i}e*=this._updateTimeScale(t);const s=this._updateTime(e),r=this._updateWeight(t);if(r>0){const t=this._interpolants,e=this._propertyBindings;if(2501===this.blendMode)for(let n=0,i=t.length;n!==i;++n)t[n].evaluate(s),e[n].accumulateAdditive(r);else for(let n=0,o=t.length;n!==o;++n)t[n].evaluate(s),e[n].accumulate(i,r)}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const n=this._weightInterpolant;if(null!==n){const i=n.evaluate(t)[0];e*=i,t>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const n=this._timeScaleInterpolant;null!==n&&(e*=n.evaluate(t)[0],t>n.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e))}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,n=this.loop;let i=this.time+t,o=this._loopCount;const s=2202===n;if(0===t)return-1===o?i:s&&1==(1&o)?e-i:i;if(n===Vc){-1===o&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(i>=e)i=e;else{if(!(i<0)){this.time=i;break t}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===o&&(t>=0?(o=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),i>=e||i<0){const n=Math.floor(i/e);i-=e*n,o+=Math.abs(n);const r=this.repetitions-o;if(r<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=t>0?e:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===r){const e=t<0;this._setEndings(e,!e,s)}else this._setEndings(!1,!1,s);this._loopCount=o,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=i;if(s&&1==(1&o))return e-i}return i}_setEndings(t,e,n){const i=this._interpolantSettings;n?(i.endingStart=fc,i.endingEnd=fc):(i.endingStart=t?this.zeroSlopeAtStart?fc:vc:Rc,i.endingEnd=e?this.zeroSlopeAtEnd?fc:vc:Rc)}_scheduleFading(t,e,n){const i=this._mixer,o=i.time;let s=this._weightInterpolant;null===s&&(s=i._lendControlInterpolant(),this._weightInterpolant=s);const r=s.parameterPositions,a=s.sampleValues;return r[0]=o,a[0]=e,r[1]=o+t,a[1]=n,this}}class Ob extends xc{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const n=t._localRoot||this._root,i=t._clip.tracks,o=i.length,s=t._propertyBindings,r=t._interpolants,a=n.uuid,l=this._bindingsByRootAndName;let c=l[a];void 0===c&&(c={},l[a]=c);for(let g=0;g!==o;++g){const t=i[g],o=t.name;let l=c[o];if(void 0!==l)s[g]=l;else{if(l=s[g],void 0!==l){null===l._cacheIndex&&(++l.referenceCount,this._addInactiveBinding(l,a,o));continue}const i=e&&e._propertyBindings[g].binding.parsedPath;l=new xb(Pb.create(n,o,i),t.ValueTypeName,t.getValueSize()),++l.referenceCount,this._addInactiveBinding(l,a,o),s[g]=l}r[g].resultBuffer=l.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,n=t._clip.uuid,i=this._actionsByClip[n];this._bindAction(t,i&&i.knownActions[0]),this._addInactiveAction(t,n,e)}const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,n){const i=this._actions,o=this._actionsByClip;let s=o[e];if(void 0===s)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,o[e]=s;else{const e=s.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=i.length,i.push(t),s.actionByRoot[n]=t}_removeInactiveAction(t){const e=this._actions,n=e[e.length-1],i=t._cacheIndex;n._cacheIndex=i,e[i]=n,e.pop(),t._cacheIndex=null;const o=t._clip.uuid,s=this._actionsByClip,r=s[o],a=r.knownActions,l=a[a.length-1],c=t._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),t._byClipCacheIndex=null,delete r.actionByRoot[(t._localRoot||this._root).uuid],0===a.length&&delete s[o],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let n=0,i=e.length;n!==i;++n){const t=e[n];0==--t.referenceCount&&this._removeInactiveBinding(t)}}_lendAction(t){const e=this._actions,n=t._cacheIndex,i=this._nActiveActions++,o=e[i];t._cacheIndex=i,e[i]=t,o._cacheIndex=n,e[n]=o}_takeBackAction(t){const e=this._actions,n=t._cacheIndex,i=--this._nActiveActions,o=e[i];t._cacheIndex=i,e[i]=t,o._cacheIndex=n,e[n]=o}_addInactiveBinding(t,e,n){const i=this._bindingsByRootAndName,o=this._bindings;let s=i[e];void 0===s&&(s={},i[e]=s),s[n]=t,t._cacheIndex=o.length,o.push(t)}_removeInactiveBinding(t){const e=this._bindings,n=t.binding,i=n.rootNode.uuid,o=n.path,s=this._bindingsByRootAndName,r=s[i],a=e[e.length-1],l=t._cacheIndex;a._cacheIndex=l,e[l]=a,e.pop(),delete r[o],0===Object.keys(r).length&&delete s[i]}_lendBinding(t){const e=this._bindings,n=t._cacheIndex,i=this._nActiveBindings++,o=e[i];t._cacheIndex=i,e[i]=t,o._cacheIndex=n,e[n]=o}_takeBackBinding(t){const e=this._bindings,n=t._cacheIndex,i=--this._nActiveBindings,o=e[i];t._cacheIndex=i,e[i]=t,o._cacheIndex=n,e[n]=o}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let n=t[e];return void 0===n&&(n=new EC(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=e,t[e]=n),n}_takeBackControlInterpolant(t){const e=this._controlInterpolants,n=t.__cacheIndex,i=--this._nActiveControlInterpolants,o=e[i];t.__cacheIndex=i,e[i]=t,o.__cacheIndex=n,e[n]=o}clipAction(t,e,n){const i=e||this._root,o=i.uuid;let s="string"==typeof t?$C.findByName(i,t):t;const r=null!==s?s.uuid:t,a=this._actionsByClip[r];let l=null;if(void 0===n&&(n=null!==s?s.blendMode:Wc),void 0!==a){const t=a.actionByRoot[o];if(void 0!==t&&t.blendMode===n)return t;l=a.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;const c=new _b(this,s,e,n);return this._bindAction(c,l),this._addInactiveAction(c,r,o),c}existingAction(t,e){const n=e||this._root,i=n.uuid,o="string"==typeof t?$C.findByName(n,t):t,s=o?o.uuid:t,r=this._actionsByClip[s];return void 0!==r&&r.actionByRoot[i]||null}stopAllAction(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}update(t){t*=this.timeScale;const e=this._actions,n=this._nActiveActions,i=this.time+=t,o=Math.sign(t),s=this._accuIndex^=1;for(let l=0;l!==n;++l)e[l]._update(i,t,o,s);const r=this._bindings,a=this._nActiveBindings;for(let l=0;l!==a;++l)r[l].apply(s);return this}setTime(t){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,n=t.uuid,i=this._actionsByClip,o=i[n];if(void 0!==o){const t=o.knownActions;for(let n=0,i=t.length;n!==i;++n){const i=t[n];this._deactivateAction(i);const o=i._cacheIndex,s=e[e.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,s._cacheIndex=o,e[o]=s,e.pop(),this._removeInactiveBindingsForAction(i)}delete i[n]}}uncacheRoot(t){const e=t.uuid,n=this._actionsByClip;for(const o in n){const t=n[o].actionByRoot[e];void 0!==t&&(this._deactivateAction(t),this._removeInactiveAction(t))}const i=this._bindingsByRootAndName[e];if(void 0!==i)for(const o in i){const t=i[o];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(t,e){const n=this.existingAction(t,e);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}Ob.prototype._controlInterpolantsResultBuffer=new Float32Array(1),class extends DI{constructor(t,e,n=1){super(t,e),this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}.prototype.isInstancedInterleavedBuffer=!0;class jb{constructor(t=1,e=0,n=0){return this.radius=t,this.phi=e,this.theta=n,this}set(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){const t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(Ec(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}(class extends cd{constructor(t){super(),this.material=t,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}}).prototype.isImmediateRenderObject=!0;const qb=new ag,$b=new Ng,tp=new Ng;function ep(t){const e=[];t&&t.isBone&&e.push(t);for(let n=0;n<t.children.length;n++)e.push.apply(e,ep(t.children[n]));return e}const np=new Float32Array(1);new Int32Array(np.buffer);const ip=new Wd({side:1,depthWrite:!1,depthTest:!1});new ch(new dh,ip),Ku.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(Ku.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},gb.prototype.fromPoints=function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)},class extends Yu{constructor(t=10,e=10,n=4473924,i=8947848){n=new Rd(n),i=new Rd(i);const o=e/2,s=t/e,r=t/2,a=[],l=[];for(let g=0,d=0,h=-r;g<=e;g++,h+=s){a.push(-r,0,h,r,0,h),a.push(h,0,-r,h,0,r);const t=g===o?n:i;t.toArray(l,d),d+=3,t.toArray(l,d),d+=3,t.toArray(l,d),d+=3,t.toArray(l,d),d+=3}const c=new Dd;c.setAttribute("position",new Hd(a,3)),c.setAttribute("color",new Hd(l,3)),super(c,new Su({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},class extends Yu{constructor(t){const e=ep(t),n=new Dd,i=[],o=[],s=new Rd(0,0,1),r=new Rd(0,1,0);for(let a=0;a<e.length;a++){const t=e[a];t.parent&&t.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),o.push(s.r,s.g,s.b),o.push(r.r,r.g,r.b))}n.setAttribute("position",new Hd(i,3)),n.setAttribute("color",new Hd(o,3)),super(n,new Su({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,n=this.geometry,i=n.getAttribute("position");tp.copy(this.root.matrixWorld).invert();for(let o=0,s=0;o<e.length;o++){const t=e[o];t.parent&&t.parent.isBone&&($b.multiplyMatrices(tp,t.matrixWorld),qb.setFromMatrixPosition($b),i.setXYZ(s,qb.x,qb.y,qb.z),$b.multiplyMatrices(tp,t.parent.matrixWorld),qb.setFromMatrixPosition($b),i.setXYZ(s+1,qb.x,qb.y,qb.z),s+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}}.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},ib.prototype.extractUrlBase=function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Wb.extractUrlBase(t)},ib.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},gg.prototype.center=function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},gg.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},gg.prototype.isIntersectionBox=function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},gg.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},gg.prototype.size=function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)},Rg.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},fh.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},jc.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},jc.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},jc.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},jc.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},jc.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},jc.prototype.getInverse=function(t){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},Ng.prototype.extractPosition=function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},Ng.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},Ng.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new ag).setFromMatrixColumn(this,3)},Ng.prototype.setRotationFromQuaternion=function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},Ng.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},Ng.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},Ng.prototype.multiplyVector4=function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},Ng.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},Ng.prototype.rotateAxis=function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},Ng.prototype.crossVector=function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},Ng.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},Ng.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},Ng.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},Ng.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},Ng.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},Ng.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},Ng.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},Ng.prototype.makeFrustum=function(t,e,n,i,o,s){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,i,n,o,s)},Ng.prototype.getInverse=function(t){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},Bh.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},rg.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},rg.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},xg.prototype.isIntersectionBox=function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},xg.prototype.isIntersectionPlane=function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},xg.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},Zd.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},Zd.prototype.barycoordFromPoint=function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},Zd.prototype.midpoint=function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},Zd.prototypenormal=function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},Zd.prototype.plane=function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)},Zd.barycoordFromPoint=function(t,e,n,i,o){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Zd.getBarycoord(t,e,n,i,o)},Zd.normal=function(t,e,n,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Zd.getNormal(t,e,n,i)},db.prototype.extractAllPoints=function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},db.prototype.extrude=function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new FC(this,t)},db.prototype.makeGeometry=function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new xC(this,t)},Oc.prototype.fromAttribute=function(t,e,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},Oc.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},Oc.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},ag.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},ag.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},ag.prototype.getPositionFromMatrix=function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},ag.prototype.getScaleFromMatrix=function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},ag.prototype.getColumnFromMatrix=function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},ag.prototype.applyProjection=function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},ag.prototype.fromAttribute=function(t,e,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},ag.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},ag.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},ig.prototype.fromAttribute=function(t,e,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},ig.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},cd.prototype.getChildByName=function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},cd.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},cd.prototype.translate=function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},cd.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},cd.prototype.applyMatrix=function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties(cd.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),ch.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(ch.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Iu.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},bh.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(hb.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(Yd.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Fc},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Fc)}}}),Yd.prototype.setDynamic=function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?Fc:kc),this},Yd.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Yd.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Dd.prototype.addIndex=function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},Dd.prototype.addAttribute=function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new Yd(arguments[1],arguments[2])))},Dd.prototype.addDrawCall=function(t,e,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},Dd.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},Dd.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},Dd.prototype.removeAttribute=function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},Dd.prototype.applyMatrix=function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties(Dd.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),DI.prototype.setDynamic=function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?Fc:kc),this},DI.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},FC.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},FC.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},FC.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},LI.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},Object.defineProperties(Gd.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Rd}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===t}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}}}),Object.defineProperties(uh.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),EI.prototype.clearTarget=function(t,e,n,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,n,i)},EI.prototype.animate=function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},EI.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},EI.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},EI.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},EI.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},EI.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},EI.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},EI.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},EI.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},EI.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},EI.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},EI.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},EI.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},EI.prototype.enableScissorTest=function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},EI.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},EI.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},EI.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},EI.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},EI.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},EI.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},EI.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},EI.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},EI.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},EI.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(EI.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?wc:Ac}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(YI.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(og.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),class extends cd{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}.prototype.load=function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return(new kb).load(t,(function(t){e.setBuffer(t)})),this},yh.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)},yh.prototype.clear=function(t,e,n,i){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(t,e,n,i)},$c.crossOrigin=void 0,$c.loadTexture=function(t,e,n,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const o=new lb;o.setCrossOrigin(this.crossOrigin);const s=o.load(t,n,void 0,i);return e&&(s.mapping=e),s},$c.loadTextureCube=function(t,e,n,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const o=new ab;o.setCrossOrigin(this.crossOrigin);const s=o.load(t,n,void 0,i);return e&&(s.mapping=e),s},$c.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},$c.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"130"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="130");class op extends ib{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(t){return new cp(t)})),this.register((function(t){return new dp(t)})),this.register((function(t){return new hp(t)})),this.register((function(t){return new gp(t)})),this.register((function(t){return new ap(t)})),this.register((function(t){return new mp(t)}))}load(t,e,n,i){const o=this;let s;s=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:Wb.extractUrlBase(t),this.manager.itemStart(t);const r=function(e){i?i(e):console.error(e),o.manager.itemError(t),o.manager.itemEnd(t)},a=new sb(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,(function(n){try{o.parse(n,s,(function(n){e(n),o.manager.itemEnd(t)}),r)}catch(t){r(t)}}),n,r)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return-1===this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.push(t),this}unregister(t){return-1!==this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,n,i){let o;const s={},r={};if("string"==typeof t)o=t;else if(Wb.decodeText(new Uint8Array(t,0,4))===Ip){try{s[rp.KHR_BINARY_GLTF]=new bp(t)}catch(t){return void(i&&i(t))}o=s[rp.KHR_BINARY_GLTF].content}else o=Wb.decodeText(new Uint8Array(t));const a=JSON.parse(o);if(void 0===a.asset||a.asset.version[0]<2)return void(i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new Pp(a,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let c=0;c<this.pluginCallbacks.length;c++){const t=this.pluginCallbacks[c](l);r[t.name]=t,s[t.name]=!0}if(a.extensionsUsed)for(let c=0;c<a.extensionsUsed.length;++c){const t=a.extensionsUsed[c],e=a.extensionsRequired||[];switch(t){case rp.KHR_MATERIALS_UNLIT:s[t]=new lp;break;case rp.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:s[t]=new Jp;break;case rp.KHR_DRACO_MESH_COMPRESSION:s[t]=new pp(a,this.dracoLoader);break;case rp.KHR_TEXTURE_TRANSFORM:s[t]=new yp;break;case rp.KHR_MESH_QUANTIZATION:s[t]=new Gp;break;default:e.indexOf(t)>=0&&void 0===r[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}l.setExtensions(s),l.setPlugins(r),l.parse(n,i)}}function sp(){let t={};return{get:function(e){return t[e]},add:function(e,n){t[e]=n},remove:function(e){delete t[e]},removeAll:function(){t={}}}}const rp={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class ap{constructor(t){this.parser=t,this.name=rp.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,e=this.parser.json.nodes||[];for(let n=0,i=e.length;n<i;n++){const i=e[n];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&t._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(t){const e=this.parser,n="light:"+t;let i=e.cache.get(n);if(i)return i;const o=e.json,s=((o.extensions&&o.extensions[this.name]||{}).lights||[])[t];let r;const a=new Rd(16777215);void 0!==s.color&&a.fromArray(s.color);const l=void 0!==s.range?s.range:0;switch(s.type){case"directional":r=new vb(a),r.target.position.set(0,0,-1),r.add(r.target);break;case"point":r=new Sb(a),r.distance=l;break;case"spot":r=new yb(a),r.distance=l,s.spot=s.spot||{},s.spot.innerConeAngle=void 0!==s.spot.innerConeAngle?s.spot.innerConeAngle:0,s.spot.outerConeAngle=void 0!==s.spot.outerConeAngle?s.spot.outerConeAngle:Math.PI/4,r.angle=s.spot.outerConeAngle,r.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,r.target.position.set(0,0,-1),r.add(r.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+s.type)}return r.position.set(0,0,0),r.decay=2,void 0!==s.intensity&&(r.intensity=s.intensity),r.name=e.createUniqueName(s.name||"light_"+t),i=Promise.resolve(r),e.cache.add(n,i),i}createNodeAttachment(t){const e=this,n=this.parser,i=n.json.nodes[t],o=(i.extensions&&i.extensions[this.name]||{}).light;return void 0===o?null:this._loadLight(o).then((function(t){return n._getNodeRef(e.cache,o,t)}))}}class lp{constructor(){this.name=rp.KHR_MATERIALS_UNLIT}getMaterialType(){return Wd}extendParams(t,e,n){const i=[];t.color=new Rd(1,1,1),t.opacity=1;const o=e.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){const e=o.baseColorFactor;t.color.fromArray(e),t.opacity=e[3]}void 0!==o.baseColorTexture&&i.push(n.assignTexture(t,"map",o.baseColorTexture))}return Promise.all(i)}}class cp{constructor(t){this.parser=t,this.name=rp.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?TC:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],s=i.extensions[this.name];if(void 0!==s.clearcoatFactor&&(e.clearcoat=s.clearcoatFactor),void 0!==s.clearcoatTexture&&o.push(n.assignTexture(e,"clearcoatMap",s.clearcoatTexture)),void 0!==s.clearcoatRoughnessFactor&&(e.clearcoatRoughness=s.clearcoatRoughnessFactor),void 0!==s.clearcoatRoughnessTexture&&o.push(n.assignTexture(e,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),void 0!==s.clearcoatNormalTexture&&(o.push(n.assignTexture(e,"clearcoatNormalMap",s.clearcoatNormalTexture)),void 0!==s.clearcoatNormalTexture.scale)){const t=s.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new Oc(t,-t)}return Promise.all(o)}}class gp{constructor(t){this.parser=t,this.name=rp.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?TC:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],s=i.extensions[this.name];return void 0!==s.transmissionFactor&&(e.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&o.push(n.assignTexture(e,"transmissionMap",s.transmissionTexture)),Promise.all(o)}}class dp{constructor(t){this.parser=t,this.name=rp.KHR_TEXTURE_BASISU}loadTexture(t){const e=this.parser,n=e.json,i=n.textures[t];if(!i.extensions||!i.extensions[this.name])return null;const o=i.extensions[this.name],s=n.images[o.source],r=e.options.ktx2Loader;if(!r){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,s,r)}}class hp{constructor(t){this.parser=t,this.name=rp.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const e=this.name,n=this.parser,i=n.json,o=i.textures[t];if(!o.extensions||!o.extensions[e])return null;const s=o.extensions[e],r=i.images[s.source];let a=n.textureLoader;if(r.uri){const t=n.options.manager.getHandler(r.uri);null!==t&&(a=t)}return this.detectSupport().then((function(o){if(o)return n.loadTextureImage(t,r,a);if(i.extensionsRequired&&i.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(t)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(t){const e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(1===e.height)}}))),this.isSupported}}class mp{constructor(t){this.name=rp.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const e=this.parser.json,n=e.bufferViews[t];if(n.extensions&&n.extensions[this.name]){const t=n.extensions[this.name],i=this.parser.getDependency("buffer",t.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([i,o.ready]).then((function(e){const n=t.byteOffset||0,i=t.byteLength||0,s=t.count,r=t.byteStride,a=new ArrayBuffer(s*r),l=new Uint8Array(e[0],n,i);return o.decodeGltfBuffer(new Uint8Array(a),s,r,l,t.mode,t.filter),a}))}return null}}const Ip="glTF",up=1313821514,Cp=5130562;class bp{constructor(t){this.name=rp.KHR_BINARY_GLTF,this.content=null,this.body=null;const e=new DataView(t,0,12);if(this.header={magic:Wb.decodeText(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==Ip)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-12,i=new DataView(t,12);let o=0;for(;o<n;){const e=i.getUint32(o,!0);o+=4;const n=i.getUint32(o,!0);if(o+=4,n===up){const n=new Uint8Array(t,12+o,e);this.content=Wb.decodeText(n)}else if(n===Cp){const n=12+o;this.body=t.slice(n,n+e)}o+=e}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class pp{constructor(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=rp.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){const n=this.json,i=this.dracoLoader,o=t.extensions[this.name].bufferView,s=t.extensions[this.name].attributes,r={},a={},l={};for(const c in s){const t=Fp[c]||c.toLowerCase();r[t]=s[c]}for(const c in t.attributes){const e=Fp[c]||c.toLowerCase();if(void 0!==s[c]){const i=n.accessors[t.attributes[c]],o=Ap[i.componentType];l[e]=o,a[e]=!0===i.normalized}}return e.getDependency("bufferView",o).then((function(t){return new Promise((function(e){i.decodeDracoFile(t,(function(t){for(const e in t.attributes){const n=t.attributes[e],i=a[e];void 0!==i&&(n.normalized=i)}e(t)}),r,l)}))}))}}class yp{constructor(){this.name=rp.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return void 0!==e.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===e.offset&&void 0===e.rotation&&void 0===e.scale||(t=t.clone(),void 0!==e.offset&&t.offset.fromArray(e.offset),void 0!==e.rotation&&(t.rotation=e.rotation),void 0!==e.scale&&t.repeat.fromArray(e.scale),t.needsUpdate=!0),t}}class Zp extends NC{constructor(t){super(),this.isGLTFSpecularGlossinessMaterial=!0;const e=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),o=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),s=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),r={specular:{value:(new Rd).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=r,this.onBeforeCompile=function(t){for(const e in r)t.uniforms[e]=r[e];t.fragmentShader=t.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",e).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",i).replace("#include <metalnessmap_fragment>",o).replace("#include <lights_physical_fragment>",s)},Object.defineProperties(this,{specular:{get:function(){return r.specular.value},set:function(t){r.specular.value=t}},specularMap:{get:function(){return r.specularMap.value},set:function(t){r.specularMap.value=t,t?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return r.glossiness.value},set:function(t){r.glossiness.value=t}},glossinessMap:{get:function(){return r.glossinessMap.value},set:function(t){r.glossinessMap.value=t,t?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(t)}copy(t){return super.copy(t),this.specularMap=t.specularMap,this.specular.copy(t.specular),this.glossinessMap=t.glossinessMap,this.glossiness=t.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class Jp{constructor(){this.name=rp.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return Zp}extendParams(t,e,n){const i=e.extensions[this.name];t.color=new Rd(1,1,1),t.opacity=1;const o=[];if(Array.isArray(i.diffuseFactor)){const e=i.diffuseFactor;t.color.fromArray(e),t.opacity=e[3]}if(void 0!==i.diffuseTexture&&o.push(n.assignTexture(t,"map",i.diffuseTexture)),t.emissive=new Rd(0,0,0),t.glossiness=void 0!==i.glossinessFactor?i.glossinessFactor:1,t.specular=new Rd(1,1,1),Array.isArray(i.specularFactor)&&t.specular.fromArray(i.specularFactor),void 0!==i.specularGlossinessTexture){const e=i.specularGlossinessTexture;o.push(n.assignTexture(t,"glossinessMap",e)),o.push(n.assignTexture(t,"specularMap",e))}return Promise.all(o)}createMaterial(t){const e=new Zp(t);return e.fog=!0,e.color=t.color,e.map=void 0===t.map?null:t.map,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=void 0===t.aoMap?null:t.aoMap,e.aoMapIntensity=1,e.emissive=t.emissive,e.emissiveIntensity=1,e.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,e.bumpMap=void 0===t.bumpMap?null:t.bumpMap,e.bumpScale=1,e.normalMap=void 0===t.normalMap?null:t.normalMap,e.normalMapType=0,t.normalScale&&(e.normalScale=t.normalScale),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.specularMap=void 0===t.specularMap?null:t.specularMap,e.specular=t.specular,e.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,e.glossiness=t.glossiness,e.alphaMap=null,e.envMap=void 0===t.envMap?null:t.envMap,e.envMapIntensity=1,e.refractionRatio=.98,e}}class Gp{constructor(){this.name=rp.KHR_MESH_QUANTIZATION}}class Vp extends UC{constructor(t,e,n,i){super(t,e,n,i)}copySampleValue_(t){const e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,o=t*i*3+i;for(let s=0;s!==i;s++)e[s]=n[o+s];return e}}Vp.prototype.beforeStart_=Vp.prototype.copySampleValue_,Vp.prototype.afterEnd_=Vp.prototype.copySampleValue_,Vp.prototype.interpolate_=function(t,e,n,i){const o=this.resultBuffer,s=this.sampleValues,r=this.valueSize,a=2*r,l=3*r,c=i-e,g=(n-e)/c,d=g*g,h=d*g,m=t*l,I=m-l,u=-2*h+3*d,C=h-d,b=1-u,p=C-d+g;for(let y=0;y!==r;y++){const t=s[I+y+r],e=s[I+y+a]*c,n=s[m+y+r],i=s[m+y]*c;o[y]=b*t+p*e+u*n+C*i}return o};const Sp=0,Bp=1,Xp=2,vp=3,fp=4,Rp=5,Wp=6,Ap={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},wp={9728:lc,9729:dc,9984:cc,9985:1007,9986:gc,9987:hc},Yp={33071:rc,33648:ac,10497:sc},kp={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Fp={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Hp={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},xp={CUBICSPLINE:void 0,LINEAR:Bc,STEP:Sc},Np="OPAQUE",Tp="MASK",Mp="BLEND";function Up(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}function Kp(t,e,n){for(const i in n.extensions)void 0===t[i]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=n.extensions[i])}function Ep(t,e){void 0!==e.extras&&("object"==typeof e.extras?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Lp(t,e){if(t.updateMorphTargets(),void 0!==e.weights)for(let n=0,i=e.weights.length;n<i;n++)t.morphTargetInfluences[n]=e.weights[n];if(e.extras&&Array.isArray(e.extras.targetNames)){const n=e.extras.targetNames;if(t.morphTargetInfluences.length===n.length){t.morphTargetDictionary={};for(let e=0,i=n.length;e<i;e++)t.morphTargetDictionary[n[e]]=e}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Dp(t){const e=t.extensions&&t.extensions[rp.KHR_DRACO_MESH_COMPRESSION];let n;return n=e?"draco:"+e.bufferView+":"+e.indices+":"+Qp(e.attributes):t.indices+":"+Qp(t.attributes)+":"+t.mode,n}function Qp(t){let e="";const n=Object.keys(t).sort();for(let i=0,o=n.length;i<o;i++)e+=n[i]+":"+t[n[i]]+";";return e}function zp(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class Pp{constructor(t={},e={}){this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new sp,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new Ab(this.options.manager):this.textureLoader=new lb(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new sb(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){const n=this,i=this.json,o=this.extensions;this.cache.removeAll(),this._invokeAll((function(t){return t._markDefs&&t._markDefs()})),Promise.all(this._invokeAll((function(t){return t.beforeRoot&&t.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(e){const s={scene:e[0][i.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:i.asset,parser:n,userData:{}};Kp(o,s,i),Ep(s,i),Promise.all(n._invokeAll((function(t){return t.afterRoot&&t.afterRoot(s)}))).then((function(){t(s)}))})).catch(e)}_markDefs(){const t=this.json.nodes||[],e=this.json.skins||[],n=this.json.meshes||[];for(let i=0,o=e.length;i<o;i++){const n=e[i].joints;for(let e=0,i=n.length;e<i;e++)t[n[e]].isBone=!0}for(let i=0,o=t.length;i<o;i++){const e=t[i];void 0!==e.mesh&&(this._addNodeRef(this.meshCache,e.mesh),void 0!==e.skin&&(n[e.mesh].isSkinnedMesh=!0)),void 0!==e.camera&&this._addNodeRef(this.cameraCache,e.camera)}}_addNodeRef(t,e){void 0!==e&&(void 0===t.refs[e]&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,n){if(t.refs[e]<=1)return n;const i=n.clone();return i.name+="_instance_"+t.uses[e]++,i}_invokeOne(t){const e=Object.values(this.plugins);e.push(this);for(let n=0;n<e.length;n++){const i=t(e[n]);if(i)return i}return null}_invokeAll(t){const e=Object.values(this.plugins);e.unshift(this);const n=[];for(let i=0;i<e.length;i++){const o=t(e[i]);o&&n.push(o)}return n}getDependency(t,e){const n=t+":"+e;let i=this.cache.get(n);if(!i){switch(t){case"scene":i=this.loadScene(e);break;case"node":i=this.loadNode(e);break;case"mesh":i=this._invokeOne((function(t){return t.loadMesh&&t.loadMesh(e)}));break;case"accessor":i=this.loadAccessor(e);break;case"bufferView":i=this._invokeOne((function(t){return t.loadBufferView&&t.loadBufferView(e)}));break;case"buffer":i=this.loadBuffer(e);break;case"material":i=this._invokeOne((function(t){return t.loadMaterial&&t.loadMaterial(e)}));break;case"texture":i=this._invokeOne((function(t){return t.loadTexture&&t.loadTexture(e)}));break;case"skin":i=this.loadSkin(e);break;case"animation":i=this.loadAnimation(e);break;case"camera":i=this.loadCamera(e);break;default:throw new Error("Unknown type: "+t)}this.cache.add(n,i)}return i}getDependencies(t){let e=this.cache.get(t);if(!e){const n=this,i=this.json[t+("mesh"===t?"es":"s")]||[];e=Promise.all(i.map((function(e,i){return n.getDependency(t,i)}))),this.cache.add(t,e)}return e}loadBuffer(t){const e=this.json.buffers[t],n=this.fileLoader;if(e.type&&"arraybuffer"!==e.type)throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(void 0===e.uri&&0===t)return Promise.resolve(this.extensions[rp.KHR_BINARY_GLTF].body);const i=this.options;return new Promise((function(t,o){n.load(Up(e.uri,i.path),t,void 0,(function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))}))}))}loadBufferView(t){const e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then((function(t){const n=e.byteLength||0,i=e.byteOffset||0;return t.slice(i,i+n)}))}loadAccessor(t){const e=this,n=this.json,i=this.json.accessors[t];if(void 0===i.bufferView&&void 0===i.sparse)return Promise.resolve(null);const o=[];return void 0!==i.bufferView?o.push(this.getDependency("bufferView",i.bufferView)):o.push(null),void 0!==i.sparse&&(o.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(o).then((function(t){const o=t[0],s=kp[i.type],r=Ap[i.componentType],a=r.BYTES_PER_ELEMENT,l=a*s,c=i.byteOffset||0,g=void 0!==i.bufferView?n.bufferViews[i.bufferView].byteStride:void 0,d=!0===i.normalized;let h,m;if(g&&g!==l){const t=Math.floor(c/g),n="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+t+":"+i.count;let l=e.cache.get(n);l||(h=new r(o,t*g,i.count*g/a),l=new DI(h,g/a),e.cache.add(n,l)),m=new zI(l,s,c%g/a,d)}else h=null===o?new r(i.count*s):new r(o,c,i.count*s),m=new Yd(h,s,d);if(void 0!==i.sparse){const e=kp.SCALAR,n=Ap[i.sparse.indices.componentType],a=i.sparse.indices.byteOffset||0,l=i.sparse.values.byteOffset||0,c=new n(t[1],a,i.sparse.count*e),g=new r(t[2],l,i.sparse.count*s);null!==o&&(m=new Yd(m.array.slice(),m.itemSize,m.normalized));for(let t=0,i=c.length;t<i;t++){const e=c[t];if(m.setX(e,g[t*s]),s>=2&&m.setY(e,g[t*s+1]),s>=3&&m.setZ(e,g[t*s+2]),s>=4&&m.setW(e,g[t*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return m}))}loadTexture(t){const e=this.json,n=this.options,i=e.textures[t],o=e.images[i.source];let s=this.textureLoader;if(o.uri){const t=n.manager.getHandler(o.uri);null!==t&&(s=t)}return this.loadTextureImage(t,o,s)}loadTextureImage(t,e,n){const i=this,o=this.json,s=this.options,r=o.textures[t],a=(e.uri||e.bufferView)+":"+r.sampler;if(this.textureCache[a])return this.textureCache[a];const l=self.URL||self.webkitURL;let c=e.uri||"",g=!1,d=!0;const h=c.search(/\.jpe?g($|\?)/i)>0||0===c.search(/^data\:image\/jpeg/);if(("image/jpeg"===e.mimeType||h)&&(d=!1),void 0!==e.bufferView)c=i.getDependency("bufferView",e.bufferView).then((function(t){if("image/png"===e.mimeType){const e=new DataView(t,25,1).getUint8(0,!1);d=6===e||4===e||3===e}g=!0;const n=new Blob([t],{type:e.mimeType});return c=l.createObjectURL(n),c}));else if(void 0===e.uri)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const m=Promise.resolve(c).then((function(t){return new Promise((function(e,i){let o=e;!0===n.isImageBitmapLoader&&(o=function(t){const n=new eg(t);n.needsUpdate=!0,e(n)}),n.load(Up(t,s.path),o,void 0,i)}))})).then((function(e){!0===g&&l.revokeObjectURL(c),e.flipY=!1,r.name&&(e.name=r.name),d||(e.format=yc);const n=(o.samplers||{})[r.sampler]||{};return e.magFilter=wp[n.magFilter]||dc,e.minFilter=wp[n.minFilter]||hc,e.wrapS=Yp[n.wrapS]||sc,e.wrapT=Yp[n.wrapT]||sc,i.associations.set(e,{type:"textures",index:t}),e})).catch((function(){return console.error("THREE.GLTFLoader: Couldn't load texture",c),null}));return this.textureCache[a]=m,m}assignTexture(t,e,n){const i=this;return this.getDependency("texture",n.index).then((function(o){if(void 0===n.texCoord||0==n.texCoord||"aoMap"===e&&1==n.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+e+" not yet supported."),i.extensions[rp.KHR_TEXTURE_TRANSFORM]){const t=void 0!==n.extensions?n.extensions[rp.KHR_TEXTURE_TRANSFORM]:void 0;if(t){const e=i.associations.get(o);o=i.extensions[rp.KHR_TEXTURE_TRANSFORM].extendTexture(o,t),i.associations.set(o,e)}}t[e]=o}))}assignFinalMaterial(t){const e=t.geometry;let n=t.material;const i=void 0!==e.attributes.tangent,o=void 0!==e.attributes.color,s=void 0===e.attributes.normal,r=Object.keys(e.morphAttributes).length>0,a=r&&void 0!==e.morphAttributes.normal;if(t.isPoints){const t="PointsMaterial:"+n.uuid;let e=this.cache.get(t);e||(e=new Fu,Gd.prototype.copy.call(e,n),e.color.copy(n.color),e.map=n.map,e.sizeAttenuation=!1,this.cache.add(t,e)),n=e}else if(t.isLine){const t="LineBasicMaterial:"+n.uuid;let e=this.cache.get(t);e||(e=new Su,Gd.prototype.copy.call(e,n),e.color.copy(n.color),this.cache.add(t,e)),n=e}if(i||o||s||r){let t="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(t+="specular-glossiness:"),i&&(t+="vertex-tangents:"),o&&(t+="vertex-colors:"),s&&(t+="flat-shading:"),r&&(t+="morph-targets:"),a&&(t+="morph-normals:");let e=this.cache.get(t);e||(e=n.clone(),o&&(e.vertexColors=!0),s&&(e.flatShading=!0),r&&(e.morphTargets=!0),a&&(e.morphNormals=!0),i&&(e.vertexTangents=!0,e.normalScale&&(e.normalScale.y*=-1),e.clearcoatNormalScale&&(e.clearcoatNormalScale.y*=-1)),this.cache.add(t,e),this.associations.set(e,this.associations.get(n))),n=e}n.aoMap&&void 0===e.attributes.uv2&&void 0!==e.attributes.uv&&e.setAttribute("uv2",e.attributes.uv),t.material=n}getMaterialType(){return NC}loadMaterial(t){const e=this,n=this.json,i=this.extensions,o=n.materials[t];let s;const r={},a=o.extensions||{},l=[];if(a[rp.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const t=i[rp.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];s=t.getMaterialType(),l.push(t.extendParams(r,o,e))}else if(a[rp.KHR_MATERIALS_UNLIT]){const t=i[rp.KHR_MATERIALS_UNLIT];s=t.getMaterialType(),l.push(t.extendParams(r,o,e))}else{const n=o.pbrMetallicRoughness||{};if(r.color=new Rd(1,1,1),r.opacity=1,Array.isArray(n.baseColorFactor)){const t=n.baseColorFactor;r.color.fromArray(t),r.opacity=t[3]}void 0!==n.baseColorTexture&&l.push(e.assignTexture(r,"map",n.baseColorTexture)),r.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,r.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(l.push(e.assignTexture(r,"metalnessMap",n.metallicRoughnessTexture)),l.push(e.assignTexture(r,"roughnessMap",n.metallicRoughnessTexture))),s=this._invokeOne((function(e){return e.getMaterialType&&e.getMaterialType(t)})),l.push(Promise.all(this._invokeAll((function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,r)}))))}!0===o.doubleSided&&(r.side=2);const c=o.alphaMode||Np;return c===Mp?(r.transparent=!0,r.depthWrite=!1):(r.transparent=!1,c===Tp&&(r.alphaTest=void 0!==o.alphaCutoff?o.alphaCutoff:.5)),void 0!==o.normalTexture&&s!==Wd&&(l.push(e.assignTexture(r,"normalMap",o.normalTexture)),r.normalScale=new Oc(1,-1),void 0!==o.normalTexture.scale&&r.normalScale.set(o.normalTexture.scale,-o.normalTexture.scale)),void 0!==o.occlusionTexture&&s!==Wd&&(l.push(e.assignTexture(r,"aoMap",o.occlusionTexture)),void 0!==o.occlusionTexture.strength&&(r.aoMapIntensity=o.occlusionTexture.strength)),void 0!==o.emissiveFactor&&s!==Wd&&(r.emissive=(new Rd).fromArray(o.emissiveFactor)),void 0!==o.emissiveTexture&&s!==Wd&&l.push(e.assignTexture(r,"emissiveMap",o.emissiveTexture)),Promise.all(l).then((function(){let n;return n=s===Zp?i[rp.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(r):new s(r),o.name&&(n.name=o.name),n.map&&(n.map.encoding=wc),n.emissiveMap&&(n.emissiveMap.encoding=wc),Ep(n,o),e.associations.set(n,{type:"materials",index:t}),o.extensions&&Kp(i,n,o),n}))}createUniqueName(t){const e=Pb.sanitizeNodeName(t||"");let n=e;for(let i=1;this.nodeNamesUsed[n];++i)n=e+"_"+i;return this.nodeNamesUsed[n]=!0,n}loadGeometries(t){const e=this,n=this.extensions,i=this.primitiveCache;function o(t){return n[rp.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,e).then((function(n){return Op(n,t,e)}))}const s=[];for(let r=0,a=t.length;r<a;r++){const n=t[r],a=Dp(n),l=i[a];if(l)s.push(l.promise);else{let t;t=n.extensions&&n.extensions[rp.KHR_DRACO_MESH_COMPRESSION]?o(n):Op(new Dd,n,e),i[a]={primitive:n,promise:t},s.push(t)}}return Promise.all(s)}loadMesh(t){const e=this,n=this.json,i=this.extensions,o=n.meshes[t],s=o.primitives,r=[];for(let l=0,c=s.length;l<c;l++){const t=void 0===s[l].material?(void 0===(a=this.cache).DefaultMaterial&&(a.DefaultMaterial=new NC({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:0})),a.DefaultMaterial):this.getDependency("material",s[l].material);r.push(t)}var a;return r.push(e.loadGeometries(s)),Promise.all(r).then((function(n){const r=n.slice(0,n.length-1),a=n[n.length-1],l=[];for(let g=0,d=a.length;g<d;g++){const n=a[g],c=s[g];let d;const h=r[g];if(c.mode===fp||c.mode===Rp||c.mode===Wp||void 0===c.mode)d=!0===o.isSkinnedMesh?new Iu(n,h):new ch(n,h),!0!==d.isSkinnedMesh||d.geometry.attributes.skinWeight.normalized||d.normalizeSkinWeights(),c.mode===Rp?d.geometry=jp(d.geometry,1):c.mode===Wp&&(d.geometry=jp(d.geometry,2));else if(c.mode===Bp)d=new Yu(n,h);else if(c.mode===vp)d=new Wu(n,h);else if(c.mode===Xp)d=new ku(n,h);else{if(c.mode!==Sp)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+c.mode);d=new Mu(n,h)}Object.keys(d.geometry.morphAttributes).length>0&&Lp(d,o),d.name=e.createUniqueName(o.name||"mesh_"+t),Ep(d,o),c.extensions&&Kp(i,d,c),e.assignFinalMaterial(d),l.push(d)}if(1===l.length)return l[0];const c=new NI;for(let t=0,e=l.length;t<e;t++)c.add(l[t]);return c}))}loadCamera(t){let e;const n=this.json.cameras[t],i=n[n.type];if(i)return"perspective"===n.type?e=new bh(_c.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===n.type&&(e=new Bb(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(e.name=this.createUniqueName(n.name)),Ep(e,n),Promise.resolve(e);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(t){const e=this.json.skins[t],n={joints:e.joints};return void 0===e.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",e.inverseBindMatrices).then((function(t){return n.inverseBindMatrices=t,n}))}loadAnimation(t){const e=this.json.animations[t],n=[],i=[],o=[],s=[],r=[];for(let a=0,l=e.channels.length;a<l;a++){const t=e.channels[a],l=e.samplers[t.sampler],c=t.target,g=void 0!==c.node?c.node:c.id,d=void 0!==e.parameters?e.parameters[l.input]:l.input,h=void 0!==e.parameters?e.parameters[l.output]:l.output;n.push(this.getDependency("node",g)),i.push(this.getDependency("accessor",d)),o.push(this.getDependency("accessor",h)),s.push(l),r.push(c)}return Promise.all([Promise.all(n),Promise.all(i),Promise.all(o),Promise.all(s),Promise.all(r)]).then((function(n){const i=n[0],o=n[1],s=n[2],r=n[3],a=n[4],l=[];for(let t=0,e=i.length;t<e;t++){const e=i[t],n=o[t],c=s[t],g=r[t],d=a[t];if(void 0===e)continue;let h;switch(e.updateMatrix(),e.matrixAutoUpdate=!0,Hp[d.path]){case Hp.weights:h=PC;break;case Hp.rotation:h=OC;break;default:h=qC}const m=e.name?e.name:e.uuid,I=void 0!==g.interpolation?xp[g.interpolation]:Bc,u=[];Hp[d.path]===Hp.weights?e.traverse((function(t){!0===t.isMesh&&t.morphTargetInfluences&&u.push(t.name?t.name:t.uuid)})):u.push(m);let C=c.array;if(c.normalized){const t=zp(C.constructor),e=new Float32Array(C.length);for(let n=0,i=C.length;n<i;n++)e[n]=C[n]*t;C=e}for(let t=0,i=u.length;t<i;t++){const e=new h(u[t]+"."+Hp[d.path],n.array,C,I);"CUBICSPLINE"===g.interpolation&&(e.createInterpolant=function(t){return new Vp(this.times,this.values,this.getValueSize()/3,t)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(e)}}const c=e.name?e.name:"animation_"+t;return new $C(c,void 0,l)}))}createNodeMesh(t){const e=this.json,n=this,i=e.nodes[t];return void 0===i.mesh?null:n.getDependency("mesh",i.mesh).then((function(t){const e=n._getNodeRef(n.meshCache,i.mesh,t);return void 0!==i.weights&&e.traverse((function(t){if(t.isMesh)for(let e=0,n=i.weights.length;e<n;e++)t.morphTargetInfluences[e]=i.weights[e]})),e}))}loadNode(t){const e=this.json,n=this.extensions,i=this,o=e.nodes[t],s=o.name?i.createUniqueName(o.name):"";return function(){const e=[],n=i._invokeOne((function(e){return e.createNodeMesh&&e.createNodeMesh(t)}));return n&&e.push(n),void 0!==o.camera&&e.push(i.getDependency("camera",o.camera).then((function(t){return i._getNodeRef(i.cameraCache,o.camera,t)}))),i._invokeAll((function(e){return e.createNodeAttachment&&e.createNodeAttachment(t)})).forEach((function(t){e.push(t)})),Promise.all(e)}().then((function(e){let r;if(r=!0===o.isBone?new uu:e.length>1?new NI:1===e.length?e[0]:new cd,r!==e[0])for(let t=0,n=e.length;t<n;t++)r.add(e[t]);if(o.name&&(r.userData.name=o.name,r.name=s),Ep(r,o),o.extensions&&Kp(n,r,o),void 0!==o.matrix){const t=new Ng;t.fromArray(o.matrix),r.applyMatrix4(t)}else void 0!==o.translation&&r.position.fromArray(o.translation),void 0!==o.rotation&&r.quaternion.fromArray(o.rotation),void 0!==o.scale&&r.scale.fromArray(o.scale);return i.associations.set(r,{type:"nodes",index:t}),r}))}loadScene(t){const e=this.json,n=this.extensions,i=this.json.scenes[t],o=this,s=new NI;i.name&&(s.name=o.createUniqueName(i.name)),Ep(s,i),i.extensions&&Kp(n,s,i);const r=i.nodes||[],a=[];for(let l=0,c=r.length;l<c;l++)a.push(_p(r[l],s,e,o));return Promise.all(a).then((function(){return s}))}}function _p(t,e,n,i){const o=n.nodes[t];return i.getDependency("node",t).then((function(t){if(void 0===o.skin)return t;let e;return i.getDependency("skin",o.skin).then((function(t){e=t;const n=[];for(let o=0,s=e.joints.length;o<s;o++)n.push(i.getDependency("node",e.joints[o]));return Promise.all(n)})).then((function(n){return t.traverse((function(t){if(!t.isMesh)return;const i=[],o=[];for(let s=0,r=n.length;s<r;s++){const t=n[s];if(t){i.push(t);const n=new Ng;void 0!==e.inverseBindMatrices&&n.fromArray(e.inverseBindMatrices.array,16*s),o.push(n)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[s])}t.bind(new yu(i,o),t.matrixWorld)})),t}))})).then((function(t){e.add(t);const s=[];if(o.children){const e=o.children;for(let o=0,r=e.length;o<r;o++){const r=e[o];s.push(_p(r,t,n,i))}}return Promise.all(s)}))}function Op(t,e,n){const i=e.attributes,o=[];function s(e,i){return n.getDependency("accessor",e).then((function(e){t.setAttribute(i,e)}))}for(const r in i){const e=Fp[r]||r.toLowerCase();e in t.attributes||o.push(s(i[r],e))}if(void 0!==e.indices&&!t.index){const i=n.getDependency("accessor",e.indices).then((function(e){t.setIndex(e)}));o.push(i)}return Ep(t,e),function(t,e,n){const i=e.attributes,o=new gg;if(void 0===i.POSITION)return;{const t=n.json.accessors[i.POSITION],e=t.min,s=t.max;if(void 0===e||void 0===s)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(o.set(new ag(e[0],e[1],e[2]),new ag(s[0],s[1],s[2])),t.normalized){const e=zp(Ap[t.componentType]);o.min.multiplyScalar(e),o.max.multiplyScalar(e)}}const s=e.targets;if(void 0!==s){const t=new ag,e=new ag;for(let i=0,o=s.length;i<o;i++){const o=s[i];if(void 0!==o.POSITION){const i=n.json.accessors[o.POSITION],s=i.min,r=i.max;if(void 0!==s&&void 0!==r){if(e.setX(Math.max(Math.abs(s[0]),Math.abs(r[0]))),e.setY(Math.max(Math.abs(s[1]),Math.abs(r[1]))),e.setZ(Math.max(Math.abs(s[2]),Math.abs(r[2]))),i.normalized){const t=zp(Ap[i.componentType]);e.multiplyScalar(t)}t.max(e)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}o.expandByVector(t)}t.boundingBox=o;const r=new Rg;o.getCenter(r.center),r.radius=o.min.distanceTo(o.max)/2,t.boundingSphere=r}(t,e,n),Promise.all(o).then((function(){return void 0!==e.targets?function(t,e,n){let i=!1,o=!1;for(let a=0,l=e.length;a<l;a++){const t=e[a];if(void 0!==t.POSITION&&(i=!0),void 0!==t.NORMAL&&(o=!0),i&&o)break}if(!i&&!o)return Promise.resolve(t);const s=[],r=[];for(let a=0,l=e.length;a<l;a++){const l=e[a];if(i){const e=void 0!==l.POSITION?n.getDependency("accessor",l.POSITION):t.attributes.position;s.push(e)}if(o){const e=void 0!==l.NORMAL?n.getDependency("accessor",l.NORMAL):t.attributes.normal;r.push(e)}}return Promise.all([Promise.all(s),Promise.all(r)]).then((function(e){const n=e[0],s=e[1];return i&&(t.morphAttributes.position=n),o&&(t.morphAttributes.normal=s),t.morphTargetsRelative=!0,t}))}(t,e.targets,n):t}))}function jp(t,e){let n=t.getIndex();if(null===n){const e=[],i=t.getAttribute("position");if(void 0===i)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(let t=0;t<i.count;t++)e.push(t);t.setIndex(e),n=t.getIndex()}const i=n.count-2,o=[];if(2===e)for(let r=1;r<=i;r++)o.push(n.getX(0)),o.push(n.getX(r)),o.push(n.getX(r+1));else for(let r=0;r<i;r++)r%2==0?(o.push(n.getX(r)),o.push(n.getX(r+1)),o.push(n.getX(r+2))):(o.push(n.getX(r+2)),o.push(n.getX(r+1)),o.push(n.getX(r)));o.length/3!==i&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=t.clone();return s.setIndex(o),s}const qp={type:"change"},$p={type:"start"},ty={type:"end"};class ey extends xc{constructor(t,e){super(),void 0===e&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=t,this.domElement=e,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new ag,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:jl,MIDDLE:ql,RIGHT:$l},this.touches={ONE:tc,TWO:nc},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return r.phi},this.getAzimuthalAngle=function(){return r.theta},this.listenToKeyEvents=function(t){t.addEventListener("keydown",E),this._domElementKeyEvents=t},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(qp),n.update(),o=i.NONE},this.update=function(){const e=new ag,d=(new rg).setFromUnitVectors(t.up,new ag(0,1,0)),h=d.clone().invert(),m=new ag,I=new rg,u=2*Math.PI;return function(){const t=n.object.position;e.copy(t).sub(n.target),e.applyQuaternion(d),r.setFromVector3(e),n.autoRotate&&o===i.NONE&&V(2*Math.PI/60/60*n.autoRotateSpeed),n.enableDamping?(r.theta+=a.theta*n.dampingFactor,r.phi+=a.phi*n.dampingFactor):(r.theta+=a.theta,r.phi+=a.phi);let C=n.minAzimuthAngle,b=n.maxAzimuthAngle;return isFinite(C)&&isFinite(b)&&(C<-Math.PI?C+=u:C>Math.PI&&(C-=u),b<-Math.PI?b+=u:b>Math.PI&&(b-=u),r.theta=C<=b?Math.max(C,Math.min(b,r.theta)):r.theta>(C+b)/2?Math.max(C,r.theta):Math.min(b,r.theta)),r.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,r.phi)),r.makeSafe(),r.radius*=l,r.radius=Math.max(n.minDistance,Math.min(n.maxDistance,r.radius)),!0===n.enableDamping?n.target.addScaledVector(c,n.dampingFactor):n.target.add(c),e.setFromSpherical(r),e.applyQuaternion(h),t.copy(n.target).add(e),n.object.lookAt(n.target),!0===n.enableDamping?(a.theta*=1-n.dampingFactor,a.phi*=1-n.dampingFactor,c.multiplyScalar(1-n.dampingFactor)):(a.set(0,0,0),c.set(0,0,0)),l=1,!!(g||m.distanceToSquared(n.object.position)>s||8*(1-I.dot(n.object.quaternion))>s)&&(n.dispatchEvent(qp),m.copy(n.object.position),I.copy(n.object.quaternion),g=!1,!0)}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",L),n.domElement.removeEventListener("pointerdown",N),n.domElement.removeEventListener("pointercancel",U),n.domElement.removeEventListener("wheel",K),n.domElement.ownerDocument.removeEventListener("pointermove",T),n.domElement.ownerDocument.removeEventListener("pointerup",M),null!==n._domElementKeyEvents&&n._domElementKeyEvents.removeEventListener("keydown",E)};const n=this,i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let o=i.NONE;const s=1e-6,r=new jb,a=new jb;let l=1;const c=new ag;let g=!1;const d=new Oc,h=new Oc,m=new Oc,I=new Oc,u=new Oc,C=new Oc,b=new Oc,p=new Oc,y=new Oc,Z=[],J={};function G(){return Math.pow(.95,n.zoomSpeed)}function V(t){a.theta-=t}function S(t){a.phi-=t}const B=function(){const t=new ag;return function(e,n){t.setFromMatrixColumn(n,0),t.multiplyScalar(-e),c.add(t)}}(),X=function(){const t=new ag;return function(e,i){!0===n.screenSpacePanning?t.setFromMatrixColumn(i,1):(t.setFromMatrixColumn(i,0),t.crossVectors(n.object.up,t)),t.multiplyScalar(e),c.add(t)}}(),v=function(){const t=new ag;return function(e,i){const o=n.domElement;if(n.object.isPerspectiveCamera){const s=n.object.position;t.copy(s).sub(n.target);let r=t.length();r*=Math.tan(n.object.fov/2*Math.PI/180),B(2*e*r/o.clientHeight,n.object.matrix),X(2*i*r/o.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(B(e*(n.object.right-n.object.left)/n.object.zoom/o.clientWidth,n.object.matrix),X(i*(n.object.top-n.object.bottom)/n.object.zoom/o.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function f(t){n.object.isPerspectiveCamera?l/=t:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*t)),n.object.updateProjectionMatrix(),g=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function R(t){n.object.isPerspectiveCamera?l*=t:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/t)),n.object.updateProjectionMatrix(),g=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function W(t){d.set(t.clientX,t.clientY)}function A(t){I.set(t.clientX,t.clientY)}function w(){if(1===Z.length)d.set(Z[0].pageX,Z[0].pageY);else{const t=.5*(Z[0].pageX+Z[1].pageX),e=.5*(Z[0].pageY+Z[1].pageY);d.set(t,e)}}function Y(){if(1===Z.length)I.set(Z[0].pageX,Z[0].pageY);else{const t=.5*(Z[0].pageX+Z[1].pageX),e=.5*(Z[0].pageY+Z[1].pageY);I.set(t,e)}}function k(){const t=Z[0].pageX-Z[1].pageX,e=Z[0].pageY-Z[1].pageY,n=Math.sqrt(t*t+e*e);b.set(0,n)}function F(t){if(1==Z.length)h.set(t.pageX,t.pageY);else{const e=z(t),n=.5*(t.pageX+e.x),i=.5*(t.pageY+e.y);h.set(n,i)}m.subVectors(h,d).multiplyScalar(n.rotateSpeed);const e=n.domElement;V(2*Math.PI*m.x/e.clientHeight),S(2*Math.PI*m.y/e.clientHeight),d.copy(h)}function H(t){if(1===Z.length)u.set(t.pageX,t.pageY);else{const e=z(t),n=.5*(t.pageX+e.x),i=.5*(t.pageY+e.y);u.set(n,i)}C.subVectors(u,I).multiplyScalar(n.panSpeed),v(C.x,C.y),I.copy(u)}function x(t){const e=z(t),i=t.pageX-e.x,o=t.pageY-e.y,s=Math.sqrt(i*i+o*o);p.set(0,s),y.set(0,Math.pow(p.y/b.y,n.zoomSpeed)),f(y.y),b.copy(p)}function N(t){!1!==n.enabled&&(0===Z.length&&(n.domElement.ownerDocument.addEventListener("pointermove",T),n.domElement.ownerDocument.addEventListener("pointerup",M)),function(t){Z.push(t)}(t),"touch"===t.pointerType?function(t){switch(Q(t),Z.length){case 1:switch(n.touches.ONE){case tc:if(!1===n.enableRotate)return;w(),o=i.TOUCH_ROTATE;break;case ec:if(!1===n.enablePan)return;Y(),o=i.TOUCH_PAN;break;default:o=i.NONE}break;case 2:switch(n.touches.TWO){case nc:if(!1===n.enableZoom&&!1===n.enablePan)return;n.enableZoom&&k(),n.enablePan&&Y(),o=i.TOUCH_DOLLY_PAN;break;case ic:if(!1===n.enableZoom&&!1===n.enableRotate)return;n.enableZoom&&k(),n.enableRotate&&w(),o=i.TOUCH_DOLLY_ROTATE;break;default:o=i.NONE}break;default:o=i.NONE}o!==i.NONE&&n.dispatchEvent($p)}(t):function(t){let e;switch(t.button){case 0:e=n.mouseButtons.LEFT;break;case 1:e=n.mouseButtons.MIDDLE;break;case 2:e=n.mouseButtons.RIGHT;break;default:e=-1}switch(e){case ql:if(!1===n.enableZoom)return;!function(t){b.set(t.clientX,t.clientY)}(t),o=i.DOLLY;break;case jl:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===n.enablePan)return;A(t),o=i.PAN}else{if(!1===n.enableRotate)return;W(t),o=i.ROTATE}break;case $l:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===n.enableRotate)return;W(t),o=i.ROTATE}else{if(!1===n.enablePan)return;A(t),o=i.PAN}break;default:o=i.NONE}o!==i.NONE&&n.dispatchEvent($p)}(t))}function T(t){!1!==n.enabled&&("touch"===t.pointerType?function(t){switch(Q(t),o){case i.TOUCH_ROTATE:if(!1===n.enableRotate)return;F(t),n.update();break;case i.TOUCH_PAN:if(!1===n.enablePan)return;H(t),n.update();break;case i.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(t){n.enableZoom&&x(t),n.enablePan&&H(t)}(t),n.update();break;case i.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(t){n.enableZoom&&x(t),n.enableRotate&&F(t)}(t),n.update();break;default:o=i.NONE}}(t):function(t){if(!1!==n.enabled)switch(o){case i.ROTATE:if(!1===n.enableRotate)return;!function(t){h.set(t.clientX,t.clientY),m.subVectors(h,d).multiplyScalar(n.rotateSpeed);const e=n.domElement;V(2*Math.PI*m.x/e.clientHeight),S(2*Math.PI*m.y/e.clientHeight),d.copy(h),n.update()}(t);break;case i.DOLLY:if(!1===n.enableZoom)return;!function(t){p.set(t.clientX,t.clientY),y.subVectors(p,b),y.y>0?f(G()):y.y<0&&R(G()),b.copy(p),n.update()}(t);break;case i.PAN:if(!1===n.enablePan)return;!function(t){u.set(t.clientX,t.clientY),C.subVectors(u,I).multiplyScalar(n.panSpeed),v(C.x,C.y),I.copy(u),n.update()}(t)}}(t))}function M(t){!1!==n.enabled&&(t.pointerType,n.dispatchEvent(ty),o=i.NONE,D(t),0===Z.length&&(n.domElement.ownerDocument.removeEventListener("pointermove",T),n.domElement.ownerDocument.removeEventListener("pointerup",M)))}function U(t){D(t)}function K(t){!1===n.enabled||!1===n.enableZoom||o!==i.NONE&&o!==i.ROTATE||(t.preventDefault(),n.dispatchEvent($p),function(t){t.deltaY<0?R(G()):t.deltaY>0&&f(G()),n.update()}(t),n.dispatchEvent(ty))}function E(t){!1!==n.enabled&&!1!==n.enablePan&&function(t){let e=!1;switch(t.code){case n.keys.UP:v(0,n.keyPanSpeed),e=!0;break;case n.keys.BOTTOM:v(0,-n.keyPanSpeed),e=!0;break;case n.keys.LEFT:v(n.keyPanSpeed,0),e=!0;break;case n.keys.RIGHT:v(-n.keyPanSpeed,0),e=!0}e&&(t.preventDefault(),n.update())}(t)}function L(t){!1!==n.enabled&&t.preventDefault()}function D(t){delete J[t.pointerId];for(let e=0;e<Z.length;e++)if(Z[e].pointerId==t.pointerId)return void Z.splice(e,1)}function Q(t){let e=J[t.pointerId];void 0===e&&(e=new Oc,J[t.pointerId]=e),e.set(t.pageX,t.pageY)}function z(t){const e=t.pointerId===Z[0].pointerId?Z[1]:Z[0];return J[e.pointerId]}n.domElement.addEventListener("contextmenu",L),n.domElement.addEventListener("pointerdown",N),n.domElement.addEventListener("pointercancel",U),n.domElement.addEventListener("wheel",K,{passive:!1}),this.update()}}var ny={},iy=ts,oy=es.concat("length","prototype");ny.f=Object.getOwnPropertyNames||function(t){return iy(t,oy)};var sy=mn,ry=ny,ay=ss,ly=co,cy=We([].concat),gy=sy("Reflect","ownKeys")||function(t){var e=ry.f(ly(t)),n=ay.f;return n?cy(e,n(t)):e},dy=ii,hy=gy,my=we,Iy=oo,uy=Wi,Cy=oo,by=Ee,py=function(t,e,n){var i=uy(e);i in t?Cy.f(t,i,by(0,n)):t[i]=n},yy=No,Zy=Ko,Jy=py,Gy=Ze.Array,Vy=Math.max,Sy=function(t,e,n){for(var i=Zy(t),o=yy(e,i),s=yy(void 0===n?i:n,i),r=Gy(Vy(s-o,0)),a=0;o<s;o++,a++)Jy(r,a,t[o]);return r.length=a,r},By=We,Xy=Sy,vy=By("".replace),fy=By("".split),Ry=By([].join),Wy=String(Error("zxcasd").stack),Ay=/\n\s*at [^:]*:[^\n]*/,wy=Ay.test(Wy),Yy=/@[^\n]*\n/.test(Wy)&&!/zxcasd/.test(Wy),ky=an,Fy=yo,Hy=Js,xy=yi("iterator"),Ny=Array.prototype,Ty=function(t){return void 0!==t&&(Hy.Array===t||Ny[xy]===t)},My=sa,Uy=Mn,Ky=Js,Ey=yi("iterator"),Ly=function(t){if(null!=t)return Uy(t,Ey)||Uy(t,"@@iterator")||Ky[My(t)]},Dy=He,Qy=Nn,zy=co,Py=kn,_y=Ly,Oy=Ze.TypeError,jy=function(t,e){var n=arguments.length<2?_y(t):e;if(Qy(n))return zy(Dy(n,t));throw Oy(Py(t)+" is not iterable")},qy=He,$y=co,tZ=Mn,eZ=function(t,e,n){var i,o;$y(t);try{if(!(i=tZ(t,"return"))){if("throw"===e)throw n;return n}i=qy(i,t)}catch(t){o=!0,i=t}if("throw"===e)throw n;if(o)throw i;return $y(i),n},nZ=io,iZ=He,oZ=co,sZ=kn,rZ=Ty,aZ=Ko,lZ=In,cZ=jy,gZ=Ly,dZ=eZ,hZ=Ze.TypeError,mZ=function(t,e){this.stopped=t,this.result=e},IZ=mZ.prototype,uZ=function(t,e,n){var i,o,s,r,a,l,c,g=n&&n.that,d=!(!n||!n.AS_ENTRIES),h=!(!n||!n.IS_ITERATOR),m=!(!n||!n.INTERRUPTED),I=nZ(e,g),u=function(t){return i&&dZ(i,"normal",t),new mZ(!0,t)},C=function(t){return d?(oZ(t),m?I(t[0],t[1],u):I(t[0],t[1])):m?I(t,u):I(t)};if(h)i=t;else{if(!(o=gZ(t)))throw hZ(sZ(t)+" is not iterable");if(rZ(o)){for(s=0,r=aZ(t);r>s;s++)if((a=C(t[s]))&&lZ(IZ,a))return a;return new mZ(!1)}i=cZ(t,o)}for(l=i.next;!(c=iZ(l,i)).done;){try{a=C(c.value)}catch(t){dZ(i,"throw",t)}if("object"==typeof a&&a&&lZ(IZ,a))return a}return new mZ(!1)},CZ=sa,bZ=Ze.String,pZ=function(t){if("Symbol"===CZ(t))throw TypeError("Cannot convert a Symbol value to a string");return bZ(t)},yZ=pZ,ZZ=Ee,JZ=!Ye((function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",ZZ(1,7)),7!==t.stack)})),GZ=Ao,VZ=Ze,SZ=In,BZ=Nr,XZ=fa,vZ=function(t,e){for(var n=hy(e),i=Iy.f,o=my.f,s=0;s<n.length;s++){var r=n[s];dy(t,r)||i(t,r,o(e,r))}},fZ=fr,RZ=yo,WZ=Ee,AZ=function(t,e){if("string"!=typeof t)return t;if(wy)for(;e--;)t=vy(t,Ay,"");else if(Yy)return Ry(Xy(fy(t,"\n"),e),"\n");return t},wZ=function(t,e){ky(e)&&"cause"in e&&Fy(t,"cause",e.cause)},YZ=uZ,kZ=function(t,e){return void 0===t?arguments.length<2?"":e:yZ(t)},FZ=JZ,HZ=yi("toStringTag"),xZ=VZ.Error,NZ=[].push,TZ=function(t,e){var n,i=arguments.length>2?arguments[2]:void 0,o=SZ(MZ,this);XZ?n=XZ(new xZ(void 0),o?BZ(this):MZ):(n=o?this:fZ(MZ),RZ(n,HZ,"Error")),RZ(n,"message",kZ(e,"")),FZ&&RZ(n,"stack",AZ(n.stack,1)),wZ(n,i);var s=[];return YZ(t,NZ,{that:s}),RZ(n,"errors",s),n};XZ?XZ(TZ,xZ):vZ(TZ,xZ);var MZ=TZ.prototype=fZ(xZ.prototype,{constructor:WZ(1,TZ),message:WZ(1,""),name:WZ(1,"AggregateError")});GZ({global:!0},{AggregateError:TZ});var UZ=Ze.Promise,KZ=Mr,EZ=mn,LZ=oo,DZ=ke,QZ=yi("species"),zZ=In,PZ=Ze.TypeError,_Z=yi("iterator"),OZ=!1;try{var jZ=0,qZ={next:function(){return{done:!!jZ++}},return:function(){OZ=!0}};qZ[_Z]=function(){return this},Array.from(qZ,(function(){throw 2}))}catch(t){}var $Z,tJ,eJ,nJ,iJ=function(t,e){if(!e&&!OZ)return!1;var n=!1;try{var i={};i[_Z]=function(){return{next:function(){return{done:n=!0}}}},t(i)}catch(t){}return n},oJ=Zl,sJ=kn,rJ=Ze.TypeError,aJ=co,lJ=function(t){if(oJ(t))return t;throw rJ(sJ(t)+" is not a constructor")},cJ=yi("species"),gJ=function(t,e){var n,i=aJ(t).constructor;return void 0===i||null==(n=aJ(i)[cJ])?e:lJ(n)},dJ=We([].slice),hJ=/(?:ipad|iphone|ipod).*applewebkit/i.test(un),mJ="process"==ze(Ze.process),IJ=Ze,uJ=Be,CJ=io,bJ=Ae,pJ=ii,yJ=Ye,ZJ=mr,JJ=dJ,GJ=ki,VJ=hJ,SJ=mJ,BJ=IJ.setImmediate,XJ=IJ.clearImmediate,vJ=IJ.process,fJ=IJ.Dispatch,RJ=IJ.Function,WJ=IJ.MessageChannel,AJ=IJ.String,wJ=0,YJ={},kJ="onreadystatechange";try{$Z=IJ.location}catch(t){}var FJ=function(t){if(pJ(YJ,t)){var e=YJ[t];delete YJ[t],e()}},HJ=function(t){return function(){FJ(t)}},xJ=function(t){FJ(t.data)},NJ=function(t){IJ.postMessage(AJ(t),$Z.protocol+"//"+$Z.host)};BJ&&XJ||(BJ=function(t){var e=JJ(arguments,1);return YJ[++wJ]=function(){uJ(bJ(t)?t:RJ(t),void 0,e)},tJ(wJ),wJ},XJ=function(t){delete YJ[t]},SJ?tJ=function(t){vJ.nextTick(HJ(t))}:fJ&&fJ.now?tJ=function(t){fJ.now(HJ(t))}:WJ&&!VJ?(nJ=(eJ=new WJ).port2,eJ.port1.onmessage=xJ,tJ=CJ(nJ.postMessage,nJ)):IJ.addEventListener&&bJ(IJ.postMessage)&&!IJ.importScripts&&$Z&&"file:"!==$Z.protocol&&!yJ(NJ)?(tJ=NJ,IJ.addEventListener("message",xJ,!1)):tJ=kJ in GJ("script")?function(t){ZJ.appendChild(GJ("script")).onreadystatechange=function(){ZJ.removeChild(this),FJ(t)}}:function(t){setTimeout(HJ(t),0)});var TJ,MJ,UJ,KJ,EJ,LJ,DJ,QJ,zJ={set:BJ,clear:XJ},PJ=Ze,_J=/ipad|iphone|ipod/i.test(un)&&void 0!==PJ.Pebble,OJ=/web0s(?!.*chrome)/i.test(un),jJ=Ze,qJ=io,$J=we.f,tG=zJ.set,eG=hJ,nG=_J,iG=OJ,oG=mJ,sG=jJ.MutationObserver||jJ.WebKitMutationObserver,rG=jJ.document,aG=jJ.process,lG=jJ.Promise,cG=$J(jJ,"queueMicrotask"),gG=cG&&cG.value;gG||(TJ=function(){var t,e;for(oG&&(t=aG.domain)&&t.exit();MJ;){e=MJ.fn,MJ=MJ.next;try{e()}catch(t){throw MJ?KJ():UJ=void 0,t}}UJ=void 0,t&&t.enter()},eG||oG||iG||!sG||!rG?!nG&&lG&&lG.resolve?((DJ=lG.resolve(void 0)).constructor=lG,QJ=qJ(DJ.then,DJ),KJ=function(){QJ(TJ)}):oG?KJ=function(){aG.nextTick(TJ)}:(tG=qJ(tG,jJ),KJ=function(){tG(TJ)}):(EJ=!0,LJ=rG.createTextNode(""),new sG(TJ).observe(LJ,{characterData:!0}),KJ=function(){LJ.data=EJ=!EJ}));var dG=gG||function(t){var e={fn:t,next:void 0};UJ&&(UJ.next=e),MJ||(MJ=e,KJ()),UJ=e},hG={},mG=Nn,IG=function(t){var e,n;this.promise=new t((function(t,i){if(void 0!==e||void 0!==n)throw TypeError("Bad Promise constructor");e=t,n=i})),this.resolve=mG(e),this.reject=mG(n)};hG.f=function(t){return new IG(t)};var uG,CG,bG,pG=co,yG=an,ZG=hG,JG=function(t,e){if(pG(t),yG(e)&&e.constructor===t)return e;var n=ZG.f(t);return(0,n.resolve)(e),n.promise},GG=Ze,VG=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},SG="object"==typeof window,BG=Ao,XG=Ze,vG=mn,fG=He,RG=UZ,WG=function(t,e,n){for(var i in e)n&&n.unsafe&&t[i]?t[i]=e[i]:KZ(t,i,e[i],n);return t},AG=Ia,wG=function(t){var e=EZ(t),n=LZ.f;DZ&&e&&!e[QZ]&&n(e,QZ,{configurable:!0,get:function(){return this}})},YG=Nn,kG=Ae,FG=an,HG=function(t,e){if(zZ(e,t))return t;throw PZ("Incorrect invocation")},xG=fs,NG=uZ,TG=iJ,MG=gJ,UG=zJ.set,KG=dG,EG=JG,LG=function(t,e){var n=GG.console;n&&n.error&&(1==arguments.length?n.error(t):n.error(t,e))},DG=hG,QG=VG,zG=er,PG=to,_G=SG,OG=mJ,jG=Gn,qG=yi("species"),$G="Promise",tV=zG.get,eV=zG.set,nV=zG.getterFor($G),iV=RG&&RG.prototype,oV=RG,sV=iV,rV=XG.TypeError,aV=XG.document,lV=XG.process,cV=DG.f,gV=cV,dV=!!(aV&&aV.createEvent&&XG.dispatchEvent),hV=kG(XG.PromiseRejectionEvent),mV="unhandledrejection",IV=PG($G,(function(){var t=xG(oV),e=t!==String(oV);if(!e&&66===jG)return!0;if(!sV.finally)return!0;if(jG>=51&&/native code/.test(t))return!1;var n=new oV((function(t){t(1)})),i=function(t){t((function(){}),(function(){}))};return(n.constructor={})[qG]=i,!(n.then((function(){}))instanceof i)||!e&&_G&&!hV})),uV=IV||!TG((function(t){oV.all(t).catch((function(){}))})),CV=function(t){var e;return!(!FG(t)||!kG(e=t.then))&&e},bV=function(t,e){if(!t.notified){t.notified=!0;var n=t.reactions;KG((function(){for(var i=t.value,o=1==t.state,s=0;n.length>s;){var r,a,l,c=n[s++],g=o?c.ok:c.fail,d=c.resolve,h=c.reject,m=c.domain;try{g?(o||(2===t.rejection&&JV(t),t.rejection=1),!0===g?r=i:(m&&m.enter(),r=g(i),m&&(m.exit(),l=!0)),r===c.promise?h(rV("Promise-chain cycle")):(a=CV(r))?fG(a,r,d,h):d(r)):h(i)}catch(t){m&&!l&&m.exit(),h(t)}}t.reactions=[],t.notified=!1,e&&!t.rejection&&yV(t)}))}},pV=function(t,e,n){var i,o;dV?((i=aV.createEvent("Event")).promise=e,i.reason=n,i.initEvent(t,!1,!0),XG.dispatchEvent(i)):i={promise:e,reason:n},!hV&&(o=XG["on"+t])?o(i):t===mV&&LG("Unhandled promise rejection",n)},yV=function(t){fG(UG,XG,(function(){var e,n=t.facade,i=t.value;if(ZV(t)&&(e=QG((function(){OG?lV.emit("unhandledRejection",i,n):pV(mV,n,i)})),t.rejection=OG||ZV(t)?2:1,e.error))throw e.value}))},ZV=function(t){return 1!==t.rejection&&!t.parent},JV=function(t){fG(UG,XG,(function(){var e=t.facade;OG?lV.emit("rejectionHandled",e):pV("rejectionhandled",e,t.value)}))},GV=function(t,e,n){return function(i){t(e,i,n)}},VV=function(t,e,n){t.done||(t.done=!0,n&&(t=n),t.value=e,t.state=2,bV(t,!0))},SV=function(t,e,n){if(!t.done){t.done=!0,n&&(t=n);try{if(t.facade===e)throw rV("Promise can't be resolved itself");var i=CV(e);i?KG((function(){var n={done:!1};try{fG(i,e,GV(SV,n,t),GV(VV,n,t))}catch(e){VV(n,e,t)}})):(t.value=e,t.state=1,bV(t,!1))}catch(e){VV({done:!1},e,t)}}};IV&&(sV=(oV=function(t){HG(this,sV),YG(t),fG(uG,this);var e=tV(this);try{t(GV(SV,e),GV(VV,e))}catch(t){VV(e,t)}}).prototype,(uG=function(t){eV(this,{type:$G,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=WG(sV,{then:function(t,e){var n=nV(this),i=n.reactions,o=cV(MG(this,oV));return o.ok=!kG(t)||t,o.fail=kG(e)&&e,o.domain=OG?lV.domain:void 0,n.parent=!0,i[i.length]=o,0!=n.state&&bV(n,!1),o.promise},catch:function(t){return this.then(void 0,t)}}),CG=function(){var t=new uG,e=tV(t);this.promise=t,this.resolve=GV(SV,e),this.reject=GV(VV,e)},DG.f=cV=function(t){return t===oV||t===bG?new CG(t):gV(t)}),BG({global:!0,wrap:!0,forced:IV},{Promise:oV}),AG(oV,$G,!1,!0),wG($G),bG=vG($G),BG({target:$G,stat:!0,forced:IV},{reject:function(t){var e=cV(this);return fG(e.reject,void 0,t),e.promise}}),BG({target:$G,stat:!0,forced:!0},{resolve:function(t){return EG(this===bG?oV:this,t)}}),BG({target:$G,stat:!0,forced:uV},{all:function(t){var e=this,n=cV(e),i=n.resolve,o=n.reject,s=QG((function(){var n=YG(e.resolve),s=[],r=0,a=1;NG(t,(function(t){var l=r++,c=!1;a++,fG(n,e,t).then((function(t){c||(c=!0,s[l]=t,--a||i(s))}),o)})),--a||i(s)}));return s.error&&o(s.value),n.promise},race:function(t){var e=this,n=cV(e),i=n.reject,o=QG((function(){var o=YG(e.resolve);NG(t,(function(t){fG(o,e,t).then(n.resolve,i)}))}));return o.error&&i(o.value),n.promise}});var BV=He,XV=Nn,vV=hG,fV=VG,RV=uZ;Ao({target:"Promise",stat:!0},{allSettled:function(t){var e=this,n=vV.f(e),i=n.resolve,o=n.reject,s=fV((function(){var n=XV(e.resolve),o=[],s=0,r=1;RV(t,(function(t){var a=s++,l=!1;r++,BV(n,e,t).then((function(t){l||(l=!0,o[a]={status:"fulfilled",value:t},--r||i(o))}),(function(t){l||(l=!0,o[a]={status:"rejected",reason:t},--r||i(o))}))})),--r||i(o)}));return s.error&&o(s.value),n.promise}});var WV=Nn,AV=mn,wV=He,YV=hG,kV=VG,FV=uZ,HV="No one promise resolved";Ao({target:"Promise",stat:!0},{any:function(t){var e=this,n=AV("AggregateError"),i=YV.f(e),o=i.resolve,s=i.reject,r=kV((function(){var i=WV(e.resolve),r=[],a=0,l=1,c=!1;FV(t,(function(t){var g=a++,d=!1;l++,wV(i,e,t).then((function(t){d||c||(c=!0,o(t))}),(function(t){d||c||(d=!0,r[g]=t,--l||s(new n(r,HV)))}))})),--l||s(new n(r,HV))}));return r.error&&s(r.value),i.promise}});var xV=UZ,NV=mn,TV=Ae,MV=gJ,UV=JG;Ao({target:"Promise",proto:!0,real:!0,forced:!!xV&&Ye((function(){xV.prototype.finally.call({then:function(){}},(function(){}))}))},{finally:function(t){var e=MV(this,NV("Promise")),n=TV(t);return this.then(n?function(n){return UV(e,t()).then((function(){return n}))}:t,n?function(n){return UV(e,t()).then((function(){throw n}))}:t)}});var KV=We,EV=ko,LV=pZ,DV=en,QV=KV("".charAt),zV=KV("".charCodeAt),PV=KV("".slice),_V=function(t){return function(e,n){var i,o,s=LV(DV(e)),r=EV(n),a=s.length;return r<0||r>=a?t?"":void 0:(i=zV(s,r))<55296||i>56319||r+1===a||(o=zV(s,r+1))<56320||o>57343?t?QV(s,r):i:t?PV(s,r,r+2):o-56320+(i-55296<<10)+65536}},OV={codeAt:_V(!1),charAt:_V(!0)}.charAt,jV=pZ,qV=er,$V=Ea,tS="String Iterator",eS=qV.set,nS=qV.getterFor(tS);$V(String,"String",(function(t){eS(this,{type:tS,string:jV(t),index:0})}),(function(){var t,e=nS(this),n=e.string,i=e.index;return i>=n.length?{value:void 0,done:!0}:(t=OV(n,i),e.index+=t.length,{value:t,done:!1})}));var iS=ln.Promise,oS=hG,sS=VG;Ao({target:"Promise",stat:!0},{try:function(t){var e=oS.f(this),n=sS(t);return(n.error?e.reject:e.resolve)(n.value),e.promise}});var rS=iS;function aS(t,e,n,i,o,s,r){try{var a=t[s](r),l=a.value}catch(t){return void n(t)}a.done?e(l):rS.resolve(l).then(i,o)}function lS(t){return function(){var e=this,n=arguments;return new rS((function(i,o){var s=t.apply(e,n);function r(t){aS(s,i,o,r,a,"next",t)}function a(t){aS(s,i,o,r,a,"throw",t)}r(void 0)}))}}var cS={exports:{}};!function(t){var e=function(t){var e,n=Object.prototype,i=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",r=o.asyncIterator||"@@asyncIterator",a=o.toStringTag||"@@toStringTag";function l(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,n){return t[e]=n}}function c(t,e,n,i){var o=e&&e.prototype instanceof C?e:C,s=Object.create(o.prototype),r=new f(i||[]);return s._invoke=function(t,e,n){var i=d;return function(o,s){if(i===m)throw new Error("Generator is already running");if(i===I){if("throw"===o)throw s;return W()}for(n.method=o,n.arg=s;;){var r=n.delegate;if(r){var a=B(r,n);if(a){if(a===u)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===d)throw i=I,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=m;var l=g(t,e,n);if("normal"===l.type){if(i=n.done?I:h,l.arg===u)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=I,n.method="throw",n.arg=l.arg)}}}(t,n,r),s}function g(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var d="suspendedStart",h="suspendedYield",m="executing",I="completed",u={};function C(){}function b(){}function p(){}var y={};l(y,s,(function(){return this}));var Z=Object.getPrototypeOf,J=Z&&Z(Z(R([])));J&&J!==n&&i.call(J,s)&&(y=J);var G=p.prototype=C.prototype=Object.create(y);function V(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function n(o,s,r,a){var l=g(t[o],t,s);if("throw"!==l.type){var c=l.arg,d=c.value;return d&&"object"==typeof d&&i.call(d,"__await")?e.resolve(d.__await).then((function(t){n("next",t,r,a)}),(function(t){n("throw",t,r,a)})):e.resolve(d).then((function(t){c.value=t,r(c)}),(function(t){return n("throw",t,r,a)}))}a(l.arg)}var o;this._invoke=function(t,i){function s(){return new e((function(e,o){n(t,i,e,o)}))}return o=o?o.then(s,s):s()}}function B(t,n){var i=t.iterator[n.method];if(i===e){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=e,B(t,n),"throw"===n.method))return u;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var o=g(i,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,u;var s=o.arg;return s?s.done?(n[t.resultName]=s.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,u):s:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,u)}function X(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function v(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function f(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(X,this),this.reset(!0)}function R(t){if(t){var n=t[s];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,r=function n(){for(;++o<t.length;)if(i.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return r.next=r}}return{next:W}}function W(){return{value:e,done:!0}}return b.prototype=p,l(G,"constructor",p),l(p,"constructor",b),b.displayName=l(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,l(t,a,"GeneratorFunction")),t.prototype=Object.create(G),t},t.awrap=function(t){return{__await:t}},V(S.prototype),l(S.prototype,r,(function(){return this})),t.AsyncIterator=S,t.async=function(e,n,i,o,s){void 0===s&&(s=Promise);var r=new S(c(e,n,i,o),s);return t.isGeneratorFunction(n)?r:r.next().then((function(t){return t.done?t.value:r.next()}))},V(G),l(G,a,"Generator"),l(G,s,(function(){return this})),l(G,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var i=e.pop();if(i in t)return n.value=i,n.done=!1,n}return n.done=!0,n}},t.values=R,f.prototype={constructor:f,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(v),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(i,o){return a.type="throw",a.arg=t,n.next=i,o&&(n.method="next",n.arg=e),!!o}for(var s=this.tryEntries.length-1;s>=0;--s){var r=this.tryEntries[s],a=r.completion;if("root"===r.tryLoc)return o("end");if(r.tryLoc<=this.prev){var l=i.call(r,"catchLoc"),c=i.call(r,"finallyLoc");if(l&&c){if(this.prev<r.catchLoc)return o(r.catchLoc,!0);if(this.prev<r.finallyLoc)return o(r.finallyLoc)}else if(l){if(this.prev<r.catchLoc)return o(r.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return o(r.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&i.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var s=o;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var r=s?s.completion:{};return r.type=t,r.arg=e,s?(this.method="next",this.next=s.finallyLoc,u):this.complete(r)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),u},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),v(n),u}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var o=i.arg;v(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,i){return this.delegate={iterator:R(t),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=e),u}},t}(t.exports);try{regeneratorRuntime=e}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}}(cS);var gS=cS.exports,dS=Sy,hS=Math.floor,mS=function(t,e){var n=t.length,i=hS(n/2);return n<8?IS(t,e):uS(t,mS(dS(t,0,i),e),mS(dS(t,i),e),e)},IS=function(t,e){for(var n,i,o=t.length,s=1;s<o;){for(i=s,n=t[s];i&&e(t[i-1],n)>0;)t[i]=t[--i];i!==s++&&(t[i]=n)}return t},uS=function(t,e,n,i){for(var o=e.length,s=n.length,r=0,a=0;r<o||a<s;)t[r+a]=r<o&&a<s?i(e[r],n[a])<=0?e[r++]:n[a++]:r<o?e[r++]:n[a++];return t},CS=mS,bS=un.match(/firefox\/(\d+)/i),pS=!!bS&&+bS[1],yS=/MSIE|Trident/.test(un),ZS=un.match(/AppleWebKit\/(\d+)\./),JS=!!ZS&&+ZS[1],GS=Ao,VS=We,SS=Nn,BS=ti,XS=Ko,vS=pZ,fS=Ye,RS=CS,WS=Nl,AS=pS,wS=yS,YS=Gn,kS=JS,FS=[],HS=VS(FS.sort),xS=VS(FS.push),NS=fS((function(){FS.sort(void 0)})),TS=fS((function(){FS.sort(null)})),MS=WS("sort"),US=!fS((function(){if(YS)return YS<70;if(!(AS&&AS>3)){if(wS)return!0;if(kS)return kS<603;var t,e,n,i,o="";for(t=65;t<76;t++){switch(e=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(i=0;i<47;i++)FS.push({k:e+i,v:n})}for(FS.sort((function(t,e){return e.v-t.v})),i=0;i<FS.length;i++)e=FS[i].k.charAt(0),o.charAt(o.length-1)!==e&&(o+=e);return"DGBEFHACIJK"!==o}}));GS({target:"Array",proto:!0,forced:NS||!TS||!MS||!US},{sort:function(t){void 0!==t&&SS(t);var e=BS(this);if(US)return void 0===t?HS(e):HS(e,t);var n,i,o=[],s=XS(e);for(i=0;i<s;i++)i in e&&xS(o,e[i]);for(RS(o,function(t){return function(e,n){return void 0===n?-1:void 0===e?1:void 0!==t?+t(e,n)||0:vS(e)>vS(n)?1:-1}}(t)),n=o.length,i=0;i<n;)e[i]=o[i++];for(;i<s;)delete e[i++];return e}});var KS=Kl("Array").sort,ES=In,LS=KS,DS=Array.prototype,QS=function(t){var e=t.sort;return t===DS||ES(DS,t)&&e===DS.sort?LS:e},zS=Ao,PS=Hl.findIndex,_S="findIndex",OS=!0;_S in[]&&Array(1).findIndex((function(){OS=!1})),zS({target:"Array",proto:!0,forced:OS},{findIndex:function(t){return PS(this,t,arguments.length>1?arguments[1]:void 0)}});var jS=Kl("Array").findIndex,qS=In,$S=jS,tB=Array.prototype,eB=function(t){var e=t.findIndex;return t===tB||qS(tB,t)&&e===tB.findIndex?$S:e},nB=iS,iB=Ao,oB=Ze,sB=Be,rB=Ae,aB=dJ,lB=/MSIE .\./.test(un),cB=oB.Function,gB=function(t){return function(e,n){var i=arguments.length>2,o=i?aB(arguments,2):void 0;return t(i?function(){sB(rB(e)?e:cB(e),this,o)}:e,n)}};iB({global:!0,bind:!0,forced:lB},{setTimeout:gB(oB.setTimeout),setInterval:gB(oB.setInterval)});var dB=ln.setTimeout,hB={},mB={},IB={}.propertyIsEnumerable,uB=Object.getOwnPropertyDescriptor,CB=uB&&!IB.call({1:2},1);mB.f=CB?function(t){var e=uB(this,t);return!!e&&e.enumerable}:IB;var bB=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},pB=c,yB=pB({}.toString),ZB=pB("".slice),JB=function(t){return ZB(yB(t),8,-1)},GB=c,VB=i,SB=JB,BB=d.Object,XB=GB("".split),vB=VB((function(){return!BB("z").propertyIsEnumerable(0)}))?function(t){return"String"==SB(t)?XB(t,""):BB(t)}:BB,fB=vB,RB=m,WB=function(t){return fB(RB(t))},AB=o,wB=K,YB=mB,kB=bB,FB=WB,HB=oe,xB=y,NB=F,TB=Object.getOwnPropertyDescriptor;hB.f=AB?TB:function(t,e){if(t=FB(t),e=HB(e),NB)try{return TB(t,e)}catch(t){}if(xB(t,e))return kB(!wB(YB.f,t,e),t[e])};var MB=X,UB=bB,KB=o?function(t,e,n){return MB.f(t,e,UB(1,n))}:function(t,e,n){return t[e]=n,t},EB={exports:{}},LB=v,DB=Wt,QB=c(Function.toString);LB(DB.inspectSource)||(DB.inspectSource=function(t){return QB(t)});var zB,PB,_B,OB=DB.inspectSource,jB=v,qB=OB,$B=d.WeakMap,tX=jB($B)&&/native code/.test(qB($B)),eX=St.exports,nX=Ht,iX=eX("keys"),oX=function(t){return iX[t]||(iX[t]=nX(t))},sX={},rX=tX,aX=d,lX=c,cX=R,gX=KB,dX=y,hX=Wt,mX=oX,IX=sX,uX="Object already initialized",CX=aX.TypeError,bX=aX.WeakMap;if(rX||hX.state){var pX=hX.state||(hX.state=new bX),yX=lX(pX.get),ZX=lX(pX.has),JX=lX(pX.set);zB=function(t,e){if(ZX(pX,t))throw new CX(uX);return e.facade=t,JX(pX,t,e),e},PB=function(t){return yX(pX,t)||{}},_B=function(t){return ZX(pX,t)}}else{var GX=mX("state");IX[GX]=!0,zB=function(t,e){if(dX(t,GX))throw new CX(uX);return e.facade=t,gX(t,GX,e),e},PB=function(t){return dX(t,GX)?t[GX]:{}},_B=function(t){return dX(t,GX)}}var VX={set:zB,get:PB,has:_B,enforce:function(t){return _B(t)?PB(t):zB(t,{})},getterFor:function(t){return function(e){var n;if(!cX(e)||(n=PB(e)).type!==t)throw CX("Incompatible receiver, "+t+" required");return n}}},SX=d,BX=v,XX=y,vX=KB,fX=vt,RX=OB,WX=B.CONFIGURABLE,AX=VX.get,wX=VX.enforce,YX=String(String).split("String");(EB.exports=function(t,e,n,i){var o,s=!!i&&!!i.unsafe,r=!!i&&!!i.enumerable,a=!!i&&!!i.noTargetGet,l=i&&void 0!==i.name?i.name:e;BX(n)&&("Symbol("===String(l).slice(0,7)&&(l="["+String(l).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),(!XX(n,"name")||WX&&n.name!==l)&&vX(n,"name",l),(o=wX(n)).source||(o.source=YX.join("string"==typeof l?l:""))),t!==SX?(s?!a&&t[e]&&(r=!0):delete t[e],r?t[e]=n:vX(t,e,n)):r?t[e]=n:fX(e,n)})(Function.prototype,"toString",(function(){return BX(this)&&AX(this).source||RX(this)}));var kX={},FX=Math.ceil,HX=Math.floor,xX=function(t){var e=+t;return e!=e||0===e?0:(e>0?HX:FX)(e)},NX=xX,TX=Math.max,MX=Math.min,UX=function(t,e){var n=NX(t);return n<0?TX(n+e,0):MX(n,e)},KX=xX,EX=Math.min,LX=function(t){return t>0?EX(KX(t),9007199254740991):0},DX=LX,QX=function(t){return DX(t.length)},zX=WB,PX=UX,_X=QX,OX=function(t){return function(e,n,i){var o,s=zX(e),r=_X(s),a=PX(i,r);if(t&&n!=n){for(;r>a;)if((o=s[a++])!=o)return!0}else for(;r>a;a++)if((t||a in s)&&s[a]===n)return t||a||0;return!t&&-1}},jX={includes:OX(!0),indexOf:OX(!1)},qX=y,$X=WB,tv=jX.indexOf,ev=sX,nv=c([].push),iv=function(t,e){var n,i=$X(t),o=0,s=[];for(n in i)!qX(ev,n)&&qX(i,n)&&nv(s,n);for(;e.length>o;)qX(i,n=e[o++])&&(~tv(s,n)||nv(s,n));return s},ov=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],sv=iv,rv=ov.concat("length","prototype");kX.f=Object.getOwnPropertyNames||function(t){return sv(t,rv)};var av={};av.f=Object.getOwnPropertySymbols;var lv=Q,cv=kX,gv=av,dv=M,hv=c([].concat),mv=lv("Reflect","ownKeys")||function(t){var e=cv.f(dv(t)),n=gv.f;return n?hv(e,n(t)):e},Iv=y,uv=mv,Cv=hB,bv=X,pv=i,yv=v,Zv=/#|\.prototype\./,Jv=function(t,e){var n=Vv[Gv(t)];return n==Bv||n!=Sv&&(yv(e)?pv(e):!!e)},Gv=Jv.normalize=function(t){return String(t).replace(Zv,".").toLowerCase()},Vv=Jv.data={},Sv=Jv.NATIVE="N",Bv=Jv.POLYFILL="P",Xv=Jv,vv=d,fv=hB.f,Rv=KB,Wv=EB.exports,Av=vt,wv=function(t,e){for(var n=uv(e),i=bv.f,o=Cv.f,s=0;s<n.length;s++){var r=n[s];Iv(t,r)||i(t,r,o(e,r))}},Yv=Xv,kv=function(t,e){var n,i,o,s,r,a=t.target,l=t.global,c=t.stat;if(n=l?vv:c?vv[a]||Av(a,{}):(vv[a]||{}).prototype)for(i in e){if(s=e[i],o=t.noTargetGet?(r=fv(n,i))&&r.value:n[i],!Yv(l?i:a+(c?".":"#")+i,t.forced)&&void 0!==o){if(typeof s==typeof o)continue;wv(s,o)}(t.sham||o&&o.sham)&&Rv(s,"sham",!0),Wv(n,i,s,t)}},Fv="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Hv=EB.exports,xv=function(t,e,n){for(var i in e)Hv(t,i,e[i],n);return t},Nv=z,Tv=d.TypeError,Mv=function(t,e){if(Nv(e,t))return t;throw Tv("Incorrect invocation")},Uv=xX,Kv=LX,Ev=d.RangeError,Lv=function(t){if(void 0===t)return 0;var e=Uv(t),n=Kv(e);if(e!==n)throw Ev("Wrong length or index");return n},Dv=d.Array,Qv=Math.abs,zv=Math.pow,Pv=Math.floor,_v=Math.log,Ov=Math.LN2,jv={pack:function(t,e,n){var i,o,s,r=Dv(n),a=8*n-e-1,l=(1<<a)-1,c=l>>1,g=23===e?zv(2,-24)-zv(2,-77):0,d=t<0||0===t&&1/t<0?1:0,h=0;for((t=Qv(t))!=t||t===1/0?(o=t!=t?1:0,i=l):(i=Pv(_v(t)/Ov),t*(s=zv(2,-i))<1&&(i--,s*=2),(t+=i+c>=1?g/s:g*zv(2,1-c))*s>=2&&(i++,s/=2),i+c>=l?(o=0,i=l):i+c>=1?(o=(t*s-1)*zv(2,e),i+=c):(o=t*zv(2,c-1)*zv(2,e),i=0));e>=8;)r[h++]=255&o,o/=256,e-=8;for(i=i<<e|o,a+=e;a>0;)r[h++]=255&i,i/=256,a-=8;return r[--h]|=128*d,r},unpack:function(t,e){var n,i=t.length,o=8*i-e-1,s=(1<<o)-1,r=s>>1,a=o-7,l=i-1,c=t[l--],g=127&c;for(c>>=7;a>0;)g=256*g+t[l--],a-=8;for(n=g&(1<<-a)-1,g>>=-a,a+=e;a>0;)n=256*n+t[l--],a-=8;if(0===g)g=1-r;else{if(g===s)return n?NaN:c?-1/0:1/0;n+=zv(2,e),g-=r}return(c?-1:1)*n*zv(2,g-e)}},qv=!i((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),$v=d,tf=y,ef=v,nf=C,of=qv,sf=oX("IE_PROTO"),rf=$v.Object,af=rf.prototype,lf=of?rf.getPrototypeOf:function(t){var e=nf(t);if(tf(e,sf))return e[sf];var n=e.constructor;return ef(n)&&e instanceof n?n.prototype:e instanceof rf?af:null},cf=d,gf=v,df=cf.String,hf=cf.TypeError,mf=c,If=M,uf=function(t){if("object"==typeof t||gf(t))return t;throw hf("Can't set "+df(t)+" as a prototype")},Cf=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=mf(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(n,[]),e=n instanceof Array}catch(t){}return function(n,i){return If(n),uf(i),e?t(n,i):n.__proto__=i,n}}():void 0),bf=C,pf=UX,yf=QX,Zf=function(t){for(var e=bf(this),n=yf(e),i=arguments.length,o=pf(i>1?arguments[1]:void 0,n),s=i>2?arguments[2]:void 0,r=void 0===s?n:pf(s,n);r>o;)e[o++]=t;return e},Jf=oe,Gf=X,Vf=bB,Sf=UX,Bf=QX,Xf=function(t,e,n){var i=Jf(e);i in t?Gf.f(t,i,Vf(0,n)):t[i]=n},vf=d.Array,ff=Math.max,Rf=function(t,e,n){for(var i=Bf(t),o=Sf(e,i),s=Sf(void 0===n?i:n,i),r=vf(ff(s-o,0)),a=0;o<s;o++,a++)Xf(r,a,t[o]);return r.length=a,r},Wf=X.f,Af=y,wf=zt("toStringTag"),Yf=function(t,e,n){t&&!Af(t=n?t:t.prototype,wf)&&Wf(t,wf,{configurable:!0,value:e})},kf=d,Ff=c,Hf=o,xf=Fv,Nf=B,Tf=KB,Mf=xv,Uf=i,Kf=Mv,Ef=xX,Lf=LX,Df=Lv,Qf=jv,zf=lf,Pf=Cf,_f=kX.f,Of=X.f,jf=Zf,qf=Rf,$f=Yf,tR=Nf.PROPER,eR=Nf.CONFIGURABLE,nR=VX.get,iR=VX.set,oR="ArrayBuffer",sR="DataView",rR="Wrong index",aR=kf.ArrayBuffer,lR=aR,cR=lR&&lR.prototype,gR=kf.DataView,dR=gR&&gR.prototype,hR=Object.prototype,mR=kf.Array,IR=kf.RangeError,uR=Ff(jf),CR=Ff([].reverse),bR=Qf.pack,pR=Qf.unpack,yR=function(t){return[255&t]},ZR=function(t){return[255&t,t>>8&255]},JR=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},GR=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},VR=function(t){return bR(t,23,4)},SR=function(t){return bR(t,52,8)},BR=function(t,e){Of(t.prototype,e,{get:function(){return nR(this)[e]}})},XR=function(t,e,n,i){var o=Df(n),s=nR(t);if(o+e>s.byteLength)throw IR(rR);var r=nR(s.buffer).bytes,a=o+s.byteOffset,l=qf(r,a,a+e);return i?l:CR(l)},vR=function(t,e,n,i,o,s){var r=Df(n),a=nR(t);if(r+e>a.byteLength)throw IR(rR);for(var l=nR(a.buffer).bytes,c=r+a.byteOffset,g=i(+o),d=0;d<e;d++)l[c+d]=g[s?d:e-d-1]};if(xf){var fR=tR&&aR.name!==oR;if(Uf((function(){aR(1)}))&&Uf((function(){new aR(-1)}))&&!Uf((function(){return new aR,new aR(1.5),new aR(NaN),fR&&!eR})))fR&&eR&&Tf(aR,"name",oR);else{(lR=function(t){return Kf(this,cR),new aR(Df(t))}).prototype=cR;for(var RR,WR=_f(aR),AR=0;WR.length>AR;)(RR=WR[AR++])in lR||Tf(lR,RR,aR[RR]);cR.constructor=lR}Pf&&zf(dR)!==hR&&Pf(dR,hR);var wR=new gR(new lR(2)),YR=Ff(dR.setInt8);wR.setInt8(0,2147483648),wR.setInt8(1,2147483649),!wR.getInt8(0)&&wR.getInt8(1)||Mf(dR,{setInt8:function(t,e){YR(this,t,e<<24>>24)},setUint8:function(t,e){YR(this,t,e<<24>>24)}},{unsafe:!0})}else cR=(lR=function(t){Kf(this,cR);var e=Df(t);iR(this,{bytes:uR(mR(e),0),byteLength:e}),Hf||(this.byteLength=e)}).prototype,dR=(gR=function(t,e,n){Kf(this,dR),Kf(t,cR);var i=nR(t).byteLength,o=Ef(e);if(o<0||o>i)throw IR("Wrong offset");if(o+(n=void 0===n?i-o:Lf(n))>i)throw IR("Wrong length");iR(this,{buffer:t,byteLength:n,byteOffset:o}),Hf||(this.buffer=t,this.byteLength=n,this.byteOffset=o)}).prototype,Hf&&(BR(lR,"byteLength"),BR(gR,"buffer"),BR(gR,"byteLength"),BR(gR,"byteOffset")),Mf(dR,{getInt8:function(t){return XR(this,1,t)[0]<<24>>24},getUint8:function(t){return XR(this,1,t)[0]},getInt16:function(t){var e=XR(this,2,t,arguments.length>1?arguments[1]:void 0);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=XR(this,2,t,arguments.length>1?arguments[1]:void 0);return e[1]<<8|e[0]},getInt32:function(t){return GR(XR(this,4,t,arguments.length>1?arguments[1]:void 0))},getUint32:function(t){return GR(XR(this,4,t,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(t){return pR(XR(this,4,t,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(t){return pR(XR(this,8,t,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(t,e){vR(this,1,t,yR,e)},setUint8:function(t,e){vR(this,1,t,yR,e)},setInt16:function(t,e){vR(this,2,t,ZR,e,arguments.length>2?arguments[2]:void 0)},setUint16:function(t,e){vR(this,2,t,ZR,e,arguments.length>2?arguments[2]:void 0)},setInt32:function(t,e){vR(this,4,t,JR,e,arguments.length>2?arguments[2]:void 0)},setUint32:function(t,e){vR(this,4,t,JR,e,arguments.length>2?arguments[2]:void 0)},setFloat32:function(t,e){vR(this,4,t,VR,e,arguments.length>2?arguments[2]:void 0)},setFloat64:function(t,e){vR(this,8,t,SR,e,arguments.length>2?arguments[2]:void 0)}});$f(lR,oR),$f(gR,sR);var kR={ArrayBuffer:lR,DataView:gR},FR=Q,HR=X,xR=o,NR=zt("species"),TR=function(t){var e=FR(t),n=HR.f;xR&&e&&!e[NR]&&n(e,NR,{configurable:!0,get:function(){return this}})},MR=TR,UR="ArrayBuffer",KR=kR.ArrayBuffer;kv({global:!0,forced:d.ArrayBuffer!==KR},{ArrayBuffer:KR}),MR(UR);var ER={};ER[zt("toStringTag")]="z";var LR="[object z]"===String(ER),DR=d,QR=LR,zR=v,PR=JB,_R=zt("toStringTag"),OR=DR.Object,jR="Arguments"==PR(function(){return arguments}()),qR=QR?PR:function(t){var e,n,i;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=OR(t),_R))?n:jR?PR(e):"Object"==(i=PR(e))&&zR(e.callee)?"Arguments":i},$R=qR,tW=LR?{}.toString:function(){return"[object "+$R(this)+"]"},eW=LR,nW=EB.exports,iW=tW;eW||nW(Object.prototype,"toString",iW,{unsafe:!0});var oW,sW=iv,rW=ov,aW=Object.keys||function(t){return sW(t,rW)},lW=X,cW=M,gW=WB,dW=aW,hW=o?Object.defineProperties:function(t,e){cW(t);for(var n,i=gW(e),o=dW(e),s=o.length,r=0;s>r;)lW.f(t,n=o[r++],i[n]);return t},mW=Q("document","documentElement"),IW=M,uW=hW,CW=ov,bW=sX,pW=mW,yW=Y,ZW=oX("IE_PROTO"),JW=function(){},GW=function(t){return"<script>"+t+"<\/script>"},VW=function(t){t.write(GW("")),t.close();var e=t.parentWindow.Object;return t=null,e},SW=function(){try{oW=new ActiveXObject("htmlfile")}catch(t){}var t,e;SW="undefined"!=typeof document?document.domain&&oW?VW(oW):((e=yW("iframe")).style.display="none",pW.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(GW("document.F=Object")),t.close(),t.F):VW(oW);for(var n=CW.length;n--;)delete SW.prototype[CW[n]];return SW()};bW[ZW]=!0;var BW=Object.create||function(t,e){var n;return null!==t?(JW.prototype=IW(t),n=new JW,JW.prototype=null,n[ZW]=t):n=SW(),void 0===e?n:uW(n,e)},XW=BW,vW=X,fW=zt("unscopables"),RW=Array.prototype;null==RW[fW]&&vW.f(RW,fW,{configurable:!0,value:XW(null)});var WW,AW,wW,YW={},kW=i,FW=v,HW=lf,xW=EB.exports,NW=zt("iterator"),TW=!1;[].keys&&("next"in(wW=[].keys())?(AW=HW(HW(wW)))!==Object.prototype&&(WW=AW):TW=!0);var MW=null==WW||kW((function(){var t={};return WW[NW].call(t)!==t}));MW&&(WW={}),FW(WW[NW])||xW(WW,NW,(function(){return this}));var UW={IteratorPrototype:WW,BUGGY_SAFARI_ITERATORS:TW},KW=UW.IteratorPrototype,EW=BW,LW=bB,DW=Yf,QW=YW,zW=function(){return this},PW=kv,_W=K,OW=B,jW=v,qW=function(t,e,n){var i=e+" Iterator";return t.prototype=EW(KW,{next:LW(1,n)}),DW(t,i,!1),QW[i]=zW,t},$W=lf,tA=Cf,eA=Yf,nA=KB,iA=EB.exports,oA=YW,sA=OW.PROPER,rA=OW.CONFIGURABLE,aA=UW.IteratorPrototype,lA=UW.BUGGY_SAFARI_ITERATORS,cA=zt("iterator"),gA="keys",dA="values",hA="entries",mA=function(){return this},IA=function(t,e,n,i,o,s,r){qW(n,e,i);var a,l,c,g=function(t){if(t===o&&u)return u;if(!lA&&t in m)return m[t];switch(t){case gA:case dA:case hA:return function(){return new n(this,t)}}return function(){return new n(this)}},d=e+" Iterator",h=!1,m=t.prototype,I=m[cA]||m["@@iterator"]||o&&m[o],u=!lA&&I||g(o),C="Array"==e&&m.entries||I;if(C&&(a=$W(C.call(new t)))!==Object.prototype&&a.next&&($W(a)!==aA&&(tA?tA(a,aA):jW(a[cA])||iA(a,cA,mA)),eA(a,d,!0)),sA&&o==dA&&I&&I.name!==dA&&(rA?nA(m,"name",dA):(h=!0,u=function(){return _W(I,this)})),o)if(l={values:g(dA),keys:s?u:g(gA),entries:g(hA)},r)for(c in l)(lA||h||!(c in m))&&iA(m,c,l[c]);else PW({target:e,proto:!0,forced:lA||h},l);return m[cA]!==u&&iA(m,cA,u,{name:o}),oA[e]=u,l},uA=WB,CA=function(t){RW[fW][t]=!0},bA=YW,pA=VX,yA=IA,ZA="Array Iterator",JA=pA.set,GA=pA.getterFor(ZA),VA=yA(Array,"Array",(function(t,e){JA(this,{type:ZA,target:uA(t),index:0,kind:e})}),(function(){var t=GA(this),e=t.target,n=t.kind,i=t.index++;return!e||i>=e.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:i,done:!1}:"values"==n?{value:e[i],done:!1}:{value:[i,e[i]],done:!1}}),"values");bA.Arguments=bA.Array,CA("keys"),CA("values"),CA("entries");var SA={exports:{}},BA=zt("iterator"),XA=!1;try{var vA=0,fA={next:function(){return{done:!!vA++}},return:function(){XA=!0}};fA[BA]=function(){return this},Array.from(fA,(function(){throw 2}))}catch(t){}var RA,WA,AA,wA=function(t,e){if(!e&&!XA)return!1;var n=!1;try{var i={};i[BA]=function(){return{next:function(){return{done:n=!0}}}},t(i)}catch(t){}return n},YA=Fv,kA=o,FA=d,HA=v,xA=R,NA=y,TA=qR,MA=mt,UA=KB,KA=EB.exports,EA=X.f,LA=z,DA=lf,QA=Cf,zA=zt,PA=Ht,_A=FA.Int8Array,OA=_A&&_A.prototype,jA=FA.Uint8ClampedArray,qA=jA&&jA.prototype,$A=_A&&DA(_A),tw=OA&&DA(OA),ew=Object.prototype,nw=FA.TypeError,iw=zA("toStringTag"),ow=PA("TYPED_ARRAY_TAG"),sw=PA("TYPED_ARRAY_CONSTRUCTOR"),rw=YA&&!!QA&&"Opera"!==TA(FA.opera),aw=!1,lw={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},cw={BigInt64Array:8,BigUint64Array:8},gw=function(t){if(!xA(t))return!1;var e=TA(t);return NA(lw,e)||NA(cw,e)};for(RA in lw)(AA=(WA=FA[RA])&&WA.prototype)?UA(AA,sw,WA):rw=!1;for(RA in cw)(AA=(WA=FA[RA])&&WA.prototype)&&UA(AA,sw,WA);if((!rw||!HA($A)||$A===Function.prototype)&&($A=function(){throw nw("Incorrect invocation")},rw))for(RA in lw)FA[RA]&&QA(FA[RA],$A);if((!rw||!tw||tw===ew)&&(tw=$A.prototype,rw))for(RA in lw)FA[RA]&&QA(FA[RA].prototype,tw);if(rw&&DA(qA)!==tw&&QA(qA,tw),kA&&!NA(tw,iw))for(RA in aw=!0,EA(tw,iw,{get:function(){return xA(this)?this[ow]:void 0}}),lw)FA[RA]&&UA(FA[RA],ow,RA);var dw={NATIVE_ARRAY_BUFFER_VIEWS:rw,TYPED_ARRAY_CONSTRUCTOR:sw,TYPED_ARRAY_TAG:aw&&ow,aTypedArray:function(t){if(gw(t))return t;throw nw("Target is not a typed array")},aTypedArrayConstructor:function(t){if(HA(t)&&(!QA||LA($A,t)))return t;throw nw(MA(t)+" is not a typed array constructor")},exportTypedArrayMethod:function(t,e,n){if(kA){if(n)for(var i in lw){var o=FA[i];if(o&&NA(o.prototype,t))try{delete o.prototype[t]}catch(t){}}tw[t]&&!n||KA(tw,t,n?e:rw&&OA[t]||e)}},exportTypedArrayStaticMethod:function(t,e,n){var i,o;if(kA){if(QA){if(n)for(i in lw)if((o=FA[i])&&NA(o,t))try{delete o[t]}catch(t){}if($A[t]&&!n)return;try{return KA($A,t,n?e:rw&&$A[t]||e)}catch(t){}}for(i in lw)!(o=FA[i])||o[t]&&!n||KA(o,t,e)}},isView:function(t){if(!xA(t))return!1;var e=TA(t);return"DataView"===e||NA(lw,e)||NA(cw,e)},isTypedArray:gw,TypedArray:$A,TypedArrayPrototype:tw},hw=d,mw=i,Iw=wA,uw=dw.NATIVE_ARRAY_BUFFER_VIEWS,Cw=hw.ArrayBuffer,bw=hw.Int8Array,pw=!uw||!mw((function(){bw(1)}))||!mw((function(){new bw(-1)}))||!Iw((function(t){new bw,new bw(null),new bw(1.5),new bw(t)}),!0)||mw((function(){return 1!==new bw(new Cw(2),1,void 0).length})),yw=R,Zw=Math.floor,Jw=Number.isInteger||function(t){return!yw(t)&&isFinite(t)&&Zw(t)===t},Gw=xX,Vw=d.RangeError,Sw=function(t){var e=Gw(t);if(e<0)throw Vw("The argument can't be less than 0");return e},Bw=d.RangeError,Xw=function(t,e){var n=Sw(t);if(n%e)throw Bw("Wrong offset");return n},vw=bt,fw=c(c.bind),Rw=function(t,e){return vw(t),void 0===e?t:fw?fw(t,e):function(){return t.apply(e,arguments)}},Ww=c,Aw=i,ww=v,Yw=qR,kw=OB,Fw=function(){},Hw=[],xw=Q("Reflect","construct"),Nw=/^\s*(?:class|function)\b/,Tw=Ww(Nw.exec),Mw=!Nw.exec(Fw),Uw=function(t){if(!ww(t))return!1;try{return xw(Fw,Hw,t),!0}catch(t){return!1}},Kw=!xw||Aw((function(){var t;return Uw(Uw.call)||!Uw(Object)||!Uw((function(){t=!0}))||t}))?function(t){if(!ww(t))return!1;switch(Yw(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}return Mw||!!Tw(Nw,kw(t))}:Uw,Ew=Kw,Lw=mt,Dw=d.TypeError,Qw=function(t){if(Ew(t))return t;throw Dw(Lw(t)+" is not a constructor")},zw=qR,Pw=yt,_w=YW,Ow=zt("iterator"),jw=function(t){if(null!=t)return Pw(t,Ow)||Pw(t,"@@iterator")||_w[zw(t)]},qw=K,$w=bt,tY=M,eY=mt,nY=jw,iY=d.TypeError,oY=function(t,e){var n=arguments.length<2?nY(t):e;if($w(n))return tY(qw(n,t));throw iY(eY(t)+" is not iterable")},sY=YW,rY=zt("iterator"),aY=Array.prototype,lY=function(t){return void 0!==t&&(sY.Array===t||aY[rY]===t)},cY=Rw,gY=K,dY=Qw,hY=C,mY=QX,IY=oY,uY=jw,CY=lY,bY=dw.aTypedArrayConstructor,pY=JB,yY=d,ZY=Array.isArray||function(t){return"Array"==pY(t)},JY=Kw,GY=R,VY=zt("species"),SY=yY.Array,BY=function(t){var e;return ZY(t)&&(e=t.constructor,(JY(e)&&(e===SY||ZY(e.prototype))||GY(e)&&null===(e=e[VY]))&&(e=void 0)),void 0===e?SY:e},XY=function(t,e){return new(BY(t))(0===e?0:e)},vY=Rw,fY=vB,RY=C,WY=QX,AY=XY,wY=c([].push),YY=function(t){var e=1==t,n=2==t,i=3==t,o=4==t,s=6==t,r=7==t,a=5==t||s;return function(l,c,g,d){for(var h,m,I=RY(l),u=fY(I),C=vY(c,g),b=WY(u),p=0,y=d||AY,Z=e?y(l,b):n||r?y(l,0):void 0;b>p;p++)if((a||p in u)&&(m=C(h=u[p],p,I),t))if(e)Z[p]=m;else if(m)switch(t){case 3:return!0;case 5:return h;case 6:return p;case 2:wY(Z,h)}else switch(t){case 4:return!1;case 7:wY(Z,h)}return s?-1:i||o?o:Z}},kY={forEach:YY(0),map:YY(1),filter:YY(2),some:YY(3),every:YY(4),find:YY(5),findIndex:YY(6),filterReject:YY(7)},FY=v,HY=R,xY=Cf,NY=kv,TY=d,MY=K,UY=o,KY=pw,EY=dw,LY=kR,DY=Mv,QY=bB,zY=KB,PY=Jw,_Y=LX,OY=Lv,jY=Xw,qY=oe,$Y=y,tk=qR,ek=R,nk=dt,ik=BW,ok=z,sk=Cf,rk=kX.f,ak=function(t){var e,n,i,o,s,r,a=dY(this),l=hY(t),c=arguments.length,g=c>1?arguments[1]:void 0,d=void 0!==g,h=uY(l);if(h&&!CY(h))for(r=(s=IY(l,h)).next,l=[];!(o=gY(r,s)).done;)l.push(o.value);for(d&&c>2&&(g=cY(g,arguments[2])),n=mY(l),i=new(bY(a))(n),e=0;n>e;e++)i[e]=d?g(l[e],e):l[e];return i},lk=kY.forEach,ck=TR,gk=X,dk=hB,hk=function(t,e,n){var i,o;return xY&&FY(i=e.constructor)&&i!==n&&HY(o=i.prototype)&&o!==n.prototype&&xY(t,o),t},mk=VX.get,Ik=VX.set,uk=gk.f,Ck=dk.f,bk=Math.round,pk=TY.RangeError,yk=LY.ArrayBuffer,Zk=yk.prototype,Jk=LY.DataView,Gk=EY.NATIVE_ARRAY_BUFFER_VIEWS,Vk=EY.TYPED_ARRAY_CONSTRUCTOR,Sk=EY.TYPED_ARRAY_TAG,Bk=EY.TypedArray,Xk=EY.TypedArrayPrototype,vk=EY.aTypedArrayConstructor,fk=EY.isTypedArray,Rk="BYTES_PER_ELEMENT",Wk="Wrong length",Ak=function(t,e){vk(t);for(var n=0,i=e.length,o=new t(i);i>n;)o[n]=e[n++];return o},wk=function(t,e){uk(t,e,{get:function(){return mk(this)[e]}})},Yk=function(t){var e;return ok(Zk,t)||"ArrayBuffer"==(e=tk(t))||"SharedArrayBuffer"==e},kk=function(t,e){return fk(t)&&!nk(e)&&e in t&&PY(+e)&&e>=0},Fk=function(t,e){return e=qY(e),kk(t,e)?QY(2,t[e]):Ck(t,e)},Hk=function(t,e,n){return e=qY(e),!(kk(t,e)&&ek(n)&&$Y(n,"value"))||$Y(n,"get")||$Y(n,"set")||n.configurable||$Y(n,"writable")&&!n.writable||$Y(n,"enumerable")&&!n.enumerable?uk(t,e,n):(t[e]=n.value,t)};UY?(Gk||(dk.f=Fk,gk.f=Hk,wk(Xk,"buffer"),wk(Xk,"byteOffset"),wk(Xk,"byteLength"),wk(Xk,"length")),NY({target:"Object",stat:!0,forced:!Gk},{getOwnPropertyDescriptor:Fk,defineProperty:Hk}),SA.exports=function(t,e,n){var i=t.match(/\d+$/)[0]/8,o=t+(n?"Clamped":"")+"Array",s="get"+t,r="set"+t,a=TY[o],l=a,c=l&&l.prototype,g={},d=function(t,e){uk(t,e,{get:function(){return function(t,e){var n=mk(t);return n.view[s](e*i+n.byteOffset,!0)}(this,e)},set:function(t){return function(t,e,o){var s=mk(t);n&&(o=(o=bk(o))<0?0:o>255?255:255&o),s.view[r](e*i+s.byteOffset,o,!0)}(this,e,t)},enumerable:!0})};Gk?KY&&(l=e((function(t,e,n,o){return DY(t,c),hk(ek(e)?Yk(e)?void 0!==o?new a(e,jY(n,i),o):void 0!==n?new a(e,jY(n,i)):new a(e):fk(e)?Ak(l,e):MY(ak,l,e):new a(OY(e)),t,l)})),sk&&sk(l,Bk),lk(rk(a),(function(t){t in l||zY(l,t,a[t])})),l.prototype=c):(l=e((function(t,e,n,o){DY(t,c);var s,r,a,g=0,h=0;if(ek(e)){if(!Yk(e))return fk(e)?Ak(l,e):MY(ak,l,e);s=e,h=jY(n,i);var m=e.byteLength;if(void 0===o){if(m%i)throw pk(Wk);if((r=m-h)<0)throw pk(Wk)}else if((r=_Y(o)*i)+h>m)throw pk(Wk);a=r/i}else a=OY(e),s=new yk(r=a*i);for(Ik(t,{buffer:s,byteOffset:h,byteLength:r,length:a,view:new Jk(s)});g<a;)d(t,g++)})),sk&&sk(l,Bk),c=l.prototype=ik(Xk)),c.constructor!==l&&zY(c,"constructor",l),zY(c,Vk,l),Sk&&zY(c,Sk,o),g[o]=l,NY({global:!0,forced:l!=a,sham:!Gk},g),Rk in l||zY(l,Rk,i),Rk in c||zY(c,Rk,i),ck(o)}):SA.exports=function(){},(0,SA.exports)("Float32",(function(t){return function(e,n,i){return t(this,e,n,i)}}));var xk=QX,Nk=xX,Tk=dw.aTypedArray;(0,dw.exportTypedArrayMethod)("at",(function(t){var e=Tk(this),n=xk(e),i=Nk(t),o=i>=0?i:n+i;return o<0||o>=n?void 0:e[o]}));var Mk=C,Uk=UX,Kk=QX,Ek=Math.min,Lk=[].copyWithin||function(t,e){var n=Mk(this),i=Kk(n),o=Uk(t,i),s=Uk(e,i),r=arguments.length>2?arguments[2]:void 0,a=Ek((void 0===r?i:Uk(r,i))-s,i-o),l=1;for(s<o&&o<s+a&&(l=-1,s+=a-1,o+=a-1);a-- >0;)s in n?n[o]=n[s]:delete n[o],o+=l,s+=l;return n},Dk=dw,Qk=c(Lk),zk=Dk.aTypedArray;(0,Dk.exportTypedArrayMethod)("copyWithin",(function(t,e){return Qk(zk(this),t,e,arguments.length>2?arguments[2]:void 0)}));var Pk=kY.every,_k=dw.aTypedArray;(0,dw.exportTypedArrayMethod)("every",(function(t){return Pk(_k(this),t,arguments.length>1?arguments[1]:void 0)}));var Ok=K,jk=Zf,qk=dw.aTypedArray;(0,dw.exportTypedArrayMethod)("fill",(function(t){var e=arguments.length;return Ok(jk,qk(this),t,e>1?arguments[1]:void 0,e>2?arguments[2]:void 0)}));var $k=M,tF=Qw,eF=zt("species"),nF=function(t,e){var n,i=$k(t).constructor;return void 0===i||null==(n=$k(i)[eF])?e:tF(n)},iF=nF,oF=dw.TYPED_ARRAY_CONSTRUCTOR,sF=dw.aTypedArrayConstructor,rF=function(t){return sF(iF(t,t[oF]))},aF=function(t,e){for(var n=0,i=e.length,o=new t(i);i>n;)o[n]=e[n++];return o},lF=rF,cF=function(t,e){return aF(lF(t),e)},gF=kY.filter,dF=cF,hF=dw.aTypedArray;(0,dw.exportTypedArrayMethod)("filter",(function(t){var e=gF(hF(this),t,arguments.length>1?arguments[1]:void 0);return dF(this,e)}));var mF=kY.find,IF=dw.aTypedArray;(0,dw.exportTypedArrayMethod)("find",(function(t){return mF(IF(this),t,arguments.length>1?arguments[1]:void 0)}));var uF=kY.findIndex,CF=dw.aTypedArray;(0,dw.exportTypedArrayMethod)("findIndex",(function(t){return uF(CF(this),t,arguments.length>1?arguments[1]:void 0)}));var bF=kY.forEach,pF=dw.aTypedArray;(0,dw.exportTypedArrayMethod)("forEach",(function(t){bF(pF(this),t,arguments.length>1?arguments[1]:void 0)}));var yF=jX.includes,ZF=dw.aTypedArray;(0,dw.exportTypedArrayMethod)("includes",(function(t){return yF(ZF(this),t,arguments.length>1?arguments[1]:void 0)}));var JF=jX.indexOf,GF=dw.aTypedArray;(0,dw.exportTypedArrayMethod)("indexOf",(function(t){return JF(GF(this),t,arguments.length>1?arguments[1]:void 0)}));var VF=d,SF=c,BF=B.PROPER,XF=dw,vF=VA,fF=zt("iterator"),RF=VF.Uint8Array,WF=SF(vF.values),AF=SF(vF.keys),wF=SF(vF.entries),YF=XF.aTypedArray,kF=XF.exportTypedArrayMethod,FF=RF&&RF.prototype[fF],HF=!!FF&&"values"===FF.name,xF=function(){return WF(YF(this))};kF("entries",(function(){return wF(YF(this))})),kF("keys",(function(){return AF(YF(this))})),kF("values",xF,BF&&!HF),kF(fF,xF,BF&&!HF);var NF=dw.aTypedArray,TF=dw.exportTypedArrayMethod,MF=c([].join);TF("join",(function(t){return MF(NF(this),t)}));var UF=Function.prototype,KF=UF.apply,EF=UF.bind,LF=UF.call,DF="object"==typeof Reflect&&Reflect.apply||(EF?LF.bind(KF):function(){return LF.apply(KF,arguments)}),QF=i,zF=DF,PF=WB,_F=xX,OF=QX,jF=function(t,e){var n=[][t];return!!n&&QF((function(){n.call(null,e||function(){throw 1},1)}))},qF=Math.min,$F=[].lastIndexOf,tH=!!$F&&1/[1].lastIndexOf(1,-0)<0,eH=jF("lastIndexOf"),nH=tH||!eH?function(t){if(tH)return zF($F,this,arguments)||0;var e=PF(this),n=OF(e),i=n-1;for(arguments.length>1&&(i=qF(i,_F(arguments[1]))),i<0&&(i=n+i);i>=0;i--)if(i in e&&e[i]===t)return i||0;return-1}:$F,iH=DF,oH=nH,sH=dw.aTypedArray;(0,dw.exportTypedArrayMethod)("lastIndexOf",(function(t){var e=arguments.length;return iH(oH,sH(this),e>1?[t,arguments[1]]:[t])}));var rH=kY.map,aH=rF,lH=dw.aTypedArray;(0,dw.exportTypedArrayMethod)("map",(function(t){return rH(lH(this),t,arguments.length>1?arguments[1]:void 0,(function(t,e){return new(aH(t))(e)}))}));var cH=bt,gH=C,dH=vB,hH=QX,mH=d.TypeError,IH=function(t){return function(e,n,i,o){cH(n);var s=gH(e),r=dH(s),a=hH(s),l=t?a-1:0,c=t?-1:1;if(i<2)for(;;){if(l in r){o=r[l],l+=c;break}if(l+=c,t?l<0:a<=l)throw mH("Reduce of empty array with no initial value")}for(;t?l>=0:a>l;l+=c)l in r&&(o=n(o,r[l],l,s));return o}},uH={left:IH(!1),right:IH(!0)},CH=uH.left,bH=dw.aTypedArray;(0,dw.exportTypedArrayMethod)("reduce",(function(t){var e=arguments.length;return CH(bH(this),t,e,e>1?arguments[1]:void 0)}));var pH=uH.right,yH=dw.aTypedArray;(0,dw.exportTypedArrayMethod)("reduceRight",(function(t){var e=arguments.length;return pH(yH(this),t,e,e>1?arguments[1]:void 0)}));var ZH=dw.aTypedArray,JH=dw.exportTypedArrayMethod,GH=Math.floor;JH("reverse",(function(){for(var t,e=this,n=ZH(e).length,i=GH(n/2),o=0;o<i;)t=e[o],e[o++]=e[--n],e[n]=t;return e}));var VH=dw,SH=QX,BH=Xw,XH=C,vH=i,fH=d.RangeError,RH=VH.aTypedArray;(0,VH.exportTypedArrayMethod)("set",(function(t){RH(this);var e=BH(arguments.length>1?arguments[1]:void 0,1),n=this.length,i=XH(t),o=SH(i),s=0;if(o+e>n)throw fH("Wrong length");for(;s<o;)this[e+s]=i[s++]}),vH((function(){new Int8Array(1).set({})})));var WH=c([].slice),AH=rF,wH=WH,YH=dw.aTypedArray;(0,dw.exportTypedArrayMethod)("slice",(function(t,e){for(var n=wH(YH(this),t,e),i=AH(this),o=0,s=n.length,r=new i(s);s>o;)r[o]=n[o++];return r}),i((function(){new Int8Array(1).slice()})));var kH=kY.some,FH=dw.aTypedArray;(0,dw.exportTypedArrayMethod)("some",(function(t){return kH(FH(this),t,arguments.length>1?arguments[1]:void 0)}));var HH=Rf,xH=Math.floor,NH=function(t,e){var n=t.length,i=xH(n/2);return n<8?TH(t,e):MH(t,NH(HH(t,0,i),e),NH(HH(t,i),e),e)},TH=function(t,e){for(var n,i,o=t.length,s=1;s<o;){for(i=s,n=t[s];i&&e(t[i-1],n)>0;)t[i]=t[--i];i!==s++&&(t[i]=n)}return t},MH=function(t,e,n,i){for(var o=e.length,s=n.length,r=0,a=0;r<o||a<s;)t[r+a]=r<o&&a<s?i(e[r],n[a])<=0?e[r++]:n[a++]:r<o?e[r++]:n[a++];return t},UH=NH,KH=P.match(/firefox\/(\d+)/i),EH=!!KH&&+KH[1],LH=/MSIE|Trident/.test(P),DH=P.match(/AppleWebKit\/(\d+)\./),QH=!!DH&&+DH[1],zH=d,PH=c,_H=i,OH=bt,jH=UH,qH=dw,$H=EH,tx=LH,ex=et,nx=QH,ix=zH.Array,ox=qH.aTypedArray,sx=qH.exportTypedArrayMethod,rx=zH.Uint16Array,ax=rx&&PH(rx.prototype.sort),lx=!(!ax||_H((function(){ax(new rx(2),null)}))&&_H((function(){ax(new rx(2),{})}))),cx=!!ax&&!_H((function(){if(ex)return ex<74;if($H)return $H<67;if(tx)return!0;if(nx)return nx<602;var t,e,n=new rx(516),i=ix(516);for(t=0;t<516;t++)e=t%4,n[t]=515-t,i[t]=t-2*e+3;for(ax(n,(function(t,e){return(t/4|0)-(e/4|0)})),t=0;t<516;t++)if(n[t]!==i[t])return!0}));sx("sort",(function(t){return void 0!==t&&OH(t),cx?ax(this,t):jH(ox(this),function(t){return function(e,n){return void 0!==t?+t(e,n)||0:n!=n?-1:e!=e?1:0===e&&0===n?1/e>0&&1/n<0?1:-1:e>n}}(t))}),!cx||lx);var gx=LX,dx=UX,hx=rF,mx=dw.aTypedArray;(0,dw.exportTypedArrayMethod)("subarray",(function(t,e){var n=mx(this),i=n.length,o=dx(t,i);return new(hx(n))(n.buffer,n.byteOffset+o*n.BYTES_PER_ELEMENT,gx((void 0===e?i:dx(e,i))-o))}));var Ix=DF,ux=dw,Cx=i,bx=WH,px=d.Int8Array,yx=ux.aTypedArray,Zx=ux.exportTypedArrayMethod,Jx=[].toLocaleString,Gx=!!px&&Cx((function(){Jx.call(new px(1))}));Zx("toLocaleString",(function(){return Ix(Jx,Gx?bx(yx(this)):yx(this),bx(arguments))}),Cx((function(){return[1,2].toLocaleString()!=new px([1,2]).toLocaleString()}))||!Cx((function(){px.prototype.toLocaleString.call([1,2])})));var Vx=dw.exportTypedArrayMethod,Sx=i,Bx=c,Xx=d.Uint8Array,vx=Xx&&Xx.prototype||{},fx=[].toString,Rx=Bx([].join);Sx((function(){fx.call({})}))&&(fx=function(){return Rx(this)});var Wx=vx.toString!=fx;Vx("toString",fx,Wx);var Ax=Rw,wx=vB,Yx=C,kx=QX,Fx=function(t){var e=1==t;return function(n,i,o){for(var s,r=Yx(n),a=wx(r),l=Ax(i,o),c=kx(a);c-- >0;)if(l(s=a[c],c,r))switch(t){case 0:return s;case 1:return c}return e?-1:void 0}},Hx={findLast:Fx(0),findLastIndex:Fx(1)},xx=Hx.findLast,Nx=dw.aTypedArray;(0,dw.exportTypedArrayMethod)("findLast",(function(t){return xx(Nx(this),t,arguments.length>1?arguments[1]:void 0)}));var Tx=Hx.findLastIndex,Mx=dw.aTypedArray;(0,dw.exportTypedArrayMethod)("findLastIndex",(function(t){return Tx(Mx(this),t,arguments.length>1?arguments[1]:void 0)}));var Ux=c,Kx=bt,Ex=QX,Lx=C,Dx=XY,Qx=Q("Map"),zx=Qx.prototype,Px=Ux(zx.forEach),_x=Ux(zx.has),Ox=Ux(zx.set),jx=Ux([].push),qx=function(t){var e,n,i,o=Lx(this),s=Ex(o),r=Dx(o,0),a=new Qx,l=null!=t?Kx(t):function(t){return t};for(e=0;e<s;e++)i=l(n=o[e]),_x(a,i)||Ox(a,i,n);return Px(a,(function(t){jx(r,t)})),r},$x=cF,tN=dw.aTypedArray,eN=dw.exportTypedArrayMethod,nN=c(qx);function iN(t,e,n){var i=void 0===e?null:e,o=function(t,e){var n=atob(t);if(e){for(var i=new Uint8Array(n.length),o=0,s=n.length;o<s;++o)i[o]=n.charCodeAt(o);return String.fromCharCode.apply(null,new Uint16Array(i.buffer))}return n}(t,void 0!==n&&n),s=o.indexOf("\n",10)+1,r=o.substring(s)+(i?"//# sourceMappingURL="+i:""),a=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(a)}function oN(t,e,n){var i;return function(o){return i=i||iN(t,e,n),new Worker(i,o)}}eN("uniqueBy",(function(t){return $x(this,nN(tN(this),t))}));var sN=oN("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewoJJ3VzZSBzdHJpY3QnOwoKCXZhciBjb21tb25qc0dsb2JhbCA9IHR5cGVvZiBnbG9iYWxUaGlzICE9PSAndW5kZWZpbmVkJyA/IGdsb2JhbFRoaXMgOiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnID8gZ2xvYmFsIDogdHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnID8gc2VsZiA6IHt9OwoKCXZhciBjaGVjayA9IGZ1bmN0aW9uIChpdCkgewoJICByZXR1cm4gaXQgJiYgaXQuTWF0aCA9PSBNYXRoICYmIGl0OwoJfTsKCgkvLyBodHRwczovL2dpdGh1Yi5jb20vemxvaXJvY2svY29yZS1qcy9pc3N1ZXMvODYjaXNzdWVjb21tZW50LTExNTc1OTAyOAoJdmFyIGdsb2JhbCRJID0KCSAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGVzL25vLWdsb2JhbC10aGlzIC0tIHNhZmUKCSAgY2hlY2sodHlwZW9mIGdsb2JhbFRoaXMgPT0gJ29iamVjdCcgJiYgZ2xvYmFsVGhpcykgfHwKCSAgY2hlY2sodHlwZW9mIHdpbmRvdyA9PSAnb2JqZWN0JyAmJiB3aW5kb3cpIHx8CgkgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1yZXN0cmljdGVkLWdsb2JhbHMgLS0gc2FmZQoJICBjaGVjayh0eXBlb2Ygc2VsZiA9PSAnb2JqZWN0JyAmJiBzZWxmKSB8fAoJICBjaGVjayh0eXBlb2YgY29tbW9uanNHbG9iYWwgPT0gJ29iamVjdCcgJiYgY29tbW9uanNHbG9iYWwpIHx8CgkgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1uZXctZnVuYyAtLSBmYWxsYmFjawoJICAoZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpczsgfSkoKSB8fCBGdW5jdGlvbigncmV0dXJuIHRoaXMnKSgpOwoKCXZhciBGdW5jdGlvblByb3RvdHlwZSQyID0gRnVuY3Rpb24ucHJvdG90eXBlOwoJdmFyIGJpbmQkNSA9IEZ1bmN0aW9uUHJvdG90eXBlJDIuYmluZDsKCXZhciBjYWxsJGEgPSBGdW5jdGlvblByb3RvdHlwZSQyLmNhbGw7Cgl2YXIgY2FsbEJpbmQgPSBiaW5kJDUgJiYgYmluZCQ1LmJpbmQoY2FsbCRhKTsKCgl2YXIgZnVuY3Rpb25VbmN1cnJ5VGhpcyA9IGJpbmQkNSA/IGZ1bmN0aW9uIChmbikgewoJICByZXR1cm4gZm4gJiYgY2FsbEJpbmQoY2FsbCRhLCBmbik7Cgl9IDogZnVuY3Rpb24gKGZuKSB7CgkgIHJldHVybiBmbiAmJiBmdW5jdGlvbiAoKSB7CgkgICAgcmV0dXJuIGNhbGwkYS5hcHBseShmbiwgYXJndW1lbnRzKTsKCSAgfTsKCX07CgoJdmFyIGZhaWxzJGcgPSBmdW5jdGlvbiAoZXhlYykgewoJICB0cnkgewoJICAgIHJldHVybiAhIWV4ZWMoKTsKCSAgfSBjYXRjaCAoZXJyb3IpIHsKCSAgICByZXR1cm4gdHJ1ZTsKCSAgfQoJfTsKCgl2YXIgdW5jdXJyeVRoaXMkbCA9IGZ1bmN0aW9uVW5jdXJyeVRoaXM7CgoJdmFyIHRvU3RyaW5nJDIgPSB1bmN1cnJ5VGhpcyRsKHt9LnRvU3RyaW5nKTsKCXZhciBzdHJpbmdTbGljZSA9IHVuY3VycnlUaGlzJGwoJycuc2xpY2UpOwoKCXZhciBjbGFzc29mUmF3JDEgPSBmdW5jdGlvbiAoaXQpIHsKCSAgcmV0dXJuIHN0cmluZ1NsaWNlKHRvU3RyaW5nJDIoaXQpLCA4LCAtMSk7Cgl9OwoKCXZhciBnbG9iYWwkSCA9IGdsb2JhbCRJOwoJdmFyIHVuY3VycnlUaGlzJGsgPSBmdW5jdGlvblVuY3VycnlUaGlzOwoJdmFyIGZhaWxzJGYgPSBmYWlscyRnOwoJdmFyIGNsYXNzb2YkNyA9IGNsYXNzb2ZSYXckMTsKCgl2YXIgT2JqZWN0JDUgPSBnbG9iYWwkSC5PYmplY3Q7Cgl2YXIgc3BsaXQgPSB1bmN1cnJ5VGhpcyRrKCcnLnNwbGl0KTsKCgkvLyBmYWxsYmFjayBmb3Igbm9uLWFycmF5LWxpa2UgRVMzIGFuZCBub24tZW51bWVyYWJsZSBvbGQgVjggc3RyaW5ncwoJdmFyIGluZGV4ZWRPYmplY3QgPSBmYWlscyRmKGZ1bmN0aW9uICgpIHsKCSAgLy8gdGhyb3dzIGFuIGVycm9yIGluIHJoaW5vLCBzZWUgaHR0cHM6Ly9naXRodWIuY29tL21vemlsbGEvcmhpbm8vaXNzdWVzLzM0NgoJICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcHJvdG90eXBlLWJ1aWx0aW5zIC0tIHNhZmUKCSAgcmV0dXJuICFPYmplY3QkNSgneicpLnByb3BlcnR5SXNFbnVtZXJhYmxlKDApOwoJfSkgPyBmdW5jdGlvbiAoaXQpIHsKCSAgcmV0dXJuIGNsYXNzb2YkNyhpdCkgPT0gJ1N0cmluZycgPyBzcGxpdChpdCwgJycpIDogT2JqZWN0JDUoaXQpOwoJfSA6IE9iamVjdCQ1OwoKCXZhciBnbG9iYWwkRyA9IGdsb2JhbCRJOwoKCXZhciBUeXBlRXJyb3IkYyA9IGdsb2JhbCRHLlR5cGVFcnJvcjsKCgkvLyBgUmVxdWlyZU9iamVjdENvZXJjaWJsZWAgYWJzdHJhY3Qgb3BlcmF0aW9uCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLXJlcXVpcmVvYmplY3Rjb2VyY2libGUKCXZhciByZXF1aXJlT2JqZWN0Q29lcmNpYmxlJDIgPSBmdW5jdGlvbiAoaXQpIHsKCSAgaWYgKGl0ID09IHVuZGVmaW5lZCkgdGhyb3cgVHlwZUVycm9yJGMoIkNhbid0IGNhbGwgbWV0aG9kIG9uICIgKyBpdCk7CgkgIHJldHVybiBpdDsKCX07CgoJLy8gdG9PYmplY3Qgd2l0aCBmYWxsYmFjayBmb3Igbm9uLWFycmF5LWxpa2UgRVMzIHN0cmluZ3MKCXZhciBJbmRleGVkT2JqZWN0JDMgPSBpbmRleGVkT2JqZWN0OwoJdmFyIHJlcXVpcmVPYmplY3RDb2VyY2libGUkMSA9IHJlcXVpcmVPYmplY3RDb2VyY2libGUkMjsKCgl2YXIgdG9JbmRleGVkT2JqZWN0JDYgPSBmdW5jdGlvbiAoaXQpIHsKCSAgcmV0dXJuIEluZGV4ZWRPYmplY3QkMyhyZXF1aXJlT2JqZWN0Q29lcmNpYmxlJDEoaXQpKTsKCX07CgoJdmFyIHNoYXJlZCQzID0ge2V4cG9ydHM6IHt9fTsKCgl2YXIgZ2xvYmFsJEYgPSBnbG9iYWwkSTsKCgkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZXMvbm8tb2JqZWN0LWRlZmluZXByb3BlcnR5IC0tIHNhZmUKCXZhciBkZWZpbmVQcm9wZXJ0eSQzID0gT2JqZWN0LmRlZmluZVByb3BlcnR5OwoKCXZhciBzZXRHbG9iYWwkMyA9IGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CgkgIHRyeSB7CgkgICAgZGVmaW5lUHJvcGVydHkkMyhnbG9iYWwkRiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTsKCSAgfSBjYXRjaCAoZXJyb3IpIHsKCSAgICBnbG9iYWwkRltrZXldID0gdmFsdWU7CgkgIH0gcmV0dXJuIHZhbHVlOwoJfTsKCgl2YXIgZ2xvYmFsJEUgPSBnbG9iYWwkSTsKCXZhciBzZXRHbG9iYWwkMiA9IHNldEdsb2JhbCQzOwoKCXZhciBTSEFSRUQgPSAnX19jb3JlLWpzX3NoYXJlZF9fJzsKCXZhciBzdG9yZSQzID0gZ2xvYmFsJEVbU0hBUkVEXSB8fCBzZXRHbG9iYWwkMihTSEFSRUQsIHt9KTsKCgl2YXIgc2hhcmVkU3RvcmUgPSBzdG9yZSQzOwoKCXZhciBzdG9yZSQyID0gc2hhcmVkU3RvcmU7CgoJKHNoYXJlZCQzLmV4cG9ydHMgPSBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkgewoJICByZXR1cm4gc3RvcmUkMltrZXldIHx8IChzdG9yZSQyW2tleV0gPSB2YWx1ZSAhPT0gdW5kZWZpbmVkID8gdmFsdWUgOiB7fSk7Cgl9KSgndmVyc2lvbnMnLCBbXSkucHVzaCh7CgkgIHZlcnNpb246ICczLjE5LjInLAoJICBtb2RlOiAnZ2xvYmFsJywKCSAgY29weXJpZ2h0OiAnwqkgMjAyMSBEZW5pcyBQdXNoa2FyZXYgKHpsb2lyb2NrLnJ1KScKCX0pOwoKCXZhciBnbG9iYWwkRCA9IGdsb2JhbCRJOwoJdmFyIHJlcXVpcmVPYmplY3RDb2VyY2libGUgPSByZXF1aXJlT2JqZWN0Q29lcmNpYmxlJDI7CgoJdmFyIE9iamVjdCQ0ID0gZ2xvYmFsJEQuT2JqZWN0OwoKCS8vIGBUb09iamVjdGAgYWJzdHJhY3Qgb3BlcmF0aW9uCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLXRvb2JqZWN0Cgl2YXIgdG9PYmplY3QkYSA9IGZ1bmN0aW9uIChhcmd1bWVudCkgewoJICByZXR1cm4gT2JqZWN0JDQocmVxdWlyZU9iamVjdENvZXJjaWJsZShhcmd1bWVudCkpOwoJfTsKCgl2YXIgdW5jdXJyeVRoaXMkaiA9IGZ1bmN0aW9uVW5jdXJyeVRoaXM7Cgl2YXIgdG9PYmplY3QkOSA9IHRvT2JqZWN0JGE7CgoJdmFyIGhhc093blByb3BlcnR5ID0gdW5jdXJyeVRoaXMkaih7fS5oYXNPd25Qcm9wZXJ0eSk7CgoJLy8gYEhhc093blByb3BlcnR5YCBhYnN0cmFjdCBvcGVyYXRpb24KCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtaGFzb3ducHJvcGVydHkKCXZhciBoYXNPd25Qcm9wZXJ0eV8xID0gT2JqZWN0Lmhhc093biB8fCBmdW5jdGlvbiBoYXNPd24oaXQsIGtleSkgewoJICByZXR1cm4gaGFzT3duUHJvcGVydHkodG9PYmplY3QkOShpdCksIGtleSk7Cgl9OwoKCXZhciB1bmN1cnJ5VGhpcyRpID0gZnVuY3Rpb25VbmN1cnJ5VGhpczsKCgl2YXIgaWQgPSAwOwoJdmFyIHBvc3RmaXggPSBNYXRoLnJhbmRvbSgpOwoJdmFyIHRvU3RyaW5nJDEgPSB1bmN1cnJ5VGhpcyRpKDEuMC50b1N0cmluZyk7CgoJdmFyIHVpZCQzID0gZnVuY3Rpb24gKGtleSkgewoJICByZXR1cm4gJ1N5bWJvbCgnICsgKGtleSA9PT0gdW5kZWZpbmVkID8gJycgOiBrZXkpICsgJylfJyArIHRvU3RyaW5nJDEoKytpZCArIHBvc3RmaXgsIDM2KTsKCX07CgoJLy8gYElzQ2FsbGFibGVgIGFic3RyYWN0IG9wZXJhdGlvbgoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1pc2NhbGxhYmxlCgl2YXIgaXNDYWxsYWJsZSRoID0gZnVuY3Rpb24gKGFyZ3VtZW50KSB7CgkgIHJldHVybiB0eXBlb2YgYXJndW1lbnQgPT0gJ2Z1bmN0aW9uJzsKCX07CgoJdmFyIGdsb2JhbCRDID0gZ2xvYmFsJEk7Cgl2YXIgaXNDYWxsYWJsZSRnID0gaXNDYWxsYWJsZSRoOwoKCXZhciBhRnVuY3Rpb24gPSBmdW5jdGlvbiAoYXJndW1lbnQpIHsKCSAgcmV0dXJuIGlzQ2FsbGFibGUkZyhhcmd1bWVudCkgPyBhcmd1bWVudCA6IHVuZGVmaW5lZDsKCX07CgoJdmFyIGdldEJ1aWx0SW4kNyA9IGZ1bmN0aW9uIChuYW1lc3BhY2UsIG1ldGhvZCkgewoJICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA8IDIgPyBhRnVuY3Rpb24oZ2xvYmFsJENbbmFtZXNwYWNlXSkgOiBnbG9iYWwkQ1tuYW1lc3BhY2VdICYmIGdsb2JhbCRDW25hbWVzcGFjZV1bbWV0aG9kXTsKCX07CgoJdmFyIGdldEJ1aWx0SW4kNiA9IGdldEJ1aWx0SW4kNzsKCgl2YXIgZW5naW5lVXNlckFnZW50ID0gZ2V0QnVpbHRJbiQ2KCduYXZpZ2F0b3InLCAndXNlckFnZW50JykgfHwgJyc7CgoJdmFyIGdsb2JhbCRCID0gZ2xvYmFsJEk7Cgl2YXIgdXNlckFnZW50JDIgPSBlbmdpbmVVc2VyQWdlbnQ7CgoJdmFyIHByb2Nlc3MgPSBnbG9iYWwkQi5wcm9jZXNzOwoJdmFyIERlbm8gPSBnbG9iYWwkQi5EZW5vOwoJdmFyIHZlcnNpb25zID0gcHJvY2VzcyAmJiBwcm9jZXNzLnZlcnNpb25zIHx8IERlbm8gJiYgRGVuby52ZXJzaW9uOwoJdmFyIHY4ID0gdmVyc2lvbnMgJiYgdmVyc2lvbnMudjg7Cgl2YXIgbWF0Y2gsIHZlcnNpb247CgoJaWYgKHY4KSB7CgkgIG1hdGNoID0gdjguc3BsaXQoJy4nKTsKCSAgLy8gaW4gb2xkIENocm9tZSwgdmVyc2lvbnMgb2YgVjggaXNuJ3QgVjggPSBDaHJvbWUgLyAxMAoJICAvLyBidXQgdGhlaXIgY29ycmVjdCB2ZXJzaW9ucyBhcmUgbm90IGludGVyZXN0aW5nIGZvciB1cwoJICB2ZXJzaW9uID0gbWF0Y2hbMF0gPiAwICYmIG1hdGNoWzBdIDwgNCA/IDEgOiArKG1hdGNoWzBdICsgbWF0Y2hbMV0pOwoJfQoKCS8vIEJyb3dzZXJGUyBOb2RlSlMgYHByb2Nlc3NgIHBvbHlmaWxsIGluY29ycmVjdGx5IHNldCBgLnY4YCB0byBgMC4wYAoJLy8gc28gY2hlY2sgYHVzZXJBZ2VudGAgZXZlbiBpZiBgLnY4YCBleGlzdHMsIGJ1dCAwCglpZiAoIXZlcnNpb24gJiYgdXNlckFnZW50JDIpIHsKCSAgbWF0Y2ggPSB1c2VyQWdlbnQkMi5tYXRjaCgvRWRnZVwvKFxkKykvKTsKCSAgaWYgKCFtYXRjaCB8fCBtYXRjaFsxXSA+PSA3NCkgewoJICAgIG1hdGNoID0gdXNlckFnZW50JDIubWF0Y2goL0Nocm9tZVwvKFxkKykvKTsKCSAgICBpZiAobWF0Y2gpIHZlcnNpb24gPSArbWF0Y2hbMV07CgkgIH0KCX0KCgl2YXIgZW5naW5lVjhWZXJzaW9uID0gdmVyc2lvbjsKCgkvKiBlc2xpbnQtZGlzYWJsZSBlcy9uby1zeW1ib2wgLS0gcmVxdWlyZWQgZm9yIHRlc3RpbmcgKi8KCgl2YXIgVjhfVkVSU0lPTiA9IGVuZ2luZVY4VmVyc2lvbjsKCXZhciBmYWlscyRlID0gZmFpbHMkZzsKCgkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZXMvbm8tb2JqZWN0LWdldG93bnByb3BlcnR5c3ltYm9scyAtLSByZXF1aXJlZCBmb3IgdGVzdGluZwoJdmFyIG5hdGl2ZVN5bWJvbCA9ICEhT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyAmJiAhZmFpbHMkZShmdW5jdGlvbiAoKSB7CgkgIHZhciBzeW1ib2wgPSBTeW1ib2woKTsKCSAgLy8gQ2hyb21lIDM4IFN5bWJvbCBoYXMgaW5jb3JyZWN0IHRvU3RyaW5nIGNvbnZlcnNpb24KCSAgLy8gYGdldC1vd24tcHJvcGVydHktc3ltYm9sc2AgcG9seWZpbGwgc3ltYm9scyBjb252ZXJ0ZWQgdG8gb2JqZWN0IGFyZSBub3QgU3ltYm9sIGluc3RhbmNlcwoJICByZXR1cm4gIVN0cmluZyhzeW1ib2wpIHx8ICEoT2JqZWN0KHN5bWJvbCkgaW5zdGFuY2VvZiBTeW1ib2wpIHx8CgkgICAgLy8gQ2hyb21lIDM4LTQwIHN5bWJvbHMgYXJlIG5vdCBpbmhlcml0ZWQgZnJvbSBET00gY29sbGVjdGlvbnMgcHJvdG90eXBlcyB0byBpbnN0YW5jZXMKCSAgICAhU3ltYm9sLnNoYW0gJiYgVjhfVkVSU0lPTiAmJiBWOF9WRVJTSU9OIDwgNDE7Cgl9KTsKCgkvKiBlc2xpbnQtZGlzYWJsZSBlcy9uby1zeW1ib2wgLS0gcmVxdWlyZWQgZm9yIHRlc3RpbmcgKi8KCgl2YXIgTkFUSVZFX1NZTUJPTCQxID0gbmF0aXZlU3ltYm9sOwoKCXZhciB1c2VTeW1ib2xBc1VpZCA9IE5BVElWRV9TWU1CT0wkMQoJICAmJiAhU3ltYm9sLnNoYW0KCSAgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PSAnc3ltYm9sJzsKCgl2YXIgZ2xvYmFsJEEgPSBnbG9iYWwkSTsKCXZhciBzaGFyZWQkMiA9IHNoYXJlZCQzLmV4cG9ydHM7Cgl2YXIgaGFzT3duJGEgPSBoYXNPd25Qcm9wZXJ0eV8xOwoJdmFyIHVpZCQyID0gdWlkJDM7Cgl2YXIgTkFUSVZFX1NZTUJPTCA9IG5hdGl2ZVN5bWJvbDsKCXZhciBVU0VfU1lNQk9MX0FTX1VJRCQxID0gdXNlU3ltYm9sQXNVaWQ7CgoJdmFyIFdlbGxLbm93blN5bWJvbHNTdG9yZSA9IHNoYXJlZCQyKCd3a3MnKTsKCXZhciBTeW1ib2wkMSA9IGdsb2JhbCRBLlN5bWJvbDsKCXZhciBzeW1ib2xGb3IgPSBTeW1ib2wkMSAmJiBTeW1ib2wkMVsnZm9yJ107Cgl2YXIgY3JlYXRlV2VsbEtub3duU3ltYm9sID0gVVNFX1NZTUJPTF9BU19VSUQkMSA/IFN5bWJvbCQxIDogU3ltYm9sJDEgJiYgU3ltYm9sJDEud2l0aG91dFNldHRlciB8fCB1aWQkMjsKCgl2YXIgd2VsbEtub3duU3ltYm9sJGYgPSBmdW5jdGlvbiAobmFtZSkgewoJICBpZiAoIWhhc093biRhKFdlbGxLbm93blN5bWJvbHNTdG9yZSwgbmFtZSkgfHwgIShOQVRJVkVfU1lNQk9MIHx8IHR5cGVvZiBXZWxsS25vd25TeW1ib2xzU3RvcmVbbmFtZV0gPT0gJ3N0cmluZycpKSB7CgkgICAgdmFyIGRlc2NyaXB0aW9uID0gJ1N5bWJvbC4nICsgbmFtZTsKCSAgICBpZiAoTkFUSVZFX1NZTUJPTCAmJiBoYXNPd24kYShTeW1ib2wkMSwgbmFtZSkpIHsKCSAgICAgIFdlbGxLbm93blN5bWJvbHNTdG9yZVtuYW1lXSA9IFN5bWJvbCQxW25hbWVdOwoJICAgIH0gZWxzZSBpZiAoVVNFX1NZTUJPTF9BU19VSUQkMSAmJiBzeW1ib2xGb3IpIHsKCSAgICAgIFdlbGxLbm93blN5bWJvbHNTdG9yZVtuYW1lXSA9IHN5bWJvbEZvcihkZXNjcmlwdGlvbik7CgkgICAgfSBlbHNlIHsKCSAgICAgIFdlbGxLbm93blN5bWJvbHNTdG9yZVtuYW1lXSA9IGNyZWF0ZVdlbGxLbm93blN5bWJvbChkZXNjcmlwdGlvbik7CgkgICAgfQoJICB9IHJldHVybiBXZWxsS25vd25TeW1ib2xzU3RvcmVbbmFtZV07Cgl9OwoKCXZhciBpc0NhbGxhYmxlJGYgPSBpc0NhbGxhYmxlJGg7CgoJdmFyIGlzT2JqZWN0JGEgPSBmdW5jdGlvbiAoaXQpIHsKCSAgcmV0dXJuIHR5cGVvZiBpdCA9PSAnb2JqZWN0JyA/IGl0ICE9PSBudWxsIDogaXNDYWxsYWJsZSRmKGl0KTsKCX07CgoJdmFyIGdsb2JhbCR6ID0gZ2xvYmFsJEk7Cgl2YXIgaXNPYmplY3QkOSA9IGlzT2JqZWN0JGE7CgoJdmFyIFN0cmluZyQzID0gZ2xvYmFsJHouU3RyaW5nOwoJdmFyIFR5cGVFcnJvciRiID0gZ2xvYmFsJHouVHlwZUVycm9yOwoKCS8vIGBBc3NlcnQ6IFR5cGUoYXJndW1lbnQpIGlzIE9iamVjdGAKCXZhciBhbk9iamVjdCQ3ID0gZnVuY3Rpb24gKGFyZ3VtZW50KSB7CgkgIGlmIChpc09iamVjdCQ5KGFyZ3VtZW50KSkgcmV0dXJuIGFyZ3VtZW50OwoJICB0aHJvdyBUeXBlRXJyb3IkYihTdHJpbmckMyhhcmd1bWVudCkgKyAnIGlzIG5vdCBhbiBvYmplY3QnKTsKCX07CgoJdmFyIGZhaWxzJGQgPSBmYWlscyRnOwoKCS8vIERldGVjdCBJRTgncyBpbmNvbXBsZXRlIGRlZmluZVByb3BlcnR5IGltcGxlbWVudGF0aW9uCgl2YXIgZGVzY3JpcHRvcnMgPSAhZmFpbHMkZChmdW5jdGlvbiAoKSB7CgkgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBlcy9uby1vYmplY3QtZGVmaW5lcHJvcGVydHkgLS0gcmVxdWlyZWQgZm9yIHRlc3RpbmcKCSAgcmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh7fSwgMSwgeyBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIDc7IH0gfSlbMV0gIT0gNzsKCX0pOwoKCXZhciBvYmplY3REZWZpbmVQcm9wZXJ0eSA9IHt9OwoKCXZhciBnbG9iYWwkeSA9IGdsb2JhbCRJOwoJdmFyIGlzT2JqZWN0JDggPSBpc09iamVjdCRhOwoKCXZhciBkb2N1bWVudCQxID0gZ2xvYmFsJHkuZG9jdW1lbnQ7CgkvLyB0eXBlb2YgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCBpcyAnb2JqZWN0JyBpbiBvbGQgSUUKCXZhciBFWElTVFMkMSA9IGlzT2JqZWN0JDgoZG9jdW1lbnQkMSkgJiYgaXNPYmplY3QkOChkb2N1bWVudCQxLmNyZWF0ZUVsZW1lbnQpOwoKCXZhciBkb2N1bWVudENyZWF0ZUVsZW1lbnQkMSA9IGZ1bmN0aW9uIChpdCkgewoJICByZXR1cm4gRVhJU1RTJDEgPyBkb2N1bWVudCQxLmNyZWF0ZUVsZW1lbnQoaXQpIDoge307Cgl9OwoKCXZhciBERVNDUklQVE9SUyQ5ID0gZGVzY3JpcHRvcnM7Cgl2YXIgZmFpbHMkYyA9IGZhaWxzJGc7Cgl2YXIgY3JlYXRlRWxlbWVudCA9IGRvY3VtZW50Q3JlYXRlRWxlbWVudCQxOwoKCS8vIFRoYW5rJ3MgSUU4IGZvciBoaXMgZnVubnkgZGVmaW5lUHJvcGVydHkKCXZhciBpZThEb21EZWZpbmUgPSAhREVTQ1JJUFRPUlMkOSAmJiAhZmFpbHMkYyhmdW5jdGlvbiAoKSB7CgkgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBlcy9uby1vYmplY3QtZGVmaW5lcHJvcGVydHkgLS0gcmVxdWllZCBmb3IgdGVzdGluZwoJICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KGNyZWF0ZUVsZW1lbnQoJ2RpdicpLCAnYScsIHsKCSAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIDc7IH0KCSAgfSkuYSAhPSA3OwoJfSk7CgoJdmFyIGNhbGwkOSA9IEZ1bmN0aW9uLnByb3RvdHlwZS5jYWxsOwoKCXZhciBmdW5jdGlvbkNhbGwgPSBjYWxsJDkuYmluZCA/IGNhbGwkOS5iaW5kKGNhbGwkOSkgOiBmdW5jdGlvbiAoKSB7CgkgIHJldHVybiBjYWxsJDkuYXBwbHkoY2FsbCQ5LCBhcmd1bWVudHMpOwoJfTsKCgl2YXIgdW5jdXJyeVRoaXMkaCA9IGZ1bmN0aW9uVW5jdXJyeVRoaXM7CgoJdmFyIG9iamVjdElzUHJvdG90eXBlT2YgPSB1bmN1cnJ5VGhpcyRoKHt9LmlzUHJvdG90eXBlT2YpOwoKCXZhciBnbG9iYWwkeCA9IGdsb2JhbCRJOwoJdmFyIGdldEJ1aWx0SW4kNSA9IGdldEJ1aWx0SW4kNzsKCXZhciBpc0NhbGxhYmxlJGUgPSBpc0NhbGxhYmxlJGg7Cgl2YXIgaXNQcm90b3R5cGVPZiQzID0gb2JqZWN0SXNQcm90b3R5cGVPZjsKCXZhciBVU0VfU1lNQk9MX0FTX1VJRCA9IHVzZVN5bWJvbEFzVWlkOwoKCXZhciBPYmplY3QkMyA9IGdsb2JhbCR4Lk9iamVjdDsKCgl2YXIgaXNTeW1ib2wkMyA9IFVTRV9TWU1CT0xfQVNfVUlEID8gZnVuY3Rpb24gKGl0KSB7CgkgIHJldHVybiB0eXBlb2YgaXQgPT0gJ3N5bWJvbCc7Cgl9IDogZnVuY3Rpb24gKGl0KSB7CgkgIHZhciAkU3ltYm9sID0gZ2V0QnVpbHRJbiQ1KCdTeW1ib2wnKTsKCSAgcmV0dXJuIGlzQ2FsbGFibGUkZSgkU3ltYm9sKSAmJiBpc1Byb3RvdHlwZU9mJDMoJFN5bWJvbC5wcm90b3R5cGUsIE9iamVjdCQzKGl0KSk7Cgl9OwoKCXZhciBnbG9iYWwkdyA9IGdsb2JhbCRJOwoKCXZhciBTdHJpbmckMiA9IGdsb2JhbCR3LlN0cmluZzsKCgl2YXIgdHJ5VG9TdHJpbmckNCA9IGZ1bmN0aW9uIChhcmd1bWVudCkgewoJICB0cnkgewoJICAgIHJldHVybiBTdHJpbmckMihhcmd1bWVudCk7CgkgIH0gY2F0Y2ggKGVycm9yKSB7CgkgICAgcmV0dXJuICdPYmplY3QnOwoJICB9Cgl9OwoKCXZhciBnbG9iYWwkdiA9IGdsb2JhbCRJOwoJdmFyIGlzQ2FsbGFibGUkZCA9IGlzQ2FsbGFibGUkaDsKCXZhciB0cnlUb1N0cmluZyQzID0gdHJ5VG9TdHJpbmckNDsKCgl2YXIgVHlwZUVycm9yJGEgPSBnbG9iYWwkdi5UeXBlRXJyb3I7CgoJLy8gYEFzc2VydDogSXNDYWxsYWJsZShhcmd1bWVudCkgaXMgdHJ1ZWAKCXZhciBhQ2FsbGFibGUkNiA9IGZ1bmN0aW9uIChhcmd1bWVudCkgewoJICBpZiAoaXNDYWxsYWJsZSRkKGFyZ3VtZW50KSkgcmV0dXJuIGFyZ3VtZW50OwoJICB0aHJvdyBUeXBlRXJyb3IkYSh0cnlUb1N0cmluZyQzKGFyZ3VtZW50KSArICcgaXMgbm90IGEgZnVuY3Rpb24nKTsKCX07CgoJdmFyIGFDYWxsYWJsZSQ1ID0gYUNhbGxhYmxlJDY7CgoJLy8gYEdldE1ldGhvZGAgYWJzdHJhY3Qgb3BlcmF0aW9uCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLWdldG1ldGhvZAoJdmFyIGdldE1ldGhvZCQyID0gZnVuY3Rpb24gKFYsIFApIHsKCSAgdmFyIGZ1bmMgPSBWW1BdOwoJICByZXR1cm4gZnVuYyA9PSBudWxsID8gdW5kZWZpbmVkIDogYUNhbGxhYmxlJDUoZnVuYyk7Cgl9OwoKCXZhciBnbG9iYWwkdSA9IGdsb2JhbCRJOwoJdmFyIGNhbGwkOCA9IGZ1bmN0aW9uQ2FsbDsKCXZhciBpc0NhbGxhYmxlJGMgPSBpc0NhbGxhYmxlJGg7Cgl2YXIgaXNPYmplY3QkNyA9IGlzT2JqZWN0JGE7CgoJdmFyIFR5cGVFcnJvciQ5ID0gZ2xvYmFsJHUuVHlwZUVycm9yOwoKCS8vIGBPcmRpbmFyeVRvUHJpbWl0aXZlYCBhYnN0cmFjdCBvcGVyYXRpb24KCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtb3JkaW5hcnl0b3ByaW1pdGl2ZQoJdmFyIG9yZGluYXJ5VG9QcmltaXRpdmUkMSA9IGZ1bmN0aW9uIChpbnB1dCwgcHJlZikgewoJICB2YXIgZm4sIHZhbDsKCSAgaWYgKHByZWYgPT09ICdzdHJpbmcnICYmIGlzQ2FsbGFibGUkYyhmbiA9IGlucHV0LnRvU3RyaW5nKSAmJiAhaXNPYmplY3QkNyh2YWwgPSBjYWxsJDgoZm4sIGlucHV0KSkpIHJldHVybiB2YWw7CgkgIGlmIChpc0NhbGxhYmxlJGMoZm4gPSBpbnB1dC52YWx1ZU9mKSAmJiAhaXNPYmplY3QkNyh2YWwgPSBjYWxsJDgoZm4sIGlucHV0KSkpIHJldHVybiB2YWw7CgkgIGlmIChwcmVmICE9PSAnc3RyaW5nJyAmJiBpc0NhbGxhYmxlJGMoZm4gPSBpbnB1dC50b1N0cmluZykgJiYgIWlzT2JqZWN0JDcodmFsID0gY2FsbCQ4KGZuLCBpbnB1dCkpKSByZXR1cm4gdmFsOwoJICB0aHJvdyBUeXBlRXJyb3IkOSgiQ2FuJ3QgY29udmVydCBvYmplY3QgdG8gcHJpbWl0aXZlIHZhbHVlIik7Cgl9OwoKCXZhciBnbG9iYWwkdCA9IGdsb2JhbCRJOwoJdmFyIGNhbGwkNyA9IGZ1bmN0aW9uQ2FsbDsKCXZhciBpc09iamVjdCQ2ID0gaXNPYmplY3QkYTsKCXZhciBpc1N5bWJvbCQyID0gaXNTeW1ib2wkMzsKCXZhciBnZXRNZXRob2QkMSA9IGdldE1ldGhvZCQyOwoJdmFyIG9yZGluYXJ5VG9QcmltaXRpdmUgPSBvcmRpbmFyeVRvUHJpbWl0aXZlJDE7Cgl2YXIgd2VsbEtub3duU3ltYm9sJGUgPSB3ZWxsS25vd25TeW1ib2wkZjsKCgl2YXIgVHlwZUVycm9yJDggPSBnbG9iYWwkdC5UeXBlRXJyb3I7Cgl2YXIgVE9fUFJJTUlUSVZFID0gd2VsbEtub3duU3ltYm9sJGUoJ3RvUHJpbWl0aXZlJyk7CgoJLy8gYFRvUHJpbWl0aXZlYCBhYnN0cmFjdCBvcGVyYXRpb24KCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtdG9wcmltaXRpdmUKCXZhciB0b1ByaW1pdGl2ZSQxID0gZnVuY3Rpb24gKGlucHV0LCBwcmVmKSB7CgkgIGlmICghaXNPYmplY3QkNihpbnB1dCkgfHwgaXNTeW1ib2wkMihpbnB1dCkpIHJldHVybiBpbnB1dDsKCSAgdmFyIGV4b3RpY1RvUHJpbSA9IGdldE1ldGhvZCQxKGlucHV0LCBUT19QUklNSVRJVkUpOwoJICB2YXIgcmVzdWx0OwoJICBpZiAoZXhvdGljVG9QcmltKSB7CgkgICAgaWYgKHByZWYgPT09IHVuZGVmaW5lZCkgcHJlZiA9ICdkZWZhdWx0JzsKCSAgICByZXN1bHQgPSBjYWxsJDcoZXhvdGljVG9QcmltLCBpbnB1dCwgcHJlZik7CgkgICAgaWYgKCFpc09iamVjdCQ2KHJlc3VsdCkgfHwgaXNTeW1ib2wkMihyZXN1bHQpKSByZXR1cm4gcmVzdWx0OwoJICAgIHRocm93IFR5cGVFcnJvciQ4KCJDYW4ndCBjb252ZXJ0IG9iamVjdCB0byBwcmltaXRpdmUgdmFsdWUiKTsKCSAgfQoJICBpZiAocHJlZiA9PT0gdW5kZWZpbmVkKSBwcmVmID0gJ251bWJlcic7CgkgIHJldHVybiBvcmRpbmFyeVRvUHJpbWl0aXZlKGlucHV0LCBwcmVmKTsKCX07CgoJdmFyIHRvUHJpbWl0aXZlID0gdG9QcmltaXRpdmUkMTsKCXZhciBpc1N5bWJvbCQxID0gaXNTeW1ib2wkMzsKCgkvLyBgVG9Qcm9wZXJ0eUtleWAgYWJzdHJhY3Qgb3BlcmF0aW9uCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLXRvcHJvcGVydHlrZXkKCXZhciB0b1Byb3BlcnR5S2V5JDQgPSBmdW5jdGlvbiAoYXJndW1lbnQpIHsKCSAgdmFyIGtleSA9IHRvUHJpbWl0aXZlKGFyZ3VtZW50LCAnc3RyaW5nJyk7CgkgIHJldHVybiBpc1N5bWJvbCQxKGtleSkgPyBrZXkgOiBrZXkgKyAnJzsKCX07CgoJdmFyIGdsb2JhbCRzID0gZ2xvYmFsJEk7Cgl2YXIgREVTQ1JJUFRPUlMkOCA9IGRlc2NyaXB0b3JzOwoJdmFyIElFOF9ET01fREVGSU5FJDEgPSBpZThEb21EZWZpbmU7Cgl2YXIgYW5PYmplY3QkNiA9IGFuT2JqZWN0JDc7Cgl2YXIgdG9Qcm9wZXJ0eUtleSQzID0gdG9Qcm9wZXJ0eUtleSQ0OwoKCXZhciBUeXBlRXJyb3IkNyA9IGdsb2JhbCRzLlR5cGVFcnJvcjsKCS8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBlcy9uby1vYmplY3QtZGVmaW5lcHJvcGVydHkgLS0gc2FmZQoJdmFyICRkZWZpbmVQcm9wZXJ0eSA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eTsKCgkvLyBgT2JqZWN0LmRlZmluZVByb3BlcnR5YCBtZXRob2QKCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtb2JqZWN0LmRlZmluZXByb3BlcnR5CglvYmplY3REZWZpbmVQcm9wZXJ0eS5mID0gREVTQ1JJUFRPUlMkOCA/ICRkZWZpbmVQcm9wZXJ0eSA6IGZ1bmN0aW9uIGRlZmluZVByb3BlcnR5KE8sIFAsIEF0dHJpYnV0ZXMpIHsKCSAgYW5PYmplY3QkNihPKTsKCSAgUCA9IHRvUHJvcGVydHlLZXkkMyhQKTsKCSAgYW5PYmplY3QkNihBdHRyaWJ1dGVzKTsKCSAgaWYgKElFOF9ET01fREVGSU5FJDEpIHRyeSB7CgkgICAgcmV0dXJuICRkZWZpbmVQcm9wZXJ0eShPLCBQLCBBdHRyaWJ1dGVzKTsKCSAgfSBjYXRjaCAoZXJyb3IpIHsgLyogZW1wdHkgKi8gfQoJICBpZiAoJ2dldCcgaW4gQXR0cmlidXRlcyB8fCAnc2V0JyBpbiBBdHRyaWJ1dGVzKSB0aHJvdyBUeXBlRXJyb3IkNygnQWNjZXNzb3JzIG5vdCBzdXBwb3J0ZWQnKTsKCSAgaWYgKCd2YWx1ZScgaW4gQXR0cmlidXRlcykgT1tQXSA9IEF0dHJpYnV0ZXMudmFsdWU7CgkgIHJldHVybiBPOwoJfTsKCgl2YXIgY2VpbCA9IE1hdGguY2VpbDsKCXZhciBmbG9vciQ0ID0gTWF0aC5mbG9vcjsKCgkvLyBgVG9JbnRlZ2VyT3JJbmZpbml0eWAgYWJzdHJhY3Qgb3BlcmF0aW9uCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLXRvaW50ZWdlcm9yaW5maW5pdHkKCXZhciB0b0ludGVnZXJPckluZmluaXR5JDcgPSBmdW5jdGlvbiAoYXJndW1lbnQpIHsKCSAgdmFyIG51bWJlciA9ICthcmd1bWVudDsKCSAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXNlbGYtY29tcGFyZSAtLSBzYWZlCgkgIHJldHVybiBudW1iZXIgIT09IG51bWJlciB8fCBudW1iZXIgPT09IDAgPyAwIDogKG51bWJlciA+IDAgPyBmbG9vciQ0IDogY2VpbCkobnVtYmVyKTsKCX07CgoJdmFyIHRvSW50ZWdlck9ySW5maW5pdHkkNiA9IHRvSW50ZWdlck9ySW5maW5pdHkkNzsKCgl2YXIgbWF4JDEgPSBNYXRoLm1heDsKCXZhciBtaW4kMyA9IE1hdGgubWluOwoKCS8vIEhlbHBlciBmb3IgYSBwb3B1bGFyIHJlcGVhdGluZyBjYXNlIG9mIHRoZSBzcGVjOgoJLy8gTGV0IGludGVnZXIgYmUgPyBUb0ludGVnZXIoaW5kZXgpLgoJLy8gSWYgaW50ZWdlciA8IDAsIGxldCByZXN1bHQgYmUgbWF4KChsZW5ndGggKyBpbnRlZ2VyKSwgMCk7IGVsc2UgbGV0IHJlc3VsdCBiZSBtaW4oaW50ZWdlciwgbGVuZ3RoKS4KCXZhciB0b0Fic29sdXRlSW5kZXgkNSA9IGZ1bmN0aW9uIChpbmRleCwgbGVuZ3RoKSB7CgkgIHZhciBpbnRlZ2VyID0gdG9JbnRlZ2VyT3JJbmZpbml0eSQ2KGluZGV4KTsKCSAgcmV0dXJuIGludGVnZXIgPCAwID8gbWF4JDEoaW50ZWdlciArIGxlbmd0aCwgMCkgOiBtaW4kMyhpbnRlZ2VyLCBsZW5ndGgpOwoJfTsKCgl2YXIgdG9JbnRlZ2VyT3JJbmZpbml0eSQ1ID0gdG9JbnRlZ2VyT3JJbmZpbml0eSQ3OwoKCXZhciBtaW4kMiA9IE1hdGgubWluOwoKCS8vIGBUb0xlbmd0aGAgYWJzdHJhY3Qgb3BlcmF0aW9uCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLXRvbGVuZ3RoCgl2YXIgdG9MZW5ndGgkNSA9IGZ1bmN0aW9uIChhcmd1bWVudCkgewoJICByZXR1cm4gYXJndW1lbnQgPiAwID8gbWluJDIodG9JbnRlZ2VyT3JJbmZpbml0eSQ1KGFyZ3VtZW50KSwgMHgxRkZGRkZGRkZGRkZGRikgOiAwOyAvLyAyICoqIDUzIC0gMSA9PSA5MDA3MTk5MjU0NzQwOTkxCgl9OwoKCXZhciB0b0xlbmd0aCQ0ID0gdG9MZW5ndGgkNTsKCgkvLyBgTGVuZ3RoT2ZBcnJheUxpa2VgIGFic3RyYWN0IG9wZXJhdGlvbgoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1sZW5ndGhvZmFycmF5bGlrZQoJdmFyIGxlbmd0aE9mQXJyYXlMaWtlJGMgPSBmdW5jdGlvbiAob2JqKSB7CgkgIHJldHVybiB0b0xlbmd0aCQ0KG9iai5sZW5ndGgpOwoJfTsKCgl2YXIgdG9JbmRleGVkT2JqZWN0JDUgPSB0b0luZGV4ZWRPYmplY3QkNjsKCXZhciB0b0Fic29sdXRlSW5kZXgkNCA9IHRvQWJzb2x1dGVJbmRleCQ1OwoJdmFyIGxlbmd0aE9mQXJyYXlMaWtlJGIgPSBsZW5ndGhPZkFycmF5TGlrZSRjOwoKCS8vIGBBcnJheS5wcm90b3R5cGUueyBpbmRleE9mLCBpbmNsdWRlcyB9YCBtZXRob2RzIGltcGxlbWVudGF0aW9uCgl2YXIgY3JlYXRlTWV0aG9kJDMgPSBmdW5jdGlvbiAoSVNfSU5DTFVERVMpIHsKCSAgcmV0dXJuIGZ1bmN0aW9uICgkdGhpcywgZWwsIGZyb21JbmRleCkgewoJICAgIHZhciBPID0gdG9JbmRleGVkT2JqZWN0JDUoJHRoaXMpOwoJICAgIHZhciBsZW5ndGggPSBsZW5ndGhPZkFycmF5TGlrZSRiKE8pOwoJICAgIHZhciBpbmRleCA9IHRvQWJzb2x1dGVJbmRleCQ0KGZyb21JbmRleCwgbGVuZ3RoKTsKCSAgICB2YXIgdmFsdWU7CgkgICAgLy8gQXJyYXkjaW5jbHVkZXMgdXNlcyBTYW1lVmFsdWVaZXJvIGVxdWFsaXR5IGFsZ29yaXRobQoJICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1zZWxmLWNvbXBhcmUgLS0gTmFOIGNoZWNrCgkgICAgaWYgKElTX0lOQ0xVREVTICYmIGVsICE9IGVsKSB3aGlsZSAobGVuZ3RoID4gaW5kZXgpIHsKCSAgICAgIHZhbHVlID0gT1tpbmRleCsrXTsKCSAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1zZWxmLWNvbXBhcmUgLS0gTmFOIGNoZWNrCgkgICAgICBpZiAodmFsdWUgIT0gdmFsdWUpIHJldHVybiB0cnVlOwoJICAgIC8vIEFycmF5I2luZGV4T2YgaWdub3JlcyBob2xlcywgQXJyYXkjaW5jbHVkZXMgLSBub3QKCSAgICB9IGVsc2UgZm9yICg7bGVuZ3RoID4gaW5kZXg7IGluZGV4KyspIHsKCSAgICAgIGlmICgoSVNfSU5DTFVERVMgfHwgaW5kZXggaW4gTykgJiYgT1tpbmRleF0gPT09IGVsKSByZXR1cm4gSVNfSU5DTFVERVMgfHwgaW5kZXggfHwgMDsKCSAgICB9IHJldHVybiAhSVNfSU5DTFVERVMgJiYgLTE7CgkgIH07Cgl9OwoKCXZhciBhcnJheUluY2x1ZGVzID0gewoJICAvLyBgQXJyYXkucHJvdG90eXBlLmluY2x1ZGVzYCBtZXRob2QKCSAgLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1hcnJheS5wcm90b3R5cGUuaW5jbHVkZXMKCSAgaW5jbHVkZXM6IGNyZWF0ZU1ldGhvZCQzKHRydWUpLAoJICAvLyBgQXJyYXkucHJvdG90eXBlLmluZGV4T2ZgIG1ldGhvZAoJICAvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLWFycmF5LnByb3RvdHlwZS5pbmRleG9mCgkgIGluZGV4T2Y6IGNyZWF0ZU1ldGhvZCQzKGZhbHNlKQoJfTsKCgl2YXIgaGlkZGVuS2V5cyQ0ID0ge307CgoJdmFyIHVuY3VycnlUaGlzJGcgPSBmdW5jdGlvblVuY3VycnlUaGlzOwoJdmFyIGhhc093biQ5ID0gaGFzT3duUHJvcGVydHlfMTsKCXZhciB0b0luZGV4ZWRPYmplY3QkNCA9IHRvSW5kZXhlZE9iamVjdCQ2OwoJdmFyIGluZGV4T2YgPSBhcnJheUluY2x1ZGVzLmluZGV4T2Y7Cgl2YXIgaGlkZGVuS2V5cyQzID0gaGlkZGVuS2V5cyQ0OwoKCXZhciBwdXNoJDIgPSB1bmN1cnJ5VGhpcyRnKFtdLnB1c2gpOwoKCXZhciBvYmplY3RLZXlzSW50ZXJuYWwgPSBmdW5jdGlvbiAob2JqZWN0LCBuYW1lcykgewoJICB2YXIgTyA9IHRvSW5kZXhlZE9iamVjdCQ0KG9iamVjdCk7CgkgIHZhciBpID0gMDsKCSAgdmFyIHJlc3VsdCA9IFtdOwoJICB2YXIga2V5OwoJICBmb3IgKGtleSBpbiBPKSAhaGFzT3duJDkoaGlkZGVuS2V5cyQzLCBrZXkpICYmIGhhc093biQ5KE8sIGtleSkgJiYgcHVzaCQyKHJlc3VsdCwga2V5KTsKCSAgLy8gRG9uJ3QgZW51bSBidWcgJiBoaWRkZW4ga2V5cwoJICB3aGlsZSAobmFtZXMubGVuZ3RoID4gaSkgaWYgKGhhc093biQ5KE8sIGtleSA9IG5hbWVzW2krK10pKSB7CgkgICAgfmluZGV4T2YocmVzdWx0LCBrZXkpIHx8IHB1c2gkMihyZXN1bHQsIGtleSk7CgkgIH0KCSAgcmV0dXJuIHJlc3VsdDsKCX07CgoJLy8gSUU4LSBkb24ndCBlbnVtIGJ1ZyBrZXlzCgl2YXIgZW51bUJ1Z0tleXMkMyA9IFsKCSAgJ2NvbnN0cnVjdG9yJywKCSAgJ2hhc093blByb3BlcnR5JywKCSAgJ2lzUHJvdG90eXBlT2YnLAoJICAncHJvcGVydHlJc0VudW1lcmFibGUnLAoJICAndG9Mb2NhbGVTdHJpbmcnLAoJICAndG9TdHJpbmcnLAoJICAndmFsdWVPZicKCV07CgoJdmFyIGludGVybmFsT2JqZWN0S2V5cyQxID0gb2JqZWN0S2V5c0ludGVybmFsOwoJdmFyIGVudW1CdWdLZXlzJDIgPSBlbnVtQnVnS2V5cyQzOwoKCS8vIGBPYmplY3Qua2V5c2AgbWV0aG9kCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLW9iamVjdC5rZXlzCgkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZXMvbm8tb2JqZWN0LWtleXMgLS0gc2FmZQoJdmFyIG9iamVjdEtleXMkMSA9IE9iamVjdC5rZXlzIHx8IGZ1bmN0aW9uIGtleXMoTykgewoJICByZXR1cm4gaW50ZXJuYWxPYmplY3RLZXlzJDEoTywgZW51bUJ1Z0tleXMkMik7Cgl9OwoKCXZhciBERVNDUklQVE9SUyQ3ID0gZGVzY3JpcHRvcnM7Cgl2YXIgZGVmaW5lUHJvcGVydHlNb2R1bGUkNiA9IG9iamVjdERlZmluZVByb3BlcnR5OwoJdmFyIGFuT2JqZWN0JDUgPSBhbk9iamVjdCQ3OwoJdmFyIHRvSW5kZXhlZE9iamVjdCQzID0gdG9JbmRleGVkT2JqZWN0JDY7Cgl2YXIgb2JqZWN0S2V5cyA9IG9iamVjdEtleXMkMTsKCgkvLyBgT2JqZWN0LmRlZmluZVByb3BlcnRpZXNgIG1ldGhvZAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1vYmplY3QuZGVmaW5lcHJvcGVydGllcwoJLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGVzL25vLW9iamVjdC1kZWZpbmVwcm9wZXJ0aWVzIC0tIHNhZmUKCXZhciBvYmplY3REZWZpbmVQcm9wZXJ0aWVzID0gREVTQ1JJUFRPUlMkNyA/IE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzIDogZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyhPLCBQcm9wZXJ0aWVzKSB7CgkgIGFuT2JqZWN0JDUoTyk7CgkgIHZhciBwcm9wcyA9IHRvSW5kZXhlZE9iamVjdCQzKFByb3BlcnRpZXMpOwoJICB2YXIga2V5cyA9IG9iamVjdEtleXMoUHJvcGVydGllcyk7CgkgIHZhciBsZW5ndGggPSBrZXlzLmxlbmd0aDsKCSAgdmFyIGluZGV4ID0gMDsKCSAgdmFyIGtleTsKCSAgd2hpbGUgKGxlbmd0aCA+IGluZGV4KSBkZWZpbmVQcm9wZXJ0eU1vZHVsZSQ2LmYoTywga2V5ID0ga2V5c1tpbmRleCsrXSwgcHJvcHNba2V5XSk7CgkgIHJldHVybiBPOwoJfTsKCgl2YXIgZ2V0QnVpbHRJbiQ0ID0gZ2V0QnVpbHRJbiQ3OwoKCXZhciBodG1sJDEgPSBnZXRCdWlsdEluJDQoJ2RvY3VtZW50JywgJ2RvY3VtZW50RWxlbWVudCcpOwoKCXZhciBzaGFyZWQkMSA9IHNoYXJlZCQzLmV4cG9ydHM7Cgl2YXIgdWlkJDEgPSB1aWQkMzsKCgl2YXIga2V5cyQxID0gc2hhcmVkJDEoJ2tleXMnKTsKCgl2YXIgc2hhcmVkS2V5JDMgPSBmdW5jdGlvbiAoa2V5KSB7CgkgIHJldHVybiBrZXlzJDFba2V5XSB8fCAoa2V5cyQxW2tleV0gPSB1aWQkMShrZXkpKTsKCX07CgoJLyogZ2xvYmFsIEFjdGl2ZVhPYmplY3QgLS0gb2xkIElFLCBXU0ggKi8KCgl2YXIgYW5PYmplY3QkNCA9IGFuT2JqZWN0JDc7Cgl2YXIgZGVmaW5lUHJvcGVydGllcyA9IG9iamVjdERlZmluZVByb3BlcnRpZXM7Cgl2YXIgZW51bUJ1Z0tleXMkMSA9IGVudW1CdWdLZXlzJDM7Cgl2YXIgaGlkZGVuS2V5cyQyID0gaGlkZGVuS2V5cyQ0OwoJdmFyIGh0bWwgPSBodG1sJDE7Cgl2YXIgZG9jdW1lbnRDcmVhdGVFbGVtZW50ID0gZG9jdW1lbnRDcmVhdGVFbGVtZW50JDE7Cgl2YXIgc2hhcmVkS2V5JDIgPSBzaGFyZWRLZXkkMzsKCgl2YXIgR1QgPSAnPic7Cgl2YXIgTFQgPSAnPCc7Cgl2YXIgUFJPVE9UWVBFJDEgPSAncHJvdG90eXBlJzsKCXZhciBTQ1JJUFQgPSAnc2NyaXB0JzsKCXZhciBJRV9QUk9UTyQxID0gc2hhcmVkS2V5JDIoJ0lFX1BST1RPJyk7CgoJdmFyIEVtcHR5Q29uc3RydWN0b3IgPSBmdW5jdGlvbiAoKSB7IC8qIGVtcHR5ICovIH07CgoJdmFyIHNjcmlwdFRhZyA9IGZ1bmN0aW9uIChjb250ZW50KSB7CgkgIHJldHVybiBMVCArIFNDUklQVCArIEdUICsgY29udGVudCArIExUICsgJy8nICsgU0NSSVBUICsgR1Q7Cgl9OwoKCS8vIENyZWF0ZSBvYmplY3Qgd2l0aCBmYWtlIGBudWxsYCBwcm90b3R5cGU6IHVzZSBBY3RpdmVYIE9iamVjdCB3aXRoIGNsZWFyZWQgcHJvdG90eXBlCgl2YXIgTnVsbFByb3RvT2JqZWN0VmlhQWN0aXZlWCA9IGZ1bmN0aW9uIChhY3RpdmVYRG9jdW1lbnQpIHsKCSAgYWN0aXZlWERvY3VtZW50LndyaXRlKHNjcmlwdFRhZygnJykpOwoJICBhY3RpdmVYRG9jdW1lbnQuY2xvc2UoKTsKCSAgdmFyIHRlbXAgPSBhY3RpdmVYRG9jdW1lbnQucGFyZW50V2luZG93Lk9iamVjdDsKCSAgYWN0aXZlWERvY3VtZW50ID0gbnVsbDsgLy8gYXZvaWQgbWVtb3J5IGxlYWsKCSAgcmV0dXJuIHRlbXA7Cgl9OwoKCS8vIENyZWF0ZSBvYmplY3Qgd2l0aCBmYWtlIGBudWxsYCBwcm90b3R5cGU6IHVzZSBpZnJhbWUgT2JqZWN0IHdpdGggY2xlYXJlZCBwcm90b3R5cGUKCXZhciBOdWxsUHJvdG9PYmplY3RWaWFJRnJhbWUgPSBmdW5jdGlvbiAoKSB7CgkgIC8vIFRocmFzaCwgd2FzdGUgYW5kIHNvZG9teTogSUUgR0MgYnVnCgkgIHZhciBpZnJhbWUgPSBkb2N1bWVudENyZWF0ZUVsZW1lbnQoJ2lmcmFtZScpOwoJICB2YXIgSlMgPSAnamF2YScgKyBTQ1JJUFQgKyAnOic7CgkgIHZhciBpZnJhbWVEb2N1bWVudDsKCSAgaWZyYW1lLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CgkgIGh0bWwuYXBwZW5kQ2hpbGQoaWZyYW1lKTsKCSAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3psb2lyb2NrL2NvcmUtanMvaXNzdWVzLzQ3NQoJICBpZnJhbWUuc3JjID0gU3RyaW5nKEpTKTsKCSAgaWZyYW1lRG9jdW1lbnQgPSBpZnJhbWUuY29udGVudFdpbmRvdy5kb2N1bWVudDsKCSAgaWZyYW1lRG9jdW1lbnQub3BlbigpOwoJICBpZnJhbWVEb2N1bWVudC53cml0ZShzY3JpcHRUYWcoJ2RvY3VtZW50LkY9T2JqZWN0JykpOwoJICBpZnJhbWVEb2N1bWVudC5jbG9zZSgpOwoJICByZXR1cm4gaWZyYW1lRG9jdW1lbnQuRjsKCX07CgoJLy8gQ2hlY2sgZm9yIGRvY3VtZW50LmRvbWFpbiBhbmQgYWN0aXZlIHggc3VwcG9ydAoJLy8gTm8gbmVlZCB0byB1c2UgYWN0aXZlIHggYXBwcm9hY2ggd2hlbiBkb2N1bWVudC5kb21haW4gaXMgbm90IHNldAoJLy8gc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9lcy1zaGltcy9lczUtc2hpbS9pc3N1ZXMvMTUwCgkvLyB2YXJpYXRpb24gb2YgaHR0cHM6Ly9naXRodWIuY29tL2tpdGNhbWJyaWRnZS9lczUtc2hpbS9jb21taXQvNGY3MzhhYzA2NjM0NgoJLy8gYXZvaWQgSUUgR0MgYnVnCgl2YXIgYWN0aXZlWERvY3VtZW50OwoJdmFyIE51bGxQcm90b09iamVjdCA9IGZ1bmN0aW9uICgpIHsKCSAgdHJ5IHsKCSAgICBhY3RpdmVYRG9jdW1lbnQgPSBuZXcgQWN0aXZlWE9iamVjdCgnaHRtbGZpbGUnKTsKCSAgfSBjYXRjaCAoZXJyb3IpIHsgLyogaWdub3JlICovIH0KCSAgTnVsbFByb3RvT2JqZWN0ID0gdHlwZW9mIGRvY3VtZW50ICE9ICd1bmRlZmluZWQnCgkgICAgPyBkb2N1bWVudC5kb21haW4gJiYgYWN0aXZlWERvY3VtZW50CgkgICAgICA/IE51bGxQcm90b09iamVjdFZpYUFjdGl2ZVgoYWN0aXZlWERvY3VtZW50KSAvLyBvbGQgSUUKCSAgICAgIDogTnVsbFByb3RvT2JqZWN0VmlhSUZyYW1lKCkKCSAgICA6IE51bGxQcm90b09iamVjdFZpYUFjdGl2ZVgoYWN0aXZlWERvY3VtZW50KTsgLy8gV1NICgkgIHZhciBsZW5ndGggPSBlbnVtQnVnS2V5cyQxLmxlbmd0aDsKCSAgd2hpbGUgKGxlbmd0aC0tKSBkZWxldGUgTnVsbFByb3RvT2JqZWN0W1BST1RPVFlQRSQxXVtlbnVtQnVnS2V5cyQxW2xlbmd0aF1dOwoJICByZXR1cm4gTnVsbFByb3RvT2JqZWN0KCk7Cgl9OwoKCWhpZGRlbktleXMkMltJRV9QUk9UTyQxXSA9IHRydWU7CgoJLy8gYE9iamVjdC5jcmVhdGVgIG1ldGhvZAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1vYmplY3QuY3JlYXRlCgl2YXIgb2JqZWN0Q3JlYXRlID0gT2JqZWN0LmNyZWF0ZSB8fCBmdW5jdGlvbiBjcmVhdGUoTywgUHJvcGVydGllcykgewoJICB2YXIgcmVzdWx0OwoJICBpZiAoTyAhPT0gbnVsbCkgewoJICAgIEVtcHR5Q29uc3RydWN0b3JbUFJPVE9UWVBFJDFdID0gYW5PYmplY3QkNChPKTsKCSAgICByZXN1bHQgPSBuZXcgRW1wdHlDb25zdHJ1Y3RvcigpOwoJICAgIEVtcHR5Q29uc3RydWN0b3JbUFJPVE9UWVBFJDFdID0gbnVsbDsKCSAgICAvLyBhZGQgIl9fcHJvdG9fXyIgZm9yIE9iamVjdC5nZXRQcm90b3R5cGVPZiBwb2x5ZmlsbAoJICAgIHJlc3VsdFtJRV9QUk9UTyQxXSA9IE87CgkgIH0gZWxzZSByZXN1bHQgPSBOdWxsUHJvdG9PYmplY3QoKTsKCSAgcmV0dXJuIFByb3BlcnRpZXMgPT09IHVuZGVmaW5lZCA/IHJlc3VsdCA6IGRlZmluZVByb3BlcnRpZXMocmVzdWx0LCBQcm9wZXJ0aWVzKTsKCX07CgoJdmFyIHdlbGxLbm93blN5bWJvbCRkID0gd2VsbEtub3duU3ltYm9sJGY7Cgl2YXIgY3JlYXRlJDIgPSBvYmplY3RDcmVhdGU7Cgl2YXIgZGVmaW5lUHJvcGVydHlNb2R1bGUkNSA9IG9iamVjdERlZmluZVByb3BlcnR5OwoKCXZhciBVTlNDT1BBQkxFUyA9IHdlbGxLbm93blN5bWJvbCRkKCd1bnNjb3BhYmxlcycpOwoJdmFyIEFycmF5UHJvdG90eXBlJDEgPSBBcnJheS5wcm90b3R5cGU7CgoJLy8gQXJyYXkucHJvdG90eXBlW0BAdW5zY29wYWJsZXNdCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLWFycmF5LnByb3RvdHlwZS1AQHVuc2NvcGFibGVzCglpZiAoQXJyYXlQcm90b3R5cGUkMVtVTlNDT1BBQkxFU10gPT0gdW5kZWZpbmVkKSB7CgkgIGRlZmluZVByb3BlcnR5TW9kdWxlJDUuZihBcnJheVByb3RvdHlwZSQxLCBVTlNDT1BBQkxFUywgewoJICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKCSAgICB2YWx1ZTogY3JlYXRlJDIobnVsbCkKCSAgfSk7Cgl9CgoJLy8gYWRkIGEga2V5IHRvIEFycmF5LnByb3RvdHlwZVtAQHVuc2NvcGFibGVzXQoJdmFyIGFkZFRvVW5zY29wYWJsZXMkMSA9IGZ1bmN0aW9uIChrZXkpIHsKCSAgQXJyYXlQcm90b3R5cGUkMVtVTlNDT1BBQkxFU11ba2V5XSA9IHRydWU7Cgl9OwoKCXZhciBpdGVyYXRvcnMgPSB7fTsKCgl2YXIgdW5jdXJyeVRoaXMkZiA9IGZ1bmN0aW9uVW5jdXJyeVRoaXM7Cgl2YXIgaXNDYWxsYWJsZSRiID0gaXNDYWxsYWJsZSRoOwoJdmFyIHN0b3JlJDEgPSBzaGFyZWRTdG9yZTsKCgl2YXIgZnVuY3Rpb25Ub1N0cmluZyA9IHVuY3VycnlUaGlzJGYoRnVuY3Rpb24udG9TdHJpbmcpOwoKCS8vIHRoaXMgaGVscGVyIGJyb2tlbiBpbiBgY29yZS1qc0AzLjQuMS0zLjQuNGAsIHNvIHdlIGNhbid0IHVzZSBgc2hhcmVkYCBoZWxwZXIKCWlmICghaXNDYWxsYWJsZSRiKHN0b3JlJDEuaW5zcGVjdFNvdXJjZSkpIHsKCSAgc3RvcmUkMS5pbnNwZWN0U291cmNlID0gZnVuY3Rpb24gKGl0KSB7CgkgICAgcmV0dXJuIGZ1bmN0aW9uVG9TdHJpbmcoaXQpOwoJICB9OwoJfQoKCXZhciBpbnNwZWN0U291cmNlJDMgPSBzdG9yZSQxLmluc3BlY3RTb3VyY2U7CgoJdmFyIGdsb2JhbCRyID0gZ2xvYmFsJEk7Cgl2YXIgaXNDYWxsYWJsZSRhID0gaXNDYWxsYWJsZSRoOwoJdmFyIGluc3BlY3RTb3VyY2UkMiA9IGluc3BlY3RTb3VyY2UkMzsKCgl2YXIgV2Vha01hcCQxID0gZ2xvYmFsJHIuV2Vha01hcDsKCgl2YXIgbmF0aXZlV2Vha01hcCA9IGlzQ2FsbGFibGUkYShXZWFrTWFwJDEpICYmIC9uYXRpdmUgY29kZS8udGVzdChpbnNwZWN0U291cmNlJDIoV2Vha01hcCQxKSk7CgoJdmFyIGNyZWF0ZVByb3BlcnR5RGVzY3JpcHRvciQ1ID0gZnVuY3Rpb24gKGJpdG1hcCwgdmFsdWUpIHsKCSAgcmV0dXJuIHsKCSAgICBlbnVtZXJhYmxlOiAhKGJpdG1hcCAmIDEpLAoJICAgIGNvbmZpZ3VyYWJsZTogIShiaXRtYXAgJiAyKSwKCSAgICB3cml0YWJsZTogIShiaXRtYXAgJiA0KSwKCSAgICB2YWx1ZTogdmFsdWUKCSAgfTsKCX07CgoJdmFyIERFU0NSSVBUT1JTJDYgPSBkZXNjcmlwdG9yczsKCXZhciBkZWZpbmVQcm9wZXJ0eU1vZHVsZSQ0ID0gb2JqZWN0RGVmaW5lUHJvcGVydHk7Cgl2YXIgY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yJDQgPSBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IkNTsKCgl2YXIgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5JDcgPSBERVNDUklQVE9SUyQ2ID8gZnVuY3Rpb24gKG9iamVjdCwga2V5LCB2YWx1ZSkgewoJICByZXR1cm4gZGVmaW5lUHJvcGVydHlNb2R1bGUkNC5mKG9iamVjdCwga2V5LCBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IkNCgxLCB2YWx1ZSkpOwoJfSA6IGZ1bmN0aW9uIChvYmplY3QsIGtleSwgdmFsdWUpIHsKCSAgb2JqZWN0W2tleV0gPSB2YWx1ZTsKCSAgcmV0dXJuIG9iamVjdDsKCX07CgoJdmFyIE5BVElWRV9XRUFLX01BUCA9IG5hdGl2ZVdlYWtNYXA7Cgl2YXIgZ2xvYmFsJHEgPSBnbG9iYWwkSTsKCXZhciB1bmN1cnJ5VGhpcyRlID0gZnVuY3Rpb25VbmN1cnJ5VGhpczsKCXZhciBpc09iamVjdCQ1ID0gaXNPYmplY3QkYTsKCXZhciBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkkNiA9IGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSQ3OwoJdmFyIGhhc093biQ4ID0gaGFzT3duUHJvcGVydHlfMTsKCXZhciBzaGFyZWQgPSBzaGFyZWRTdG9yZTsKCXZhciBzaGFyZWRLZXkkMSA9IHNoYXJlZEtleSQzOwoJdmFyIGhpZGRlbktleXMkMSA9IGhpZGRlbktleXMkNDsKCgl2YXIgT0JKRUNUX0FMUkVBRFlfSU5JVElBTElaRUQgPSAnT2JqZWN0IGFscmVhZHkgaW5pdGlhbGl6ZWQnOwoJdmFyIFR5cGVFcnJvciQ2ID0gZ2xvYmFsJHEuVHlwZUVycm9yOwoJdmFyIFdlYWtNYXAgPSBnbG9iYWwkcS5XZWFrTWFwOwoJdmFyIHNldCQxLCBnZXQkMSwgaGFzOwoKCXZhciBlbmZvcmNlID0gZnVuY3Rpb24gKGl0KSB7CgkgIHJldHVybiBoYXMoaXQpID8gZ2V0JDEoaXQpIDogc2V0JDEoaXQsIHt9KTsKCX07CgoJdmFyIGdldHRlckZvciA9IGZ1bmN0aW9uIChUWVBFKSB7CgkgIHJldHVybiBmdW5jdGlvbiAoaXQpIHsKCSAgICB2YXIgc3RhdGU7CgkgICAgaWYgKCFpc09iamVjdCQ1KGl0KSB8fCAoc3RhdGUgPSBnZXQkMShpdCkpLnR5cGUgIT09IFRZUEUpIHsKCSAgICAgIHRocm93IFR5cGVFcnJvciQ2KCdJbmNvbXBhdGlibGUgcmVjZWl2ZXIsICcgKyBUWVBFICsgJyByZXF1aXJlZCcpOwoJICAgIH0gcmV0dXJuIHN0YXRlOwoJICB9OwoJfTsKCglpZiAoTkFUSVZFX1dFQUtfTUFQIHx8IHNoYXJlZC5zdGF0ZSkgewoJICB2YXIgc3RvcmUgPSBzaGFyZWQuc3RhdGUgfHwgKHNoYXJlZC5zdGF0ZSA9IG5ldyBXZWFrTWFwKCkpOwoJICB2YXIgd21nZXQgPSB1bmN1cnJ5VGhpcyRlKHN0b3JlLmdldCk7CgkgIHZhciB3bWhhcyA9IHVuY3VycnlUaGlzJGUoc3RvcmUuaGFzKTsKCSAgdmFyIHdtc2V0ID0gdW5jdXJyeVRoaXMkZShzdG9yZS5zZXQpOwoJICBzZXQkMSA9IGZ1bmN0aW9uIChpdCwgbWV0YWRhdGEpIHsKCSAgICBpZiAod21oYXMoc3RvcmUsIGl0KSkgdGhyb3cgbmV3IFR5cGVFcnJvciQ2KE9CSkVDVF9BTFJFQURZX0lOSVRJQUxJWkVEKTsKCSAgICBtZXRhZGF0YS5mYWNhZGUgPSBpdDsKCSAgICB3bXNldChzdG9yZSwgaXQsIG1ldGFkYXRhKTsKCSAgICByZXR1cm4gbWV0YWRhdGE7CgkgIH07CgkgIGdldCQxID0gZnVuY3Rpb24gKGl0KSB7CgkgICAgcmV0dXJuIHdtZ2V0KHN0b3JlLCBpdCkgfHwge307CgkgIH07CgkgIGhhcyA9IGZ1bmN0aW9uIChpdCkgewoJICAgIHJldHVybiB3bWhhcyhzdG9yZSwgaXQpOwoJICB9OwoJfSBlbHNlIHsKCSAgdmFyIFNUQVRFID0gc2hhcmVkS2V5JDEoJ3N0YXRlJyk7CgkgIGhpZGRlbktleXMkMVtTVEFURV0gPSB0cnVlOwoJICBzZXQkMSA9IGZ1bmN0aW9uIChpdCwgbWV0YWRhdGEpIHsKCSAgICBpZiAoaGFzT3duJDgoaXQsIFNUQVRFKSkgdGhyb3cgbmV3IFR5cGVFcnJvciQ2KE9CSkVDVF9BTFJFQURZX0lOSVRJQUxJWkVEKTsKCSAgICBtZXRhZGF0YS5mYWNhZGUgPSBpdDsKCSAgICBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkkNihpdCwgU1RBVEUsIG1ldGFkYXRhKTsKCSAgICByZXR1cm4gbWV0YWRhdGE7CgkgIH07CgkgIGdldCQxID0gZnVuY3Rpb24gKGl0KSB7CgkgICAgcmV0dXJuIGhhc093biQ4KGl0LCBTVEFURSkgPyBpdFtTVEFURV0gOiB7fTsKCSAgfTsKCSAgaGFzID0gZnVuY3Rpb24gKGl0KSB7CgkgICAgcmV0dXJuIGhhc093biQ4KGl0LCBTVEFURSk7CgkgIH07Cgl9CgoJdmFyIGludGVybmFsU3RhdGUgPSB7CgkgIHNldDogc2V0JDEsCgkgIGdldDogZ2V0JDEsCgkgIGhhczogaGFzLAoJICBlbmZvcmNlOiBlbmZvcmNlLAoJICBnZXR0ZXJGb3I6IGdldHRlckZvcgoJfTsKCgl2YXIgb2JqZWN0R2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID0ge307CgoJdmFyIG9iamVjdFByb3BlcnR5SXNFbnVtZXJhYmxlID0ge307CgoJdmFyICRwcm9wZXJ0eUlzRW51bWVyYWJsZSA9IHt9LnByb3BlcnR5SXNFbnVtZXJhYmxlOwoJLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGVzL25vLW9iamVjdC1nZXRvd25wcm9wZXJ0eWRlc2NyaXB0b3IgLS0gc2FmZQoJdmFyIGdldE93blByb3BlcnR5RGVzY3JpcHRvciQxID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcjsKCgkvLyBOYXNob3JuIH4gSkRLOCBidWcKCXZhciBOQVNIT1JOX0JVRyA9IGdldE93blByb3BlcnR5RGVzY3JpcHRvciQxICYmICEkcHJvcGVydHlJc0VudW1lcmFibGUuY2FsbCh7IDE6IDIgfSwgMSk7CgoJLy8gYE9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGVgIG1ldGhvZCBpbXBsZW1lbnRhdGlvbgoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1vYmplY3QucHJvdG90eXBlLnByb3BlcnR5aXNlbnVtZXJhYmxlCglvYmplY3RQcm9wZXJ0eUlzRW51bWVyYWJsZS5mID0gTkFTSE9STl9CVUcgPyBmdW5jdGlvbiBwcm9wZXJ0eUlzRW51bWVyYWJsZShWKSB7CgkgIHZhciBkZXNjcmlwdG9yID0gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yJDEodGhpcywgVik7CgkgIHJldHVybiAhIWRlc2NyaXB0b3IgJiYgZGVzY3JpcHRvci5lbnVtZXJhYmxlOwoJfSA6ICRwcm9wZXJ0eUlzRW51bWVyYWJsZTsKCgl2YXIgREVTQ1JJUFRPUlMkNSA9IGRlc2NyaXB0b3JzOwoJdmFyIGNhbGwkNiA9IGZ1bmN0aW9uQ2FsbDsKCXZhciBwcm9wZXJ0eUlzRW51bWVyYWJsZU1vZHVsZSA9IG9iamVjdFByb3BlcnR5SXNFbnVtZXJhYmxlOwoJdmFyIGNyZWF0ZVByb3BlcnR5RGVzY3JpcHRvciQzID0gY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yJDU7Cgl2YXIgdG9JbmRleGVkT2JqZWN0JDIgPSB0b0luZGV4ZWRPYmplY3QkNjsKCXZhciB0b1Byb3BlcnR5S2V5JDIgPSB0b1Byb3BlcnR5S2V5JDQ7Cgl2YXIgaGFzT3duJDcgPSBoYXNPd25Qcm9wZXJ0eV8xOwoJdmFyIElFOF9ET01fREVGSU5FID0gaWU4RG9tRGVmaW5lOwoKCS8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBlcy9uby1vYmplY3QtZ2V0b3ducHJvcGVydHlkZXNjcmlwdG9yIC0tIHNhZmUKCXZhciAkZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcjsKCgkvLyBgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcmAgbWV0aG9kCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLW9iamVjdC5nZXRvd25wcm9wZXJ0eWRlc2NyaXB0b3IKCW9iamVjdEdldE93blByb3BlcnR5RGVzY3JpcHRvci5mID0gREVTQ1JJUFRPUlMkNSA/ICRnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgOiBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTywgUCkgewoJICBPID0gdG9JbmRleGVkT2JqZWN0JDIoTyk7CgkgIFAgPSB0b1Byb3BlcnR5S2V5JDIoUCk7CgkgIGlmIChJRThfRE9NX0RFRklORSkgdHJ5IHsKCSAgICByZXR1cm4gJGdldE93blByb3BlcnR5RGVzY3JpcHRvcihPLCBQKTsKCSAgfSBjYXRjaCAoZXJyb3IpIHsgLyogZW1wdHkgKi8gfQoJICBpZiAoaGFzT3duJDcoTywgUCkpIHJldHVybiBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IkMyghY2FsbCQ2KHByb3BlcnR5SXNFbnVtZXJhYmxlTW9kdWxlLmYsIE8sIFApLCBPW1BdKTsKCX07CgoJdmFyIHJlZGVmaW5lJDYgPSB7ZXhwb3J0czoge319OwoKCXZhciBERVNDUklQVE9SUyQ0ID0gZGVzY3JpcHRvcnM7Cgl2YXIgaGFzT3duJDYgPSBoYXNPd25Qcm9wZXJ0eV8xOwoKCXZhciBGdW5jdGlvblByb3RvdHlwZSQxID0gRnVuY3Rpb24ucHJvdG90eXBlOwoJLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGVzL25vLW9iamVjdC1nZXRvd25wcm9wZXJ0eWRlc2NyaXB0b3IgLS0gc2FmZQoJdmFyIGdldERlc2NyaXB0b3IgPSBERVNDUklQVE9SUyQ0ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7CgoJdmFyIEVYSVNUUyA9IGhhc093biQ2KEZ1bmN0aW9uUHJvdG90eXBlJDEsICduYW1lJyk7CgkvLyBhZGRpdGlvbmFsIHByb3RlY3Rpb24gZnJvbSBtaW5pZmllZCAvIG1hbmdsZWQgLyBkcm9wcGVkIGZ1bmN0aW9uIG5hbWVzCgl2YXIgUFJPUEVSID0gRVhJU1RTICYmIChmdW5jdGlvbiBzb21ldGhpbmcoKSB7IC8qIGVtcHR5ICovIH0pLm5hbWUgPT09ICdzb21ldGhpbmcnOwoJdmFyIENPTkZJR1VSQUJMRSA9IEVYSVNUUyAmJiAoIURFU0NSSVBUT1JTJDQgfHwgKERFU0NSSVBUT1JTJDQgJiYgZ2V0RGVzY3JpcHRvcihGdW5jdGlvblByb3RvdHlwZSQxLCAnbmFtZScpLmNvbmZpZ3VyYWJsZSkpOwoKCXZhciBmdW5jdGlvbk5hbWUgPSB7CgkgIEVYSVNUUzogRVhJU1RTLAoJICBQUk9QRVI6IFBST1BFUiwKCSAgQ09ORklHVVJBQkxFOiBDT05GSUdVUkFCTEUKCX07CgoJdmFyIGdsb2JhbCRwID0gZ2xvYmFsJEk7Cgl2YXIgaXNDYWxsYWJsZSQ5ID0gaXNDYWxsYWJsZSRoOwoJdmFyIGhhc093biQ1ID0gaGFzT3duUHJvcGVydHlfMTsKCXZhciBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkkNSA9IGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSQ3OwoJdmFyIHNldEdsb2JhbCQxID0gc2V0R2xvYmFsJDM7Cgl2YXIgaW5zcGVjdFNvdXJjZSQxID0gaW5zcGVjdFNvdXJjZSQzOwoJdmFyIEludGVybmFsU3RhdGVNb2R1bGUkMyA9IGludGVybmFsU3RhdGU7Cgl2YXIgQ09ORklHVVJBQkxFX0ZVTkNUSU9OX05BTUUkMiA9IGZ1bmN0aW9uTmFtZS5DT05GSUdVUkFCTEU7CgoJdmFyIGdldEludGVybmFsU3RhdGUkMyA9IEludGVybmFsU3RhdGVNb2R1bGUkMy5nZXQ7Cgl2YXIgZW5mb3JjZUludGVybmFsU3RhdGUgPSBJbnRlcm5hbFN0YXRlTW9kdWxlJDMuZW5mb3JjZTsKCXZhciBURU1QTEFURSA9IFN0cmluZyhTdHJpbmcpLnNwbGl0KCdTdHJpbmcnKTsKCgkocmVkZWZpbmUkNi5leHBvcnRzID0gZnVuY3Rpb24gKE8sIGtleSwgdmFsdWUsIG9wdGlvbnMpIHsKCSAgdmFyIHVuc2FmZSA9IG9wdGlvbnMgPyAhIW9wdGlvbnMudW5zYWZlIDogZmFsc2U7CgkgIHZhciBzaW1wbGUgPSBvcHRpb25zID8gISFvcHRpb25zLmVudW1lcmFibGUgOiBmYWxzZTsKCSAgdmFyIG5vVGFyZ2V0R2V0ID0gb3B0aW9ucyA/ICEhb3B0aW9ucy5ub1RhcmdldEdldCA6IGZhbHNlOwoJICB2YXIgbmFtZSA9IG9wdGlvbnMgJiYgb3B0aW9ucy5uYW1lICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLm5hbWUgOiBrZXk7CgkgIHZhciBzdGF0ZTsKCSAgaWYgKGlzQ2FsbGFibGUkOSh2YWx1ZSkpIHsKCSAgICBpZiAoU3RyaW5nKG5hbWUpLnNsaWNlKDAsIDcpID09PSAnU3ltYm9sKCcpIHsKCSAgICAgIG5hbWUgPSAnWycgKyBTdHJpbmcobmFtZSkucmVwbGFjZSgvXlN5bWJvbFwoKFteKV0qKVwpLywgJyQxJykgKyAnXSc7CgkgICAgfQoJICAgIGlmICghaGFzT3duJDUodmFsdWUsICduYW1lJykgfHwgKENPTkZJR1VSQUJMRV9GVU5DVElPTl9OQU1FJDIgJiYgdmFsdWUubmFtZSAhPT0gbmFtZSkpIHsKCSAgICAgIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSQ1KHZhbHVlLCAnbmFtZScsIG5hbWUpOwoJICAgIH0KCSAgICBzdGF0ZSA9IGVuZm9yY2VJbnRlcm5hbFN0YXRlKHZhbHVlKTsKCSAgICBpZiAoIXN0YXRlLnNvdXJjZSkgewoJICAgICAgc3RhdGUuc291cmNlID0gVEVNUExBVEUuam9pbih0eXBlb2YgbmFtZSA9PSAnc3RyaW5nJyA/IG5hbWUgOiAnJyk7CgkgICAgfQoJICB9CgkgIGlmIChPID09PSBnbG9iYWwkcCkgewoJICAgIGlmIChzaW1wbGUpIE9ba2V5XSA9IHZhbHVlOwoJICAgIGVsc2Ugc2V0R2xvYmFsJDEoa2V5LCB2YWx1ZSk7CgkgICAgcmV0dXJuOwoJICB9IGVsc2UgaWYgKCF1bnNhZmUpIHsKCSAgICBkZWxldGUgT1trZXldOwoJICB9IGVsc2UgaWYgKCFub1RhcmdldEdldCAmJiBPW2tleV0pIHsKCSAgICBzaW1wbGUgPSB0cnVlOwoJICB9CgkgIGlmIChzaW1wbGUpIE9ba2V5XSA9IHZhbHVlOwoJICBlbHNlIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSQ1KE8sIGtleSwgdmFsdWUpOwoJLy8gYWRkIGZha2UgRnVuY3Rpb24jdG9TdHJpbmcgZm9yIGNvcnJlY3Qgd29yayB3cmFwcGVkIG1ldGhvZHMgLyBjb25zdHJ1Y3RvcnMgd2l0aCBtZXRob2RzIGxpa2UgTG9EYXNoIGlzTmF0aXZlCgl9KShGdW5jdGlvbi5wcm90b3R5cGUsICd0b1N0cmluZycsIGZ1bmN0aW9uIHRvU3RyaW5nKCkgewoJICByZXR1cm4gaXNDYWxsYWJsZSQ5KHRoaXMpICYmIGdldEludGVybmFsU3RhdGUkMyh0aGlzKS5zb3VyY2UgfHwgaW5zcGVjdFNvdXJjZSQxKHRoaXMpOwoJfSk7CgoJdmFyIG9iamVjdEdldE93blByb3BlcnR5TmFtZXMgPSB7fTsKCgl2YXIgaW50ZXJuYWxPYmplY3RLZXlzID0gb2JqZWN0S2V5c0ludGVybmFsOwoJdmFyIGVudW1CdWdLZXlzID0gZW51bUJ1Z0tleXMkMzsKCgl2YXIgaGlkZGVuS2V5cyA9IGVudW1CdWdLZXlzLmNvbmNhdCgnbGVuZ3RoJywgJ3Byb3RvdHlwZScpOwoKCS8vIGBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lc2AgbWV0aG9kCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLW9iamVjdC5nZXRvd25wcm9wZXJ0eW5hbWVzCgkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZXMvbm8tb2JqZWN0LWdldG93bnByb3BlcnR5bmFtZXMgLS0gc2FmZQoJb2JqZWN0R2V0T3duUHJvcGVydHlOYW1lcy5mID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMgfHwgZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlOYW1lcyhPKSB7CgkgIHJldHVybiBpbnRlcm5hbE9iamVjdEtleXMoTywgaGlkZGVuS2V5cyk7Cgl9OwoKCXZhciBvYmplY3RHZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPSB7fTsKCgkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZXMvbm8tb2JqZWN0LWdldG93bnByb3BlcnR5c3ltYm9scyAtLSBzYWZlCglvYmplY3RHZXRPd25Qcm9wZXJ0eVN5bWJvbHMuZiA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHM7CgoJdmFyIGdldEJ1aWx0SW4kMyA9IGdldEJ1aWx0SW4kNzsKCXZhciB1bmN1cnJ5VGhpcyRkID0gZnVuY3Rpb25VbmN1cnJ5VGhpczsKCXZhciBnZXRPd25Qcm9wZXJ0eU5hbWVzTW9kdWxlID0gb2JqZWN0R2V0T3duUHJvcGVydHlOYW1lczsKCXZhciBnZXRPd25Qcm9wZXJ0eVN5bWJvbHNNb2R1bGUgPSBvYmplY3RHZXRPd25Qcm9wZXJ0eVN5bWJvbHM7Cgl2YXIgYW5PYmplY3QkMyA9IGFuT2JqZWN0JDc7CgoJdmFyIGNvbmNhdCA9IHVuY3VycnlUaGlzJGQoW10uY29uY2F0KTsKCgkvLyBhbGwgb2JqZWN0IGtleXMsIGluY2x1ZGVzIG5vbi1lbnVtZXJhYmxlIGFuZCBzeW1ib2xzCgl2YXIgb3duS2V5cyQxID0gZ2V0QnVpbHRJbiQzKCdSZWZsZWN0JywgJ293bktleXMnKSB8fCBmdW5jdGlvbiBvd25LZXlzKGl0KSB7CgkgIHZhciBrZXlzID0gZ2V0T3duUHJvcGVydHlOYW1lc01vZHVsZS5mKGFuT2JqZWN0JDMoaXQpKTsKCSAgdmFyIGdldE93blByb3BlcnR5U3ltYm9scyA9IGdldE93blByb3BlcnR5U3ltYm9sc01vZHVsZS5mOwoJICByZXR1cm4gZ2V0T3duUHJvcGVydHlTeW1ib2xzID8gY29uY2F0KGtleXMsIGdldE93blByb3BlcnR5U3ltYm9scyhpdCkpIDoga2V5czsKCX07CgoJdmFyIGhhc093biQ0ID0gaGFzT3duUHJvcGVydHlfMTsKCXZhciBvd25LZXlzID0gb3duS2V5cyQxOwoJdmFyIGdldE93blByb3BlcnR5RGVzY3JpcHRvck1vZHVsZSQxID0gb2JqZWN0R2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOwoJdmFyIGRlZmluZVByb3BlcnR5TW9kdWxlJDMgPSBvYmplY3REZWZpbmVQcm9wZXJ0eTsKCgl2YXIgY29weUNvbnN0cnVjdG9yUHJvcGVydGllcyQxID0gZnVuY3Rpb24gKHRhcmdldCwgc291cmNlKSB7CgkgIHZhciBrZXlzID0gb3duS2V5cyhzb3VyY2UpOwoJICB2YXIgZGVmaW5lUHJvcGVydHkgPSBkZWZpbmVQcm9wZXJ0eU1vZHVsZSQzLmY7CgkgIHZhciBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPSBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JNb2R1bGUkMS5mOwoJICBmb3IgKHZhciBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHsKCSAgICB2YXIga2V5ID0ga2V5c1tpXTsKCSAgICBpZiAoIWhhc093biQ0KHRhcmdldCwga2V5KSkgZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIGdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOwoJICB9Cgl9OwoKCXZhciBmYWlscyRiID0gZmFpbHMkZzsKCXZhciBpc0NhbGxhYmxlJDggPSBpc0NhbGxhYmxlJGg7CgoJdmFyIHJlcGxhY2VtZW50ID0gLyN8XC5wcm90b3R5cGVcLi87CgoJdmFyIGlzRm9yY2VkJDEgPSBmdW5jdGlvbiAoZmVhdHVyZSwgZGV0ZWN0aW9uKSB7CgkgIHZhciB2YWx1ZSA9IGRhdGFbbm9ybWFsaXplKGZlYXR1cmUpXTsKCSAgcmV0dXJuIHZhbHVlID09IFBPTFlGSUxMID8gdHJ1ZQoJICAgIDogdmFsdWUgPT0gTkFUSVZFID8gZmFsc2UKCSAgICA6IGlzQ2FsbGFibGUkOChkZXRlY3Rpb24pID8gZmFpbHMkYihkZXRlY3Rpb24pCgkgICAgOiAhIWRldGVjdGlvbjsKCX07CgoJdmFyIG5vcm1hbGl6ZSA9IGlzRm9yY2VkJDEubm9ybWFsaXplID0gZnVuY3Rpb24gKHN0cmluZykgewoJICByZXR1cm4gU3RyaW5nKHN0cmluZykucmVwbGFjZShyZXBsYWNlbWVudCwgJy4nKS50b0xvd2VyQ2FzZSgpOwoJfTsKCgl2YXIgZGF0YSA9IGlzRm9yY2VkJDEuZGF0YSA9IHt9OwoJdmFyIE5BVElWRSA9IGlzRm9yY2VkJDEuTkFUSVZFID0gJ04nOwoJdmFyIFBPTFlGSUxMID0gaXNGb3JjZWQkMS5QT0xZRklMTCA9ICdQJzsKCgl2YXIgaXNGb3JjZWRfMSA9IGlzRm9yY2VkJDE7CgoJdmFyIGdsb2JhbCRvID0gZ2xvYmFsJEk7Cgl2YXIgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID0gb2JqZWN0R2V0T3duUHJvcGVydHlEZXNjcmlwdG9yLmY7Cgl2YXIgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5JDQgPSBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkkNzsKCXZhciByZWRlZmluZSQ1ID0gcmVkZWZpbmUkNi5leHBvcnRzOwoJdmFyIHNldEdsb2JhbCA9IHNldEdsb2JhbCQzOwoJdmFyIGNvcHlDb25zdHJ1Y3RvclByb3BlcnRpZXMgPSBjb3B5Q29uc3RydWN0b3JQcm9wZXJ0aWVzJDE7Cgl2YXIgaXNGb3JjZWQgPSBpc0ZvcmNlZF8xOwoKCS8qCgkgIG9wdGlvbnMudGFyZ2V0ICAgICAgLSBuYW1lIG9mIHRoZSB0YXJnZXQgb2JqZWN0CgkgIG9wdGlvbnMuZ2xvYmFsICAgICAgLSB0YXJnZXQgaXMgdGhlIGdsb2JhbCBvYmplY3QKCSAgb3B0aW9ucy5zdGF0ICAgICAgICAtIGV4cG9ydCBhcyBzdGF0aWMgbWV0aG9kcyBvZiB0YXJnZXQKCSAgb3B0aW9ucy5wcm90byAgICAgICAtIGV4cG9ydCBhcyBwcm90b3R5cGUgbWV0aG9kcyBvZiB0YXJnZXQKCSAgb3B0aW9ucy5yZWFsICAgICAgICAtIHJlYWwgcHJvdG90eXBlIG1ldGhvZCBmb3IgdGhlIGBwdXJlYCB2ZXJzaW9uCgkgIG9wdGlvbnMuZm9yY2VkICAgICAgLSBleHBvcnQgZXZlbiBpZiB0aGUgbmF0aXZlIGZlYXR1cmUgaXMgYXZhaWxhYmxlCgkgIG9wdGlvbnMuYmluZCAgICAgICAgLSBiaW5kIG1ldGhvZHMgdG8gdGhlIHRhcmdldCwgcmVxdWlyZWQgZm9yIHRoZSBgcHVyZWAgdmVyc2lvbgoJICBvcHRpb25zLndyYXAgICAgICAgIC0gd3JhcCBjb25zdHJ1Y3RvcnMgdG8gcHJldmVudGluZyBnbG9iYWwgcG9sbHV0aW9uLCByZXF1aXJlZCBmb3IgdGhlIGBwdXJlYCB2ZXJzaW9uCgkgIG9wdGlvbnMudW5zYWZlICAgICAgLSB1c2UgdGhlIHNpbXBsZSBhc3NpZ25tZW50IG9mIHByb3BlcnR5IGluc3RlYWQgb2YgZGVsZXRlICsgZGVmaW5lUHJvcGVydHkKCSAgb3B0aW9ucy5zaGFtICAgICAgICAtIGFkZCBhIGZsYWcgdG8gbm90IGNvbXBsZXRlbHkgZnVsbCBwb2x5ZmlsbHMKCSAgb3B0aW9ucy5lbnVtZXJhYmxlICAtIGV4cG9ydCBhcyBlbnVtZXJhYmxlIHByb3BlcnR5CgkgIG9wdGlvbnMubm9UYXJnZXRHZXQgLSBwcmV2ZW50IGNhbGxpbmcgYSBnZXR0ZXIgb24gdGFyZ2V0CgkgIG9wdGlvbnMubmFtZSAgICAgICAgLSB0aGUgLm5hbWUgb2YgdGhlIGZ1bmN0aW9uIGlmIGl0IGRvZXMgbm90IG1hdGNoIHRoZSBrZXkKCSovCgl2YXIgX2V4cG9ydCA9IGZ1bmN0aW9uIChvcHRpb25zLCBzb3VyY2UpIHsKCSAgdmFyIFRBUkdFVCA9IG9wdGlvbnMudGFyZ2V0OwoJICB2YXIgR0xPQkFMID0gb3B0aW9ucy5nbG9iYWw7CgkgIHZhciBTVEFUSUMgPSBvcHRpb25zLnN0YXQ7CgkgIHZhciBGT1JDRUQsIHRhcmdldCwga2V5LCB0YXJnZXRQcm9wZXJ0eSwgc291cmNlUHJvcGVydHksIGRlc2NyaXB0b3I7CgkgIGlmIChHTE9CQUwpIHsKCSAgICB0YXJnZXQgPSBnbG9iYWwkbzsKCSAgfSBlbHNlIGlmIChTVEFUSUMpIHsKCSAgICB0YXJnZXQgPSBnbG9iYWwkb1tUQVJHRVRdIHx8IHNldEdsb2JhbChUQVJHRVQsIHt9KTsKCSAgfSBlbHNlIHsKCSAgICB0YXJnZXQgPSAoZ2xvYmFsJG9bVEFSR0VUXSB8fCB7fSkucHJvdG90eXBlOwoJICB9CgkgIGlmICh0YXJnZXQpIGZvciAoa2V5IGluIHNvdXJjZSkgewoJICAgIHNvdXJjZVByb3BlcnR5ID0gc291cmNlW2tleV07CgkgICAgaWYgKG9wdGlvbnMubm9UYXJnZXRHZXQpIHsKCSAgICAgIGRlc2NyaXB0b3IgPSBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBrZXkpOwoJICAgICAgdGFyZ2V0UHJvcGVydHkgPSBkZXNjcmlwdG9yICYmIGRlc2NyaXB0b3IudmFsdWU7CgkgICAgfSBlbHNlIHRhcmdldFByb3BlcnR5ID0gdGFyZ2V0W2tleV07CgkgICAgRk9SQ0VEID0gaXNGb3JjZWQoR0xPQkFMID8ga2V5IDogVEFSR0VUICsgKFNUQVRJQyA/ICcuJyA6ICcjJykgKyBrZXksIG9wdGlvbnMuZm9yY2VkKTsKCSAgICAvLyBjb250YWluZWQgaW4gdGFyZ2V0CgkgICAgaWYgKCFGT1JDRUQgJiYgdGFyZ2V0UHJvcGVydHkgIT09IHVuZGVmaW5lZCkgewoJICAgICAgaWYgKHR5cGVvZiBzb3VyY2VQcm9wZXJ0eSA9PSB0eXBlb2YgdGFyZ2V0UHJvcGVydHkpIGNvbnRpbnVlOwoJICAgICAgY29weUNvbnN0cnVjdG9yUHJvcGVydGllcyhzb3VyY2VQcm9wZXJ0eSwgdGFyZ2V0UHJvcGVydHkpOwoJICAgIH0KCSAgICAvLyBhZGQgYSBmbGFnIHRvIG5vdCBjb21wbGV0ZWx5IGZ1bGwgcG9seWZpbGxzCgkgICAgaWYgKG9wdGlvbnMuc2hhbSB8fCAodGFyZ2V0UHJvcGVydHkgJiYgdGFyZ2V0UHJvcGVydHkuc2hhbSkpIHsKCSAgICAgIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSQ0KHNvdXJjZVByb3BlcnR5LCAnc2hhbScsIHRydWUpOwoJICAgIH0KCSAgICAvLyBleHRlbmQgZ2xvYmFsCgkgICAgcmVkZWZpbmUkNSh0YXJnZXQsIGtleSwgc291cmNlUHJvcGVydHksIG9wdGlvbnMpOwoJICB9Cgl9OwoKCXZhciBmYWlscyRhID0gZmFpbHMkZzsKCgl2YXIgY29ycmVjdFByb3RvdHlwZUdldHRlciA9ICFmYWlscyRhKGZ1bmN0aW9uICgpIHsKCSAgZnVuY3Rpb24gRigpIHsgLyogZW1wdHkgKi8gfQoJICBGLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IG51bGw7CgkgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBlcy9uby1vYmplY3QtZ2V0cHJvdG90eXBlb2YgLS0gcmVxdWlyZWQgZm9yIHRlc3RpbmcKCSAgcmV0dXJuIE9iamVjdC5nZXRQcm90b3R5cGVPZihuZXcgRigpKSAhPT0gRi5wcm90b3R5cGU7Cgl9KTsKCgl2YXIgZ2xvYmFsJG4gPSBnbG9iYWwkSTsKCXZhciBoYXNPd24kMyA9IGhhc093blByb3BlcnR5XzE7Cgl2YXIgaXNDYWxsYWJsZSQ3ID0gaXNDYWxsYWJsZSRoOwoJdmFyIHRvT2JqZWN0JDggPSB0b09iamVjdCRhOwoJdmFyIHNoYXJlZEtleSA9IHNoYXJlZEtleSQzOwoJdmFyIENPUlJFQ1RfUFJPVE9UWVBFX0dFVFRFUiA9IGNvcnJlY3RQcm90b3R5cGVHZXR0ZXI7CgoJdmFyIElFX1BST1RPID0gc2hhcmVkS2V5KCdJRV9QUk9UTycpOwoJdmFyIE9iamVjdCQyID0gZ2xvYmFsJG4uT2JqZWN0OwoJdmFyIE9iamVjdFByb3RvdHlwZSQyID0gT2JqZWN0JDIucHJvdG90eXBlOwoKCS8vIGBPYmplY3QuZ2V0UHJvdG90eXBlT2ZgIG1ldGhvZAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1vYmplY3QuZ2V0cHJvdG90eXBlb2YKCXZhciBvYmplY3RHZXRQcm90b3R5cGVPZiA9IENPUlJFQ1RfUFJPVE9UWVBFX0dFVFRFUiA/IE9iamVjdCQyLmdldFByb3RvdHlwZU9mIDogZnVuY3Rpb24gKE8pIHsKCSAgdmFyIG9iamVjdCA9IHRvT2JqZWN0JDgoTyk7CgkgIGlmIChoYXNPd24kMyhvYmplY3QsIElFX1BST1RPKSkgcmV0dXJuIG9iamVjdFtJRV9QUk9UT107CgkgIHZhciBjb25zdHJ1Y3RvciA9IG9iamVjdC5jb25zdHJ1Y3RvcjsKCSAgaWYgKGlzQ2FsbGFibGUkNyhjb25zdHJ1Y3RvcikgJiYgb2JqZWN0IGluc3RhbmNlb2YgY29uc3RydWN0b3IpIHsKCSAgICByZXR1cm4gY29uc3RydWN0b3IucHJvdG90eXBlOwoJICB9IHJldHVybiBvYmplY3QgaW5zdGFuY2VvZiBPYmplY3QkMiA/IE9iamVjdFByb3RvdHlwZSQyIDogbnVsbDsKCX07CgoJdmFyIGZhaWxzJDkgPSBmYWlscyRnOwoJdmFyIGlzQ2FsbGFibGUkNiA9IGlzQ2FsbGFibGUkaDsKCXZhciBnZXRQcm90b3R5cGVPZiQzID0gb2JqZWN0R2V0UHJvdG90eXBlT2Y7Cgl2YXIgcmVkZWZpbmUkNCA9IHJlZGVmaW5lJDYuZXhwb3J0czsKCXZhciB3ZWxsS25vd25TeW1ib2wkYyA9IHdlbGxLbm93blN5bWJvbCRmOwoKCXZhciBJVEVSQVRPUiQ1ID0gd2VsbEtub3duU3ltYm9sJGMoJ2l0ZXJhdG9yJyk7Cgl2YXIgQlVHR1lfU0FGQVJJX0lURVJBVE9SUyQxID0gZmFsc2U7CgoJLy8gYCVJdGVyYXRvclByb3RvdHlwZSVgIG9iamVjdAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy0laXRlcmF0b3Jwcm90b3R5cGUlLW9iamVjdAoJdmFyIEl0ZXJhdG9yUHJvdG90eXBlJDIsIFByb3RvdHlwZU9mQXJyYXlJdGVyYXRvclByb3RvdHlwZSwgYXJyYXlJdGVyYXRvcjsKCgkvKiBlc2xpbnQtZGlzYWJsZSBlcy9uby1hcnJheS1wcm90b3R5cGUta2V5cyAtLSBzYWZlICovCglpZiAoW10ua2V5cykgewoJICBhcnJheUl0ZXJhdG9yID0gW10ua2V5cygpOwoJICAvLyBTYWZhcmkgOCBoYXMgYnVnZ3kgaXRlcmF0b3JzIHcvbyBgbmV4dGAKCSAgaWYgKCEoJ25leHQnIGluIGFycmF5SXRlcmF0b3IpKSBCVUdHWV9TQUZBUklfSVRFUkFUT1JTJDEgPSB0cnVlOwoJICBlbHNlIHsKCSAgICBQcm90b3R5cGVPZkFycmF5SXRlcmF0b3JQcm90b3R5cGUgPSBnZXRQcm90b3R5cGVPZiQzKGdldFByb3RvdHlwZU9mJDMoYXJyYXlJdGVyYXRvcikpOwoJICAgIGlmIChQcm90b3R5cGVPZkFycmF5SXRlcmF0b3JQcm90b3R5cGUgIT09IE9iamVjdC5wcm90b3R5cGUpIEl0ZXJhdG9yUHJvdG90eXBlJDIgPSBQcm90b3R5cGVPZkFycmF5SXRlcmF0b3JQcm90b3R5cGU7CgkgIH0KCX0KCgl2YXIgTkVXX0lURVJBVE9SX1BST1RPVFlQRSA9IEl0ZXJhdG9yUHJvdG90eXBlJDIgPT0gdW5kZWZpbmVkIHx8IGZhaWxzJDkoZnVuY3Rpb24gKCkgewoJICB2YXIgdGVzdCA9IHt9OwoJICAvLyBGRjQ0LSBsZWdhY3kgaXRlcmF0b3JzIGNhc2UKCSAgcmV0dXJuIEl0ZXJhdG9yUHJvdG90eXBlJDJbSVRFUkFUT1IkNV0uY2FsbCh0ZXN0KSAhPT0gdGVzdDsKCX0pOwoKCWlmIChORVdfSVRFUkFUT1JfUFJPVE9UWVBFKSBJdGVyYXRvclByb3RvdHlwZSQyID0ge307CgoJLy8gYCVJdGVyYXRvclByb3RvdHlwZSVbQEBpdGVyYXRvcl0oKWAgbWV0aG9kCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLSVpdGVyYXRvcnByb3RvdHlwZSUtQEBpdGVyYXRvcgoJaWYgKCFpc0NhbGxhYmxlJDYoSXRlcmF0b3JQcm90b3R5cGUkMltJVEVSQVRPUiQ1XSkpIHsKCSAgcmVkZWZpbmUkNChJdGVyYXRvclByb3RvdHlwZSQyLCBJVEVSQVRPUiQ1LCBmdW5jdGlvbiAoKSB7CgkgICAgcmV0dXJuIHRoaXM7CgkgIH0pOwoJfQoKCXZhciBpdGVyYXRvcnNDb3JlID0gewoJICBJdGVyYXRvclByb3RvdHlwZTogSXRlcmF0b3JQcm90b3R5cGUkMiwKCSAgQlVHR1lfU0FGQVJJX0lURVJBVE9SUzogQlVHR1lfU0FGQVJJX0lURVJBVE9SUyQxCgl9OwoKCXZhciBkZWZpbmVQcm9wZXJ0eSQyID0gb2JqZWN0RGVmaW5lUHJvcGVydHkuZjsKCXZhciBoYXNPd24kMiA9IGhhc093blByb3BlcnR5XzE7Cgl2YXIgd2VsbEtub3duU3ltYm9sJGIgPSB3ZWxsS25vd25TeW1ib2wkZjsKCgl2YXIgVE9fU1RSSU5HX1RBRyQzID0gd2VsbEtub3duU3ltYm9sJGIoJ3RvU3RyaW5nVGFnJyk7CgoJdmFyIHNldFRvU3RyaW5nVGFnJDMgPSBmdW5jdGlvbiAoaXQsIFRBRywgU1RBVElDKSB7CgkgIGlmIChpdCAmJiAhaGFzT3duJDIoaXQgPSBTVEFUSUMgPyBpdCA6IGl0LnByb3RvdHlwZSwgVE9fU1RSSU5HX1RBRyQzKSkgewoJICAgIGRlZmluZVByb3BlcnR5JDIoaXQsIFRPX1NUUklOR19UQUckMywgeyBjb25maWd1cmFibGU6IHRydWUsIHZhbHVlOiBUQUcgfSk7CgkgIH0KCX07CgoJdmFyIEl0ZXJhdG9yUHJvdG90eXBlJDEgPSBpdGVyYXRvcnNDb3JlLkl0ZXJhdG9yUHJvdG90eXBlOwoJdmFyIGNyZWF0ZSQxID0gb2JqZWN0Q3JlYXRlOwoJdmFyIGNyZWF0ZVByb3BlcnR5RGVzY3JpcHRvciQyID0gY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yJDU7Cgl2YXIgc2V0VG9TdHJpbmdUYWckMiA9IHNldFRvU3RyaW5nVGFnJDM7Cgl2YXIgSXRlcmF0b3JzJDQgPSBpdGVyYXRvcnM7CgoJdmFyIHJldHVyblRoaXMkMSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH07CgoJdmFyIGNyZWF0ZUl0ZXJhdG9yQ29uc3RydWN0b3IkMSA9IGZ1bmN0aW9uIChJdGVyYXRvckNvbnN0cnVjdG9yLCBOQU1FLCBuZXh0KSB7CgkgIHZhciBUT19TVFJJTkdfVEFHID0gTkFNRSArICcgSXRlcmF0b3InOwoJICBJdGVyYXRvckNvbnN0cnVjdG9yLnByb3RvdHlwZSA9IGNyZWF0ZSQxKEl0ZXJhdG9yUHJvdG90eXBlJDEsIHsgbmV4dDogY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yJDIoMSwgbmV4dCkgfSk7CgkgIHNldFRvU3RyaW5nVGFnJDIoSXRlcmF0b3JDb25zdHJ1Y3RvciwgVE9fU1RSSU5HX1RBRywgZmFsc2UpOwoJICBJdGVyYXRvcnMkNFtUT19TVFJJTkdfVEFHXSA9IHJldHVyblRoaXMkMTsKCSAgcmV0dXJuIEl0ZXJhdG9yQ29uc3RydWN0b3I7Cgl9OwoKCXZhciBnbG9iYWwkbSA9IGdsb2JhbCRJOwoJdmFyIGlzQ2FsbGFibGUkNSA9IGlzQ2FsbGFibGUkaDsKCgl2YXIgU3RyaW5nJDEgPSBnbG9iYWwkbS5TdHJpbmc7Cgl2YXIgVHlwZUVycm9yJDUgPSBnbG9iYWwkbS5UeXBlRXJyb3I7CgoJdmFyIGFQb3NzaWJsZVByb3RvdHlwZSQxID0gZnVuY3Rpb24gKGFyZ3VtZW50KSB7CgkgIGlmICh0eXBlb2YgYXJndW1lbnQgPT0gJ29iamVjdCcgfHwgaXNDYWxsYWJsZSQ1KGFyZ3VtZW50KSkgcmV0dXJuIGFyZ3VtZW50OwoJICB0aHJvdyBUeXBlRXJyb3IkNSgiQ2FuJ3Qgc2V0ICIgKyBTdHJpbmckMShhcmd1bWVudCkgKyAnIGFzIGEgcHJvdG90eXBlJyk7Cgl9OwoKCS8qIGVzbGludC1kaXNhYmxlIG5vLXByb3RvIC0tIHNhZmUgKi8KCgl2YXIgdW5jdXJyeVRoaXMkYyA9IGZ1bmN0aW9uVW5jdXJyeVRoaXM7Cgl2YXIgYW5PYmplY3QkMiA9IGFuT2JqZWN0JDc7Cgl2YXIgYVBvc3NpYmxlUHJvdG90eXBlID0gYVBvc3NpYmxlUHJvdG90eXBlJDE7CgoJLy8gYE9iamVjdC5zZXRQcm90b3R5cGVPZmAgbWV0aG9kCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLW9iamVjdC5zZXRwcm90b3R5cGVvZgoJLy8gV29ya3Mgd2l0aCBfX3Byb3RvX18gb25seS4gT2xkIHY4IGNhbid0IHdvcmsgd2l0aCBudWxsIHByb3RvIG9iamVjdHMuCgkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZXMvbm8tb2JqZWN0LXNldHByb3RvdHlwZW9mIC0tIHNhZmUKCXZhciBvYmplY3RTZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCAoJ19fcHJvdG9fXycgaW4ge30gPyBmdW5jdGlvbiAoKSB7CgkgIHZhciBDT1JSRUNUX1NFVFRFUiA9IGZhbHNlOwoJICB2YXIgdGVzdCA9IHt9OwoJICB2YXIgc2V0dGVyOwoJICB0cnkgewoJICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBlcy9uby1vYmplY3QtZ2V0b3ducHJvcGVydHlkZXNjcmlwdG9yIC0tIHNhZmUKCSAgICBzZXR0ZXIgPSB1bmN1cnJ5VGhpcyRjKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoT2JqZWN0LnByb3RvdHlwZSwgJ19fcHJvdG9fXycpLnNldCk7CgkgICAgc2V0dGVyKHRlc3QsIFtdKTsKCSAgICBDT1JSRUNUX1NFVFRFUiA9IHRlc3QgaW5zdGFuY2VvZiBBcnJheTsKCSAgfSBjYXRjaCAoZXJyb3IpIHsgLyogZW1wdHkgKi8gfQoJICByZXR1cm4gZnVuY3Rpb24gc2V0UHJvdG90eXBlT2YoTywgcHJvdG8pIHsKCSAgICBhbk9iamVjdCQyKE8pOwoJICAgIGFQb3NzaWJsZVByb3RvdHlwZShwcm90byk7CgkgICAgaWYgKENPUlJFQ1RfU0VUVEVSKSBzZXR0ZXIoTywgcHJvdG8pOwoJICAgIGVsc2UgTy5fX3Byb3RvX18gPSBwcm90bzsKCSAgICByZXR1cm4gTzsKCSAgfTsKCX0oKSA6IHVuZGVmaW5lZCk7CgoJdmFyICQkMiA9IF9leHBvcnQ7Cgl2YXIgY2FsbCQ1ID0gZnVuY3Rpb25DYWxsOwoJdmFyIEZ1bmN0aW9uTmFtZSQxID0gZnVuY3Rpb25OYW1lOwoJdmFyIGlzQ2FsbGFibGUkNCA9IGlzQ2FsbGFibGUkaDsKCXZhciBjcmVhdGVJdGVyYXRvckNvbnN0cnVjdG9yID0gY3JlYXRlSXRlcmF0b3JDb25zdHJ1Y3RvciQxOwoJdmFyIGdldFByb3RvdHlwZU9mJDIgPSBvYmplY3RHZXRQcm90b3R5cGVPZjsKCXZhciBzZXRQcm90b3R5cGVPZiQ0ID0gb2JqZWN0U2V0UHJvdG90eXBlT2Y7Cgl2YXIgc2V0VG9TdHJpbmdUYWckMSA9IHNldFRvU3RyaW5nVGFnJDM7Cgl2YXIgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5JDMgPSBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkkNzsKCXZhciByZWRlZmluZSQzID0gcmVkZWZpbmUkNi5leHBvcnRzOwoJdmFyIHdlbGxLbm93blN5bWJvbCRhID0gd2VsbEtub3duU3ltYm9sJGY7Cgl2YXIgSXRlcmF0b3JzJDMgPSBpdGVyYXRvcnM7Cgl2YXIgSXRlcmF0b3JzQ29yZSA9IGl0ZXJhdG9yc0NvcmU7CgoJdmFyIFBST1BFUl9GVU5DVElPTl9OQU1FJDIgPSBGdW5jdGlvbk5hbWUkMS5QUk9QRVI7Cgl2YXIgQ09ORklHVVJBQkxFX0ZVTkNUSU9OX05BTUUkMSA9IEZ1bmN0aW9uTmFtZSQxLkNPTkZJR1VSQUJMRTsKCXZhciBJdGVyYXRvclByb3RvdHlwZSA9IEl0ZXJhdG9yc0NvcmUuSXRlcmF0b3JQcm90b3R5cGU7Cgl2YXIgQlVHR1lfU0FGQVJJX0lURVJBVE9SUyA9IEl0ZXJhdG9yc0NvcmUuQlVHR1lfU0FGQVJJX0lURVJBVE9SUzsKCXZhciBJVEVSQVRPUiQ0ID0gd2VsbEtub3duU3ltYm9sJGEoJ2l0ZXJhdG9yJyk7Cgl2YXIgS0VZUyA9ICdrZXlzJzsKCXZhciBWQUxVRVMgPSAndmFsdWVzJzsKCXZhciBFTlRSSUVTID0gJ2VudHJpZXMnOwoKCXZhciByZXR1cm5UaGlzID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpczsgfTsKCgl2YXIgZGVmaW5lSXRlcmF0b3IkMSA9IGZ1bmN0aW9uIChJdGVyYWJsZSwgTkFNRSwgSXRlcmF0b3JDb25zdHJ1Y3RvciwgbmV4dCwgREVGQVVMVCwgSVNfU0VULCBGT1JDRUQpIHsKCSAgY3JlYXRlSXRlcmF0b3JDb25zdHJ1Y3RvcihJdGVyYXRvckNvbnN0cnVjdG9yLCBOQU1FLCBuZXh0KTsKCgkgIHZhciBnZXRJdGVyYXRpb25NZXRob2QgPSBmdW5jdGlvbiAoS0lORCkgewoJICAgIGlmIChLSU5EID09PSBERUZBVUxUICYmIGRlZmF1bHRJdGVyYXRvcikgcmV0dXJuIGRlZmF1bHRJdGVyYXRvcjsKCSAgICBpZiAoIUJVR0dZX1NBRkFSSV9JVEVSQVRPUlMgJiYgS0lORCBpbiBJdGVyYWJsZVByb3RvdHlwZSkgcmV0dXJuIEl0ZXJhYmxlUHJvdG90eXBlW0tJTkRdOwoJICAgIHN3aXRjaCAoS0lORCkgewoJICAgICAgY2FzZSBLRVlTOiByZXR1cm4gZnVuY3Rpb24ga2V5cygpIHsgcmV0dXJuIG5ldyBJdGVyYXRvckNvbnN0cnVjdG9yKHRoaXMsIEtJTkQpOyB9OwoJICAgICAgY2FzZSBWQUxVRVM6IHJldHVybiBmdW5jdGlvbiB2YWx1ZXMoKSB7IHJldHVybiBuZXcgSXRlcmF0b3JDb25zdHJ1Y3Rvcih0aGlzLCBLSU5EKTsgfTsKCSAgICAgIGNhc2UgRU5UUklFUzogcmV0dXJuIGZ1bmN0aW9uIGVudHJpZXMoKSB7IHJldHVybiBuZXcgSXRlcmF0b3JDb25zdHJ1Y3Rvcih0aGlzLCBLSU5EKTsgfTsKCSAgICB9IHJldHVybiBmdW5jdGlvbiAoKSB7IHJldHVybiBuZXcgSXRlcmF0b3JDb25zdHJ1Y3Rvcih0aGlzKTsgfTsKCSAgfTsKCgkgIHZhciBUT19TVFJJTkdfVEFHID0gTkFNRSArICcgSXRlcmF0b3InOwoJICB2YXIgSU5DT1JSRUNUX1ZBTFVFU19OQU1FID0gZmFsc2U7CgkgIHZhciBJdGVyYWJsZVByb3RvdHlwZSA9IEl0ZXJhYmxlLnByb3RvdHlwZTsKCSAgdmFyIG5hdGl2ZUl0ZXJhdG9yID0gSXRlcmFibGVQcm90b3R5cGVbSVRFUkFUT1IkNF0KCSAgICB8fCBJdGVyYWJsZVByb3RvdHlwZVsnQEBpdGVyYXRvciddCgkgICAgfHwgREVGQVVMVCAmJiBJdGVyYWJsZVByb3RvdHlwZVtERUZBVUxUXTsKCSAgdmFyIGRlZmF1bHRJdGVyYXRvciA9ICFCVUdHWV9TQUZBUklfSVRFUkFUT1JTICYmIG5hdGl2ZUl0ZXJhdG9yIHx8IGdldEl0ZXJhdGlvbk1ldGhvZChERUZBVUxUKTsKCSAgdmFyIGFueU5hdGl2ZUl0ZXJhdG9yID0gTkFNRSA9PSAnQXJyYXknID8gSXRlcmFibGVQcm90b3R5cGUuZW50cmllcyB8fCBuYXRpdmVJdGVyYXRvciA6IG5hdGl2ZUl0ZXJhdG9yOwoJICB2YXIgQ3VycmVudEl0ZXJhdG9yUHJvdG90eXBlLCBtZXRob2RzLCBLRVk7CgoJICAvLyBmaXggbmF0aXZlCgkgIGlmIChhbnlOYXRpdmVJdGVyYXRvcikgewoJICAgIEN1cnJlbnRJdGVyYXRvclByb3RvdHlwZSA9IGdldFByb3RvdHlwZU9mJDIoYW55TmF0aXZlSXRlcmF0b3IuY2FsbChuZXcgSXRlcmFibGUoKSkpOwoJICAgIGlmIChDdXJyZW50SXRlcmF0b3JQcm90b3R5cGUgIT09IE9iamVjdC5wcm90b3R5cGUgJiYgQ3VycmVudEl0ZXJhdG9yUHJvdG90eXBlLm5leHQpIHsKCSAgICAgIGlmIChnZXRQcm90b3R5cGVPZiQyKEN1cnJlbnRJdGVyYXRvclByb3RvdHlwZSkgIT09IEl0ZXJhdG9yUHJvdG90eXBlKSB7CgkgICAgICAgIGlmIChzZXRQcm90b3R5cGVPZiQ0KSB7CgkgICAgICAgICAgc2V0UHJvdG90eXBlT2YkNChDdXJyZW50SXRlcmF0b3JQcm90b3R5cGUsIEl0ZXJhdG9yUHJvdG90eXBlKTsKCSAgICAgICAgfSBlbHNlIGlmICghaXNDYWxsYWJsZSQ0KEN1cnJlbnRJdGVyYXRvclByb3RvdHlwZVtJVEVSQVRPUiQ0XSkpIHsKCSAgICAgICAgICByZWRlZmluZSQzKEN1cnJlbnRJdGVyYXRvclByb3RvdHlwZSwgSVRFUkFUT1IkNCwgcmV0dXJuVGhpcyk7CgkgICAgICAgIH0KCSAgICAgIH0KCSAgICAgIC8vIFNldCBAQHRvU3RyaW5nVGFnIHRvIG5hdGl2ZSBpdGVyYXRvcnMKCSAgICAgIHNldFRvU3RyaW5nVGFnJDEoQ3VycmVudEl0ZXJhdG9yUHJvdG90eXBlLCBUT19TVFJJTkdfVEFHLCB0cnVlKTsKCSAgICB9CgkgIH0KCgkgIC8vIGZpeCBBcnJheS5wcm90b3R5cGUueyB2YWx1ZXMsIEBAaXRlcmF0b3IgfS5uYW1lIGluIFY4IC8gRkYKCSAgaWYgKFBST1BFUl9GVU5DVElPTl9OQU1FJDIgJiYgREVGQVVMVCA9PSBWQUxVRVMgJiYgbmF0aXZlSXRlcmF0b3IgJiYgbmF0aXZlSXRlcmF0b3IubmFtZSAhPT0gVkFMVUVTKSB7CgkgICAgaWYgKENPTkZJR1VSQUJMRV9GVU5DVElPTl9OQU1FJDEpIHsKCSAgICAgIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSQzKEl0ZXJhYmxlUHJvdG90eXBlLCAnbmFtZScsIFZBTFVFUyk7CgkgICAgfSBlbHNlIHsKCSAgICAgIElOQ09SUkVDVF9WQUxVRVNfTkFNRSA9IHRydWU7CgkgICAgICBkZWZhdWx0SXRlcmF0b3IgPSBmdW5jdGlvbiB2YWx1ZXMoKSB7IHJldHVybiBjYWxsJDUobmF0aXZlSXRlcmF0b3IsIHRoaXMpOyB9OwoJICAgIH0KCSAgfQoKCSAgLy8gZXhwb3J0IGFkZGl0aW9uYWwgbWV0aG9kcwoJICBpZiAoREVGQVVMVCkgewoJICAgIG1ldGhvZHMgPSB7CgkgICAgICB2YWx1ZXM6IGdldEl0ZXJhdGlvbk1ldGhvZChWQUxVRVMpLAoJICAgICAga2V5czogSVNfU0VUID8gZGVmYXVsdEl0ZXJhdG9yIDogZ2V0SXRlcmF0aW9uTWV0aG9kKEtFWVMpLAoJICAgICAgZW50cmllczogZ2V0SXRlcmF0aW9uTWV0aG9kKEVOVFJJRVMpCgkgICAgfTsKCSAgICBpZiAoRk9SQ0VEKSBmb3IgKEtFWSBpbiBtZXRob2RzKSB7CgkgICAgICBpZiAoQlVHR1lfU0FGQVJJX0lURVJBVE9SUyB8fCBJTkNPUlJFQ1RfVkFMVUVTX05BTUUgfHwgIShLRVkgaW4gSXRlcmFibGVQcm90b3R5cGUpKSB7CgkgICAgICAgIHJlZGVmaW5lJDMoSXRlcmFibGVQcm90b3R5cGUsIEtFWSwgbWV0aG9kc1tLRVldKTsKCSAgICAgIH0KCSAgICB9IGVsc2UgJCQyKHsgdGFyZ2V0OiBOQU1FLCBwcm90bzogdHJ1ZSwgZm9yY2VkOiBCVUdHWV9TQUZBUklfSVRFUkFUT1JTIHx8IElOQ09SUkVDVF9WQUxVRVNfTkFNRSB9LCBtZXRob2RzKTsKCSAgfQoKCSAgLy8gZGVmaW5lIGl0ZXJhdG9yCgkgIGlmIChJdGVyYWJsZVByb3RvdHlwZVtJVEVSQVRPUiQ0XSAhPT0gZGVmYXVsdEl0ZXJhdG9yKSB7CgkgICAgcmVkZWZpbmUkMyhJdGVyYWJsZVByb3RvdHlwZSwgSVRFUkFUT1IkNCwgZGVmYXVsdEl0ZXJhdG9yLCB7IG5hbWU6IERFRkFVTFQgfSk7CgkgIH0KCSAgSXRlcmF0b3JzJDNbTkFNRV0gPSBkZWZhdWx0SXRlcmF0b3I7CgoJICByZXR1cm4gbWV0aG9kczsKCX07CgoJdmFyIHRvSW5kZXhlZE9iamVjdCQxID0gdG9JbmRleGVkT2JqZWN0JDY7Cgl2YXIgYWRkVG9VbnNjb3BhYmxlcyA9IGFkZFRvVW5zY29wYWJsZXMkMTsKCXZhciBJdGVyYXRvcnMkMiA9IGl0ZXJhdG9yczsKCXZhciBJbnRlcm5hbFN0YXRlTW9kdWxlJDIgPSBpbnRlcm5hbFN0YXRlOwoJdmFyIGRlZmluZUl0ZXJhdG9yID0gZGVmaW5lSXRlcmF0b3IkMTsKCgl2YXIgQVJSQVlfSVRFUkFUT1IgPSAnQXJyYXkgSXRlcmF0b3InOwoJdmFyIHNldEludGVybmFsU3RhdGUkMiA9IEludGVybmFsU3RhdGVNb2R1bGUkMi5zZXQ7Cgl2YXIgZ2V0SW50ZXJuYWxTdGF0ZSQyID0gSW50ZXJuYWxTdGF0ZU1vZHVsZSQyLmdldHRlckZvcihBUlJBWV9JVEVSQVRPUik7CgoJLy8gYEFycmF5LnByb3RvdHlwZS5lbnRyaWVzYCBtZXRob2QKCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtYXJyYXkucHJvdG90eXBlLmVudHJpZXMKCS8vIGBBcnJheS5wcm90b3R5cGUua2V5c2AgbWV0aG9kCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLWFycmF5LnByb3RvdHlwZS5rZXlzCgkvLyBgQXJyYXkucHJvdG90eXBlLnZhbHVlc2AgbWV0aG9kCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLWFycmF5LnByb3RvdHlwZS52YWx1ZXMKCS8vIGBBcnJheS5wcm90b3R5cGVbQEBpdGVyYXRvcl1gIG1ldGhvZAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1hcnJheS5wcm90b3R5cGUtQEBpdGVyYXRvcgoJLy8gYENyZWF0ZUFycmF5SXRlcmF0b3JgIGludGVybmFsIG1ldGhvZAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1jcmVhdGVhcnJheWl0ZXJhdG9yCgl2YXIgZXNfYXJyYXlfaXRlcmF0b3IgPSBkZWZpbmVJdGVyYXRvcihBcnJheSwgJ0FycmF5JywgZnVuY3Rpb24gKGl0ZXJhdGVkLCBraW5kKSB7CgkgIHNldEludGVybmFsU3RhdGUkMih0aGlzLCB7CgkgICAgdHlwZTogQVJSQVlfSVRFUkFUT1IsCgkgICAgdGFyZ2V0OiB0b0luZGV4ZWRPYmplY3QkMShpdGVyYXRlZCksIC8vIHRhcmdldAoJICAgIGluZGV4OiAwLCAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbmV4dCBpbmRleAoJICAgIGtpbmQ6IGtpbmQgICAgICAgICAgICAgICAgICAgICAgICAgLy8ga2luZAoJICB9KTsKCS8vIGAlQXJyYXlJdGVyYXRvclByb3RvdHlwZSUubmV4dGAgbWV0aG9kCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLSVhcnJheWl0ZXJhdG9ycHJvdG90eXBlJS5uZXh0Cgl9LCBmdW5jdGlvbiAoKSB7CgkgIHZhciBzdGF0ZSA9IGdldEludGVybmFsU3RhdGUkMih0aGlzKTsKCSAgdmFyIHRhcmdldCA9IHN0YXRlLnRhcmdldDsKCSAgdmFyIGtpbmQgPSBzdGF0ZS5raW5kOwoJICB2YXIgaW5kZXggPSBzdGF0ZS5pbmRleCsrOwoJICBpZiAoIXRhcmdldCB8fCBpbmRleCA+PSB0YXJnZXQubGVuZ3RoKSB7CgkgICAgc3RhdGUudGFyZ2V0ID0gdW5kZWZpbmVkOwoJICAgIHJldHVybiB7IHZhbHVlOiB1bmRlZmluZWQsIGRvbmU6IHRydWUgfTsKCSAgfQoJICBpZiAoa2luZCA9PSAna2V5cycpIHJldHVybiB7IHZhbHVlOiBpbmRleCwgZG9uZTogZmFsc2UgfTsKCSAgaWYgKGtpbmQgPT0gJ3ZhbHVlcycpIHJldHVybiB7IHZhbHVlOiB0YXJnZXRbaW5kZXhdLCBkb25lOiBmYWxzZSB9OwoJICByZXR1cm4geyB2YWx1ZTogW2luZGV4LCB0YXJnZXRbaW5kZXhdXSwgZG9uZTogZmFsc2UgfTsKCX0sICd2YWx1ZXMnKTsKCgkvLyBhcmd1bWVudHNMaXN0W0BAaXRlcmF0b3JdIGlzICVBcnJheVByb3RvX3ZhbHVlcyUKCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtY3JlYXRldW5tYXBwZWRhcmd1bWVudHNvYmplY3QKCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtY3JlYXRlbWFwcGVkYXJndW1lbnRzb2JqZWN0CglJdGVyYXRvcnMkMi5Bcmd1bWVudHMgPSBJdGVyYXRvcnMkMi5BcnJheTsKCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLWFycmF5LnByb3RvdHlwZS1AQHVuc2NvcGFibGVzCglhZGRUb1Vuc2NvcGFibGVzKCdrZXlzJyk7CglhZGRUb1Vuc2NvcGFibGVzKCd2YWx1ZXMnKTsKCWFkZFRvVW5zY29wYWJsZXMoJ2VudHJpZXMnKTsKCgl2YXIgd2VsbEtub3duU3ltYm9sJDkgPSB3ZWxsS25vd25TeW1ib2wkZjsKCgl2YXIgVE9fU1RSSU5HX1RBRyQyID0gd2VsbEtub3duU3ltYm9sJDkoJ3RvU3RyaW5nVGFnJyk7Cgl2YXIgdGVzdCA9IHt9OwoKCXRlc3RbVE9fU1RSSU5HX1RBRyQyXSA9ICd6JzsKCgl2YXIgdG9TdHJpbmdUYWdTdXBwb3J0ID0gU3RyaW5nKHRlc3QpID09PSAnW29iamVjdCB6XSc7CgoJdmFyIGdsb2JhbCRsID0gZ2xvYmFsJEk7Cgl2YXIgVE9fU1RSSU5HX1RBR19TVVBQT1JUJDIgPSB0b1N0cmluZ1RhZ1N1cHBvcnQ7Cgl2YXIgaXNDYWxsYWJsZSQzID0gaXNDYWxsYWJsZSRoOwoJdmFyIGNsYXNzb2ZSYXcgPSBjbGFzc29mUmF3JDE7Cgl2YXIgd2VsbEtub3duU3ltYm9sJDggPSB3ZWxsS25vd25TeW1ib2wkZjsKCgl2YXIgVE9fU1RSSU5HX1RBRyQxID0gd2VsbEtub3duU3ltYm9sJDgoJ3RvU3RyaW5nVGFnJyk7Cgl2YXIgT2JqZWN0JDEgPSBnbG9iYWwkbC5PYmplY3Q7CgoJLy8gRVMzIHdyb25nIGhlcmUKCXZhciBDT1JSRUNUX0FSR1VNRU5UUyA9IGNsYXNzb2ZSYXcoZnVuY3Rpb24gKCkgeyByZXR1cm4gYXJndW1lbnRzOyB9KCkpID09ICdBcmd1bWVudHMnOwoKCS8vIGZhbGxiYWNrIGZvciBJRTExIFNjcmlwdCBBY2Nlc3MgRGVuaWVkIGVycm9yCgl2YXIgdHJ5R2V0ID0gZnVuY3Rpb24gKGl0LCBrZXkpIHsKCSAgdHJ5IHsKCSAgICByZXR1cm4gaXRba2V5XTsKCSAgfSBjYXRjaCAoZXJyb3IpIHsgLyogZW1wdHkgKi8gfQoJfTsKCgkvLyBnZXR0aW5nIHRhZyBmcm9tIEVTNisgYE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmdgCgl2YXIgY2xhc3NvZiQ2ID0gVE9fU1RSSU5HX1RBR19TVVBQT1JUJDIgPyBjbGFzc29mUmF3IDogZnVuY3Rpb24gKGl0KSB7CgkgIHZhciBPLCB0YWcsIHJlc3VsdDsKCSAgcmV0dXJuIGl0ID09PSB1bmRlZmluZWQgPyAnVW5kZWZpbmVkJyA6IGl0ID09PSBudWxsID8gJ051bGwnCgkgICAgLy8gQEB0b1N0cmluZ1RhZyBjYXNlCgkgICAgOiB0eXBlb2YgKHRhZyA9IHRyeUdldChPID0gT2JqZWN0JDEoaXQpLCBUT19TVFJJTkdfVEFHJDEpKSA9PSAnc3RyaW5nJyA/IHRhZwoJICAgIC8vIGJ1aWx0aW5UYWcgY2FzZQoJICAgIDogQ09SUkVDVF9BUkdVTUVOVFMgPyBjbGFzc29mUmF3KE8pCgkgICAgLy8gRVMzIGFyZ3VtZW50cyBmYWxsYmFjawoJICAgIDogKHJlc3VsdCA9IGNsYXNzb2ZSYXcoTykpID09ICdPYmplY3QnICYmIGlzQ2FsbGFibGUkMyhPLmNhbGxlZSkgPyAnQXJndW1lbnRzJyA6IHJlc3VsdDsKCX07CgoJdmFyIFRPX1NUUklOR19UQUdfU1VQUE9SVCQxID0gdG9TdHJpbmdUYWdTdXBwb3J0OwoJdmFyIGNsYXNzb2YkNSA9IGNsYXNzb2YkNjsKCgkvLyBgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZ2AgbWV0aG9kIGltcGxlbWVudGF0aW9uCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLW9iamVjdC5wcm90b3R5cGUudG9zdHJpbmcKCXZhciBvYmplY3RUb1N0cmluZyA9IFRPX1NUUklOR19UQUdfU1VQUE9SVCQxID8ge30udG9TdHJpbmcgOiBmdW5jdGlvbiB0b1N0cmluZygpIHsKCSAgcmV0dXJuICdbb2JqZWN0ICcgKyBjbGFzc29mJDUodGhpcykgKyAnXSc7Cgl9OwoKCXZhciBUT19TVFJJTkdfVEFHX1NVUFBPUlQgPSB0b1N0cmluZ1RhZ1N1cHBvcnQ7Cgl2YXIgcmVkZWZpbmUkMiA9IHJlZGVmaW5lJDYuZXhwb3J0czsKCXZhciB0b1N0cmluZyA9IG9iamVjdFRvU3RyaW5nOwoKCS8vIGBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nYCBtZXRob2QKCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtb2JqZWN0LnByb3RvdHlwZS50b3N0cmluZwoJaWYgKCFUT19TVFJJTkdfVEFHX1NVUFBPUlQpIHsKCSAgcmVkZWZpbmUkMihPYmplY3QucHJvdG90eXBlLCAndG9TdHJpbmcnLCB0b1N0cmluZywgeyB1bnNhZmU6IHRydWUgfSk7Cgl9CgoJdmFyIHR5cGVkQXJyYXlDb25zdHJ1Y3RvciA9IHtleHBvcnRzOiB7fX07CgoJdmFyIHdlbGxLbm93blN5bWJvbCQ3ID0gd2VsbEtub3duU3ltYm9sJGY7CgoJdmFyIElURVJBVE9SJDMgPSB3ZWxsS25vd25TeW1ib2wkNygnaXRlcmF0b3InKTsKCXZhciBTQUZFX0NMT1NJTkcgPSBmYWxzZTsKCgl0cnkgewoJICB2YXIgY2FsbGVkID0gMDsKCSAgdmFyIGl0ZXJhdG9yV2l0aFJldHVybiA9IHsKCSAgICBuZXh0OiBmdW5jdGlvbiAoKSB7CgkgICAgICByZXR1cm4geyBkb25lOiAhIWNhbGxlZCsrIH07CgkgICAgfSwKCSAgICAncmV0dXJuJzogZnVuY3Rpb24gKCkgewoJICAgICAgU0FGRV9DTE9TSU5HID0gdHJ1ZTsKCSAgICB9CgkgIH07CgkgIGl0ZXJhdG9yV2l0aFJldHVybltJVEVSQVRPUiQzXSA9IGZ1bmN0aW9uICgpIHsKCSAgICByZXR1cm4gdGhpczsKCSAgfTsKCSAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGVzL25vLWFycmF5LWZyb20sIG5vLXRocm93LWxpdGVyYWwgLS0gcmVxdWlyZWQgZm9yIHRlc3RpbmcKCSAgQXJyYXkuZnJvbShpdGVyYXRvcldpdGhSZXR1cm4sIGZ1bmN0aW9uICgpIHsgdGhyb3cgMjsgfSk7Cgl9IGNhdGNoIChlcnJvcikgeyAvKiBlbXB0eSAqLyB9CgoJdmFyIGNoZWNrQ29ycmVjdG5lc3NPZkl0ZXJhdGlvbiQxID0gZnVuY3Rpb24gKGV4ZWMsIFNLSVBfQ0xPU0lORykgewoJICBpZiAoIVNLSVBfQ0xPU0lORyAmJiAhU0FGRV9DTE9TSU5HKSByZXR1cm4gZmFsc2U7CgkgIHZhciBJVEVSQVRJT05fU1VQUE9SVCA9IGZhbHNlOwoJICB0cnkgewoJICAgIHZhciBvYmplY3QgPSB7fTsKCSAgICBvYmplY3RbSVRFUkFUT1IkM10gPSBmdW5jdGlvbiAoKSB7CgkgICAgICByZXR1cm4gewoJICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgcmV0dXJuIHsgZG9uZTogSVRFUkFUSU9OX1NVUFBPUlQgPSB0cnVlIH07CgkgICAgICAgIH0KCSAgICAgIH07CgkgICAgfTsKCSAgICBleGVjKG9iamVjdCk7CgkgIH0gY2F0Y2ggKGVycm9yKSB7IC8qIGVtcHR5ICovIH0KCSAgcmV0dXJuIElURVJBVElPTl9TVVBQT1JUOwoJfTsKCgkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZXMvbm8tdHlwZWQtYXJyYXlzIC0tIHNhZmUKCXZhciBhcnJheUJ1ZmZlck5hdGl2ZSA9IHR5cGVvZiBBcnJheUJ1ZmZlciAhPSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgRGF0YVZpZXcgIT0gJ3VuZGVmaW5lZCc7CgoJdmFyIE5BVElWRV9BUlJBWV9CVUZGRVIkMSA9IGFycmF5QnVmZmVyTmF0aXZlOwoJdmFyIERFU0NSSVBUT1JTJDMgPSBkZXNjcmlwdG9yczsKCXZhciBnbG9iYWwkayA9IGdsb2JhbCRJOwoJdmFyIGlzQ2FsbGFibGUkMiA9IGlzQ2FsbGFibGUkaDsKCXZhciBpc09iamVjdCQ0ID0gaXNPYmplY3QkYTsKCXZhciBoYXNPd24kMSA9IGhhc093blByb3BlcnR5XzE7Cgl2YXIgY2xhc3NvZiQ0ID0gY2xhc3NvZiQ2OwoJdmFyIHRyeVRvU3RyaW5nJDIgPSB0cnlUb1N0cmluZyQ0OwoJdmFyIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSQyID0gY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5JDc7Cgl2YXIgcmVkZWZpbmUkMSA9IHJlZGVmaW5lJDYuZXhwb3J0czsKCXZhciBkZWZpbmVQcm9wZXJ0eSQxID0gb2JqZWN0RGVmaW5lUHJvcGVydHkuZjsKCXZhciBpc1Byb3RvdHlwZU9mJDIgPSBvYmplY3RJc1Byb3RvdHlwZU9mOwoJdmFyIGdldFByb3RvdHlwZU9mJDEgPSBvYmplY3RHZXRQcm90b3R5cGVPZjsKCXZhciBzZXRQcm90b3R5cGVPZiQzID0gb2JqZWN0U2V0UHJvdG90eXBlT2Y7Cgl2YXIgd2VsbEtub3duU3ltYm9sJDYgPSB3ZWxsS25vd25TeW1ib2wkZjsKCXZhciB1aWQgPSB1aWQkMzsKCgl2YXIgSW50OEFycmF5JDMgPSBnbG9iYWwkay5JbnQ4QXJyYXk7Cgl2YXIgSW50OEFycmF5UHJvdG90eXBlID0gSW50OEFycmF5JDMgJiYgSW50OEFycmF5JDMucHJvdG90eXBlOwoJdmFyIFVpbnQ4Q2xhbXBlZEFycmF5ID0gZ2xvYmFsJGsuVWludDhDbGFtcGVkQXJyYXk7Cgl2YXIgVWludDhDbGFtcGVkQXJyYXlQcm90b3R5cGUgPSBVaW50OENsYW1wZWRBcnJheSAmJiBVaW50OENsYW1wZWRBcnJheS5wcm90b3R5cGU7Cgl2YXIgVHlwZWRBcnJheSQxID0gSW50OEFycmF5JDMgJiYgZ2V0UHJvdG90eXBlT2YkMShJbnQ4QXJyYXkkMyk7Cgl2YXIgVHlwZWRBcnJheVByb3RvdHlwZSQxID0gSW50OEFycmF5UHJvdG90eXBlICYmIGdldFByb3RvdHlwZU9mJDEoSW50OEFycmF5UHJvdG90eXBlKTsKCXZhciBPYmplY3RQcm90b3R5cGUkMSA9IE9iamVjdC5wcm90b3R5cGU7Cgl2YXIgVHlwZUVycm9yJDQgPSBnbG9iYWwkay5UeXBlRXJyb3I7CgoJdmFyIFRPX1NUUklOR19UQUcgPSB3ZWxsS25vd25TeW1ib2wkNigndG9TdHJpbmdUYWcnKTsKCXZhciBUWVBFRF9BUlJBWV9UQUckMSA9IHVpZCgnVFlQRURfQVJSQVlfVEFHJyk7Cgl2YXIgVFlQRURfQVJSQVlfQ09OU1RSVUNUT1IkMiA9IHVpZCgnVFlQRURfQVJSQVlfQ09OU1RSVUNUT1InKTsKCS8vIEZpeGluZyBuYXRpdmUgdHlwZWQgYXJyYXlzIGluIE9wZXJhIFByZXN0byBjcmFzaGVzIHRoZSBicm93c2VyLCBzZWUgIzU5NQoJdmFyIE5BVElWRV9BUlJBWV9CVUZGRVJfVklFV1MkMiA9IE5BVElWRV9BUlJBWV9CVUZGRVIkMSAmJiAhIXNldFByb3RvdHlwZU9mJDMgJiYgY2xhc3NvZiQ0KGdsb2JhbCRrLm9wZXJhKSAhPT0gJ09wZXJhJzsKCXZhciBUWVBFRF9BUlJBWV9UQUdfUkVRSVJFRCA9IGZhbHNlOwoJdmFyIE5BTUUsIENvbnN0cnVjdG9yLCBQcm90b3R5cGU7CgoJdmFyIFR5cGVkQXJyYXlDb25zdHJ1Y3RvcnNMaXN0ID0gewoJICBJbnQ4QXJyYXk6IDEsCgkgIFVpbnQ4QXJyYXk6IDEsCgkgIFVpbnQ4Q2xhbXBlZEFycmF5OiAxLAoJICBJbnQxNkFycmF5OiAyLAoJICBVaW50MTZBcnJheTogMiwKCSAgSW50MzJBcnJheTogNCwKCSAgVWludDMyQXJyYXk6IDQsCgkgIEZsb2F0MzJBcnJheTogNCwKCSAgRmxvYXQ2NEFycmF5OiA4Cgl9OwoKCXZhciBCaWdJbnRBcnJheUNvbnN0cnVjdG9yc0xpc3QgPSB7CgkgIEJpZ0ludDY0QXJyYXk6IDgsCgkgIEJpZ1VpbnQ2NEFycmF5OiA4Cgl9OwoKCXZhciBpc1ZpZXcgPSBmdW5jdGlvbiBpc1ZpZXcoaXQpIHsKCSAgaWYgKCFpc09iamVjdCQ0KGl0KSkgcmV0dXJuIGZhbHNlOwoJICB2YXIga2xhc3MgPSBjbGFzc29mJDQoaXQpOwoJICByZXR1cm4ga2xhc3MgPT09ICdEYXRhVmlldycKCSAgICB8fCBoYXNPd24kMShUeXBlZEFycmF5Q29uc3RydWN0b3JzTGlzdCwga2xhc3MpCgkgICAgfHwgaGFzT3duJDEoQmlnSW50QXJyYXlDb25zdHJ1Y3RvcnNMaXN0LCBrbGFzcyk7Cgl9OwoKCXZhciBpc1R5cGVkQXJyYXkkMSA9IGZ1bmN0aW9uIChpdCkgewoJICBpZiAoIWlzT2JqZWN0JDQoaXQpKSByZXR1cm4gZmFsc2U7CgkgIHZhciBrbGFzcyA9IGNsYXNzb2YkNChpdCk7CgkgIHJldHVybiBoYXNPd24kMShUeXBlZEFycmF5Q29uc3RydWN0b3JzTGlzdCwga2xhc3MpCgkgICAgfHwgaGFzT3duJDEoQmlnSW50QXJyYXlDb25zdHJ1Y3RvcnNMaXN0LCBrbGFzcyk7Cgl9OwoKCXZhciBhVHlwZWRBcnJheSRxID0gZnVuY3Rpb24gKGl0KSB7CgkgIGlmIChpc1R5cGVkQXJyYXkkMShpdCkpIHJldHVybiBpdDsKCSAgdGhyb3cgVHlwZUVycm9yJDQoJ1RhcmdldCBpcyBub3QgYSB0eXBlZCBhcnJheScpOwoJfTsKCgl2YXIgYVR5cGVkQXJyYXlDb25zdHJ1Y3RvciQzID0gZnVuY3Rpb24gKEMpIHsKCSAgaWYgKGlzQ2FsbGFibGUkMihDKSAmJiAoIXNldFByb3RvdHlwZU9mJDMgfHwgaXNQcm90b3R5cGVPZiQyKFR5cGVkQXJyYXkkMSwgQykpKSByZXR1cm4gQzsKCSAgdGhyb3cgVHlwZUVycm9yJDQodHJ5VG9TdHJpbmckMihDKSArICcgaXMgbm90IGEgdHlwZWQgYXJyYXkgY29uc3RydWN0b3InKTsKCX07CgoJdmFyIGV4cG9ydFR5cGVkQXJyYXlNZXRob2QkciA9IGZ1bmN0aW9uIChLRVksIHByb3BlcnR5LCBmb3JjZWQpIHsKCSAgaWYgKCFERVNDUklQVE9SUyQzKSByZXR1cm47CgkgIGlmIChmb3JjZWQpIGZvciAodmFyIEFSUkFZIGluIFR5cGVkQXJyYXlDb25zdHJ1Y3RvcnNMaXN0KSB7CgkgICAgdmFyIFR5cGVkQXJyYXlDb25zdHJ1Y3RvciA9IGdsb2JhbCRrW0FSUkFZXTsKCSAgICBpZiAoVHlwZWRBcnJheUNvbnN0cnVjdG9yICYmIGhhc093biQxKFR5cGVkQXJyYXlDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIEtFWSkpIHRyeSB7CgkgICAgICBkZWxldGUgVHlwZWRBcnJheUNvbnN0cnVjdG9yLnByb3RvdHlwZVtLRVldOwoJICAgIH0gY2F0Y2ggKGVycm9yKSB7IC8qIGVtcHR5ICovIH0KCSAgfQoJICBpZiAoIVR5cGVkQXJyYXlQcm90b3R5cGUkMVtLRVldIHx8IGZvcmNlZCkgewoJICAgIHJlZGVmaW5lJDEoVHlwZWRBcnJheVByb3RvdHlwZSQxLCBLRVksIGZvcmNlZCA/IHByb3BlcnR5CgkgICAgICA6IE5BVElWRV9BUlJBWV9CVUZGRVJfVklFV1MkMiAmJiBJbnQ4QXJyYXlQcm90b3R5cGVbS0VZXSB8fCBwcm9wZXJ0eSk7CgkgIH0KCX07CgoJdmFyIGV4cG9ydFR5cGVkQXJyYXlTdGF0aWNNZXRob2QgPSBmdW5jdGlvbiAoS0VZLCBwcm9wZXJ0eSwgZm9yY2VkKSB7CgkgIHZhciBBUlJBWSwgVHlwZWRBcnJheUNvbnN0cnVjdG9yOwoJICBpZiAoIURFU0NSSVBUT1JTJDMpIHJldHVybjsKCSAgaWYgKHNldFByb3RvdHlwZU9mJDMpIHsKCSAgICBpZiAoZm9yY2VkKSBmb3IgKEFSUkFZIGluIFR5cGVkQXJyYXlDb25zdHJ1Y3RvcnNMaXN0KSB7CgkgICAgICBUeXBlZEFycmF5Q29uc3RydWN0b3IgPSBnbG9iYWwka1tBUlJBWV07CgkgICAgICBpZiAoVHlwZWRBcnJheUNvbnN0cnVjdG9yICYmIGhhc093biQxKFR5cGVkQXJyYXlDb25zdHJ1Y3RvciwgS0VZKSkgdHJ5IHsKCSAgICAgICAgZGVsZXRlIFR5cGVkQXJyYXlDb25zdHJ1Y3RvcltLRVldOwoJICAgICAgfSBjYXRjaCAoZXJyb3IpIHsgLyogZW1wdHkgKi8gfQoJICAgIH0KCSAgICBpZiAoIVR5cGVkQXJyYXkkMVtLRVldIHx8IGZvcmNlZCkgewoJICAgICAgLy8gVjggfiBDaHJvbWUgNDktNTAgYCVUeXBlZEFycmF5JWAgbWV0aG9kcyBhcmUgbm9uLXdyaXRhYmxlIG5vbi1jb25maWd1cmFibGUKCSAgICAgIHRyeSB7CgkgICAgICAgIHJldHVybiByZWRlZmluZSQxKFR5cGVkQXJyYXkkMSwgS0VZLCBmb3JjZWQgPyBwcm9wZXJ0eSA6IE5BVElWRV9BUlJBWV9CVUZGRVJfVklFV1MkMiAmJiBUeXBlZEFycmF5JDFbS0VZXSB8fCBwcm9wZXJ0eSk7CgkgICAgICB9IGNhdGNoIChlcnJvcikgeyAvKiBlbXB0eSAqLyB9CgkgICAgfSBlbHNlIHJldHVybjsKCSAgfQoJICBmb3IgKEFSUkFZIGluIFR5cGVkQXJyYXlDb25zdHJ1Y3RvcnNMaXN0KSB7CgkgICAgVHlwZWRBcnJheUNvbnN0cnVjdG9yID0gZ2xvYmFsJGtbQVJSQVldOwoJICAgIGlmIChUeXBlZEFycmF5Q29uc3RydWN0b3IgJiYgKCFUeXBlZEFycmF5Q29uc3RydWN0b3JbS0VZXSB8fCBmb3JjZWQpKSB7CgkgICAgICByZWRlZmluZSQxKFR5cGVkQXJyYXlDb25zdHJ1Y3RvciwgS0VZLCBwcm9wZXJ0eSk7CgkgICAgfQoJICB9Cgl9OwoKCWZvciAoTkFNRSBpbiBUeXBlZEFycmF5Q29uc3RydWN0b3JzTGlzdCkgewoJICBDb25zdHJ1Y3RvciA9IGdsb2JhbCRrW05BTUVdOwoJICBQcm90b3R5cGUgPSBDb25zdHJ1Y3RvciAmJiBDb25zdHJ1Y3Rvci5wcm90b3R5cGU7CgkgIGlmIChQcm90b3R5cGUpIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSQyKFByb3RvdHlwZSwgVFlQRURfQVJSQVlfQ09OU1RSVUNUT1IkMiwgQ29uc3RydWN0b3IpOwoJICBlbHNlIE5BVElWRV9BUlJBWV9CVUZGRVJfVklFV1MkMiA9IGZhbHNlOwoJfQoKCWZvciAoTkFNRSBpbiBCaWdJbnRBcnJheUNvbnN0cnVjdG9yc0xpc3QpIHsKCSAgQ29uc3RydWN0b3IgPSBnbG9iYWwka1tOQU1FXTsKCSAgUHJvdG90eXBlID0gQ29uc3RydWN0b3IgJiYgQ29uc3RydWN0b3IucHJvdG90eXBlOwoJICBpZiAoUHJvdG90eXBlKSBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkkMihQcm90b3R5cGUsIFRZUEVEX0FSUkFZX0NPTlNUUlVDVE9SJDIsIENvbnN0cnVjdG9yKTsKCX0KCgkvLyBXZWJLaXQgYnVnIC0gdHlwZWQgYXJyYXlzIGNvbnN0cnVjdG9ycyBwcm90b3R5cGUgaXMgT2JqZWN0LnByb3RvdHlwZQoJaWYgKCFOQVRJVkVfQVJSQVlfQlVGRkVSX1ZJRVdTJDIgfHwgIWlzQ2FsbGFibGUkMihUeXBlZEFycmF5JDEpIHx8IFR5cGVkQXJyYXkkMSA9PT0gRnVuY3Rpb24ucHJvdG90eXBlKSB7CgkgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1zaGFkb3cgLS0gc2FmZQoJICBUeXBlZEFycmF5JDEgPSBmdW5jdGlvbiBUeXBlZEFycmF5KCkgewoJICAgIHRocm93IFR5cGVFcnJvciQ0KCdJbmNvcnJlY3QgaW52b2NhdGlvbicpOwoJICB9OwoJICBpZiAoTkFUSVZFX0FSUkFZX0JVRkZFUl9WSUVXUyQyKSBmb3IgKE5BTUUgaW4gVHlwZWRBcnJheUNvbnN0cnVjdG9yc0xpc3QpIHsKCSAgICBpZiAoZ2xvYmFsJGtbTkFNRV0pIHNldFByb3RvdHlwZU9mJDMoZ2xvYmFsJGtbTkFNRV0sIFR5cGVkQXJyYXkkMSk7CgkgIH0KCX0KCglpZiAoIU5BVElWRV9BUlJBWV9CVUZGRVJfVklFV1MkMiB8fCAhVHlwZWRBcnJheVByb3RvdHlwZSQxIHx8IFR5cGVkQXJyYXlQcm90b3R5cGUkMSA9PT0gT2JqZWN0UHJvdG90eXBlJDEpIHsKCSAgVHlwZWRBcnJheVByb3RvdHlwZSQxID0gVHlwZWRBcnJheSQxLnByb3RvdHlwZTsKCSAgaWYgKE5BVElWRV9BUlJBWV9CVUZGRVJfVklFV1MkMikgZm9yIChOQU1FIGluIFR5cGVkQXJyYXlDb25zdHJ1Y3RvcnNMaXN0KSB7CgkgICAgaWYgKGdsb2JhbCRrW05BTUVdKSBzZXRQcm90b3R5cGVPZiQzKGdsb2JhbCRrW05BTUVdLnByb3RvdHlwZSwgVHlwZWRBcnJheVByb3RvdHlwZSQxKTsKCSAgfQoJfQoKCS8vIFdlYktpdCBidWcgLSBvbmUgbW9yZSBvYmplY3QgaW4gVWludDhDbGFtcGVkQXJyYXkgcHJvdG90eXBlIGNoYWluCglpZiAoTkFUSVZFX0FSUkFZX0JVRkZFUl9WSUVXUyQyICYmIGdldFByb3RvdHlwZU9mJDEoVWludDhDbGFtcGVkQXJyYXlQcm90b3R5cGUpICE9PSBUeXBlZEFycmF5UHJvdG90eXBlJDEpIHsKCSAgc2V0UHJvdG90eXBlT2YkMyhVaW50OENsYW1wZWRBcnJheVByb3RvdHlwZSwgVHlwZWRBcnJheVByb3RvdHlwZSQxKTsKCX0KCglpZiAoREVTQ1JJUFRPUlMkMyAmJiAhaGFzT3duJDEoVHlwZWRBcnJheVByb3RvdHlwZSQxLCBUT19TVFJJTkdfVEFHKSkgewoJICBUWVBFRF9BUlJBWV9UQUdfUkVRSVJFRCA9IHRydWU7CgkgIGRlZmluZVByb3BlcnR5JDEoVHlwZWRBcnJheVByb3RvdHlwZSQxLCBUT19TVFJJTkdfVEFHLCB7IGdldDogZnVuY3Rpb24gKCkgewoJICAgIHJldHVybiBpc09iamVjdCQ0KHRoaXMpID8gdGhpc1tUWVBFRF9BUlJBWV9UQUckMV0gOiB1bmRlZmluZWQ7CgkgIH0gfSk7CgkgIGZvciAoTkFNRSBpbiBUeXBlZEFycmF5Q29uc3RydWN0b3JzTGlzdCkgaWYgKGdsb2JhbCRrW05BTUVdKSB7CgkgICAgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5JDIoZ2xvYmFsJGtbTkFNRV0sIFRZUEVEX0FSUkFZX1RBRyQxLCBOQU1FKTsKCSAgfQoJfQoKCXZhciBhcnJheUJ1ZmZlclZpZXdDb3JlID0gewoJICBOQVRJVkVfQVJSQVlfQlVGRkVSX1ZJRVdTOiBOQVRJVkVfQVJSQVlfQlVGRkVSX1ZJRVdTJDIsCgkgIFRZUEVEX0FSUkFZX0NPTlNUUlVDVE9SOiBUWVBFRF9BUlJBWV9DT05TVFJVQ1RPUiQyLAoJICBUWVBFRF9BUlJBWV9UQUc6IFRZUEVEX0FSUkFZX1RBR19SRVFJUkVEICYmIFRZUEVEX0FSUkFZX1RBRyQxLAoJICBhVHlwZWRBcnJheTogYVR5cGVkQXJyYXkkcSwKCSAgYVR5cGVkQXJyYXlDb25zdHJ1Y3RvcjogYVR5cGVkQXJyYXlDb25zdHJ1Y3RvciQzLAoJICBleHBvcnRUeXBlZEFycmF5TWV0aG9kOiBleHBvcnRUeXBlZEFycmF5TWV0aG9kJHIsCgkgIGV4cG9ydFR5cGVkQXJyYXlTdGF0aWNNZXRob2Q6IGV4cG9ydFR5cGVkQXJyYXlTdGF0aWNNZXRob2QsCgkgIGlzVmlldzogaXNWaWV3LAoJICBpc1R5cGVkQXJyYXk6IGlzVHlwZWRBcnJheSQxLAoJICBUeXBlZEFycmF5OiBUeXBlZEFycmF5JDEsCgkgIFR5cGVkQXJyYXlQcm90b3R5cGU6IFR5cGVkQXJyYXlQcm90b3R5cGUkMQoJfTsKCgkvKiBlc2xpbnQtZGlzYWJsZSBuby1uZXcgLS0gcmVxdWlyZWQgZm9yIHRlc3RpbmcgKi8KCgl2YXIgZ2xvYmFsJGogPSBnbG9iYWwkSTsKCXZhciBmYWlscyQ4ID0gZmFpbHMkZzsKCXZhciBjaGVja0NvcnJlY3RuZXNzT2ZJdGVyYXRpb24gPSBjaGVja0NvcnJlY3RuZXNzT2ZJdGVyYXRpb24kMTsKCXZhciBOQVRJVkVfQVJSQVlfQlVGRkVSX1ZJRVdTJDEgPSBhcnJheUJ1ZmZlclZpZXdDb3JlLk5BVElWRV9BUlJBWV9CVUZGRVJfVklFV1M7CgoJdmFyIEFycmF5QnVmZmVyJDMgPSBnbG9iYWwkai5BcnJheUJ1ZmZlcjsKCXZhciBJbnQ4QXJyYXkkMiA9IGdsb2JhbCRqLkludDhBcnJheTsKCgl2YXIgdHlwZWRBcnJheUNvbnN0cnVjdG9yc1JlcXVpcmVXcmFwcGVycyA9ICFOQVRJVkVfQVJSQVlfQlVGRkVSX1ZJRVdTJDEgfHwgIWZhaWxzJDgoZnVuY3Rpb24gKCkgewoJICBJbnQ4QXJyYXkkMigxKTsKCX0pIHx8ICFmYWlscyQ4KGZ1bmN0aW9uICgpIHsKCSAgbmV3IEludDhBcnJheSQyKC0xKTsKCX0pIHx8ICFjaGVja0NvcnJlY3RuZXNzT2ZJdGVyYXRpb24oZnVuY3Rpb24gKGl0ZXJhYmxlKSB7CgkgIG5ldyBJbnQ4QXJyYXkkMigpOwoJICBuZXcgSW50OEFycmF5JDIobnVsbCk7CgkgIG5ldyBJbnQ4QXJyYXkkMigxLjUpOwoJICBuZXcgSW50OEFycmF5JDIoaXRlcmFibGUpOwoJfSwgdHJ1ZSkgfHwgZmFpbHMkOChmdW5jdGlvbiAoKSB7CgkgIC8vIFNhZmFyaSAoMTErKSBidWcgLSBhIHJlYXNvbiB3aHkgZXZlbiBTYWZhcmkgMTMgc2hvdWxkIGxvYWQgYSB0eXBlZCBhcnJheSBwb2x5ZmlsbAoJICByZXR1cm4gbmV3IEludDhBcnJheSQyKG5ldyBBcnJheUJ1ZmZlciQzKDIpLCAxLCB1bmRlZmluZWQpLmxlbmd0aCAhPT0gMTsKCX0pOwoKCXZhciByZWRlZmluZSA9IHJlZGVmaW5lJDYuZXhwb3J0czsKCgl2YXIgcmVkZWZpbmVBbGwkMSA9IGZ1bmN0aW9uICh0YXJnZXQsIHNyYywgb3B0aW9ucykgewoJICBmb3IgKHZhciBrZXkgaW4gc3JjKSByZWRlZmluZSh0YXJnZXQsIGtleSwgc3JjW2tleV0sIG9wdGlvbnMpOwoJICByZXR1cm4gdGFyZ2V0OwoJfTsKCgl2YXIgZ2xvYmFsJGkgPSBnbG9iYWwkSTsKCXZhciBpc1Byb3RvdHlwZU9mJDEgPSBvYmplY3RJc1Byb3RvdHlwZU9mOwoKCXZhciBUeXBlRXJyb3IkMyA9IGdsb2JhbCRpLlR5cGVFcnJvcjsKCgl2YXIgYW5JbnN0YW5jZSQyID0gZnVuY3Rpb24gKGl0LCBQcm90b3R5cGUpIHsKCSAgaWYgKGlzUHJvdG90eXBlT2YkMShQcm90b3R5cGUsIGl0KSkgcmV0dXJuIGl0OwoJICB0aHJvdyBUeXBlRXJyb3IkMygnSW5jb3JyZWN0IGludm9jYXRpb24nKTsKCX07CgoJdmFyIGdsb2JhbCRoID0gZ2xvYmFsJEk7Cgl2YXIgdG9JbnRlZ2VyT3JJbmZpbml0eSQ0ID0gdG9JbnRlZ2VyT3JJbmZpbml0eSQ3OwoJdmFyIHRvTGVuZ3RoJDMgPSB0b0xlbmd0aCQ1OwoKCXZhciBSYW5nZUVycm9yJDUgPSBnbG9iYWwkaC5SYW5nZUVycm9yOwoKCS8vIGBUb0luZGV4YCBhYnN0cmFjdCBvcGVyYXRpb24KCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtdG9pbmRleAoJdmFyIHRvSW5kZXgkMiA9IGZ1bmN0aW9uIChpdCkgewoJICBpZiAoaXQgPT09IHVuZGVmaW5lZCkgcmV0dXJuIDA7CgkgIHZhciBudW1iZXIgPSB0b0ludGVnZXJPckluZmluaXR5JDQoaXQpOwoJICB2YXIgbGVuZ3RoID0gdG9MZW5ndGgkMyhudW1iZXIpOwoJICBpZiAobnVtYmVyICE9PSBsZW5ndGgpIHRocm93IFJhbmdlRXJyb3IkNSgnV3JvbmcgbGVuZ3RoIG9yIGluZGV4Jyk7CgkgIHJldHVybiBsZW5ndGg7Cgl9OwoKCS8vIElFRUU3NTQgY29udmVyc2lvbnMgYmFzZWQgb24gaHR0cHM6Ly9naXRodWIuY29tL2Zlcm9zcy9pZWVlNzU0Cgl2YXIgZ2xvYmFsJGcgPSBnbG9iYWwkSTsKCgl2YXIgQXJyYXkkNSA9IGdsb2JhbCRnLkFycmF5OwoJdmFyIGFicyA9IE1hdGguYWJzOwoJdmFyIHBvdyA9IE1hdGgucG93OwoJdmFyIGZsb29yJDMgPSBNYXRoLmZsb29yOwoJdmFyIGxvZyA9IE1hdGgubG9nOwoJdmFyIExOMiA9IE1hdGguTE4yOwoKCXZhciBwYWNrID0gZnVuY3Rpb24gKG51bWJlciwgbWFudGlzc2FMZW5ndGgsIGJ5dGVzKSB7CgkgIHZhciBidWZmZXIgPSBBcnJheSQ1KGJ5dGVzKTsKCSAgdmFyIGV4cG9uZW50TGVuZ3RoID0gYnl0ZXMgKiA4IC0gbWFudGlzc2FMZW5ndGggLSAxOwoJICB2YXIgZU1heCA9ICgxIDw8IGV4cG9uZW50TGVuZ3RoKSAtIDE7CgkgIHZhciBlQmlhcyA9IGVNYXggPj4gMTsKCSAgdmFyIHJ0ID0gbWFudGlzc2FMZW5ndGggPT09IDIzID8gcG93KDIsIC0yNCkgLSBwb3coMiwgLTc3KSA6IDA7CgkgIHZhciBzaWduID0gbnVtYmVyIDwgMCB8fCBudW1iZXIgPT09IDAgJiYgMSAvIG51bWJlciA8IDAgPyAxIDogMDsKCSAgdmFyIGluZGV4ID0gMDsKCSAgdmFyIGV4cG9uZW50LCBtYW50aXNzYSwgYzsKCSAgbnVtYmVyID0gYWJzKG51bWJlcik7CgkgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1zZWxmLWNvbXBhcmUgLS0gTmFOIGNoZWNrCgkgIGlmIChudW1iZXIgIT0gbnVtYmVyIHx8IG51bWJlciA9PT0gSW5maW5pdHkpIHsKCSAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tc2VsZi1jb21wYXJlIC0tIE5hTiBjaGVjawoJICAgIG1hbnRpc3NhID0gbnVtYmVyICE9IG51bWJlciA/IDEgOiAwOwoJICAgIGV4cG9uZW50ID0gZU1heDsKCSAgfSBlbHNlIHsKCSAgICBleHBvbmVudCA9IGZsb29yJDMobG9nKG51bWJlcikgLyBMTjIpOwoJICAgIGMgPSBwb3coMiwgLWV4cG9uZW50KTsKCSAgICBpZiAobnVtYmVyICogYyA8IDEpIHsKCSAgICAgIGV4cG9uZW50LS07CgkgICAgICBjICo9IDI7CgkgICAgfQoJICAgIGlmIChleHBvbmVudCArIGVCaWFzID49IDEpIHsKCSAgICAgIG51bWJlciArPSBydCAvIGM7CgkgICAgfSBlbHNlIHsKCSAgICAgIG51bWJlciArPSBydCAqIHBvdygyLCAxIC0gZUJpYXMpOwoJICAgIH0KCSAgICBpZiAobnVtYmVyICogYyA+PSAyKSB7CgkgICAgICBleHBvbmVudCsrOwoJICAgICAgYyAvPSAyOwoJICAgIH0KCSAgICBpZiAoZXhwb25lbnQgKyBlQmlhcyA+PSBlTWF4KSB7CgkgICAgICBtYW50aXNzYSA9IDA7CgkgICAgICBleHBvbmVudCA9IGVNYXg7CgkgICAgfSBlbHNlIGlmIChleHBvbmVudCArIGVCaWFzID49IDEpIHsKCSAgICAgIG1hbnRpc3NhID0gKG51bWJlciAqIGMgLSAxKSAqIHBvdygyLCBtYW50aXNzYUxlbmd0aCk7CgkgICAgICBleHBvbmVudCA9IGV4cG9uZW50ICsgZUJpYXM7CgkgICAgfSBlbHNlIHsKCSAgICAgIG1hbnRpc3NhID0gbnVtYmVyICogcG93KDIsIGVCaWFzIC0gMSkgKiBwb3coMiwgbWFudGlzc2FMZW5ndGgpOwoJICAgICAgZXhwb25lbnQgPSAwOwoJICAgIH0KCSAgfQoJICB3aGlsZSAobWFudGlzc2FMZW5ndGggPj0gOCkgewoJICAgIGJ1ZmZlcltpbmRleCsrXSA9IG1hbnRpc3NhICYgMjU1OwoJICAgIG1hbnRpc3NhIC89IDI1NjsKCSAgICBtYW50aXNzYUxlbmd0aCAtPSA4OwoJICB9CgkgIGV4cG9uZW50ID0gZXhwb25lbnQgPDwgbWFudGlzc2FMZW5ndGggfCBtYW50aXNzYTsKCSAgZXhwb25lbnRMZW5ndGggKz0gbWFudGlzc2FMZW5ndGg7CgkgIHdoaWxlIChleHBvbmVudExlbmd0aCA+IDApIHsKCSAgICBidWZmZXJbaW5kZXgrK10gPSBleHBvbmVudCAmIDI1NTsKCSAgICBleHBvbmVudCAvPSAyNTY7CgkgICAgZXhwb25lbnRMZW5ndGggLT0gODsKCSAgfQoJICBidWZmZXJbLS1pbmRleF0gfD0gc2lnbiAqIDEyODsKCSAgcmV0dXJuIGJ1ZmZlcjsKCX07CgoJdmFyIHVucGFjayA9IGZ1bmN0aW9uIChidWZmZXIsIG1hbnRpc3NhTGVuZ3RoKSB7CgkgIHZhciBieXRlcyA9IGJ1ZmZlci5sZW5ndGg7CgkgIHZhciBleHBvbmVudExlbmd0aCA9IGJ5dGVzICogOCAtIG1hbnRpc3NhTGVuZ3RoIC0gMTsKCSAgdmFyIGVNYXggPSAoMSA8PCBleHBvbmVudExlbmd0aCkgLSAxOwoJICB2YXIgZUJpYXMgPSBlTWF4ID4+IDE7CgkgIHZhciBuQml0cyA9IGV4cG9uZW50TGVuZ3RoIC0gNzsKCSAgdmFyIGluZGV4ID0gYnl0ZXMgLSAxOwoJICB2YXIgc2lnbiA9IGJ1ZmZlcltpbmRleC0tXTsKCSAgdmFyIGV4cG9uZW50ID0gc2lnbiAmIDEyNzsKCSAgdmFyIG1hbnRpc3NhOwoJICBzaWduID4+PSA3OwoJICB3aGlsZSAobkJpdHMgPiAwKSB7CgkgICAgZXhwb25lbnQgPSBleHBvbmVudCAqIDI1NiArIGJ1ZmZlcltpbmRleC0tXTsKCSAgICBuQml0cyAtPSA4OwoJICB9CgkgIG1hbnRpc3NhID0gZXhwb25lbnQgJiAoMSA8PCAtbkJpdHMpIC0gMTsKCSAgZXhwb25lbnQgPj49IC1uQml0czsKCSAgbkJpdHMgKz0gbWFudGlzc2FMZW5ndGg7CgkgIHdoaWxlIChuQml0cyA+IDApIHsKCSAgICBtYW50aXNzYSA9IG1hbnRpc3NhICogMjU2ICsgYnVmZmVyW2luZGV4LS1dOwoJICAgIG5CaXRzIC09IDg7CgkgIH0KCSAgaWYgKGV4cG9uZW50ID09PSAwKSB7CgkgICAgZXhwb25lbnQgPSAxIC0gZUJpYXM7CgkgIH0gZWxzZSBpZiAoZXhwb25lbnQgPT09IGVNYXgpIHsKCSAgICByZXR1cm4gbWFudGlzc2EgPyBOYU4gOiBzaWduID8gLUluZmluaXR5IDogSW5maW5pdHk7CgkgIH0gZWxzZSB7CgkgICAgbWFudGlzc2EgPSBtYW50aXNzYSArIHBvdygyLCBtYW50aXNzYUxlbmd0aCk7CgkgICAgZXhwb25lbnQgPSBleHBvbmVudCAtIGVCaWFzOwoJICB9IHJldHVybiAoc2lnbiA/IC0xIDogMSkgKiBtYW50aXNzYSAqIHBvdygyLCBleHBvbmVudCAtIG1hbnRpc3NhTGVuZ3RoKTsKCX07CgoJdmFyIGllZWU3NTQgPSB7CgkgIHBhY2s6IHBhY2ssCgkgIHVucGFjazogdW5wYWNrCgl9OwoKCXZhciB0b09iamVjdCQ3ID0gdG9PYmplY3QkYTsKCXZhciB0b0Fic29sdXRlSW5kZXgkMyA9IHRvQWJzb2x1dGVJbmRleCQ1OwoJdmFyIGxlbmd0aE9mQXJyYXlMaWtlJGEgPSBsZW5ndGhPZkFycmF5TGlrZSRjOwoKCS8vIGBBcnJheS5wcm90b3R5cGUuZmlsbGAgbWV0aG9kIGltcGxlbWVudGF0aW9uCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLWFycmF5LnByb3RvdHlwZS5maWxsCgl2YXIgYXJyYXlGaWxsJDEgPSBmdW5jdGlvbiBmaWxsKHZhbHVlIC8qICwgc3RhcnQgPSAwLCBlbmQgPSBAbGVuZ3RoICovKSB7CgkgIHZhciBPID0gdG9PYmplY3QkNyh0aGlzKTsKCSAgdmFyIGxlbmd0aCA9IGxlbmd0aE9mQXJyYXlMaWtlJGEoTyk7CgkgIHZhciBhcmd1bWVudHNMZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoOwoJICB2YXIgaW5kZXggPSB0b0Fic29sdXRlSW5kZXgkMyhhcmd1bWVudHNMZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkLCBsZW5ndGgpOwoJICB2YXIgZW5kID0gYXJndW1lbnRzTGVuZ3RoID4gMiA/IGFyZ3VtZW50c1syXSA6IHVuZGVmaW5lZDsKCSAgdmFyIGVuZFBvcyA9IGVuZCA9PT0gdW5kZWZpbmVkID8gbGVuZ3RoIDogdG9BYnNvbHV0ZUluZGV4JDMoZW5kLCBsZW5ndGgpOwoJICB3aGlsZSAoZW5kUG9zID4gaW5kZXgpIE9baW5kZXgrK10gPSB2YWx1ZTsKCSAgcmV0dXJuIE87Cgl9OwoKCXZhciB0b1Byb3BlcnR5S2V5JDEgPSB0b1Byb3BlcnR5S2V5JDQ7Cgl2YXIgZGVmaW5lUHJvcGVydHlNb2R1bGUkMiA9IG9iamVjdERlZmluZVByb3BlcnR5OwoJdmFyIGNyZWF0ZVByb3BlcnR5RGVzY3JpcHRvciQxID0gY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yJDU7CgoJdmFyIGNyZWF0ZVByb3BlcnR5JDEgPSBmdW5jdGlvbiAob2JqZWN0LCBrZXksIHZhbHVlKSB7CgkgIHZhciBwcm9wZXJ0eUtleSA9IHRvUHJvcGVydHlLZXkkMShrZXkpOwoJICBpZiAocHJvcGVydHlLZXkgaW4gb2JqZWN0KSBkZWZpbmVQcm9wZXJ0eU1vZHVsZSQyLmYob2JqZWN0LCBwcm9wZXJ0eUtleSwgY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yJDEoMCwgdmFsdWUpKTsKCSAgZWxzZSBvYmplY3RbcHJvcGVydHlLZXldID0gdmFsdWU7Cgl9OwoKCXZhciBnbG9iYWwkZiA9IGdsb2JhbCRJOwoJdmFyIHRvQWJzb2x1dGVJbmRleCQyID0gdG9BYnNvbHV0ZUluZGV4JDU7Cgl2YXIgbGVuZ3RoT2ZBcnJheUxpa2UkOSA9IGxlbmd0aE9mQXJyYXlMaWtlJGM7Cgl2YXIgY3JlYXRlUHJvcGVydHkgPSBjcmVhdGVQcm9wZXJ0eSQxOwoKCXZhciBBcnJheSQ0ID0gZ2xvYmFsJGYuQXJyYXk7Cgl2YXIgbWF4ID0gTWF0aC5tYXg7CgoJdmFyIGFycmF5U2xpY2VTaW1wbGUgPSBmdW5jdGlvbiAoTywgc3RhcnQsIGVuZCkgewoJICB2YXIgbGVuZ3RoID0gbGVuZ3RoT2ZBcnJheUxpa2UkOShPKTsKCSAgdmFyIGsgPSB0b0Fic29sdXRlSW5kZXgkMihzdGFydCwgbGVuZ3RoKTsKCSAgdmFyIGZpbiA9IHRvQWJzb2x1dGVJbmRleCQyKGVuZCA9PT0gdW5kZWZpbmVkID8gbGVuZ3RoIDogZW5kLCBsZW5ndGgpOwoJICB2YXIgcmVzdWx0ID0gQXJyYXkkNChtYXgoZmluIC0gaywgMCkpOwoJICBmb3IgKHZhciBuID0gMDsgayA8IGZpbjsgaysrLCBuKyspIGNyZWF0ZVByb3BlcnR5KHJlc3VsdCwgbiwgT1trXSk7CgkgIHJlc3VsdC5sZW5ndGggPSBuOwoJICByZXR1cm4gcmVzdWx0OwoJfTsKCgl2YXIgZ2xvYmFsJGUgPSBnbG9iYWwkSTsKCXZhciB1bmN1cnJ5VGhpcyRiID0gZnVuY3Rpb25VbmN1cnJ5VGhpczsKCXZhciBERVNDUklQVE9SUyQyID0gZGVzY3JpcHRvcnM7Cgl2YXIgTkFUSVZFX0FSUkFZX0JVRkZFUiA9IGFycmF5QnVmZmVyTmF0aXZlOwoJdmFyIEZ1bmN0aW9uTmFtZSA9IGZ1bmN0aW9uTmFtZTsKCXZhciBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkkMSA9IGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSQ3OwoJdmFyIHJlZGVmaW5lQWxsID0gcmVkZWZpbmVBbGwkMTsKCXZhciBmYWlscyQ3ID0gZmFpbHMkZzsKCXZhciBhbkluc3RhbmNlJDEgPSBhbkluc3RhbmNlJDI7Cgl2YXIgdG9JbnRlZ2VyT3JJbmZpbml0eSQzID0gdG9JbnRlZ2VyT3JJbmZpbml0eSQ3OwoJdmFyIHRvTGVuZ3RoJDIgPSB0b0xlbmd0aCQ1OwoJdmFyIHRvSW5kZXgkMSA9IHRvSW5kZXgkMjsKCXZhciBJRUVFNzU0ID0gaWVlZTc1NDsKCXZhciBnZXRQcm90b3R5cGVPZiA9IG9iamVjdEdldFByb3RvdHlwZU9mOwoJdmFyIHNldFByb3RvdHlwZU9mJDIgPSBvYmplY3RTZXRQcm90b3R5cGVPZjsKCXZhciBnZXRPd25Qcm9wZXJ0eU5hbWVzJDEgPSBvYmplY3RHZXRPd25Qcm9wZXJ0eU5hbWVzLmY7Cgl2YXIgZGVmaW5lUHJvcGVydHkgPSBvYmplY3REZWZpbmVQcm9wZXJ0eS5mOwoJdmFyIGFycmF5RmlsbCA9IGFycmF5RmlsbCQxOwoJdmFyIGFycmF5U2xpY2UkNCA9IGFycmF5U2xpY2VTaW1wbGU7Cgl2YXIgc2V0VG9TdHJpbmdUYWcgPSBzZXRUb1N0cmluZ1RhZyQzOwoJdmFyIEludGVybmFsU3RhdGVNb2R1bGUkMSA9IGludGVybmFsU3RhdGU7CgoJdmFyIFBST1BFUl9GVU5DVElPTl9OQU1FJDEgPSBGdW5jdGlvbk5hbWUuUFJPUEVSOwoJdmFyIENPTkZJR1VSQUJMRV9GVU5DVElPTl9OQU1FID0gRnVuY3Rpb25OYW1lLkNPTkZJR1VSQUJMRTsKCXZhciBnZXRJbnRlcm5hbFN0YXRlJDEgPSBJbnRlcm5hbFN0YXRlTW9kdWxlJDEuZ2V0OwoJdmFyIHNldEludGVybmFsU3RhdGUkMSA9IEludGVybmFsU3RhdGVNb2R1bGUkMS5zZXQ7Cgl2YXIgQVJSQVlfQlVGRkVSJDEgPSAnQXJyYXlCdWZmZXInOwoJdmFyIERBVEFfVklFVyA9ICdEYXRhVmlldyc7Cgl2YXIgUFJPVE9UWVBFID0gJ3Byb3RvdHlwZSc7Cgl2YXIgV1JPTkdfTEVOR1RIJDEgPSAnV3JvbmcgbGVuZ3RoJzsKCXZhciBXUk9OR19JTkRFWCA9ICdXcm9uZyBpbmRleCc7Cgl2YXIgTmF0aXZlQXJyYXlCdWZmZXIkMSA9IGdsb2JhbCRlW0FSUkFZX0JVRkZFUiQxXTsKCXZhciAkQXJyYXlCdWZmZXIgPSBOYXRpdmVBcnJheUJ1ZmZlciQxOwoJdmFyIEFycmF5QnVmZmVyUHJvdG90eXBlJDEgPSAkQXJyYXlCdWZmZXIgJiYgJEFycmF5QnVmZmVyW1BST1RPVFlQRV07Cgl2YXIgJERhdGFWaWV3ID0gZ2xvYmFsJGVbREFUQV9WSUVXXTsKCXZhciBEYXRhVmlld1Byb3RvdHlwZSA9ICREYXRhVmlldyAmJiAkRGF0YVZpZXdbUFJPVE9UWVBFXTsKCXZhciBPYmplY3RQcm90b3R5cGUgPSBPYmplY3QucHJvdG90eXBlOwoJdmFyIEFycmF5JDMgPSBnbG9iYWwkZS5BcnJheTsKCXZhciBSYW5nZUVycm9yJDQgPSBnbG9iYWwkZS5SYW5nZUVycm9yOwoJdmFyIGZpbGwgPSB1bmN1cnJ5VGhpcyRiKGFycmF5RmlsbCk7Cgl2YXIgcmV2ZXJzZSA9IHVuY3VycnlUaGlzJGIoW10ucmV2ZXJzZSk7CgoJdmFyIHBhY2tJRUVFNzU0ID0gSUVFRTc1NC5wYWNrOwoJdmFyIHVucGFja0lFRUU3NTQgPSBJRUVFNzU0LnVucGFjazsKCgl2YXIgcGFja0ludDggPSBmdW5jdGlvbiAobnVtYmVyKSB7CgkgIHJldHVybiBbbnVtYmVyICYgMHhGRl07Cgl9OwoKCXZhciBwYWNrSW50MTYgPSBmdW5jdGlvbiAobnVtYmVyKSB7CgkgIHJldHVybiBbbnVtYmVyICYgMHhGRiwgbnVtYmVyID4+IDggJiAweEZGXTsKCX07CgoJdmFyIHBhY2tJbnQzMiA9IGZ1bmN0aW9uIChudW1iZXIpIHsKCSAgcmV0dXJuIFtudW1iZXIgJiAweEZGLCBudW1iZXIgPj4gOCAmIDB4RkYsIG51bWJlciA+PiAxNiAmIDB4RkYsIG51bWJlciA+PiAyNCAmIDB4RkZdOwoJfTsKCgl2YXIgdW5wYWNrSW50MzIgPSBmdW5jdGlvbiAoYnVmZmVyKSB7CgkgIHJldHVybiBidWZmZXJbM10gPDwgMjQgfCBidWZmZXJbMl0gPDwgMTYgfCBidWZmZXJbMV0gPDwgOCB8IGJ1ZmZlclswXTsKCX07CgoJdmFyIHBhY2tGbG9hdDMyID0gZnVuY3Rpb24gKG51bWJlcikgewoJICByZXR1cm4gcGFja0lFRUU3NTQobnVtYmVyLCAyMywgNCk7Cgl9OwoKCXZhciBwYWNrRmxvYXQ2NCA9IGZ1bmN0aW9uIChudW1iZXIpIHsKCSAgcmV0dXJuIHBhY2tJRUVFNzU0KG51bWJlciwgNTIsIDgpOwoJfTsKCgl2YXIgYWRkR2V0dGVyJDEgPSBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIGtleSkgewoJICBkZWZpbmVQcm9wZXJ0eShDb25zdHJ1Y3RvcltQUk9UT1RZUEVdLCBrZXksIHsgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBnZXRJbnRlcm5hbFN0YXRlJDEodGhpcylba2V5XTsgfSB9KTsKCX07CgoJdmFyIGdldCA9IGZ1bmN0aW9uICh2aWV3LCBjb3VudCwgaW5kZXgsIGlzTGl0dGxlRW5kaWFuKSB7CgkgIHZhciBpbnRJbmRleCA9IHRvSW5kZXgkMShpbmRleCk7CgkgIHZhciBzdG9yZSA9IGdldEludGVybmFsU3RhdGUkMSh2aWV3KTsKCSAgaWYgKGludEluZGV4ICsgY291bnQgPiBzdG9yZS5ieXRlTGVuZ3RoKSB0aHJvdyBSYW5nZUVycm9yJDQoV1JPTkdfSU5ERVgpOwoJICB2YXIgYnl0ZXMgPSBnZXRJbnRlcm5hbFN0YXRlJDEoc3RvcmUuYnVmZmVyKS5ieXRlczsKCSAgdmFyIHN0YXJ0ID0gaW50SW5kZXggKyBzdG9yZS5ieXRlT2Zmc2V0OwoJICB2YXIgcGFjayA9IGFycmF5U2xpY2UkNChieXRlcywgc3RhcnQsIHN0YXJ0ICsgY291bnQpOwoJICByZXR1cm4gaXNMaXR0bGVFbmRpYW4gPyBwYWNrIDogcmV2ZXJzZShwYWNrKTsKCX07CgoJdmFyIHNldCA9IGZ1bmN0aW9uICh2aWV3LCBjb3VudCwgaW5kZXgsIGNvbnZlcnNpb24sIHZhbHVlLCBpc0xpdHRsZUVuZGlhbikgewoJICB2YXIgaW50SW5kZXggPSB0b0luZGV4JDEoaW5kZXgpOwoJICB2YXIgc3RvcmUgPSBnZXRJbnRlcm5hbFN0YXRlJDEodmlldyk7CgkgIGlmIChpbnRJbmRleCArIGNvdW50ID4gc3RvcmUuYnl0ZUxlbmd0aCkgdGhyb3cgUmFuZ2VFcnJvciQ0KFdST05HX0lOREVYKTsKCSAgdmFyIGJ5dGVzID0gZ2V0SW50ZXJuYWxTdGF0ZSQxKHN0b3JlLmJ1ZmZlcikuYnl0ZXM7CgkgIHZhciBzdGFydCA9IGludEluZGV4ICsgc3RvcmUuYnl0ZU9mZnNldDsKCSAgdmFyIHBhY2sgPSBjb252ZXJzaW9uKCt2YWx1ZSk7CgkgIGZvciAodmFyIGkgPSAwOyBpIDwgY291bnQ7IGkrKykgYnl0ZXNbc3RhcnQgKyBpXSA9IHBhY2tbaXNMaXR0bGVFbmRpYW4gPyBpIDogY291bnQgLSBpIC0gMV07Cgl9OwoKCWlmICghTkFUSVZFX0FSUkFZX0JVRkZFUikgewoJICAkQXJyYXlCdWZmZXIgPSBmdW5jdGlvbiBBcnJheUJ1ZmZlcihsZW5ndGgpIHsKCSAgICBhbkluc3RhbmNlJDEodGhpcywgQXJyYXlCdWZmZXJQcm90b3R5cGUkMSk7CgkgICAgdmFyIGJ5dGVMZW5ndGggPSB0b0luZGV4JDEobGVuZ3RoKTsKCSAgICBzZXRJbnRlcm5hbFN0YXRlJDEodGhpcywgewoJICAgICAgYnl0ZXM6IGZpbGwoQXJyYXkkMyhieXRlTGVuZ3RoKSwgMCksCgkgICAgICBieXRlTGVuZ3RoOiBieXRlTGVuZ3RoCgkgICAgfSk7CgkgICAgaWYgKCFERVNDUklQVE9SUyQyKSB0aGlzLmJ5dGVMZW5ndGggPSBieXRlTGVuZ3RoOwoJICB9OwoKCSAgQXJyYXlCdWZmZXJQcm90b3R5cGUkMSA9ICRBcnJheUJ1ZmZlcltQUk9UT1RZUEVdOwoKCSAgJERhdGFWaWV3ID0gZnVuY3Rpb24gRGF0YVZpZXcoYnVmZmVyLCBieXRlT2Zmc2V0LCBieXRlTGVuZ3RoKSB7CgkgICAgYW5JbnN0YW5jZSQxKHRoaXMsIERhdGFWaWV3UHJvdG90eXBlKTsKCSAgICBhbkluc3RhbmNlJDEoYnVmZmVyLCBBcnJheUJ1ZmZlclByb3RvdHlwZSQxKTsKCSAgICB2YXIgYnVmZmVyTGVuZ3RoID0gZ2V0SW50ZXJuYWxTdGF0ZSQxKGJ1ZmZlcikuYnl0ZUxlbmd0aDsKCSAgICB2YXIgb2Zmc2V0ID0gdG9JbnRlZ2VyT3JJbmZpbml0eSQzKGJ5dGVPZmZzZXQpOwoJICAgIGlmIChvZmZzZXQgPCAwIHx8IG9mZnNldCA+IGJ1ZmZlckxlbmd0aCkgdGhyb3cgUmFuZ2VFcnJvciQ0KCdXcm9uZyBvZmZzZXQnKTsKCSAgICBieXRlTGVuZ3RoID0gYnl0ZUxlbmd0aCA9PT0gdW5kZWZpbmVkID8gYnVmZmVyTGVuZ3RoIC0gb2Zmc2V0IDogdG9MZW5ndGgkMihieXRlTGVuZ3RoKTsKCSAgICBpZiAob2Zmc2V0ICsgYnl0ZUxlbmd0aCA+IGJ1ZmZlckxlbmd0aCkgdGhyb3cgUmFuZ2VFcnJvciQ0KFdST05HX0xFTkdUSCQxKTsKCSAgICBzZXRJbnRlcm5hbFN0YXRlJDEodGhpcywgewoJICAgICAgYnVmZmVyOiBidWZmZXIsCgkgICAgICBieXRlTGVuZ3RoOiBieXRlTGVuZ3RoLAoJICAgICAgYnl0ZU9mZnNldDogb2Zmc2V0CgkgICAgfSk7CgkgICAgaWYgKCFERVNDUklQVE9SUyQyKSB7CgkgICAgICB0aGlzLmJ1ZmZlciA9IGJ1ZmZlcjsKCSAgICAgIHRoaXMuYnl0ZUxlbmd0aCA9IGJ5dGVMZW5ndGg7CgkgICAgICB0aGlzLmJ5dGVPZmZzZXQgPSBvZmZzZXQ7CgkgICAgfQoJICB9OwoKCSAgRGF0YVZpZXdQcm90b3R5cGUgPSAkRGF0YVZpZXdbUFJPVE9UWVBFXTsKCgkgIGlmIChERVNDUklQVE9SUyQyKSB7CgkgICAgYWRkR2V0dGVyJDEoJEFycmF5QnVmZmVyLCAnYnl0ZUxlbmd0aCcpOwoJICAgIGFkZEdldHRlciQxKCREYXRhVmlldywgJ2J1ZmZlcicpOwoJICAgIGFkZEdldHRlciQxKCREYXRhVmlldywgJ2J5dGVMZW5ndGgnKTsKCSAgICBhZGRHZXR0ZXIkMSgkRGF0YVZpZXcsICdieXRlT2Zmc2V0Jyk7CgkgIH0KCgkgIHJlZGVmaW5lQWxsKERhdGFWaWV3UHJvdG90eXBlLCB7CgkgICAgZ2V0SW50ODogZnVuY3Rpb24gZ2V0SW50OChieXRlT2Zmc2V0KSB7CgkgICAgICByZXR1cm4gZ2V0KHRoaXMsIDEsIGJ5dGVPZmZzZXQpWzBdIDw8IDI0ID4+IDI0OwoJICAgIH0sCgkgICAgZ2V0VWludDg6IGZ1bmN0aW9uIGdldFVpbnQ4KGJ5dGVPZmZzZXQpIHsKCSAgICAgIHJldHVybiBnZXQodGhpcywgMSwgYnl0ZU9mZnNldClbMF07CgkgICAgfSwKCSAgICBnZXRJbnQxNjogZnVuY3Rpb24gZ2V0SW50MTYoYnl0ZU9mZnNldCAvKiAsIGxpdHRsZUVuZGlhbiAqLykgewoJICAgICAgdmFyIGJ5dGVzID0gZ2V0KHRoaXMsIDIsIGJ5dGVPZmZzZXQsIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkKTsKCSAgICAgIHJldHVybiAoYnl0ZXNbMV0gPDwgOCB8IGJ5dGVzWzBdKSA8PCAxNiA+PiAxNjsKCSAgICB9LAoJICAgIGdldFVpbnQxNjogZnVuY3Rpb24gZ2V0VWludDE2KGJ5dGVPZmZzZXQgLyogLCBsaXR0bGVFbmRpYW4gKi8pIHsKCSAgICAgIHZhciBieXRlcyA9IGdldCh0aGlzLCAyLCBieXRlT2Zmc2V0LCBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZCk7CgkgICAgICByZXR1cm4gYnl0ZXNbMV0gPDwgOCB8IGJ5dGVzWzBdOwoJICAgIH0sCgkgICAgZ2V0SW50MzI6IGZ1bmN0aW9uIGdldEludDMyKGJ5dGVPZmZzZXQgLyogLCBsaXR0bGVFbmRpYW4gKi8pIHsKCSAgICAgIHJldHVybiB1bnBhY2tJbnQzMihnZXQodGhpcywgNCwgYnl0ZU9mZnNldCwgYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQpKTsKCSAgICB9LAoJICAgIGdldFVpbnQzMjogZnVuY3Rpb24gZ2V0VWludDMyKGJ5dGVPZmZzZXQgLyogLCBsaXR0bGVFbmRpYW4gKi8pIHsKCSAgICAgIHJldHVybiB1bnBhY2tJbnQzMihnZXQodGhpcywgNCwgYnl0ZU9mZnNldCwgYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQpKSA+Pj4gMDsKCSAgICB9LAoJICAgIGdldEZsb2F0MzI6IGZ1bmN0aW9uIGdldEZsb2F0MzIoYnl0ZU9mZnNldCAvKiAsIGxpdHRsZUVuZGlhbiAqLykgewoJICAgICAgcmV0dXJuIHVucGFja0lFRUU3NTQoZ2V0KHRoaXMsIDQsIGJ5dGVPZmZzZXQsIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkKSwgMjMpOwoJICAgIH0sCgkgICAgZ2V0RmxvYXQ2NDogZnVuY3Rpb24gZ2V0RmxvYXQ2NChieXRlT2Zmc2V0IC8qICwgbGl0dGxlRW5kaWFuICovKSB7CgkgICAgICByZXR1cm4gdW5wYWNrSUVFRTc1NChnZXQodGhpcywgOCwgYnl0ZU9mZnNldCwgYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQpLCA1Mik7CgkgICAgfSwKCSAgICBzZXRJbnQ4OiBmdW5jdGlvbiBzZXRJbnQ4KGJ5dGVPZmZzZXQsIHZhbHVlKSB7CgkgICAgICBzZXQodGhpcywgMSwgYnl0ZU9mZnNldCwgcGFja0ludDgsIHZhbHVlKTsKCSAgICB9LAoJICAgIHNldFVpbnQ4OiBmdW5jdGlvbiBzZXRVaW50OChieXRlT2Zmc2V0LCB2YWx1ZSkgewoJICAgICAgc2V0KHRoaXMsIDEsIGJ5dGVPZmZzZXQsIHBhY2tJbnQ4LCB2YWx1ZSk7CgkgICAgfSwKCSAgICBzZXRJbnQxNjogZnVuY3Rpb24gc2V0SW50MTYoYnl0ZU9mZnNldCwgdmFsdWUgLyogLCBsaXR0bGVFbmRpYW4gKi8pIHsKCSAgICAgIHNldCh0aGlzLCAyLCBieXRlT2Zmc2V0LCBwYWNrSW50MTYsIHZhbHVlLCBhcmd1bWVudHMubGVuZ3RoID4gMiA/IGFyZ3VtZW50c1syXSA6IHVuZGVmaW5lZCk7CgkgICAgfSwKCSAgICBzZXRVaW50MTY6IGZ1bmN0aW9uIHNldFVpbnQxNihieXRlT2Zmc2V0LCB2YWx1ZSAvKiAsIGxpdHRsZUVuZGlhbiAqLykgewoJICAgICAgc2V0KHRoaXMsIDIsIGJ5dGVPZmZzZXQsIHBhY2tJbnQxNiwgdmFsdWUsIGFyZ3VtZW50cy5sZW5ndGggPiAyID8gYXJndW1lbnRzWzJdIDogdW5kZWZpbmVkKTsKCSAgICB9LAoJICAgIHNldEludDMyOiBmdW5jdGlvbiBzZXRJbnQzMihieXRlT2Zmc2V0LCB2YWx1ZSAvKiAsIGxpdHRsZUVuZGlhbiAqLykgewoJICAgICAgc2V0KHRoaXMsIDQsIGJ5dGVPZmZzZXQsIHBhY2tJbnQzMiwgdmFsdWUsIGFyZ3VtZW50cy5sZW5ndGggPiAyID8gYXJndW1lbnRzWzJdIDogdW5kZWZpbmVkKTsKCSAgICB9LAoJICAgIHNldFVpbnQzMjogZnVuY3Rpb24gc2V0VWludDMyKGJ5dGVPZmZzZXQsIHZhbHVlIC8qICwgbGl0dGxlRW5kaWFuICovKSB7CgkgICAgICBzZXQodGhpcywgNCwgYnl0ZU9mZnNldCwgcGFja0ludDMyLCB2YWx1ZSwgYXJndW1lbnRzLmxlbmd0aCA+IDIgPyBhcmd1bWVudHNbMl0gOiB1bmRlZmluZWQpOwoJICAgIH0sCgkgICAgc2V0RmxvYXQzMjogZnVuY3Rpb24gc2V0RmxvYXQzMihieXRlT2Zmc2V0LCB2YWx1ZSAvKiAsIGxpdHRsZUVuZGlhbiAqLykgewoJICAgICAgc2V0KHRoaXMsIDQsIGJ5dGVPZmZzZXQsIHBhY2tGbG9hdDMyLCB2YWx1ZSwgYXJndW1lbnRzLmxlbmd0aCA+IDIgPyBhcmd1bWVudHNbMl0gOiB1bmRlZmluZWQpOwoJICAgIH0sCgkgICAgc2V0RmxvYXQ2NDogZnVuY3Rpb24gc2V0RmxvYXQ2NChieXRlT2Zmc2V0LCB2YWx1ZSAvKiAsIGxpdHRsZUVuZGlhbiAqLykgewoJICAgICAgc2V0KHRoaXMsIDgsIGJ5dGVPZmZzZXQsIHBhY2tGbG9hdDY0LCB2YWx1ZSwgYXJndW1lbnRzLmxlbmd0aCA+IDIgPyBhcmd1bWVudHNbMl0gOiB1bmRlZmluZWQpOwoJICAgIH0KCSAgfSk7Cgl9IGVsc2UgewoJICB2YXIgSU5DT1JSRUNUX0FSUkFZX0JVRkZFUl9OQU1FID0gUFJPUEVSX0ZVTkNUSU9OX05BTUUkMSAmJiBOYXRpdmVBcnJheUJ1ZmZlciQxLm5hbWUgIT09IEFSUkFZX0JVRkZFUiQxOwoJICAvKiBlc2xpbnQtZGlzYWJsZSBuby1uZXcgLS0gcmVxdWlyZWQgZm9yIHRlc3RpbmcgKi8KCSAgaWYgKCFmYWlscyQ3KGZ1bmN0aW9uICgpIHsKCSAgICBOYXRpdmVBcnJheUJ1ZmZlciQxKDEpOwoJICB9KSB8fCAhZmFpbHMkNyhmdW5jdGlvbiAoKSB7CgkgICAgbmV3IE5hdGl2ZUFycmF5QnVmZmVyJDEoLTEpOwoJICB9KSB8fCBmYWlscyQ3KGZ1bmN0aW9uICgpIHsKCSAgICBuZXcgTmF0aXZlQXJyYXlCdWZmZXIkMSgpOwoJICAgIG5ldyBOYXRpdmVBcnJheUJ1ZmZlciQxKDEuNSk7CgkgICAgbmV3IE5hdGl2ZUFycmF5QnVmZmVyJDEoTmFOKTsKCSAgICByZXR1cm4gSU5DT1JSRUNUX0FSUkFZX0JVRkZFUl9OQU1FICYmICFDT05GSUdVUkFCTEVfRlVOQ1RJT05fTkFNRTsKCSAgfSkpIHsKCSAgLyogZXNsaW50LWVuYWJsZSBuby1uZXcgLS0gcmVxdWlyZWQgZm9yIHRlc3RpbmcgKi8KCSAgICAkQXJyYXlCdWZmZXIgPSBmdW5jdGlvbiBBcnJheUJ1ZmZlcihsZW5ndGgpIHsKCSAgICAgIGFuSW5zdGFuY2UkMSh0aGlzLCBBcnJheUJ1ZmZlclByb3RvdHlwZSQxKTsKCSAgICAgIHJldHVybiBuZXcgTmF0aXZlQXJyYXlCdWZmZXIkMSh0b0luZGV4JDEobGVuZ3RoKSk7CgkgICAgfTsKCgkgICAgJEFycmF5QnVmZmVyW1BST1RPVFlQRV0gPSBBcnJheUJ1ZmZlclByb3RvdHlwZSQxOwoKCSAgICBmb3IgKHZhciBrZXlzID0gZ2V0T3duUHJvcGVydHlOYW1lcyQxKE5hdGl2ZUFycmF5QnVmZmVyJDEpLCBqID0gMCwga2V5OyBrZXlzLmxlbmd0aCA+IGo7KSB7CgkgICAgICBpZiAoISgoa2V5ID0ga2V5c1tqKytdKSBpbiAkQXJyYXlCdWZmZXIpKSB7CgkgICAgICAgIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSQxKCRBcnJheUJ1ZmZlciwga2V5LCBOYXRpdmVBcnJheUJ1ZmZlciQxW2tleV0pOwoJICAgICAgfQoJICAgIH0KCgkgICAgQXJyYXlCdWZmZXJQcm90b3R5cGUkMS5jb25zdHJ1Y3RvciA9ICRBcnJheUJ1ZmZlcjsKCSAgfSBlbHNlIGlmIChJTkNPUlJFQ1RfQVJSQVlfQlVGRkVSX05BTUUgJiYgQ09ORklHVVJBQkxFX0ZVTkNUSU9OX05BTUUpIHsKCSAgICBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkkMShOYXRpdmVBcnJheUJ1ZmZlciQxLCAnbmFtZScsIEFSUkFZX0JVRkZFUiQxKTsKCSAgfQoKCSAgLy8gV2ViS2l0IGJ1ZyAtIHRoZSBzYW1lIHBhcmVudCBwcm90b3R5cGUgZm9yIHR5cGVkIGFycmF5cyBhbmQgZGF0YSB2aWV3CgkgIGlmIChzZXRQcm90b3R5cGVPZiQyICYmIGdldFByb3RvdHlwZU9mKERhdGFWaWV3UHJvdG90eXBlKSAhPT0gT2JqZWN0UHJvdG90eXBlKSB7CgkgICAgc2V0UHJvdG90eXBlT2YkMihEYXRhVmlld1Byb3RvdHlwZSwgT2JqZWN0UHJvdG90eXBlKTsKCSAgfQoKCSAgLy8gaU9TIFNhZmFyaSA3LnggYnVnCgkgIHZhciB0ZXN0VmlldyA9IG5ldyAkRGF0YVZpZXcobmV3ICRBcnJheUJ1ZmZlcigyKSk7CgkgIHZhciAkc2V0SW50OCA9IHVuY3VycnlUaGlzJGIoRGF0YVZpZXdQcm90b3R5cGUuc2V0SW50OCk7CgkgIHRlc3RWaWV3LnNldEludDgoMCwgMjE0NzQ4MzY0OCk7CgkgIHRlc3RWaWV3LnNldEludDgoMSwgMjE0NzQ4MzY0OSk7CgkgIGlmICh0ZXN0Vmlldy5nZXRJbnQ4KDApIHx8ICF0ZXN0Vmlldy5nZXRJbnQ4KDEpKSByZWRlZmluZUFsbChEYXRhVmlld1Byb3RvdHlwZSwgewoJICAgIHNldEludDg6IGZ1bmN0aW9uIHNldEludDgoYnl0ZU9mZnNldCwgdmFsdWUpIHsKCSAgICAgICRzZXRJbnQ4KHRoaXMsIGJ5dGVPZmZzZXQsIHZhbHVlIDw8IDI0ID4+IDI0KTsKCSAgICB9LAoJICAgIHNldFVpbnQ4OiBmdW5jdGlvbiBzZXRVaW50OChieXRlT2Zmc2V0LCB2YWx1ZSkgewoJICAgICAgJHNldEludDgodGhpcywgYnl0ZU9mZnNldCwgdmFsdWUgPDwgMjQgPj4gMjQpOwoJICAgIH0KCSAgfSwgeyB1bnNhZmU6IHRydWUgfSk7Cgl9CgoJc2V0VG9TdHJpbmdUYWcoJEFycmF5QnVmZmVyLCBBUlJBWV9CVUZGRVIkMSk7CglzZXRUb1N0cmluZ1RhZygkRGF0YVZpZXcsIERBVEFfVklFVyk7CgoJdmFyIGFycmF5QnVmZmVyID0gewoJICBBcnJheUJ1ZmZlcjogJEFycmF5QnVmZmVyLAoJICBEYXRhVmlldzogJERhdGFWaWV3Cgl9OwoKCXZhciBpc09iamVjdCQzID0gaXNPYmplY3QkYTsKCgl2YXIgZmxvb3IkMiA9IE1hdGguZmxvb3I7CgoJLy8gYElzSW50ZWdyYWxOdW1iZXJgIGFic3RyYWN0IG9wZXJhdGlvbgoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1pc2ludGVncmFsbnVtYmVyCgkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZXMvbm8tbnVtYmVyLWlzaW50ZWdlciAtLSBzYWZlCgl2YXIgaXNJbnRlZ3JhbE51bWJlciQxID0gTnVtYmVyLmlzSW50ZWdlciB8fCBmdW5jdGlvbiBpc0ludGVnZXIoaXQpIHsKCSAgcmV0dXJuICFpc09iamVjdCQzKGl0KSAmJiBpc0Zpbml0ZShpdCkgJiYgZmxvb3IkMihpdCkgPT09IGl0OwoJfTsKCgl2YXIgZ2xvYmFsJGQgPSBnbG9iYWwkSTsKCXZhciB0b0ludGVnZXJPckluZmluaXR5JDIgPSB0b0ludGVnZXJPckluZmluaXR5JDc7CgoJdmFyIFJhbmdlRXJyb3IkMyA9IGdsb2JhbCRkLlJhbmdlRXJyb3I7CgoJdmFyIHRvUG9zaXRpdmVJbnRlZ2VyJDEgPSBmdW5jdGlvbiAoaXQpIHsKCSAgdmFyIHJlc3VsdCA9IHRvSW50ZWdlck9ySW5maW5pdHkkMihpdCk7CgkgIGlmIChyZXN1bHQgPCAwKSB0aHJvdyBSYW5nZUVycm9yJDMoIlRoZSBhcmd1bWVudCBjYW4ndCBiZSBsZXNzIHRoYW4gMCIpOwoJICByZXR1cm4gcmVzdWx0OwoJfTsKCgl2YXIgZ2xvYmFsJGMgPSBnbG9iYWwkSTsKCXZhciB0b1Bvc2l0aXZlSW50ZWdlciA9IHRvUG9zaXRpdmVJbnRlZ2VyJDE7CgoJdmFyIFJhbmdlRXJyb3IkMiA9IGdsb2JhbCRjLlJhbmdlRXJyb3I7CgoJdmFyIHRvT2Zmc2V0JDIgPSBmdW5jdGlvbiAoaXQsIEJZVEVTKSB7CgkgIHZhciBvZmZzZXQgPSB0b1Bvc2l0aXZlSW50ZWdlcihpdCk7CgkgIGlmIChvZmZzZXQgJSBCWVRFUykgdGhyb3cgUmFuZ2VFcnJvciQyKCdXcm9uZyBvZmZzZXQnKTsKCSAgcmV0dXJuIG9mZnNldDsKCX07CgoJdmFyIHVuY3VycnlUaGlzJGEgPSBmdW5jdGlvblVuY3VycnlUaGlzOwoJdmFyIGFDYWxsYWJsZSQ0ID0gYUNhbGxhYmxlJDY7CgoJdmFyIGJpbmQkNCA9IHVuY3VycnlUaGlzJGEodW5jdXJyeVRoaXMkYS5iaW5kKTsKCgkvLyBvcHRpb25hbCAvIHNpbXBsZSBjb250ZXh0IGJpbmRpbmcKCXZhciBmdW5jdGlvbkJpbmRDb250ZXh0ID0gZnVuY3Rpb24gKGZuLCB0aGF0KSB7CgkgIGFDYWxsYWJsZSQ0KGZuKTsKCSAgcmV0dXJuIHRoYXQgPT09IHVuZGVmaW5lZCA/IGZuIDogYmluZCQ0ID8gYmluZCQ0KGZuLCB0aGF0KSA6IGZ1bmN0aW9uICgvKiAuLi5hcmdzICovKSB7CgkgICAgcmV0dXJuIGZuLmFwcGx5KHRoYXQsIGFyZ3VtZW50cyk7CgkgIH07Cgl9OwoKCXZhciB1bmN1cnJ5VGhpcyQ5ID0gZnVuY3Rpb25VbmN1cnJ5VGhpczsKCXZhciBmYWlscyQ2ID0gZmFpbHMkZzsKCXZhciBpc0NhbGxhYmxlJDEgPSBpc0NhbGxhYmxlJGg7Cgl2YXIgY2xhc3NvZiQzID0gY2xhc3NvZiQ2OwoJdmFyIGdldEJ1aWx0SW4kMiA9IGdldEJ1aWx0SW4kNzsKCXZhciBpbnNwZWN0U291cmNlID0gaW5zcGVjdFNvdXJjZSQzOwoKCXZhciBub29wID0gZnVuY3Rpb24gKCkgeyAvKiBlbXB0eSAqLyB9OwoJdmFyIGVtcHR5ID0gW107Cgl2YXIgY29uc3RydWN0ID0gZ2V0QnVpbHRJbiQyKCdSZWZsZWN0JywgJ2NvbnN0cnVjdCcpOwoJdmFyIGNvbnN0cnVjdG9yUmVnRXhwID0gL15ccyooPzpjbGFzc3xmdW5jdGlvbilcYi87Cgl2YXIgZXhlYyA9IHVuY3VycnlUaGlzJDkoY29uc3RydWN0b3JSZWdFeHAuZXhlYyk7Cgl2YXIgSU5DT1JSRUNUX1RPX1NUUklORyA9ICFjb25zdHJ1Y3RvclJlZ0V4cC5leGVjKG5vb3ApOwoKCXZhciBpc0NvbnN0cnVjdG9yTW9kZXJuID0gZnVuY3Rpb24gKGFyZ3VtZW50KSB7CgkgIGlmICghaXNDYWxsYWJsZSQxKGFyZ3VtZW50KSkgcmV0dXJuIGZhbHNlOwoJICB0cnkgewoJICAgIGNvbnN0cnVjdChub29wLCBlbXB0eSwgYXJndW1lbnQpOwoJICAgIHJldHVybiB0cnVlOwoJICB9IGNhdGNoIChlcnJvcikgewoJICAgIHJldHVybiBmYWxzZTsKCSAgfQoJfTsKCgl2YXIgaXNDb25zdHJ1Y3RvckxlZ2FjeSA9IGZ1bmN0aW9uIChhcmd1bWVudCkgewoJICBpZiAoIWlzQ2FsbGFibGUkMShhcmd1bWVudCkpIHJldHVybiBmYWxzZTsKCSAgc3dpdGNoIChjbGFzc29mJDMoYXJndW1lbnQpKSB7CgkgICAgY2FzZSAnQXN5bmNGdW5jdGlvbic6CgkgICAgY2FzZSAnR2VuZXJhdG9yRnVuY3Rpb24nOgoJICAgIGNhc2UgJ0FzeW5jR2VuZXJhdG9yRnVuY3Rpb24nOiByZXR1cm4gZmFsc2U7CgkgICAgLy8gd2UgY2FuJ3QgY2hlY2sgLnByb3RvdHlwZSBzaW5jZSBjb25zdHJ1Y3RvcnMgcHJvZHVjZWQgYnkgLmJpbmQgaGF2ZW4ndCBpdAoJICB9IHJldHVybiBJTkNPUlJFQ1RfVE9fU1RSSU5HIHx8ICEhZXhlYyhjb25zdHJ1Y3RvclJlZ0V4cCwgaW5zcGVjdFNvdXJjZShhcmd1bWVudCkpOwoJfTsKCgkvLyBgSXNDb25zdHJ1Y3RvcmAgYWJzdHJhY3Qgb3BlcmF0aW9uCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLWlzY29uc3RydWN0b3IKCXZhciBpc0NvbnN0cnVjdG9yJDIgPSAhY29uc3RydWN0IHx8IGZhaWxzJDYoZnVuY3Rpb24gKCkgewoJICB2YXIgY2FsbGVkOwoJICByZXR1cm4gaXNDb25zdHJ1Y3Rvck1vZGVybihpc0NvbnN0cnVjdG9yTW9kZXJuLmNhbGwpCgkgICAgfHwgIWlzQ29uc3RydWN0b3JNb2Rlcm4oT2JqZWN0KQoJICAgIHx8ICFpc0NvbnN0cnVjdG9yTW9kZXJuKGZ1bmN0aW9uICgpIHsgY2FsbGVkID0gdHJ1ZTsgfSkKCSAgICB8fCBjYWxsZWQ7Cgl9KSA/IGlzQ29uc3RydWN0b3JMZWdhY3kgOiBpc0NvbnN0cnVjdG9yTW9kZXJuOwoKCXZhciBnbG9iYWwkYiA9IGdsb2JhbCRJOwoJdmFyIGlzQ29uc3RydWN0b3IkMSA9IGlzQ29uc3RydWN0b3IkMjsKCXZhciB0cnlUb1N0cmluZyQxID0gdHJ5VG9TdHJpbmckNDsKCgl2YXIgVHlwZUVycm9yJDIgPSBnbG9iYWwkYi5UeXBlRXJyb3I7CgoJLy8gYEFzc2VydDogSXNDb25zdHJ1Y3Rvcihhcmd1bWVudCkgaXMgdHJ1ZWAKCXZhciBhQ29uc3RydWN0b3IkMiA9IGZ1bmN0aW9uIChhcmd1bWVudCkgewoJICBpZiAoaXNDb25zdHJ1Y3RvciQxKGFyZ3VtZW50KSkgcmV0dXJuIGFyZ3VtZW50OwoJICB0aHJvdyBUeXBlRXJyb3IkMih0cnlUb1N0cmluZyQxKGFyZ3VtZW50KSArICcgaXMgbm90IGEgY29uc3RydWN0b3InKTsKCX07CgoJdmFyIGNsYXNzb2YkMiA9IGNsYXNzb2YkNjsKCXZhciBnZXRNZXRob2QgPSBnZXRNZXRob2QkMjsKCXZhciBJdGVyYXRvcnMkMSA9IGl0ZXJhdG9yczsKCXZhciB3ZWxsS25vd25TeW1ib2wkNSA9IHdlbGxLbm93blN5bWJvbCRmOwoKCXZhciBJVEVSQVRPUiQyID0gd2VsbEtub3duU3ltYm9sJDUoJ2l0ZXJhdG9yJyk7CgoJdmFyIGdldEl0ZXJhdG9yTWV0aG9kJDIgPSBmdW5jdGlvbiAoaXQpIHsKCSAgaWYgKGl0ICE9IHVuZGVmaW5lZCkgcmV0dXJuIGdldE1ldGhvZChpdCwgSVRFUkFUT1IkMikKCSAgICB8fCBnZXRNZXRob2QoaXQsICdAQGl0ZXJhdG9yJykKCSAgICB8fCBJdGVyYXRvcnMkMVtjbGFzc29mJDIoaXQpXTsKCX07CgoJdmFyIGdsb2JhbCRhID0gZ2xvYmFsJEk7Cgl2YXIgY2FsbCQ0ID0gZnVuY3Rpb25DYWxsOwoJdmFyIGFDYWxsYWJsZSQzID0gYUNhbGxhYmxlJDY7Cgl2YXIgYW5PYmplY3QkMSA9IGFuT2JqZWN0JDc7Cgl2YXIgdHJ5VG9TdHJpbmcgPSB0cnlUb1N0cmluZyQ0OwoJdmFyIGdldEl0ZXJhdG9yTWV0aG9kJDEgPSBnZXRJdGVyYXRvck1ldGhvZCQyOwoKCXZhciBUeXBlRXJyb3IkMSA9IGdsb2JhbCRhLlR5cGVFcnJvcjsKCgl2YXIgZ2V0SXRlcmF0b3IkMSA9IGZ1bmN0aW9uIChhcmd1bWVudCwgdXNpbmdJdGVyYXRvcikgewoJICB2YXIgaXRlcmF0b3JNZXRob2QgPSBhcmd1bWVudHMubGVuZ3RoIDwgMiA/IGdldEl0ZXJhdG9yTWV0aG9kJDEoYXJndW1lbnQpIDogdXNpbmdJdGVyYXRvcjsKCSAgaWYgKGFDYWxsYWJsZSQzKGl0ZXJhdG9yTWV0aG9kKSkgcmV0dXJuIGFuT2JqZWN0JDEoY2FsbCQ0KGl0ZXJhdG9yTWV0aG9kLCBhcmd1bWVudCkpOwoJICB0aHJvdyBUeXBlRXJyb3IkMSh0cnlUb1N0cmluZyhhcmd1bWVudCkgKyAnIGlzIG5vdCBpdGVyYWJsZScpOwoJfTsKCgl2YXIgd2VsbEtub3duU3ltYm9sJDQgPSB3ZWxsS25vd25TeW1ib2wkZjsKCXZhciBJdGVyYXRvcnMgPSBpdGVyYXRvcnM7CgoJdmFyIElURVJBVE9SJDEgPSB3ZWxsS25vd25TeW1ib2wkNCgnaXRlcmF0b3InKTsKCXZhciBBcnJheVByb3RvdHlwZSA9IEFycmF5LnByb3RvdHlwZTsKCgkvLyBjaGVjayBvbiBkZWZhdWx0IEFycmF5IGl0ZXJhdG9yCgl2YXIgaXNBcnJheUl0ZXJhdG9yTWV0aG9kJDEgPSBmdW5jdGlvbiAoaXQpIHsKCSAgcmV0dXJuIGl0ICE9PSB1bmRlZmluZWQgJiYgKEl0ZXJhdG9ycy5BcnJheSA9PT0gaXQgfHwgQXJyYXlQcm90b3R5cGVbSVRFUkFUT1IkMV0gPT09IGl0KTsKCX07CgoJdmFyIGJpbmQkMyA9IGZ1bmN0aW9uQmluZENvbnRleHQ7Cgl2YXIgY2FsbCQzID0gZnVuY3Rpb25DYWxsOwoJdmFyIGFDb25zdHJ1Y3RvciQxID0gYUNvbnN0cnVjdG9yJDI7Cgl2YXIgdG9PYmplY3QkNiA9IHRvT2JqZWN0JGE7Cgl2YXIgbGVuZ3RoT2ZBcnJheUxpa2UkOCA9IGxlbmd0aE9mQXJyYXlMaWtlJGM7Cgl2YXIgZ2V0SXRlcmF0b3IgPSBnZXRJdGVyYXRvciQxOwoJdmFyIGdldEl0ZXJhdG9yTWV0aG9kID0gZ2V0SXRlcmF0b3JNZXRob2QkMjsKCXZhciBpc0FycmF5SXRlcmF0b3JNZXRob2QgPSBpc0FycmF5SXRlcmF0b3JNZXRob2QkMTsKCXZhciBhVHlwZWRBcnJheUNvbnN0cnVjdG9yJDIgPSBhcnJheUJ1ZmZlclZpZXdDb3JlLmFUeXBlZEFycmF5Q29uc3RydWN0b3I7CgoJdmFyIHR5cGVkQXJyYXlGcm9tJDEgPSBmdW5jdGlvbiBmcm9tKHNvdXJjZSAvKiAsIG1hcGZuLCB0aGlzQXJnICovKSB7CgkgIHZhciBDID0gYUNvbnN0cnVjdG9yJDEodGhpcyk7CgkgIHZhciBPID0gdG9PYmplY3QkNihzb3VyY2UpOwoJICB2YXIgYXJndW1lbnRzTGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aDsKCSAgdmFyIG1hcGZuID0gYXJndW1lbnRzTGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZDsKCSAgdmFyIG1hcHBpbmcgPSBtYXBmbiAhPT0gdW5kZWZpbmVkOwoJICB2YXIgaXRlcmF0b3JNZXRob2QgPSBnZXRJdGVyYXRvck1ldGhvZChPKTsKCSAgdmFyIGksIGxlbmd0aCwgcmVzdWx0LCBzdGVwLCBpdGVyYXRvciwgbmV4dDsKCSAgaWYgKGl0ZXJhdG9yTWV0aG9kICYmICFpc0FycmF5SXRlcmF0b3JNZXRob2QoaXRlcmF0b3JNZXRob2QpKSB7CgkgICAgaXRlcmF0b3IgPSBnZXRJdGVyYXRvcihPLCBpdGVyYXRvck1ldGhvZCk7CgkgICAgbmV4dCA9IGl0ZXJhdG9yLm5leHQ7CgkgICAgTyA9IFtdOwoJICAgIHdoaWxlICghKHN0ZXAgPSBjYWxsJDMobmV4dCwgaXRlcmF0b3IpKS5kb25lKSB7CgkgICAgICBPLnB1c2goc3RlcC52YWx1ZSk7CgkgICAgfQoJICB9CgkgIGlmIChtYXBwaW5nICYmIGFyZ3VtZW50c0xlbmd0aCA+IDIpIHsKCSAgICBtYXBmbiA9IGJpbmQkMyhtYXBmbiwgYXJndW1lbnRzWzJdKTsKCSAgfQoJICBsZW5ndGggPSBsZW5ndGhPZkFycmF5TGlrZSQ4KE8pOwoJICByZXN1bHQgPSBuZXcgKGFUeXBlZEFycmF5Q29uc3RydWN0b3IkMihDKSkobGVuZ3RoKTsKCSAgZm9yIChpID0gMDsgbGVuZ3RoID4gaTsgaSsrKSB7CgkgICAgcmVzdWx0W2ldID0gbWFwcGluZyA/IG1hcGZuKE9baV0sIGkpIDogT1tpXTsKCSAgfQoJICByZXR1cm4gcmVzdWx0OwoJfTsKCgl2YXIgY2xhc3NvZiQxID0gY2xhc3NvZlJhdyQxOwoKCS8vIGBJc0FycmF5YCBhYnN0cmFjdCBvcGVyYXRpb24KCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtaXNhcnJheQoJLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGVzL25vLWFycmF5LWlzYXJyYXkgLS0gc2FmZQoJdmFyIGlzQXJyYXkkMSA9IEFycmF5LmlzQXJyYXkgfHwgZnVuY3Rpb24gaXNBcnJheShhcmd1bWVudCkgewoJICByZXR1cm4gY2xhc3NvZiQxKGFyZ3VtZW50KSA9PSAnQXJyYXknOwoJfTsKCgl2YXIgZ2xvYmFsJDkgPSBnbG9iYWwkSTsKCXZhciBpc0FycmF5ID0gaXNBcnJheSQxOwoJdmFyIGlzQ29uc3RydWN0b3IgPSBpc0NvbnN0cnVjdG9yJDI7Cgl2YXIgaXNPYmplY3QkMiA9IGlzT2JqZWN0JGE7Cgl2YXIgd2VsbEtub3duU3ltYm9sJDMgPSB3ZWxsS25vd25TeW1ib2wkZjsKCgl2YXIgU1BFQ0lFUyQyID0gd2VsbEtub3duU3ltYm9sJDMoJ3NwZWNpZXMnKTsKCXZhciBBcnJheSQyID0gZ2xvYmFsJDkuQXJyYXk7CgoJLy8gYSBwYXJ0IG9mIGBBcnJheVNwZWNpZXNDcmVhdGVgIGFic3RyYWN0IG9wZXJhdGlvbgoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1hcnJheXNwZWNpZXNjcmVhdGUKCXZhciBhcnJheVNwZWNpZXNDb25zdHJ1Y3RvciQxID0gZnVuY3Rpb24gKG9yaWdpbmFsQXJyYXkpIHsKCSAgdmFyIEM7CgkgIGlmIChpc0FycmF5KG9yaWdpbmFsQXJyYXkpKSB7CgkgICAgQyA9IG9yaWdpbmFsQXJyYXkuY29uc3RydWN0b3I7CgkgICAgLy8gY3Jvc3MtcmVhbG0gZmFsbGJhY2sKCSAgICBpZiAoaXNDb25zdHJ1Y3RvcihDKSAmJiAoQyA9PT0gQXJyYXkkMiB8fCBpc0FycmF5KEMucHJvdG90eXBlKSkpIEMgPSB1bmRlZmluZWQ7CgkgICAgZWxzZSBpZiAoaXNPYmplY3QkMihDKSkgewoJICAgICAgQyA9IENbU1BFQ0lFUyQyXTsKCSAgICAgIGlmIChDID09PSBudWxsKSBDID0gdW5kZWZpbmVkOwoJICAgIH0KCSAgfSByZXR1cm4gQyA9PT0gdW5kZWZpbmVkID8gQXJyYXkkMiA6IEM7Cgl9OwoKCXZhciBhcnJheVNwZWNpZXNDb25zdHJ1Y3RvciA9IGFycmF5U3BlY2llc0NvbnN0cnVjdG9yJDE7CgoJLy8gYEFycmF5U3BlY2llc0NyZWF0ZWAgYWJzdHJhY3Qgb3BlcmF0aW9uCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLWFycmF5c3BlY2llc2NyZWF0ZQoJdmFyIGFycmF5U3BlY2llc0NyZWF0ZSQyID0gZnVuY3Rpb24gKG9yaWdpbmFsQXJyYXksIGxlbmd0aCkgewoJICByZXR1cm4gbmV3IChhcnJheVNwZWNpZXNDb25zdHJ1Y3RvcihvcmlnaW5hbEFycmF5KSkobGVuZ3RoID09PSAwID8gMCA6IGxlbmd0aCk7Cgl9OwoKCXZhciBiaW5kJDIgPSBmdW5jdGlvbkJpbmRDb250ZXh0OwoJdmFyIHVuY3VycnlUaGlzJDggPSBmdW5jdGlvblVuY3VycnlUaGlzOwoJdmFyIEluZGV4ZWRPYmplY3QkMiA9IGluZGV4ZWRPYmplY3Q7Cgl2YXIgdG9PYmplY3QkNSA9IHRvT2JqZWN0JGE7Cgl2YXIgbGVuZ3RoT2ZBcnJheUxpa2UkNyA9IGxlbmd0aE9mQXJyYXlMaWtlJGM7Cgl2YXIgYXJyYXlTcGVjaWVzQ3JlYXRlJDEgPSBhcnJheVNwZWNpZXNDcmVhdGUkMjsKCgl2YXIgcHVzaCQxID0gdW5jdXJyeVRoaXMkOChbXS5wdXNoKTsKCgkvLyBgQXJyYXkucHJvdG90eXBlLnsgZm9yRWFjaCwgbWFwLCBmaWx0ZXIsIHNvbWUsIGV2ZXJ5LCBmaW5kLCBmaW5kSW5kZXgsIGZpbHRlclJlamVjdCB9YCBtZXRob2RzIGltcGxlbWVudGF0aW9uCgl2YXIgY3JlYXRlTWV0aG9kJDIgPSBmdW5jdGlvbiAoVFlQRSkgewoJICB2YXIgSVNfTUFQID0gVFlQRSA9PSAxOwoJICB2YXIgSVNfRklMVEVSID0gVFlQRSA9PSAyOwoJICB2YXIgSVNfU09NRSA9IFRZUEUgPT0gMzsKCSAgdmFyIElTX0VWRVJZID0gVFlQRSA9PSA0OwoJICB2YXIgSVNfRklORF9JTkRFWCA9IFRZUEUgPT0gNjsKCSAgdmFyIElTX0ZJTFRFUl9SRUpFQ1QgPSBUWVBFID09IDc7CgkgIHZhciBOT19IT0xFUyA9IFRZUEUgPT0gNSB8fCBJU19GSU5EX0lOREVYOwoJICByZXR1cm4gZnVuY3Rpb24gKCR0aGlzLCBjYWxsYmFja2ZuLCB0aGF0LCBzcGVjaWZpY0NyZWF0ZSkgewoJICAgIHZhciBPID0gdG9PYmplY3QkNSgkdGhpcyk7CgkgICAgdmFyIHNlbGYgPSBJbmRleGVkT2JqZWN0JDIoTyk7CgkgICAgdmFyIGJvdW5kRnVuY3Rpb24gPSBiaW5kJDIoY2FsbGJhY2tmbiwgdGhhdCk7CgkgICAgdmFyIGxlbmd0aCA9IGxlbmd0aE9mQXJyYXlMaWtlJDcoc2VsZik7CgkgICAgdmFyIGluZGV4ID0gMDsKCSAgICB2YXIgY3JlYXRlID0gc3BlY2lmaWNDcmVhdGUgfHwgYXJyYXlTcGVjaWVzQ3JlYXRlJDE7CgkgICAgdmFyIHRhcmdldCA9IElTX01BUCA/IGNyZWF0ZSgkdGhpcywgbGVuZ3RoKSA6IElTX0ZJTFRFUiB8fCBJU19GSUxURVJfUkVKRUNUID8gY3JlYXRlKCR0aGlzLCAwKSA6IHVuZGVmaW5lZDsKCSAgICB2YXIgdmFsdWUsIHJlc3VsdDsKCSAgICBmb3IgKDtsZW5ndGggPiBpbmRleDsgaW5kZXgrKykgaWYgKE5PX0hPTEVTIHx8IGluZGV4IGluIHNlbGYpIHsKCSAgICAgIHZhbHVlID0gc2VsZltpbmRleF07CgkgICAgICByZXN1bHQgPSBib3VuZEZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgTyk7CgkgICAgICBpZiAoVFlQRSkgewoJICAgICAgICBpZiAoSVNfTUFQKSB0YXJnZXRbaW5kZXhdID0gcmVzdWx0OyAvLyBtYXAKCSAgICAgICAgZWxzZSBpZiAocmVzdWx0KSBzd2l0Y2ggKFRZUEUpIHsKCSAgICAgICAgICBjYXNlIDM6IHJldHVybiB0cnVlOyAgICAgICAgICAgICAgLy8gc29tZQoJICAgICAgICAgIGNhc2UgNTogcmV0dXJuIHZhbHVlOyAgICAgICAgICAgICAvLyBmaW5kCgkgICAgICAgICAgY2FzZSA2OiByZXR1cm4gaW5kZXg7ICAgICAgICAgICAgIC8vIGZpbmRJbmRleAoJICAgICAgICAgIGNhc2UgMjogcHVzaCQxKHRhcmdldCwgdmFsdWUpOyAgICAgIC8vIGZpbHRlcgoJICAgICAgICB9IGVsc2Ugc3dpdGNoIChUWVBFKSB7CgkgICAgICAgICAgY2FzZSA0OiByZXR1cm4gZmFsc2U7ICAgICAgICAgICAgIC8vIGV2ZXJ5CgkgICAgICAgICAgY2FzZSA3OiBwdXNoJDEodGFyZ2V0LCB2YWx1ZSk7ICAgICAgLy8gZmlsdGVyUmVqZWN0CgkgICAgICAgIH0KCSAgICAgIH0KCSAgICB9CgkgICAgcmV0dXJuIElTX0ZJTkRfSU5ERVggPyAtMSA6IElTX1NPTUUgfHwgSVNfRVZFUlkgPyBJU19FVkVSWSA6IHRhcmdldDsKCSAgfTsKCX07CgoJdmFyIGFycmF5SXRlcmF0aW9uID0gewoJICAvLyBgQXJyYXkucHJvdG90eXBlLmZvckVhY2hgIG1ldGhvZAoJICAvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLWFycmF5LnByb3RvdHlwZS5mb3JlYWNoCgkgIGZvckVhY2g6IGNyZWF0ZU1ldGhvZCQyKDApLAoJICAvLyBgQXJyYXkucHJvdG90eXBlLm1hcGAgbWV0aG9kCgkgIC8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtYXJyYXkucHJvdG90eXBlLm1hcAoJICBtYXA6IGNyZWF0ZU1ldGhvZCQyKDEpLAoJICAvLyBgQXJyYXkucHJvdG90eXBlLmZpbHRlcmAgbWV0aG9kCgkgIC8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtYXJyYXkucHJvdG90eXBlLmZpbHRlcgoJICBmaWx0ZXI6IGNyZWF0ZU1ldGhvZCQyKDIpLAoJICAvLyBgQXJyYXkucHJvdG90eXBlLnNvbWVgIG1ldGhvZAoJICAvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLWFycmF5LnByb3RvdHlwZS5zb21lCgkgIHNvbWU6IGNyZWF0ZU1ldGhvZCQyKDMpLAoJICAvLyBgQXJyYXkucHJvdG90eXBlLmV2ZXJ5YCBtZXRob2QKCSAgLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1hcnJheS5wcm90b3R5cGUuZXZlcnkKCSAgZXZlcnk6IGNyZWF0ZU1ldGhvZCQyKDQpLAoJICAvLyBgQXJyYXkucHJvdG90eXBlLmZpbmRgIG1ldGhvZAoJICAvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLWFycmF5LnByb3RvdHlwZS5maW5kCgkgIGZpbmQ6IGNyZWF0ZU1ldGhvZCQyKDUpLAoJICAvLyBgQXJyYXkucHJvdG90eXBlLmZpbmRJbmRleGAgbWV0aG9kCgkgIC8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtYXJyYXkucHJvdG90eXBlLmZpbmRJbmRleAoJICBmaW5kSW5kZXg6IGNyZWF0ZU1ldGhvZCQyKDYpLAoJICAvLyBgQXJyYXkucHJvdG90eXBlLmZpbHRlclJlamVjdGAgbWV0aG9kCgkgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS90YzM5L3Byb3Bvc2FsLWFycmF5LWZpbHRlcmluZwoJICBmaWx0ZXJSZWplY3Q6IGNyZWF0ZU1ldGhvZCQyKDcpCgl9OwoKCXZhciBnZXRCdWlsdEluJDEgPSBnZXRCdWlsdEluJDc7Cgl2YXIgZGVmaW5lUHJvcGVydHlNb2R1bGUkMSA9IG9iamVjdERlZmluZVByb3BlcnR5OwoJdmFyIHdlbGxLbm93blN5bWJvbCQyID0gd2VsbEtub3duU3ltYm9sJGY7Cgl2YXIgREVTQ1JJUFRPUlMkMSA9IGRlc2NyaXB0b3JzOwoKCXZhciBTUEVDSUVTJDEgPSB3ZWxsS25vd25TeW1ib2wkMignc3BlY2llcycpOwoKCXZhciBzZXRTcGVjaWVzJDIgPSBmdW5jdGlvbiAoQ09OU1RSVUNUT1JfTkFNRSkgewoJICB2YXIgQ29uc3RydWN0b3IgPSBnZXRCdWlsdEluJDEoQ09OU1RSVUNUT1JfTkFNRSk7CgkgIHZhciBkZWZpbmVQcm9wZXJ0eSA9IGRlZmluZVByb3BlcnR5TW9kdWxlJDEuZjsKCgkgIGlmIChERVNDUklQVE9SUyQxICYmIENvbnN0cnVjdG9yICYmICFDb25zdHJ1Y3RvcltTUEVDSUVTJDFdKSB7CgkgICAgZGVmaW5lUHJvcGVydHkoQ29uc3RydWN0b3IsIFNQRUNJRVMkMSwgewoJICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAoJICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzOyB9CgkgICAgfSk7CgkgIH0KCX07CgoJdmFyIGlzQ2FsbGFibGUgPSBpc0NhbGxhYmxlJGg7Cgl2YXIgaXNPYmplY3QkMSA9IGlzT2JqZWN0JGE7Cgl2YXIgc2V0UHJvdG90eXBlT2YkMSA9IG9iamVjdFNldFByb3RvdHlwZU9mOwoKCS8vIG1ha2VzIHN1YmNsYXNzaW5nIHdvcmsgY29ycmVjdCBmb3Igd3JhcHBlZCBidWlsdC1pbnMKCXZhciBpbmhlcml0SWZSZXF1aXJlZCQxID0gZnVuY3Rpb24gKCR0aGlzLCBkdW1teSwgV3JhcHBlcikgewoJICB2YXIgTmV3VGFyZ2V0LCBOZXdUYXJnZXRQcm90b3R5cGU7CgkgIGlmICgKCSAgICAvLyBpdCBjYW4gd29yayBvbmx5IHdpdGggbmF0aXZlIGBzZXRQcm90b3R5cGVPZmAKCSAgICBzZXRQcm90b3R5cGVPZiQxICYmCgkgICAgLy8gd2UgaGF2ZW4ndCBjb21wbGV0ZWx5IGNvcnJlY3QgcHJlLUVTNiB3YXkgZm9yIGdldHRpbmcgYG5ldy50YXJnZXRgLCBzbyB1c2UgdGhpcwoJICAgIGlzQ2FsbGFibGUoTmV3VGFyZ2V0ID0gZHVtbXkuY29uc3RydWN0b3IpICYmCgkgICAgTmV3VGFyZ2V0ICE9PSBXcmFwcGVyICYmCgkgICAgaXNPYmplY3QkMShOZXdUYXJnZXRQcm90b3R5cGUgPSBOZXdUYXJnZXQucHJvdG90eXBlKSAmJgoJICAgIE5ld1RhcmdldFByb3RvdHlwZSAhPT0gV3JhcHBlci5wcm90b3R5cGUKCSAgKSBzZXRQcm90b3R5cGVPZiQxKCR0aGlzLCBOZXdUYXJnZXRQcm90b3R5cGUpOwoJICByZXR1cm4gJHRoaXM7Cgl9OwoKCXZhciAkJDEgPSBfZXhwb3J0OwoJdmFyIGdsb2JhbCQ4ID0gZ2xvYmFsJEk7Cgl2YXIgY2FsbCQyID0gZnVuY3Rpb25DYWxsOwoJdmFyIERFU0NSSVBUT1JTID0gZGVzY3JpcHRvcnM7Cgl2YXIgVFlQRURfQVJSQVlTX0NPTlNUUlVDVE9SU19SRVFVSVJFU19XUkFQUEVSUyA9IHR5cGVkQXJyYXlDb25zdHJ1Y3RvcnNSZXF1aXJlV3JhcHBlcnM7Cgl2YXIgQXJyYXlCdWZmZXJWaWV3Q29yZSRyID0gYXJyYXlCdWZmZXJWaWV3Q29yZTsKCXZhciBBcnJheUJ1ZmZlck1vZHVsZSA9IGFycmF5QnVmZmVyOwoJdmFyIGFuSW5zdGFuY2UgPSBhbkluc3RhbmNlJDI7Cgl2YXIgY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yID0gY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yJDU7Cgl2YXIgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5ID0gY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5JDc7Cgl2YXIgaXNJbnRlZ3JhbE51bWJlciA9IGlzSW50ZWdyYWxOdW1iZXIkMTsKCXZhciB0b0xlbmd0aCQxID0gdG9MZW5ndGgkNTsKCXZhciB0b0luZGV4ID0gdG9JbmRleCQyOwoJdmFyIHRvT2Zmc2V0JDEgPSB0b09mZnNldCQyOwoJdmFyIHRvUHJvcGVydHlLZXkgPSB0b1Byb3BlcnR5S2V5JDQ7Cgl2YXIgaGFzT3duID0gaGFzT3duUHJvcGVydHlfMTsKCXZhciBjbGFzc29mID0gY2xhc3NvZiQ2OwoJdmFyIGlzT2JqZWN0ID0gaXNPYmplY3QkYTsKCXZhciBpc1N5bWJvbCA9IGlzU3ltYm9sJDM7Cgl2YXIgY3JlYXRlID0gb2JqZWN0Q3JlYXRlOwoJdmFyIGlzUHJvdG90eXBlT2YgPSBvYmplY3RJc1Byb3RvdHlwZU9mOwoJdmFyIHNldFByb3RvdHlwZU9mID0gb2JqZWN0U2V0UHJvdG90eXBlT2Y7Cgl2YXIgZ2V0T3duUHJvcGVydHlOYW1lcyA9IG9iamVjdEdldE93blByb3BlcnR5TmFtZXMuZjsKCXZhciB0eXBlZEFycmF5RnJvbSA9IHR5cGVkQXJyYXlGcm9tJDE7Cgl2YXIgZm9yRWFjaCA9IGFycmF5SXRlcmF0aW9uLmZvckVhY2g7Cgl2YXIgc2V0U3BlY2llcyQxID0gc2V0U3BlY2llcyQyOwoJdmFyIGRlZmluZVByb3BlcnR5TW9kdWxlID0gb2JqZWN0RGVmaW5lUHJvcGVydHk7Cgl2YXIgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yTW9kdWxlID0gb2JqZWN0R2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOwoJdmFyIEludGVybmFsU3RhdGVNb2R1bGUgPSBpbnRlcm5hbFN0YXRlOwoJdmFyIGluaGVyaXRJZlJlcXVpcmVkID0gaW5oZXJpdElmUmVxdWlyZWQkMTsKCgl2YXIgZ2V0SW50ZXJuYWxTdGF0ZSA9IEludGVybmFsU3RhdGVNb2R1bGUuZ2V0OwoJdmFyIHNldEludGVybmFsU3RhdGUgPSBJbnRlcm5hbFN0YXRlTW9kdWxlLnNldDsKCXZhciBuYXRpdmVEZWZpbmVQcm9wZXJ0eSA9IGRlZmluZVByb3BlcnR5TW9kdWxlLmY7Cgl2YXIgbmF0aXZlR2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID0gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yTW9kdWxlLmY7Cgl2YXIgcm91bmQgPSBNYXRoLnJvdW5kOwoJdmFyIFJhbmdlRXJyb3IkMSA9IGdsb2JhbCQ4LlJhbmdlRXJyb3I7Cgl2YXIgQXJyYXlCdWZmZXIkMiA9IEFycmF5QnVmZmVyTW9kdWxlLkFycmF5QnVmZmVyOwoJdmFyIEFycmF5QnVmZmVyUHJvdG90eXBlID0gQXJyYXlCdWZmZXIkMi5wcm90b3R5cGU7Cgl2YXIgRGF0YVZpZXckMSA9IEFycmF5QnVmZmVyTW9kdWxlLkRhdGFWaWV3OwoJdmFyIE5BVElWRV9BUlJBWV9CVUZGRVJfVklFV1MgPSBBcnJheUJ1ZmZlclZpZXdDb3JlJHIuTkFUSVZFX0FSUkFZX0JVRkZFUl9WSUVXUzsKCXZhciBUWVBFRF9BUlJBWV9DT05TVFJVQ1RPUiQxID0gQXJyYXlCdWZmZXJWaWV3Q29yZSRyLlRZUEVEX0FSUkFZX0NPTlNUUlVDVE9SOwoJdmFyIFRZUEVEX0FSUkFZX1RBRyA9IEFycmF5QnVmZmVyVmlld0NvcmUkci5UWVBFRF9BUlJBWV9UQUc7Cgl2YXIgVHlwZWRBcnJheSA9IEFycmF5QnVmZmVyVmlld0NvcmUkci5UeXBlZEFycmF5OwoJdmFyIFR5cGVkQXJyYXlQcm90b3R5cGUgPSBBcnJheUJ1ZmZlclZpZXdDb3JlJHIuVHlwZWRBcnJheVByb3RvdHlwZTsKCXZhciBhVHlwZWRBcnJheUNvbnN0cnVjdG9yJDEgPSBBcnJheUJ1ZmZlclZpZXdDb3JlJHIuYVR5cGVkQXJyYXlDb25zdHJ1Y3RvcjsKCXZhciBpc1R5cGVkQXJyYXkgPSBBcnJheUJ1ZmZlclZpZXdDb3JlJHIuaXNUeXBlZEFycmF5OwoJdmFyIEJZVEVTX1BFUl9FTEVNRU5UID0gJ0JZVEVTX1BFUl9FTEVNRU5UJzsKCXZhciBXUk9OR19MRU5HVEggPSAnV3JvbmcgbGVuZ3RoJzsKCgl2YXIgZnJvbUxpc3QgPSBmdW5jdGlvbiAoQywgbGlzdCkgewoJICBhVHlwZWRBcnJheUNvbnN0cnVjdG9yJDEoQyk7CgkgIHZhciBpbmRleCA9IDA7CgkgIHZhciBsZW5ndGggPSBsaXN0Lmxlbmd0aDsKCSAgdmFyIHJlc3VsdCA9IG5ldyBDKGxlbmd0aCk7CgkgIHdoaWxlIChsZW5ndGggPiBpbmRleCkgcmVzdWx0W2luZGV4XSA9IGxpc3RbaW5kZXgrK107CgkgIHJldHVybiByZXN1bHQ7Cgl9OwoKCXZhciBhZGRHZXR0ZXIgPSBmdW5jdGlvbiAoaXQsIGtleSkgewoJICBuYXRpdmVEZWZpbmVQcm9wZXJ0eShpdCwga2V5LCB7IGdldDogZnVuY3Rpb24gKCkgewoJICAgIHJldHVybiBnZXRJbnRlcm5hbFN0YXRlKHRoaXMpW2tleV07CgkgIH0gfSk7Cgl9OwoKCXZhciBpc0FycmF5QnVmZmVyID0gZnVuY3Rpb24gKGl0KSB7CgkgIHZhciBrbGFzczsKCSAgcmV0dXJuIGlzUHJvdG90eXBlT2YoQXJyYXlCdWZmZXJQcm90b3R5cGUsIGl0KSB8fCAoa2xhc3MgPSBjbGFzc29mKGl0KSkgPT0gJ0FycmF5QnVmZmVyJyB8fCBrbGFzcyA9PSAnU2hhcmVkQXJyYXlCdWZmZXInOwoJfTsKCgl2YXIgaXNUeXBlZEFycmF5SW5kZXggPSBmdW5jdGlvbiAodGFyZ2V0LCBrZXkpIHsKCSAgcmV0dXJuIGlzVHlwZWRBcnJheSh0YXJnZXQpCgkgICAgJiYgIWlzU3ltYm9sKGtleSkKCSAgICAmJiBrZXkgaW4gdGFyZ2V0CgkgICAgJiYgaXNJbnRlZ3JhbE51bWJlcigra2V5KQoJICAgICYmIGtleSA+PSAwOwoJfTsKCgl2YXIgd3JhcHBlZEdldE93blByb3BlcnR5RGVzY3JpcHRvciA9IGZ1bmN0aW9uIGdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIGtleSkgewoJICBrZXkgPSB0b1Byb3BlcnR5S2V5KGtleSk7CgkgIHJldHVybiBpc1R5cGVkQXJyYXlJbmRleCh0YXJnZXQsIGtleSkKCSAgICA/IGNyZWF0ZVByb3BlcnR5RGVzY3JpcHRvcigyLCB0YXJnZXRba2V5XSkKCSAgICA6IG5hdGl2ZUdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIGtleSk7Cgl9OwoKCXZhciB3cmFwcGVkRGVmaW5lUHJvcGVydHkgPSBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgZGVzY3JpcHRvcikgewoJICBrZXkgPSB0b1Byb3BlcnR5S2V5KGtleSk7CgkgIGlmIChpc1R5cGVkQXJyYXlJbmRleCh0YXJnZXQsIGtleSkKCSAgICAmJiBpc09iamVjdChkZXNjcmlwdG9yKQoJICAgICYmIGhhc093bihkZXNjcmlwdG9yLCAndmFsdWUnKQoJICAgICYmICFoYXNPd24oZGVzY3JpcHRvciwgJ2dldCcpCgkgICAgJiYgIWhhc093bihkZXNjcmlwdG9yLCAnc2V0JykKCSAgICAvLyBUT0RPOiBhZGQgdmFsaWRhdGlvbiBkZXNjcmlwdG9yIHcvbyBjYWxsaW5nIGFjY2Vzc29ycwoJICAgICYmICFkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZQoJICAgICYmICghaGFzT3duKGRlc2NyaXB0b3IsICd3cml0YWJsZScpIHx8IGRlc2NyaXB0b3Iud3JpdGFibGUpCgkgICAgJiYgKCFoYXNPd24oZGVzY3JpcHRvciwgJ2VudW1lcmFibGUnKSB8fCBkZXNjcmlwdG9yLmVudW1lcmFibGUpCgkgICkgewoJICAgIHRhcmdldFtrZXldID0gZGVzY3JpcHRvci52YWx1ZTsKCSAgICByZXR1cm4gdGFyZ2V0OwoJICB9IHJldHVybiBuYXRpdmVEZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgZGVzY3JpcHRvcik7Cgl9OwoKCWlmIChERVNDUklQVE9SUykgewoJICBpZiAoIU5BVElWRV9BUlJBWV9CVUZGRVJfVklFV1MpIHsKCSAgICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JNb2R1bGUuZiA9IHdyYXBwZWRHZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7CgkgICAgZGVmaW5lUHJvcGVydHlNb2R1bGUuZiA9IHdyYXBwZWREZWZpbmVQcm9wZXJ0eTsKCSAgICBhZGRHZXR0ZXIoVHlwZWRBcnJheVByb3RvdHlwZSwgJ2J1ZmZlcicpOwoJICAgIGFkZEdldHRlcihUeXBlZEFycmF5UHJvdG90eXBlLCAnYnl0ZU9mZnNldCcpOwoJICAgIGFkZEdldHRlcihUeXBlZEFycmF5UHJvdG90eXBlLCAnYnl0ZUxlbmd0aCcpOwoJICAgIGFkZEdldHRlcihUeXBlZEFycmF5UHJvdG90eXBlLCAnbGVuZ3RoJyk7CgkgIH0KCgkgICQkMSh7IHRhcmdldDogJ09iamVjdCcsIHN0YXQ6IHRydWUsIGZvcmNlZDogIU5BVElWRV9BUlJBWV9CVUZGRVJfVklFV1MgfSwgewoJICAgIGdldE93blByb3BlcnR5RGVzY3JpcHRvcjogd3JhcHBlZEdldE93blByb3BlcnR5RGVzY3JpcHRvciwKCSAgICBkZWZpbmVQcm9wZXJ0eTogd3JhcHBlZERlZmluZVByb3BlcnR5CgkgIH0pOwoKCSAgdHlwZWRBcnJheUNvbnN0cnVjdG9yLmV4cG9ydHMgPSBmdW5jdGlvbiAoVFlQRSwgd3JhcHBlciwgQ0xBTVBFRCkgewoJICAgIHZhciBCWVRFUyA9IFRZUEUubWF0Y2goL1xkKyQvKVswXSAvIDg7CgkgICAgdmFyIENPTlNUUlVDVE9SX05BTUUgPSBUWVBFICsgKENMQU1QRUQgPyAnQ2xhbXBlZCcgOiAnJykgKyAnQXJyYXknOwoJICAgIHZhciBHRVRURVIgPSAnZ2V0JyArIFRZUEU7CgkgICAgdmFyIFNFVFRFUiA9ICdzZXQnICsgVFlQRTsKCSAgICB2YXIgTmF0aXZlVHlwZWRBcnJheUNvbnN0cnVjdG9yID0gZ2xvYmFsJDhbQ09OU1RSVUNUT1JfTkFNRV07CgkgICAgdmFyIFR5cGVkQXJyYXlDb25zdHJ1Y3RvciA9IE5hdGl2ZVR5cGVkQXJyYXlDb25zdHJ1Y3RvcjsKCSAgICB2YXIgVHlwZWRBcnJheUNvbnN0cnVjdG9yUHJvdG90eXBlID0gVHlwZWRBcnJheUNvbnN0cnVjdG9yICYmIFR5cGVkQXJyYXlDb25zdHJ1Y3Rvci5wcm90b3R5cGU7CgkgICAgdmFyIGV4cG9ydGVkID0ge307CgoJICAgIHZhciBnZXR0ZXIgPSBmdW5jdGlvbiAodGhhdCwgaW5kZXgpIHsKCSAgICAgIHZhciBkYXRhID0gZ2V0SW50ZXJuYWxTdGF0ZSh0aGF0KTsKCSAgICAgIHJldHVybiBkYXRhLnZpZXdbR0VUVEVSXShpbmRleCAqIEJZVEVTICsgZGF0YS5ieXRlT2Zmc2V0LCB0cnVlKTsKCSAgICB9OwoKCSAgICB2YXIgc2V0dGVyID0gZnVuY3Rpb24gKHRoYXQsIGluZGV4LCB2YWx1ZSkgewoJICAgICAgdmFyIGRhdGEgPSBnZXRJbnRlcm5hbFN0YXRlKHRoYXQpOwoJICAgICAgaWYgKENMQU1QRUQpIHZhbHVlID0gKHZhbHVlID0gcm91bmQodmFsdWUpKSA8IDAgPyAwIDogdmFsdWUgPiAweEZGID8gMHhGRiA6IHZhbHVlICYgMHhGRjsKCSAgICAgIGRhdGEudmlld1tTRVRURVJdKGluZGV4ICogQllURVMgKyBkYXRhLmJ5dGVPZmZzZXQsIHZhbHVlLCB0cnVlKTsKCSAgICB9OwoKCSAgICB2YXIgYWRkRWxlbWVudCA9IGZ1bmN0aW9uICh0aGF0LCBpbmRleCkgewoJICAgICAgbmF0aXZlRGVmaW5lUHJvcGVydHkodGhhdCwgaW5kZXgsIHsKCSAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgcmV0dXJuIGdldHRlcih0aGlzLCBpbmRleCk7CgkgICAgICAgIH0sCgkgICAgICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7CgkgICAgICAgICAgcmV0dXJuIHNldHRlcih0aGlzLCBpbmRleCwgdmFsdWUpOwoJICAgICAgICB9LAoJICAgICAgICBlbnVtZXJhYmxlOiB0cnVlCgkgICAgICB9KTsKCSAgICB9OwoKCSAgICBpZiAoIU5BVElWRV9BUlJBWV9CVUZGRVJfVklFV1MpIHsKCSAgICAgIFR5cGVkQXJyYXlDb25zdHJ1Y3RvciA9IHdyYXBwZXIoZnVuY3Rpb24gKHRoYXQsIGRhdGEsIG9mZnNldCwgJGxlbmd0aCkgewoJICAgICAgICBhbkluc3RhbmNlKHRoYXQsIFR5cGVkQXJyYXlDb25zdHJ1Y3RvclByb3RvdHlwZSk7CgkgICAgICAgIHZhciBpbmRleCA9IDA7CgkgICAgICAgIHZhciBieXRlT2Zmc2V0ID0gMDsKCSAgICAgICAgdmFyIGJ1ZmZlciwgYnl0ZUxlbmd0aCwgbGVuZ3RoOwoJICAgICAgICBpZiAoIWlzT2JqZWN0KGRhdGEpKSB7CgkgICAgICAgICAgbGVuZ3RoID0gdG9JbmRleChkYXRhKTsKCSAgICAgICAgICBieXRlTGVuZ3RoID0gbGVuZ3RoICogQllURVM7CgkgICAgICAgICAgYnVmZmVyID0gbmV3IEFycmF5QnVmZmVyJDIoYnl0ZUxlbmd0aCk7CgkgICAgICAgIH0gZWxzZSBpZiAoaXNBcnJheUJ1ZmZlcihkYXRhKSkgewoJICAgICAgICAgIGJ1ZmZlciA9IGRhdGE7CgkgICAgICAgICAgYnl0ZU9mZnNldCA9IHRvT2Zmc2V0JDEob2Zmc2V0LCBCWVRFUyk7CgkgICAgICAgICAgdmFyICRsZW4gPSBkYXRhLmJ5dGVMZW5ndGg7CgkgICAgICAgICAgaWYgKCRsZW5ndGggPT09IHVuZGVmaW5lZCkgewoJICAgICAgICAgICAgaWYgKCRsZW4gJSBCWVRFUykgdGhyb3cgUmFuZ2VFcnJvciQxKFdST05HX0xFTkdUSCk7CgkgICAgICAgICAgICBieXRlTGVuZ3RoID0gJGxlbiAtIGJ5dGVPZmZzZXQ7CgkgICAgICAgICAgICBpZiAoYnl0ZUxlbmd0aCA8IDApIHRocm93IFJhbmdlRXJyb3IkMShXUk9OR19MRU5HVEgpOwoJICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICBieXRlTGVuZ3RoID0gdG9MZW5ndGgkMSgkbGVuZ3RoKSAqIEJZVEVTOwoJICAgICAgICAgICAgaWYgKGJ5dGVMZW5ndGggKyBieXRlT2Zmc2V0ID4gJGxlbikgdGhyb3cgUmFuZ2VFcnJvciQxKFdST05HX0xFTkdUSCk7CgkgICAgICAgICAgfQoJICAgICAgICAgIGxlbmd0aCA9IGJ5dGVMZW5ndGggLyBCWVRFUzsKCSAgICAgICAgfSBlbHNlIGlmIChpc1R5cGVkQXJyYXkoZGF0YSkpIHsKCSAgICAgICAgICByZXR1cm4gZnJvbUxpc3QoVHlwZWRBcnJheUNvbnN0cnVjdG9yLCBkYXRhKTsKCSAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICByZXR1cm4gY2FsbCQyKHR5cGVkQXJyYXlGcm9tLCBUeXBlZEFycmF5Q29uc3RydWN0b3IsIGRhdGEpOwoJICAgICAgICB9CgkgICAgICAgIHNldEludGVybmFsU3RhdGUodGhhdCwgewoJICAgICAgICAgIGJ1ZmZlcjogYnVmZmVyLAoJICAgICAgICAgIGJ5dGVPZmZzZXQ6IGJ5dGVPZmZzZXQsCgkgICAgICAgICAgYnl0ZUxlbmd0aDogYnl0ZUxlbmd0aCwKCSAgICAgICAgICBsZW5ndGg6IGxlbmd0aCwKCSAgICAgICAgICB2aWV3OiBuZXcgRGF0YVZpZXckMShidWZmZXIpCgkgICAgICAgIH0pOwoJICAgICAgICB3aGlsZSAoaW5kZXggPCBsZW5ndGgpIGFkZEVsZW1lbnQodGhhdCwgaW5kZXgrKyk7CgkgICAgICB9KTsKCgkgICAgICBpZiAoc2V0UHJvdG90eXBlT2YpIHNldFByb3RvdHlwZU9mKFR5cGVkQXJyYXlDb25zdHJ1Y3RvciwgVHlwZWRBcnJheSk7CgkgICAgICBUeXBlZEFycmF5Q29uc3RydWN0b3JQcm90b3R5cGUgPSBUeXBlZEFycmF5Q29uc3RydWN0b3IucHJvdG90eXBlID0gY3JlYXRlKFR5cGVkQXJyYXlQcm90b3R5cGUpOwoJICAgIH0gZWxzZSBpZiAoVFlQRURfQVJSQVlTX0NPTlNUUlVDVE9SU19SRVFVSVJFU19XUkFQUEVSUykgewoJICAgICAgVHlwZWRBcnJheUNvbnN0cnVjdG9yID0gd3JhcHBlcihmdW5jdGlvbiAoZHVtbXksIGRhdGEsIHR5cGVkQXJyYXlPZmZzZXQsICRsZW5ndGgpIHsKCSAgICAgICAgYW5JbnN0YW5jZShkdW1teSwgVHlwZWRBcnJheUNvbnN0cnVjdG9yUHJvdG90eXBlKTsKCSAgICAgICAgcmV0dXJuIGluaGVyaXRJZlJlcXVpcmVkKGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICBpZiAoIWlzT2JqZWN0KGRhdGEpKSByZXR1cm4gbmV3IE5hdGl2ZVR5cGVkQXJyYXlDb25zdHJ1Y3Rvcih0b0luZGV4KGRhdGEpKTsKCSAgICAgICAgICBpZiAoaXNBcnJheUJ1ZmZlcihkYXRhKSkgcmV0dXJuICRsZW5ndGggIT09IHVuZGVmaW5lZAoJICAgICAgICAgICAgPyBuZXcgTmF0aXZlVHlwZWRBcnJheUNvbnN0cnVjdG9yKGRhdGEsIHRvT2Zmc2V0JDEodHlwZWRBcnJheU9mZnNldCwgQllURVMpLCAkbGVuZ3RoKQoJICAgICAgICAgICAgOiB0eXBlZEFycmF5T2Zmc2V0ICE9PSB1bmRlZmluZWQKCSAgICAgICAgICAgICAgPyBuZXcgTmF0aXZlVHlwZWRBcnJheUNvbnN0cnVjdG9yKGRhdGEsIHRvT2Zmc2V0JDEodHlwZWRBcnJheU9mZnNldCwgQllURVMpKQoJICAgICAgICAgICAgICA6IG5ldyBOYXRpdmVUeXBlZEFycmF5Q29uc3RydWN0b3IoZGF0YSk7CgkgICAgICAgICAgaWYgKGlzVHlwZWRBcnJheShkYXRhKSkgcmV0dXJuIGZyb21MaXN0KFR5cGVkQXJyYXlDb25zdHJ1Y3RvciwgZGF0YSk7CgkgICAgICAgICAgcmV0dXJuIGNhbGwkMih0eXBlZEFycmF5RnJvbSwgVHlwZWRBcnJheUNvbnN0cnVjdG9yLCBkYXRhKTsKCSAgICAgICAgfSgpLCBkdW1teSwgVHlwZWRBcnJheUNvbnN0cnVjdG9yKTsKCSAgICAgIH0pOwoKCSAgICAgIGlmIChzZXRQcm90b3R5cGVPZikgc2V0UHJvdG90eXBlT2YoVHlwZWRBcnJheUNvbnN0cnVjdG9yLCBUeXBlZEFycmF5KTsKCSAgICAgIGZvckVhY2goZ2V0T3duUHJvcGVydHlOYW1lcyhOYXRpdmVUeXBlZEFycmF5Q29uc3RydWN0b3IpLCBmdW5jdGlvbiAoa2V5KSB7CgkgICAgICAgIGlmICghKGtleSBpbiBUeXBlZEFycmF5Q29uc3RydWN0b3IpKSB7CgkgICAgICAgICAgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5KFR5cGVkQXJyYXlDb25zdHJ1Y3Rvciwga2V5LCBOYXRpdmVUeXBlZEFycmF5Q29uc3RydWN0b3Jba2V5XSk7CgkgICAgICAgIH0KCSAgICAgIH0pOwoJICAgICAgVHlwZWRBcnJheUNvbnN0cnVjdG9yLnByb3RvdHlwZSA9IFR5cGVkQXJyYXlDb25zdHJ1Y3RvclByb3RvdHlwZTsKCSAgICB9CgoJICAgIGlmIChUeXBlZEFycmF5Q29uc3RydWN0b3JQcm90b3R5cGUuY29uc3RydWN0b3IgIT09IFR5cGVkQXJyYXlDb25zdHJ1Y3RvcikgewoJICAgICAgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5KFR5cGVkQXJyYXlDb25zdHJ1Y3RvclByb3RvdHlwZSwgJ2NvbnN0cnVjdG9yJywgVHlwZWRBcnJheUNvbnN0cnVjdG9yKTsKCSAgICB9CgoJICAgIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eShUeXBlZEFycmF5Q29uc3RydWN0b3JQcm90b3R5cGUsIFRZUEVEX0FSUkFZX0NPTlNUUlVDVE9SJDEsIFR5cGVkQXJyYXlDb25zdHJ1Y3Rvcik7CgoJICAgIGlmIChUWVBFRF9BUlJBWV9UQUcpIHsKCSAgICAgIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eShUeXBlZEFycmF5Q29uc3RydWN0b3JQcm90b3R5cGUsIFRZUEVEX0FSUkFZX1RBRywgQ09OU1RSVUNUT1JfTkFNRSk7CgkgICAgfQoKCSAgICBleHBvcnRlZFtDT05TVFJVQ1RPUl9OQU1FXSA9IFR5cGVkQXJyYXlDb25zdHJ1Y3RvcjsKCgkgICAgJCQxKHsKCSAgICAgIGdsb2JhbDogdHJ1ZSwgZm9yY2VkOiBUeXBlZEFycmF5Q29uc3RydWN0b3IgIT0gTmF0aXZlVHlwZWRBcnJheUNvbnN0cnVjdG9yLCBzaGFtOiAhTkFUSVZFX0FSUkFZX0JVRkZFUl9WSUVXUwoJICAgIH0sIGV4cG9ydGVkKTsKCgkgICAgaWYgKCEoQllURVNfUEVSX0VMRU1FTlQgaW4gVHlwZWRBcnJheUNvbnN0cnVjdG9yKSkgewoJICAgICAgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5KFR5cGVkQXJyYXlDb25zdHJ1Y3RvciwgQllURVNfUEVSX0VMRU1FTlQsIEJZVEVTKTsKCSAgICB9CgoJICAgIGlmICghKEJZVEVTX1BFUl9FTEVNRU5UIGluIFR5cGVkQXJyYXlDb25zdHJ1Y3RvclByb3RvdHlwZSkpIHsKCSAgICAgIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eShUeXBlZEFycmF5Q29uc3RydWN0b3JQcm90b3R5cGUsIEJZVEVTX1BFUl9FTEVNRU5ULCBCWVRFUyk7CgkgICAgfQoKCSAgICBzZXRTcGVjaWVzJDEoQ09OU1RSVUNUT1JfTkFNRSk7CgkgIH07Cgl9IGVsc2UgdHlwZWRBcnJheUNvbnN0cnVjdG9yLmV4cG9ydHMgPSBmdW5jdGlvbiAoKSB7IC8qIGVtcHR5ICovIH07CgoJdmFyIGNyZWF0ZVR5cGVkQXJyYXlDb25zdHJ1Y3RvciQ0ID0gdHlwZWRBcnJheUNvbnN0cnVjdG9yLmV4cG9ydHM7CgoJLy8gYEludDhBcnJheWAgY29uc3RydWN0b3IKCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtdHlwZWRhcnJheS1vYmplY3RzCgljcmVhdGVUeXBlZEFycmF5Q29uc3RydWN0b3IkNCgnSW50OCcsIGZ1bmN0aW9uIChpbml0KSB7CgkgIHJldHVybiBmdW5jdGlvbiBJbnQ4QXJyYXkoZGF0YSwgYnl0ZU9mZnNldCwgbGVuZ3RoKSB7CgkgICAgcmV0dXJuIGluaXQodGhpcywgZGF0YSwgYnl0ZU9mZnNldCwgbGVuZ3RoKTsKCSAgfTsKCX0pOwoKCXZhciBBcnJheUJ1ZmZlclZpZXdDb3JlJHEgPSBhcnJheUJ1ZmZlclZpZXdDb3JlOwoJdmFyIGxlbmd0aE9mQXJyYXlMaWtlJDYgPSBsZW5ndGhPZkFycmF5TGlrZSRjOwoJdmFyIHRvSW50ZWdlck9ySW5maW5pdHkkMSA9IHRvSW50ZWdlck9ySW5maW5pdHkkNzsKCgl2YXIgYVR5cGVkQXJyYXkkcCA9IEFycmF5QnVmZmVyVmlld0NvcmUkcS5hVHlwZWRBcnJheTsKCXZhciBleHBvcnRUeXBlZEFycmF5TWV0aG9kJHEgPSBBcnJheUJ1ZmZlclZpZXdDb3JlJHEuZXhwb3J0VHlwZWRBcnJheU1ldGhvZDsKCgkvLyBgJVR5cGVkQXJyYXklLnByb3RvdHlwZS5hdGAgbWV0aG9kCgkvLyBodHRwczovL2dpdGh1Yi5jb20vdGMzOS9wcm9wb3NhbC1yZWxhdGl2ZS1pbmRleGluZy1tZXRob2QKCWV4cG9ydFR5cGVkQXJyYXlNZXRob2QkcSgnYXQnLCBmdW5jdGlvbiBhdChpbmRleCkgewoJICB2YXIgTyA9IGFUeXBlZEFycmF5JHAodGhpcyk7CgkgIHZhciBsZW4gPSBsZW5ndGhPZkFycmF5TGlrZSQ2KE8pOwoJICB2YXIgcmVsYXRpdmVJbmRleCA9IHRvSW50ZWdlck9ySW5maW5pdHkkMShpbmRleCk7CgkgIHZhciBrID0gcmVsYXRpdmVJbmRleCA+PSAwID8gcmVsYXRpdmVJbmRleCA6IGxlbiArIHJlbGF0aXZlSW5kZXg7CgkgIHJldHVybiAoayA8IDAgfHwgayA+PSBsZW4pID8gdW5kZWZpbmVkIDogT1trXTsKCX0pOwoKCXZhciB0b09iamVjdCQ0ID0gdG9PYmplY3QkYTsKCXZhciB0b0Fic29sdXRlSW5kZXgkMSA9IHRvQWJzb2x1dGVJbmRleCQ1OwoJdmFyIGxlbmd0aE9mQXJyYXlMaWtlJDUgPSBsZW5ndGhPZkFycmF5TGlrZSRjOwoKCXZhciBtaW4kMSA9IE1hdGgubWluOwoKCS8vIGBBcnJheS5wcm90b3R5cGUuY29weVdpdGhpbmAgbWV0aG9kIGltcGxlbWVudGF0aW9uCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLWFycmF5LnByb3RvdHlwZS5jb3B5d2l0aGluCgkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZXMvbm8tYXJyYXktcHJvdG90eXBlLWNvcHl3aXRoaW4gLS0gc2FmZQoJdmFyIGFycmF5Q29weVdpdGhpbiA9IFtdLmNvcHlXaXRoaW4gfHwgZnVuY3Rpb24gY29weVdpdGhpbih0YXJnZXQgLyogPSAwICovLCBzdGFydCAvKiA9IDAsIGVuZCA9IEBsZW5ndGggKi8pIHsKCSAgdmFyIE8gPSB0b09iamVjdCQ0KHRoaXMpOwoJICB2YXIgbGVuID0gbGVuZ3RoT2ZBcnJheUxpa2UkNShPKTsKCSAgdmFyIHRvID0gdG9BYnNvbHV0ZUluZGV4JDEodGFyZ2V0LCBsZW4pOwoJICB2YXIgZnJvbSA9IHRvQWJzb2x1dGVJbmRleCQxKHN0YXJ0LCBsZW4pOwoJICB2YXIgZW5kID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgPyBhcmd1bWVudHNbMl0gOiB1bmRlZmluZWQ7CgkgIHZhciBjb3VudCA9IG1pbiQxKChlbmQgPT09IHVuZGVmaW5lZCA/IGxlbiA6IHRvQWJzb2x1dGVJbmRleCQxKGVuZCwgbGVuKSkgLSBmcm9tLCBsZW4gLSB0byk7CgkgIHZhciBpbmMgPSAxOwoJICBpZiAoZnJvbSA8IHRvICYmIHRvIDwgZnJvbSArIGNvdW50KSB7CgkgICAgaW5jID0gLTE7CgkgICAgZnJvbSArPSBjb3VudCAtIDE7CgkgICAgdG8gKz0gY291bnQgLSAxOwoJICB9CgkgIHdoaWxlIChjb3VudC0tID4gMCkgewoJICAgIGlmIChmcm9tIGluIE8pIE9bdG9dID0gT1tmcm9tXTsKCSAgICBlbHNlIGRlbGV0ZSBPW3RvXTsKCSAgICB0byArPSBpbmM7CgkgICAgZnJvbSArPSBpbmM7CgkgIH0gcmV0dXJuIE87Cgl9OwoKCXZhciB1bmN1cnJ5VGhpcyQ3ID0gZnVuY3Rpb25VbmN1cnJ5VGhpczsKCXZhciBBcnJheUJ1ZmZlclZpZXdDb3JlJHAgPSBhcnJheUJ1ZmZlclZpZXdDb3JlOwoJdmFyICRBcnJheUNvcHlXaXRoaW4gPSBhcnJheUNvcHlXaXRoaW47CgoJdmFyIHUkQXJyYXlDb3B5V2l0aGluID0gdW5jdXJyeVRoaXMkNygkQXJyYXlDb3B5V2l0aGluKTsKCXZhciBhVHlwZWRBcnJheSRvID0gQXJyYXlCdWZmZXJWaWV3Q29yZSRwLmFUeXBlZEFycmF5OwoJdmFyIGV4cG9ydFR5cGVkQXJyYXlNZXRob2QkcCA9IEFycmF5QnVmZmVyVmlld0NvcmUkcC5leHBvcnRUeXBlZEFycmF5TWV0aG9kOwoKCS8vIGAlVHlwZWRBcnJheSUucHJvdG90eXBlLmNvcHlXaXRoaW5gIG1ldGhvZAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy0ldHlwZWRhcnJheSUucHJvdG90eXBlLmNvcHl3aXRoaW4KCWV4cG9ydFR5cGVkQXJyYXlNZXRob2QkcCgnY29weVdpdGhpbicsIGZ1bmN0aW9uIGNvcHlXaXRoaW4odGFyZ2V0LCBzdGFydCAvKiAsIGVuZCAqLykgewoJICByZXR1cm4gdSRBcnJheUNvcHlXaXRoaW4oYVR5cGVkQXJyYXkkbyh0aGlzKSwgdGFyZ2V0LCBzdGFydCwgYXJndW1lbnRzLmxlbmd0aCA+IDIgPyBhcmd1bWVudHNbMl0gOiB1bmRlZmluZWQpOwoJfSk7CgoJdmFyIEFycmF5QnVmZmVyVmlld0NvcmUkbyA9IGFycmF5QnVmZmVyVmlld0NvcmU7Cgl2YXIgJGV2ZXJ5ID0gYXJyYXlJdGVyYXRpb24uZXZlcnk7CgoJdmFyIGFUeXBlZEFycmF5JG4gPSBBcnJheUJ1ZmZlclZpZXdDb3JlJG8uYVR5cGVkQXJyYXk7Cgl2YXIgZXhwb3J0VHlwZWRBcnJheU1ldGhvZCRvID0gQXJyYXlCdWZmZXJWaWV3Q29yZSRvLmV4cG9ydFR5cGVkQXJyYXlNZXRob2Q7CgoJLy8gYCVUeXBlZEFycmF5JS5wcm90b3R5cGUuZXZlcnlgIG1ldGhvZAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy0ldHlwZWRhcnJheSUucHJvdG90eXBlLmV2ZXJ5CglleHBvcnRUeXBlZEFycmF5TWV0aG9kJG8oJ2V2ZXJ5JywgZnVuY3Rpb24gZXZlcnkoY2FsbGJhY2tmbiAvKiAsIHRoaXNBcmcgKi8pIHsKCSAgcmV0dXJuICRldmVyeShhVHlwZWRBcnJheSRuKHRoaXMpLCBjYWxsYmFja2ZuLCBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZCk7Cgl9KTsKCgl2YXIgQXJyYXlCdWZmZXJWaWV3Q29yZSRuID0gYXJyYXlCdWZmZXJWaWV3Q29yZTsKCXZhciBjYWxsJDEgPSBmdW5jdGlvbkNhbGw7Cgl2YXIgJGZpbGwgPSBhcnJheUZpbGwkMTsKCgl2YXIgYVR5cGVkQXJyYXkkbSA9IEFycmF5QnVmZmVyVmlld0NvcmUkbi5hVHlwZWRBcnJheTsKCXZhciBleHBvcnRUeXBlZEFycmF5TWV0aG9kJG4gPSBBcnJheUJ1ZmZlclZpZXdDb3JlJG4uZXhwb3J0VHlwZWRBcnJheU1ldGhvZDsKCgkvLyBgJVR5cGVkQXJyYXklLnByb3RvdHlwZS5maWxsYCBtZXRob2QKCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtJXR5cGVkYXJyYXklLnByb3RvdHlwZS5maWxsCglleHBvcnRUeXBlZEFycmF5TWV0aG9kJG4oJ2ZpbGwnLCBmdW5jdGlvbiBmaWxsKHZhbHVlIC8qICwgc3RhcnQsIGVuZCAqLykgewoJICB2YXIgbGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aDsKCSAgcmV0dXJuIGNhbGwkMSgKCSAgICAkZmlsbCwKCSAgICBhVHlwZWRBcnJheSRtKHRoaXMpLAoJICAgIHZhbHVlLAoJICAgIGxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQsCgkgICAgbGVuZ3RoID4gMiA/IGFyZ3VtZW50c1syXSA6IHVuZGVmaW5lZAoJICApOwoJfSk7CgoJdmFyIGFycmF5RnJvbUNvbnN0cnVjdG9yQW5kTGlzdCQxID0gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBsaXN0KSB7CgkgIHZhciBpbmRleCA9IDA7CgkgIHZhciBsZW5ndGggPSBsaXN0Lmxlbmd0aDsKCSAgdmFyIHJlc3VsdCA9IG5ldyBDb25zdHJ1Y3RvcihsZW5ndGgpOwoJICB3aGlsZSAobGVuZ3RoID4gaW5kZXgpIHJlc3VsdFtpbmRleF0gPSBsaXN0W2luZGV4KytdOwoJICByZXR1cm4gcmVzdWx0OwoJfTsKCgl2YXIgYW5PYmplY3QgPSBhbk9iamVjdCQ3OwoJdmFyIGFDb25zdHJ1Y3RvciA9IGFDb25zdHJ1Y3RvciQyOwoJdmFyIHdlbGxLbm93blN5bWJvbCQxID0gd2VsbEtub3duU3ltYm9sJGY7CgoJdmFyIFNQRUNJRVMgPSB3ZWxsS25vd25TeW1ib2wkMSgnc3BlY2llcycpOwoKCS8vIGBTcGVjaWVzQ29uc3RydWN0b3JgIGFic3RyYWN0IG9wZXJhdGlvbgoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1zcGVjaWVzY29uc3RydWN0b3IKCXZhciBzcGVjaWVzQ29uc3RydWN0b3IkMSA9IGZ1bmN0aW9uIChPLCBkZWZhdWx0Q29uc3RydWN0b3IpIHsKCSAgdmFyIEMgPSBhbk9iamVjdChPKS5jb25zdHJ1Y3RvcjsKCSAgdmFyIFM7CgkgIHJldHVybiBDID09PSB1bmRlZmluZWQgfHwgKFMgPSBhbk9iamVjdChDKVtTUEVDSUVTXSkgPT0gdW5kZWZpbmVkID8gZGVmYXVsdENvbnN0cnVjdG9yIDogYUNvbnN0cnVjdG9yKFMpOwoJfTsKCgl2YXIgQXJyYXlCdWZmZXJWaWV3Q29yZSRtID0gYXJyYXlCdWZmZXJWaWV3Q29yZTsKCXZhciBzcGVjaWVzQ29uc3RydWN0b3IgPSBzcGVjaWVzQ29uc3RydWN0b3IkMTsKCgl2YXIgVFlQRURfQVJSQVlfQ09OU1RSVUNUT1IgPSBBcnJheUJ1ZmZlclZpZXdDb3JlJG0uVFlQRURfQVJSQVlfQ09OU1RSVUNUT1I7Cgl2YXIgYVR5cGVkQXJyYXlDb25zdHJ1Y3RvciA9IEFycmF5QnVmZmVyVmlld0NvcmUkbS5hVHlwZWRBcnJheUNvbnN0cnVjdG9yOwoKCS8vIGEgcGFydCBvZiBgVHlwZWRBcnJheVNwZWNpZXNDcmVhdGVgIGFic3RyYWN0IG9wZXJhdGlvbgoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3R5cGVkYXJyYXktc3BlY2llcy1jcmVhdGUKCXZhciB0eXBlZEFycmF5U3BlY2llc0NvbnN0cnVjdG9yJDQgPSBmdW5jdGlvbiAob3JpZ2luYWxBcnJheSkgewoJICByZXR1cm4gYVR5cGVkQXJyYXlDb25zdHJ1Y3RvcihzcGVjaWVzQ29uc3RydWN0b3Iob3JpZ2luYWxBcnJheSwgb3JpZ2luYWxBcnJheVtUWVBFRF9BUlJBWV9DT05TVFJVQ1RPUl0pKTsKCX07CgoJdmFyIGFycmF5RnJvbUNvbnN0cnVjdG9yQW5kTGlzdCA9IGFycmF5RnJvbUNvbnN0cnVjdG9yQW5kTGlzdCQxOwoJdmFyIHR5cGVkQXJyYXlTcGVjaWVzQ29uc3RydWN0b3IkMyA9IHR5cGVkQXJyYXlTcGVjaWVzQ29uc3RydWN0b3IkNDsKCgl2YXIgdHlwZWRBcnJheUZyb21TcGVjaWVzQW5kTGlzdCA9IGZ1bmN0aW9uIChpbnN0YW5jZSwgbGlzdCkgewoJICByZXR1cm4gYXJyYXlGcm9tQ29uc3RydWN0b3JBbmRMaXN0KHR5cGVkQXJyYXlTcGVjaWVzQ29uc3RydWN0b3IkMyhpbnN0YW5jZSksIGxpc3QpOwoJfTsKCgl2YXIgQXJyYXlCdWZmZXJWaWV3Q29yZSRsID0gYXJyYXlCdWZmZXJWaWV3Q29yZTsKCXZhciAkZmlsdGVyID0gYXJyYXlJdGVyYXRpb24uZmlsdGVyOwoJdmFyIGZyb21TcGVjaWVzQW5kTGlzdCQxID0gdHlwZWRBcnJheUZyb21TcGVjaWVzQW5kTGlzdDsKCgl2YXIgYVR5cGVkQXJyYXkkbCA9IEFycmF5QnVmZmVyVmlld0NvcmUkbC5hVHlwZWRBcnJheTsKCXZhciBleHBvcnRUeXBlZEFycmF5TWV0aG9kJG0gPSBBcnJheUJ1ZmZlclZpZXdDb3JlJGwuZXhwb3J0VHlwZWRBcnJheU1ldGhvZDsKCgkvLyBgJVR5cGVkQXJyYXklLnByb3RvdHlwZS5maWx0ZXJgIG1ldGhvZAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy0ldHlwZWRhcnJheSUucHJvdG90eXBlLmZpbHRlcgoJZXhwb3J0VHlwZWRBcnJheU1ldGhvZCRtKCdmaWx0ZXInLCBmdW5jdGlvbiBmaWx0ZXIoY2FsbGJhY2tmbiAvKiAsIHRoaXNBcmcgKi8pIHsKCSAgdmFyIGxpc3QgPSAkZmlsdGVyKGFUeXBlZEFycmF5JGwodGhpcyksIGNhbGxiYWNrZm4sIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkKTsKCSAgcmV0dXJuIGZyb21TcGVjaWVzQW5kTGlzdCQxKHRoaXMsIGxpc3QpOwoJfSk7CgoJdmFyIEFycmF5QnVmZmVyVmlld0NvcmUkayA9IGFycmF5QnVmZmVyVmlld0NvcmU7Cgl2YXIgJGZpbmQgPSBhcnJheUl0ZXJhdGlvbi5maW5kOwoKCXZhciBhVHlwZWRBcnJheSRrID0gQXJyYXlCdWZmZXJWaWV3Q29yZSRrLmFUeXBlZEFycmF5OwoJdmFyIGV4cG9ydFR5cGVkQXJyYXlNZXRob2QkbCA9IEFycmF5QnVmZmVyVmlld0NvcmUkay5leHBvcnRUeXBlZEFycmF5TWV0aG9kOwoKCS8vIGAlVHlwZWRBcnJheSUucHJvdG90eXBlLmZpbmRgIG1ldGhvZAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy0ldHlwZWRhcnJheSUucHJvdG90eXBlLmZpbmQKCWV4cG9ydFR5cGVkQXJyYXlNZXRob2QkbCgnZmluZCcsIGZ1bmN0aW9uIGZpbmQocHJlZGljYXRlIC8qICwgdGhpc0FyZyAqLykgewoJICByZXR1cm4gJGZpbmQoYVR5cGVkQXJyYXkkayh0aGlzKSwgcHJlZGljYXRlLCBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZCk7Cgl9KTsKCgl2YXIgQXJyYXlCdWZmZXJWaWV3Q29yZSRqID0gYXJyYXlCdWZmZXJWaWV3Q29yZTsKCXZhciAkZmluZEluZGV4ID0gYXJyYXlJdGVyYXRpb24uZmluZEluZGV4OwoKCXZhciBhVHlwZWRBcnJheSRqID0gQXJyYXlCdWZmZXJWaWV3Q29yZSRqLmFUeXBlZEFycmF5OwoJdmFyIGV4cG9ydFR5cGVkQXJyYXlNZXRob2QkayA9IEFycmF5QnVmZmVyVmlld0NvcmUkai5leHBvcnRUeXBlZEFycmF5TWV0aG9kOwoKCS8vIGAlVHlwZWRBcnJheSUucHJvdG90eXBlLmZpbmRJbmRleGAgbWV0aG9kCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLSV0eXBlZGFycmF5JS5wcm90b3R5cGUuZmluZGluZGV4CglleHBvcnRUeXBlZEFycmF5TWV0aG9kJGsoJ2ZpbmRJbmRleCcsIGZ1bmN0aW9uIGZpbmRJbmRleChwcmVkaWNhdGUgLyogLCB0aGlzQXJnICovKSB7CgkgIHJldHVybiAkZmluZEluZGV4KGFUeXBlZEFycmF5JGoodGhpcyksIHByZWRpY2F0ZSwgYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQpOwoJfSk7CgoJdmFyIEFycmF5QnVmZmVyVmlld0NvcmUkaSA9IGFycmF5QnVmZmVyVmlld0NvcmU7Cgl2YXIgJGZvckVhY2ggPSBhcnJheUl0ZXJhdGlvbi5mb3JFYWNoOwoKCXZhciBhVHlwZWRBcnJheSRpID0gQXJyYXlCdWZmZXJWaWV3Q29yZSRpLmFUeXBlZEFycmF5OwoJdmFyIGV4cG9ydFR5cGVkQXJyYXlNZXRob2QkaiA9IEFycmF5QnVmZmVyVmlld0NvcmUkaS5leHBvcnRUeXBlZEFycmF5TWV0aG9kOwoKCS8vIGAlVHlwZWRBcnJheSUucHJvdG90eXBlLmZvckVhY2hgIG1ldGhvZAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy0ldHlwZWRhcnJheSUucHJvdG90eXBlLmZvcmVhY2gKCWV4cG9ydFR5cGVkQXJyYXlNZXRob2QkaignZm9yRWFjaCcsIGZ1bmN0aW9uIGZvckVhY2goY2FsbGJhY2tmbiAvKiAsIHRoaXNBcmcgKi8pIHsKCSAgJGZvckVhY2goYVR5cGVkQXJyYXkkaSh0aGlzKSwgY2FsbGJhY2tmbiwgYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQpOwoJfSk7CgoJdmFyIEFycmF5QnVmZmVyVmlld0NvcmUkaCA9IGFycmF5QnVmZmVyVmlld0NvcmU7Cgl2YXIgJGluY2x1ZGVzID0gYXJyYXlJbmNsdWRlcy5pbmNsdWRlczsKCgl2YXIgYVR5cGVkQXJyYXkkaCA9IEFycmF5QnVmZmVyVmlld0NvcmUkaC5hVHlwZWRBcnJheTsKCXZhciBleHBvcnRUeXBlZEFycmF5TWV0aG9kJGkgPSBBcnJheUJ1ZmZlclZpZXdDb3JlJGguZXhwb3J0VHlwZWRBcnJheU1ldGhvZDsKCgkvLyBgJVR5cGVkQXJyYXklLnByb3RvdHlwZS5pbmNsdWRlc2AgbWV0aG9kCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLSV0eXBlZGFycmF5JS5wcm90b3R5cGUuaW5jbHVkZXMKCWV4cG9ydFR5cGVkQXJyYXlNZXRob2QkaSgnaW5jbHVkZXMnLCBmdW5jdGlvbiBpbmNsdWRlcyhzZWFyY2hFbGVtZW50IC8qICwgZnJvbUluZGV4ICovKSB7CgkgIHJldHVybiAkaW5jbHVkZXMoYVR5cGVkQXJyYXkkaCh0aGlzKSwgc2VhcmNoRWxlbWVudCwgYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQpOwoJfSk7CgoJdmFyIEFycmF5QnVmZmVyVmlld0NvcmUkZyA9IGFycmF5QnVmZmVyVmlld0NvcmU7Cgl2YXIgJGluZGV4T2YgPSBhcnJheUluY2x1ZGVzLmluZGV4T2Y7CgoJdmFyIGFUeXBlZEFycmF5JGcgPSBBcnJheUJ1ZmZlclZpZXdDb3JlJGcuYVR5cGVkQXJyYXk7Cgl2YXIgZXhwb3J0VHlwZWRBcnJheU1ldGhvZCRoID0gQXJyYXlCdWZmZXJWaWV3Q29yZSRnLmV4cG9ydFR5cGVkQXJyYXlNZXRob2Q7CgoJLy8gYCVUeXBlZEFycmF5JS5wcm90b3R5cGUuaW5kZXhPZmAgbWV0aG9kCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLSV0eXBlZGFycmF5JS5wcm90b3R5cGUuaW5kZXhvZgoJZXhwb3J0VHlwZWRBcnJheU1ldGhvZCRoKCdpbmRleE9mJywgZnVuY3Rpb24gaW5kZXhPZihzZWFyY2hFbGVtZW50IC8qICwgZnJvbUluZGV4ICovKSB7CgkgIHJldHVybiAkaW5kZXhPZihhVHlwZWRBcnJheSRnKHRoaXMpLCBzZWFyY2hFbGVtZW50LCBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZCk7Cgl9KTsKCgl2YXIgZ2xvYmFsJDcgPSBnbG9iYWwkSTsKCXZhciB1bmN1cnJ5VGhpcyQ2ID0gZnVuY3Rpb25VbmN1cnJ5VGhpczsKCXZhciBQUk9QRVJfRlVOQ1RJT05fTkFNRSA9IGZ1bmN0aW9uTmFtZS5QUk9QRVI7Cgl2YXIgQXJyYXlCdWZmZXJWaWV3Q29yZSRmID0gYXJyYXlCdWZmZXJWaWV3Q29yZTsKCXZhciBBcnJheUl0ZXJhdG9ycyA9IGVzX2FycmF5X2l0ZXJhdG9yOwoJdmFyIHdlbGxLbm93blN5bWJvbCA9IHdlbGxLbm93blN5bWJvbCRmOwoKCXZhciBJVEVSQVRPUiA9IHdlbGxLbm93blN5bWJvbCgnaXRlcmF0b3InKTsKCXZhciBVaW50OEFycmF5JDIgPSBnbG9iYWwkNy5VaW50OEFycmF5OwoJdmFyIGFycmF5VmFsdWVzID0gdW5jdXJyeVRoaXMkNihBcnJheUl0ZXJhdG9ycy52YWx1ZXMpOwoJdmFyIGFycmF5S2V5cyA9IHVuY3VycnlUaGlzJDYoQXJyYXlJdGVyYXRvcnMua2V5cyk7Cgl2YXIgYXJyYXlFbnRyaWVzID0gdW5jdXJyeVRoaXMkNihBcnJheUl0ZXJhdG9ycy5lbnRyaWVzKTsKCXZhciBhVHlwZWRBcnJheSRmID0gQXJyYXlCdWZmZXJWaWV3Q29yZSRmLmFUeXBlZEFycmF5OwoJdmFyIGV4cG9ydFR5cGVkQXJyYXlNZXRob2QkZyA9IEFycmF5QnVmZmVyVmlld0NvcmUkZi5leHBvcnRUeXBlZEFycmF5TWV0aG9kOwoJdmFyIG5hdGl2ZVR5cGVkQXJyYXlJdGVyYXRvciA9IFVpbnQ4QXJyYXkkMiAmJiBVaW50OEFycmF5JDIucHJvdG90eXBlW0lURVJBVE9SXTsKCgl2YXIgUFJPUEVSX0FSUkFZX1ZBTFVFU19OQU1FID0gISFuYXRpdmVUeXBlZEFycmF5SXRlcmF0b3IgJiYgbmF0aXZlVHlwZWRBcnJheUl0ZXJhdG9yLm5hbWUgPT09ICd2YWx1ZXMnOwoKCXZhciB0eXBlZEFycmF5VmFsdWVzID0gZnVuY3Rpb24gdmFsdWVzKCkgewoJICByZXR1cm4gYXJyYXlWYWx1ZXMoYVR5cGVkQXJyYXkkZih0aGlzKSk7Cgl9OwoKCS8vIGAlVHlwZWRBcnJheSUucHJvdG90eXBlLmVudHJpZXNgIG1ldGhvZAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy0ldHlwZWRhcnJheSUucHJvdG90eXBlLmVudHJpZXMKCWV4cG9ydFR5cGVkQXJyYXlNZXRob2QkZygnZW50cmllcycsIGZ1bmN0aW9uIGVudHJpZXMoKSB7CgkgIHJldHVybiBhcnJheUVudHJpZXMoYVR5cGVkQXJyYXkkZih0aGlzKSk7Cgl9KTsKCS8vIGAlVHlwZWRBcnJheSUucHJvdG90eXBlLmtleXNgIG1ldGhvZAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy0ldHlwZWRhcnJheSUucHJvdG90eXBlLmtleXMKCWV4cG9ydFR5cGVkQXJyYXlNZXRob2QkZygna2V5cycsIGZ1bmN0aW9uIGtleXMoKSB7CgkgIHJldHVybiBhcnJheUtleXMoYVR5cGVkQXJyYXkkZih0aGlzKSk7Cgl9KTsKCS8vIGAlVHlwZWRBcnJheSUucHJvdG90eXBlLnZhbHVlc2AgbWV0aG9kCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLSV0eXBlZGFycmF5JS5wcm90b3R5cGUudmFsdWVzCglleHBvcnRUeXBlZEFycmF5TWV0aG9kJGcoJ3ZhbHVlcycsIHR5cGVkQXJyYXlWYWx1ZXMsIFBST1BFUl9GVU5DVElPTl9OQU1FICYmICFQUk9QRVJfQVJSQVlfVkFMVUVTX05BTUUpOwoJLy8gYCVUeXBlZEFycmF5JS5wcm90b3R5cGVbQEBpdGVyYXRvcl1gIG1ldGhvZAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy0ldHlwZWRhcnJheSUucHJvdG90eXBlLUBAaXRlcmF0b3IKCWV4cG9ydFR5cGVkQXJyYXlNZXRob2QkZyhJVEVSQVRPUiwgdHlwZWRBcnJheVZhbHVlcywgUFJPUEVSX0ZVTkNUSU9OX05BTUUgJiYgIVBST1BFUl9BUlJBWV9WQUxVRVNfTkFNRSk7CgoJdmFyIEFycmF5QnVmZmVyVmlld0NvcmUkZSA9IGFycmF5QnVmZmVyVmlld0NvcmU7Cgl2YXIgdW5jdXJyeVRoaXMkNSA9IGZ1bmN0aW9uVW5jdXJyeVRoaXM7CgoJdmFyIGFUeXBlZEFycmF5JGUgPSBBcnJheUJ1ZmZlclZpZXdDb3JlJGUuYVR5cGVkQXJyYXk7Cgl2YXIgZXhwb3J0VHlwZWRBcnJheU1ldGhvZCRmID0gQXJyYXlCdWZmZXJWaWV3Q29yZSRlLmV4cG9ydFR5cGVkQXJyYXlNZXRob2Q7Cgl2YXIgJGpvaW4gPSB1bmN1cnJ5VGhpcyQ1KFtdLmpvaW4pOwoKCS8vIGAlVHlwZWRBcnJheSUucHJvdG90eXBlLmpvaW5gIG1ldGhvZAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy0ldHlwZWRhcnJheSUucHJvdG90eXBlLmpvaW4KCWV4cG9ydFR5cGVkQXJyYXlNZXRob2QkZignam9pbicsIGZ1bmN0aW9uIGpvaW4oc2VwYXJhdG9yKSB7CgkgIHJldHVybiAkam9pbihhVHlwZWRBcnJheSRlKHRoaXMpLCBzZXBhcmF0b3IpOwoJfSk7CgoJdmFyIEZ1bmN0aW9uUHJvdG90eXBlID0gRnVuY3Rpb24ucHJvdG90eXBlOwoJdmFyIGFwcGx5JDMgPSBGdW5jdGlvblByb3RvdHlwZS5hcHBseTsKCXZhciBiaW5kJDEgPSBGdW5jdGlvblByb3RvdHlwZS5iaW5kOwoJdmFyIGNhbGwgPSBGdW5jdGlvblByb3RvdHlwZS5jYWxsOwoKCS8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBlcy9uby1yZWZsZWN0IC0tIHNhZmUKCXZhciBmdW5jdGlvbkFwcGx5ID0gdHlwZW9mIFJlZmxlY3QgPT0gJ29iamVjdCcgJiYgUmVmbGVjdC5hcHBseSB8fCAoYmluZCQxID8gY2FsbC5iaW5kKGFwcGx5JDMpIDogZnVuY3Rpb24gKCkgewoJICByZXR1cm4gY2FsbC5hcHBseShhcHBseSQzLCBhcmd1bWVudHMpOwoJfSk7CgoJdmFyIGZhaWxzJDUgPSBmYWlscyRnOwoKCXZhciBhcnJheU1ldGhvZElzU3RyaWN0JDEgPSBmdW5jdGlvbiAoTUVUSE9EX05BTUUsIGFyZ3VtZW50KSB7CgkgIHZhciBtZXRob2QgPSBbXVtNRVRIT0RfTkFNRV07CgkgIHJldHVybiAhIW1ldGhvZCAmJiBmYWlscyQ1KGZ1bmN0aW9uICgpIHsKCSAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdXNlbGVzcy1jYWxsLG5vLXRocm93LWxpdGVyYWwgLS0gcmVxdWlyZWQgZm9yIHRlc3RpbmcKCSAgICBtZXRob2QuY2FsbChudWxsLCBhcmd1bWVudCB8fCBmdW5jdGlvbiAoKSB7IHRocm93IDE7IH0sIDEpOwoJICB9KTsKCX07CgoJLyogZXNsaW50LWRpc2FibGUgZXMvbm8tYXJyYXktcHJvdG90eXBlLWxhc3RpbmRleG9mIC0tIHNhZmUgKi8KCXZhciBhcHBseSQyID0gZnVuY3Rpb25BcHBseTsKCXZhciB0b0luZGV4ZWRPYmplY3QgPSB0b0luZGV4ZWRPYmplY3QkNjsKCXZhciB0b0ludGVnZXJPckluZmluaXR5ID0gdG9JbnRlZ2VyT3JJbmZpbml0eSQ3OwoJdmFyIGxlbmd0aE9mQXJyYXlMaWtlJDQgPSBsZW5ndGhPZkFycmF5TGlrZSRjOwoJdmFyIGFycmF5TWV0aG9kSXNTdHJpY3QgPSBhcnJheU1ldGhvZElzU3RyaWN0JDE7CgoJdmFyIG1pbiA9IE1hdGgubWluOwoJdmFyICRsYXN0SW5kZXhPZiQxID0gW10ubGFzdEluZGV4T2Y7Cgl2YXIgTkVHQVRJVkVfWkVSTyA9ICEhJGxhc3RJbmRleE9mJDEgJiYgMSAvIFsxXS5sYXN0SW5kZXhPZigxLCAtMCkgPCAwOwoJdmFyIFNUUklDVF9NRVRIT0QgPSBhcnJheU1ldGhvZElzU3RyaWN0KCdsYXN0SW5kZXhPZicpOwoJdmFyIEZPUkNFRCQzID0gTkVHQVRJVkVfWkVSTyB8fCAhU1RSSUNUX01FVEhPRDsKCgkvLyBgQXJyYXkucHJvdG90eXBlLmxhc3RJbmRleE9mYCBtZXRob2QgaW1wbGVtZW50YXRpb24KCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtYXJyYXkucHJvdG90eXBlLmxhc3RpbmRleG9mCgl2YXIgYXJyYXlMYXN0SW5kZXhPZiA9IEZPUkNFRCQzID8gZnVuY3Rpb24gbGFzdEluZGV4T2Yoc2VhcmNoRWxlbWVudCAvKiAsIGZyb21JbmRleCA9IEBbKi0xXSAqLykgewoJICAvLyBjb252ZXJ0IC0wIHRvICswCgkgIGlmIChORUdBVElWRV9aRVJPKSByZXR1cm4gYXBwbHkkMigkbGFzdEluZGV4T2YkMSwgdGhpcywgYXJndW1lbnRzKSB8fCAwOwoJICB2YXIgTyA9IHRvSW5kZXhlZE9iamVjdCh0aGlzKTsKCSAgdmFyIGxlbmd0aCA9IGxlbmd0aE9mQXJyYXlMaWtlJDQoTyk7CgkgIHZhciBpbmRleCA9IGxlbmd0aCAtIDE7CgkgIGlmIChhcmd1bWVudHMubGVuZ3RoID4gMSkgaW5kZXggPSBtaW4oaW5kZXgsIHRvSW50ZWdlck9ySW5maW5pdHkoYXJndW1lbnRzWzFdKSk7CgkgIGlmIChpbmRleCA8IDApIGluZGV4ID0gbGVuZ3RoICsgaW5kZXg7CgkgIGZvciAoO2luZGV4ID49IDA7IGluZGV4LS0pIGlmIChpbmRleCBpbiBPICYmIE9baW5kZXhdID09PSBzZWFyY2hFbGVtZW50KSByZXR1cm4gaW5kZXggfHwgMDsKCSAgcmV0dXJuIC0xOwoJfSA6ICRsYXN0SW5kZXhPZiQxOwoKCXZhciBBcnJheUJ1ZmZlclZpZXdDb3JlJGQgPSBhcnJheUJ1ZmZlclZpZXdDb3JlOwoJdmFyIGFwcGx5JDEgPSBmdW5jdGlvbkFwcGx5OwoJdmFyICRsYXN0SW5kZXhPZiA9IGFycmF5TGFzdEluZGV4T2Y7CgoJdmFyIGFUeXBlZEFycmF5JGQgPSBBcnJheUJ1ZmZlclZpZXdDb3JlJGQuYVR5cGVkQXJyYXk7Cgl2YXIgZXhwb3J0VHlwZWRBcnJheU1ldGhvZCRlID0gQXJyYXlCdWZmZXJWaWV3Q29yZSRkLmV4cG9ydFR5cGVkQXJyYXlNZXRob2Q7CgoJLy8gYCVUeXBlZEFycmF5JS5wcm90b3R5cGUubGFzdEluZGV4T2ZgIG1ldGhvZAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy0ldHlwZWRhcnJheSUucHJvdG90eXBlLmxhc3RpbmRleG9mCglleHBvcnRUeXBlZEFycmF5TWV0aG9kJGUoJ2xhc3RJbmRleE9mJywgZnVuY3Rpb24gbGFzdEluZGV4T2Yoc2VhcmNoRWxlbWVudCAvKiAsIGZyb21JbmRleCAqLykgewoJICB2YXIgbGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aDsKCSAgcmV0dXJuIGFwcGx5JDEoJGxhc3RJbmRleE9mLCBhVHlwZWRBcnJheSRkKHRoaXMpLCBsZW5ndGggPiAxID8gW3NlYXJjaEVsZW1lbnQsIGFyZ3VtZW50c1sxXV0gOiBbc2VhcmNoRWxlbWVudF0pOwoJfSk7CgoJdmFyIEFycmF5QnVmZmVyVmlld0NvcmUkYyA9IGFycmF5QnVmZmVyVmlld0NvcmU7Cgl2YXIgJG1hcCA9IGFycmF5SXRlcmF0aW9uLm1hcDsKCXZhciB0eXBlZEFycmF5U3BlY2llc0NvbnN0cnVjdG9yJDIgPSB0eXBlZEFycmF5U3BlY2llc0NvbnN0cnVjdG9yJDQ7CgoJdmFyIGFUeXBlZEFycmF5JGMgPSBBcnJheUJ1ZmZlclZpZXdDb3JlJGMuYVR5cGVkQXJyYXk7Cgl2YXIgZXhwb3J0VHlwZWRBcnJheU1ldGhvZCRkID0gQXJyYXlCdWZmZXJWaWV3Q29yZSRjLmV4cG9ydFR5cGVkQXJyYXlNZXRob2Q7CgoJLy8gYCVUeXBlZEFycmF5JS5wcm90b3R5cGUubWFwYCBtZXRob2QKCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtJXR5cGVkYXJyYXklLnByb3RvdHlwZS5tYXAKCWV4cG9ydFR5cGVkQXJyYXlNZXRob2QkZCgnbWFwJywgZnVuY3Rpb24gbWFwKG1hcGZuIC8qICwgdGhpc0FyZyAqLykgewoJICByZXR1cm4gJG1hcChhVHlwZWRBcnJheSRjKHRoaXMpLCBtYXBmbiwgYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQsIGZ1bmN0aW9uIChPLCBsZW5ndGgpIHsKCSAgICByZXR1cm4gbmV3ICh0eXBlZEFycmF5U3BlY2llc0NvbnN0cnVjdG9yJDIoTykpKGxlbmd0aCk7CgkgIH0pOwoJfSk7CgoJdmFyIGdsb2JhbCQ2ID0gZ2xvYmFsJEk7Cgl2YXIgYUNhbGxhYmxlJDIgPSBhQ2FsbGFibGUkNjsKCXZhciB0b09iamVjdCQzID0gdG9PYmplY3QkYTsKCXZhciBJbmRleGVkT2JqZWN0JDEgPSBpbmRleGVkT2JqZWN0OwoJdmFyIGxlbmd0aE9mQXJyYXlMaWtlJDMgPSBsZW5ndGhPZkFycmF5TGlrZSRjOwoKCXZhciBUeXBlRXJyb3IgPSBnbG9iYWwkNi5UeXBlRXJyb3I7CgoJLy8gYEFycmF5LnByb3RvdHlwZS57IHJlZHVjZSwgcmVkdWNlUmlnaHQgfWAgbWV0aG9kcyBpbXBsZW1lbnRhdGlvbgoJdmFyIGNyZWF0ZU1ldGhvZCQxID0gZnVuY3Rpb24gKElTX1JJR0hUKSB7CgkgIHJldHVybiBmdW5jdGlvbiAodGhhdCwgY2FsbGJhY2tmbiwgYXJndW1lbnRzTGVuZ3RoLCBtZW1vKSB7CgkgICAgYUNhbGxhYmxlJDIoY2FsbGJhY2tmbik7CgkgICAgdmFyIE8gPSB0b09iamVjdCQzKHRoYXQpOwoJICAgIHZhciBzZWxmID0gSW5kZXhlZE9iamVjdCQxKE8pOwoJICAgIHZhciBsZW5ndGggPSBsZW5ndGhPZkFycmF5TGlrZSQzKE8pOwoJICAgIHZhciBpbmRleCA9IElTX1JJR0hUID8gbGVuZ3RoIC0gMSA6IDA7CgkgICAgdmFyIGkgPSBJU19SSUdIVCA/IC0xIDogMTsKCSAgICBpZiAoYXJndW1lbnRzTGVuZ3RoIDwgMikgd2hpbGUgKHRydWUpIHsKCSAgICAgIGlmIChpbmRleCBpbiBzZWxmKSB7CgkgICAgICAgIG1lbW8gPSBzZWxmW2luZGV4XTsKCSAgICAgICAgaW5kZXggKz0gaTsKCSAgICAgICAgYnJlYWs7CgkgICAgICB9CgkgICAgICBpbmRleCArPSBpOwoJICAgICAgaWYgKElTX1JJR0hUID8gaW5kZXggPCAwIDogbGVuZ3RoIDw9IGluZGV4KSB7CgkgICAgICAgIHRocm93IFR5cGVFcnJvcignUmVkdWNlIG9mIGVtcHR5IGFycmF5IHdpdGggbm8gaW5pdGlhbCB2YWx1ZScpOwoJICAgICAgfQoJICAgIH0KCSAgICBmb3IgKDtJU19SSUdIVCA/IGluZGV4ID49IDAgOiBsZW5ndGggPiBpbmRleDsgaW5kZXggKz0gaSkgaWYgKGluZGV4IGluIHNlbGYpIHsKCSAgICAgIG1lbW8gPSBjYWxsYmFja2ZuKG1lbW8sIHNlbGZbaW5kZXhdLCBpbmRleCwgTyk7CgkgICAgfQoJICAgIHJldHVybiBtZW1vOwoJICB9OwoJfTsKCgl2YXIgYXJyYXlSZWR1Y2UgPSB7CgkgIC8vIGBBcnJheS5wcm90b3R5cGUucmVkdWNlYCBtZXRob2QKCSAgLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1hcnJheS5wcm90b3R5cGUucmVkdWNlCgkgIGxlZnQ6IGNyZWF0ZU1ldGhvZCQxKGZhbHNlKSwKCSAgLy8gYEFycmF5LnByb3RvdHlwZS5yZWR1Y2VSaWdodGAgbWV0aG9kCgkgIC8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtYXJyYXkucHJvdG90eXBlLnJlZHVjZXJpZ2h0CgkgIHJpZ2h0OiBjcmVhdGVNZXRob2QkMSh0cnVlKQoJfTsKCgl2YXIgQXJyYXlCdWZmZXJWaWV3Q29yZSRiID0gYXJyYXlCdWZmZXJWaWV3Q29yZTsKCXZhciAkcmVkdWNlID0gYXJyYXlSZWR1Y2UubGVmdDsKCgl2YXIgYVR5cGVkQXJyYXkkYiA9IEFycmF5QnVmZmVyVmlld0NvcmUkYi5hVHlwZWRBcnJheTsKCXZhciBleHBvcnRUeXBlZEFycmF5TWV0aG9kJGMgPSBBcnJheUJ1ZmZlclZpZXdDb3JlJGIuZXhwb3J0VHlwZWRBcnJheU1ldGhvZDsKCgkvLyBgJVR5cGVkQXJyYXklLnByb3RvdHlwZS5yZWR1Y2VgIG1ldGhvZAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy0ldHlwZWRhcnJheSUucHJvdG90eXBlLnJlZHVjZQoJZXhwb3J0VHlwZWRBcnJheU1ldGhvZCRjKCdyZWR1Y2UnLCBmdW5jdGlvbiByZWR1Y2UoY2FsbGJhY2tmbiAvKiAsIGluaXRpYWxWYWx1ZSAqLykgewoJICB2YXIgbGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aDsKCSAgcmV0dXJuICRyZWR1Y2UoYVR5cGVkQXJyYXkkYih0aGlzKSwgY2FsbGJhY2tmbiwgbGVuZ3RoLCBsZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkKTsKCX0pOwoKCXZhciBBcnJheUJ1ZmZlclZpZXdDb3JlJGEgPSBhcnJheUJ1ZmZlclZpZXdDb3JlOwoJdmFyICRyZWR1Y2VSaWdodCA9IGFycmF5UmVkdWNlLnJpZ2h0OwoKCXZhciBhVHlwZWRBcnJheSRhID0gQXJyYXlCdWZmZXJWaWV3Q29yZSRhLmFUeXBlZEFycmF5OwoJdmFyIGV4cG9ydFR5cGVkQXJyYXlNZXRob2QkYiA9IEFycmF5QnVmZmVyVmlld0NvcmUkYS5leHBvcnRUeXBlZEFycmF5TWV0aG9kOwoKCS8vIGAlVHlwZWRBcnJheSUucHJvdG90eXBlLnJlZHVjZVJpY2h0YCBtZXRob2QKCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtJXR5cGVkYXJyYXklLnByb3RvdHlwZS5yZWR1Y2VyaWdodAoJZXhwb3J0VHlwZWRBcnJheU1ldGhvZCRiKCdyZWR1Y2VSaWdodCcsIGZ1bmN0aW9uIHJlZHVjZVJpZ2h0KGNhbGxiYWNrZm4gLyogLCBpbml0aWFsVmFsdWUgKi8pIHsKCSAgdmFyIGxlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGg7CgkgIHJldHVybiAkcmVkdWNlUmlnaHQoYVR5cGVkQXJyYXkkYSh0aGlzKSwgY2FsbGJhY2tmbiwgbGVuZ3RoLCBsZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkKTsKCX0pOwoKCXZhciBBcnJheUJ1ZmZlclZpZXdDb3JlJDkgPSBhcnJheUJ1ZmZlclZpZXdDb3JlOwoKCXZhciBhVHlwZWRBcnJheSQ5ID0gQXJyYXlCdWZmZXJWaWV3Q29yZSQ5LmFUeXBlZEFycmF5OwoJdmFyIGV4cG9ydFR5cGVkQXJyYXlNZXRob2QkYSA9IEFycmF5QnVmZmVyVmlld0NvcmUkOS5leHBvcnRUeXBlZEFycmF5TWV0aG9kOwoJdmFyIGZsb29yJDEgPSBNYXRoLmZsb29yOwoKCS8vIGAlVHlwZWRBcnJheSUucHJvdG90eXBlLnJldmVyc2VgIG1ldGhvZAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy0ldHlwZWRhcnJheSUucHJvdG90eXBlLnJldmVyc2UKCWV4cG9ydFR5cGVkQXJyYXlNZXRob2QkYSgncmV2ZXJzZScsIGZ1bmN0aW9uIHJldmVyc2UoKSB7CgkgIHZhciB0aGF0ID0gdGhpczsKCSAgdmFyIGxlbmd0aCA9IGFUeXBlZEFycmF5JDkodGhhdCkubGVuZ3RoOwoJICB2YXIgbWlkZGxlID0gZmxvb3IkMShsZW5ndGggLyAyKTsKCSAgdmFyIGluZGV4ID0gMDsKCSAgdmFyIHZhbHVlOwoJICB3aGlsZSAoaW5kZXggPCBtaWRkbGUpIHsKCSAgICB2YWx1ZSA9IHRoYXRbaW5kZXhdOwoJICAgIHRoYXRbaW5kZXgrK10gPSB0aGF0Wy0tbGVuZ3RoXTsKCSAgICB0aGF0W2xlbmd0aF0gPSB2YWx1ZTsKCSAgfSByZXR1cm4gdGhhdDsKCX0pOwoKCXZhciBnbG9iYWwkNSA9IGdsb2JhbCRJOwoJdmFyIEFycmF5QnVmZmVyVmlld0NvcmUkOCA9IGFycmF5QnVmZmVyVmlld0NvcmU7Cgl2YXIgbGVuZ3RoT2ZBcnJheUxpa2UkMiA9IGxlbmd0aE9mQXJyYXlMaWtlJGM7Cgl2YXIgdG9PZmZzZXQgPSB0b09mZnNldCQyOwoJdmFyIHRvT2JqZWN0JDIgPSB0b09iamVjdCRhOwoJdmFyIGZhaWxzJDQgPSBmYWlscyRnOwoKCXZhciBSYW5nZUVycm9yID0gZ2xvYmFsJDUuUmFuZ2VFcnJvcjsKCXZhciBhVHlwZWRBcnJheSQ4ID0gQXJyYXlCdWZmZXJWaWV3Q29yZSQ4LmFUeXBlZEFycmF5OwoJdmFyIGV4cG9ydFR5cGVkQXJyYXlNZXRob2QkOSA9IEFycmF5QnVmZmVyVmlld0NvcmUkOC5leHBvcnRUeXBlZEFycmF5TWV0aG9kOwoKCXZhciBGT1JDRUQkMiA9IGZhaWxzJDQoZnVuY3Rpb24gKCkgewoJICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZXMvbm8tdHlwZWQtYXJyYXlzIC0tIHJlcXVpcmVkIGZvciB0ZXN0aW5nCgkgIG5ldyBJbnQ4QXJyYXkoMSkuc2V0KHt9KTsKCX0pOwoKCS8vIGAlVHlwZWRBcnJheSUucHJvdG90eXBlLnNldGAgbWV0aG9kCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLSV0eXBlZGFycmF5JS5wcm90b3R5cGUuc2V0CglleHBvcnRUeXBlZEFycmF5TWV0aG9kJDkoJ3NldCcsIGZ1bmN0aW9uIHNldChhcnJheUxpa2UgLyogLCBvZmZzZXQgKi8pIHsKCSAgYVR5cGVkQXJyYXkkOCh0aGlzKTsKCSAgdmFyIG9mZnNldCA9IHRvT2Zmc2V0KGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkLCAxKTsKCSAgdmFyIGxlbmd0aCA9IHRoaXMubGVuZ3RoOwoJICB2YXIgc3JjID0gdG9PYmplY3QkMihhcnJheUxpa2UpOwoJICB2YXIgbGVuID0gbGVuZ3RoT2ZBcnJheUxpa2UkMihzcmMpOwoJICB2YXIgaW5kZXggPSAwOwoJICBpZiAobGVuICsgb2Zmc2V0ID4gbGVuZ3RoKSB0aHJvdyBSYW5nZUVycm9yKCdXcm9uZyBsZW5ndGgnKTsKCSAgd2hpbGUgKGluZGV4IDwgbGVuKSB0aGlzW29mZnNldCArIGluZGV4XSA9IHNyY1tpbmRleCsrXTsKCX0sIEZPUkNFRCQyKTsKCgl2YXIgdW5jdXJyeVRoaXMkNCA9IGZ1bmN0aW9uVW5jdXJyeVRoaXM7CgoJdmFyIGFycmF5U2xpY2UkMyA9IHVuY3VycnlUaGlzJDQoW10uc2xpY2UpOwoKCXZhciBBcnJheUJ1ZmZlclZpZXdDb3JlJDcgPSBhcnJheUJ1ZmZlclZpZXdDb3JlOwoJdmFyIHR5cGVkQXJyYXlTcGVjaWVzQ29uc3RydWN0b3IkMSA9IHR5cGVkQXJyYXlTcGVjaWVzQ29uc3RydWN0b3IkNDsKCXZhciBmYWlscyQzID0gZmFpbHMkZzsKCXZhciBhcnJheVNsaWNlJDIgPSBhcnJheVNsaWNlJDM7CgoJdmFyIGFUeXBlZEFycmF5JDcgPSBBcnJheUJ1ZmZlclZpZXdDb3JlJDcuYVR5cGVkQXJyYXk7Cgl2YXIgZXhwb3J0VHlwZWRBcnJheU1ldGhvZCQ4ID0gQXJyYXlCdWZmZXJWaWV3Q29yZSQ3LmV4cG9ydFR5cGVkQXJyYXlNZXRob2Q7CgoJdmFyIEZPUkNFRCQxID0gZmFpbHMkMyhmdW5jdGlvbiAoKSB7CgkgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBlcy9uby10eXBlZC1hcnJheXMgLS0gcmVxdWlyZWQgZm9yIHRlc3RpbmcKCSAgbmV3IEludDhBcnJheSgxKS5zbGljZSgpOwoJfSk7CgoJLy8gYCVUeXBlZEFycmF5JS5wcm90b3R5cGUuc2xpY2VgIG1ldGhvZAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy0ldHlwZWRhcnJheSUucHJvdG90eXBlLnNsaWNlCglleHBvcnRUeXBlZEFycmF5TWV0aG9kJDgoJ3NsaWNlJywgZnVuY3Rpb24gc2xpY2Uoc3RhcnQsIGVuZCkgewoJICB2YXIgbGlzdCA9IGFycmF5U2xpY2UkMihhVHlwZWRBcnJheSQ3KHRoaXMpLCBzdGFydCwgZW5kKTsKCSAgdmFyIEMgPSB0eXBlZEFycmF5U3BlY2llc0NvbnN0cnVjdG9yJDEodGhpcyk7CgkgIHZhciBpbmRleCA9IDA7CgkgIHZhciBsZW5ndGggPSBsaXN0Lmxlbmd0aDsKCSAgdmFyIHJlc3VsdCA9IG5ldyBDKGxlbmd0aCk7CgkgIHdoaWxlIChsZW5ndGggPiBpbmRleCkgcmVzdWx0W2luZGV4XSA9IGxpc3RbaW5kZXgrK107CgkgIHJldHVybiByZXN1bHQ7Cgl9LCBGT1JDRUQkMSk7CgoJdmFyIEFycmF5QnVmZmVyVmlld0NvcmUkNiA9IGFycmF5QnVmZmVyVmlld0NvcmU7Cgl2YXIgJHNvbWUgPSBhcnJheUl0ZXJhdGlvbi5zb21lOwoKCXZhciBhVHlwZWRBcnJheSQ2ID0gQXJyYXlCdWZmZXJWaWV3Q29yZSQ2LmFUeXBlZEFycmF5OwoJdmFyIGV4cG9ydFR5cGVkQXJyYXlNZXRob2QkNyA9IEFycmF5QnVmZmVyVmlld0NvcmUkNi5leHBvcnRUeXBlZEFycmF5TWV0aG9kOwoKCS8vIGAlVHlwZWRBcnJheSUucHJvdG90eXBlLnNvbWVgIG1ldGhvZAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy0ldHlwZWRhcnJheSUucHJvdG90eXBlLnNvbWUKCWV4cG9ydFR5cGVkQXJyYXlNZXRob2QkNygnc29tZScsIGZ1bmN0aW9uIHNvbWUoY2FsbGJhY2tmbiAvKiAsIHRoaXNBcmcgKi8pIHsKCSAgcmV0dXJuICRzb21lKGFUeXBlZEFycmF5JDYodGhpcyksIGNhbGxiYWNrZm4sIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkKTsKCX0pOwoKCXZhciBhcnJheVNsaWNlJDEgPSBhcnJheVNsaWNlU2ltcGxlOwoKCXZhciBmbG9vciA9IE1hdGguZmxvb3I7CgoJdmFyIG1lcmdlU29ydCA9IGZ1bmN0aW9uIChhcnJheSwgY29tcGFyZWZuKSB7CgkgIHZhciBsZW5ndGggPSBhcnJheS5sZW5ndGg7CgkgIHZhciBtaWRkbGUgPSBmbG9vcihsZW5ndGggLyAyKTsKCSAgcmV0dXJuIGxlbmd0aCA8IDggPyBpbnNlcnRpb25Tb3J0KGFycmF5LCBjb21wYXJlZm4pIDogbWVyZ2UoCgkgICAgYXJyYXksCgkgICAgbWVyZ2VTb3J0KGFycmF5U2xpY2UkMShhcnJheSwgMCwgbWlkZGxlKSwgY29tcGFyZWZuKSwKCSAgICBtZXJnZVNvcnQoYXJyYXlTbGljZSQxKGFycmF5LCBtaWRkbGUpLCBjb21wYXJlZm4pLAoJICAgIGNvbXBhcmVmbgoJICApOwoJfTsKCgl2YXIgaW5zZXJ0aW9uU29ydCA9IGZ1bmN0aW9uIChhcnJheSwgY29tcGFyZWZuKSB7CgkgIHZhciBsZW5ndGggPSBhcnJheS5sZW5ndGg7CgkgIHZhciBpID0gMTsKCSAgdmFyIGVsZW1lbnQsIGo7CgoJICB3aGlsZSAoaSA8IGxlbmd0aCkgewoJICAgIGogPSBpOwoJICAgIGVsZW1lbnQgPSBhcnJheVtpXTsKCSAgICB3aGlsZSAoaiAmJiBjb21wYXJlZm4oYXJyYXlbaiAtIDFdLCBlbGVtZW50KSA+IDApIHsKCSAgICAgIGFycmF5W2pdID0gYXJyYXlbLS1qXTsKCSAgICB9CgkgICAgaWYgKGogIT09IGkrKykgYXJyYXlbal0gPSBlbGVtZW50OwoJICB9IHJldHVybiBhcnJheTsKCX07CgoJdmFyIG1lcmdlID0gZnVuY3Rpb24gKGFycmF5LCBsZWZ0LCByaWdodCwgY29tcGFyZWZuKSB7CgkgIHZhciBsbGVuZ3RoID0gbGVmdC5sZW5ndGg7CgkgIHZhciBybGVuZ3RoID0gcmlnaHQubGVuZ3RoOwoJICB2YXIgbGluZGV4ID0gMDsKCSAgdmFyIHJpbmRleCA9IDA7CgoJICB3aGlsZSAobGluZGV4IDwgbGxlbmd0aCB8fCByaW5kZXggPCBybGVuZ3RoKSB7CgkgICAgYXJyYXlbbGluZGV4ICsgcmluZGV4XSA9IChsaW5kZXggPCBsbGVuZ3RoICYmIHJpbmRleCA8IHJsZW5ndGgpCgkgICAgICA/IGNvbXBhcmVmbihsZWZ0W2xpbmRleF0sIHJpZ2h0W3JpbmRleF0pIDw9IDAgPyBsZWZ0W2xpbmRleCsrXSA6IHJpZ2h0W3JpbmRleCsrXQoJICAgICAgOiBsaW5kZXggPCBsbGVuZ3RoID8gbGVmdFtsaW5kZXgrK10gOiByaWdodFtyaW5kZXgrK107CgkgIH0gcmV0dXJuIGFycmF5OwoJfTsKCgl2YXIgYXJyYXlTb3J0ID0gbWVyZ2VTb3J0OwoKCXZhciB1c2VyQWdlbnQkMSA9IGVuZ2luZVVzZXJBZ2VudDsKCgl2YXIgZmlyZWZveCA9IHVzZXJBZ2VudCQxLm1hdGNoKC9maXJlZm94XC8oXGQrKS9pKTsKCgl2YXIgZW5naW5lRmZWZXJzaW9uID0gISFmaXJlZm94ICYmICtmaXJlZm94WzFdOwoKCXZhciBVQSA9IGVuZ2luZVVzZXJBZ2VudDsKCgl2YXIgZW5naW5lSXNJZU9yRWRnZSA9IC9NU0lFfFRyaWRlbnQvLnRlc3QoVUEpOwoKCXZhciB1c2VyQWdlbnQgPSBlbmdpbmVVc2VyQWdlbnQ7CgoJdmFyIHdlYmtpdCA9IHVzZXJBZ2VudC5tYXRjaCgvQXBwbGVXZWJLaXRcLyhcZCspXC4vKTsKCgl2YXIgZW5naW5lV2Via2l0VmVyc2lvbiA9ICEhd2Via2l0ICYmICt3ZWJraXRbMV07CgoJdmFyIGdsb2JhbCQ0ID0gZ2xvYmFsJEk7Cgl2YXIgdW5jdXJyeVRoaXMkMyA9IGZ1bmN0aW9uVW5jdXJyeVRoaXM7Cgl2YXIgZmFpbHMkMiA9IGZhaWxzJGc7Cgl2YXIgYUNhbGxhYmxlJDEgPSBhQ2FsbGFibGUkNjsKCXZhciBpbnRlcm5hbFNvcnQgPSBhcnJheVNvcnQ7Cgl2YXIgQXJyYXlCdWZmZXJWaWV3Q29yZSQ1ID0gYXJyYXlCdWZmZXJWaWV3Q29yZTsKCXZhciBGRiA9IGVuZ2luZUZmVmVyc2lvbjsKCXZhciBJRV9PUl9FREdFID0gZW5naW5lSXNJZU9yRWRnZTsKCXZhciBWOCA9IGVuZ2luZVY4VmVyc2lvbjsKCXZhciBXRUJLSVQgPSBlbmdpbmVXZWJraXRWZXJzaW9uOwoKCXZhciBBcnJheSQxID0gZ2xvYmFsJDQuQXJyYXk7Cgl2YXIgYVR5cGVkQXJyYXkkNSA9IEFycmF5QnVmZmVyVmlld0NvcmUkNS5hVHlwZWRBcnJheTsKCXZhciBleHBvcnRUeXBlZEFycmF5TWV0aG9kJDYgPSBBcnJheUJ1ZmZlclZpZXdDb3JlJDUuZXhwb3J0VHlwZWRBcnJheU1ldGhvZDsKCXZhciBVaW50MTZBcnJheSA9IGdsb2JhbCQ0LlVpbnQxNkFycmF5OwoJdmFyIHVuJFNvcnQgPSBVaW50MTZBcnJheSAmJiB1bmN1cnJ5VGhpcyQzKFVpbnQxNkFycmF5LnByb3RvdHlwZS5zb3J0KTsKCgkvLyBXZWJLaXQKCXZhciBBQ0NFUFRfSU5DT1JSRUNUX0FSR1VNRU5UUyA9ICEhdW4kU29ydCAmJiAhKGZhaWxzJDIoZnVuY3Rpb24gKCkgewoJICB1biRTb3J0KG5ldyBVaW50MTZBcnJheSgyKSwgbnVsbCk7Cgl9KSAmJiBmYWlscyQyKGZ1bmN0aW9uICgpIHsKCSAgdW4kU29ydChuZXcgVWludDE2QXJyYXkoMiksIHt9KTsKCX0pKTsKCgl2YXIgU1RBQkxFX1NPUlQgPSAhIXVuJFNvcnQgJiYgIWZhaWxzJDIoZnVuY3Rpb24gKCkgewoJICAvLyBmZWF0dXJlIGRldGVjdGlvbiBjYW4gYmUgdG9vIHNsb3csIHNvIGNoZWNrIGVuZ2luZXMgdmVyc2lvbnMKCSAgaWYgKFY4KSByZXR1cm4gVjggPCA3NDsKCSAgaWYgKEZGKSByZXR1cm4gRkYgPCA2NzsKCSAgaWYgKElFX09SX0VER0UpIHJldHVybiB0cnVlOwoJICBpZiAoV0VCS0lUKSByZXR1cm4gV0VCS0lUIDwgNjAyOwoKCSAgdmFyIGFycmF5ID0gbmV3IFVpbnQxNkFycmF5KDUxNik7CgkgIHZhciBleHBlY3RlZCA9IEFycmF5JDEoNTE2KTsKCSAgdmFyIGluZGV4LCBtb2Q7CgoJICBmb3IgKGluZGV4ID0gMDsgaW5kZXggPCA1MTY7IGluZGV4KyspIHsKCSAgICBtb2QgPSBpbmRleCAlIDQ7CgkgICAgYXJyYXlbaW5kZXhdID0gNTE1IC0gaW5kZXg7CgkgICAgZXhwZWN0ZWRbaW5kZXhdID0gaW5kZXggLSAyICogbW9kICsgMzsKCSAgfQoKCSAgdW4kU29ydChhcnJheSwgZnVuY3Rpb24gKGEsIGIpIHsKCSAgICByZXR1cm4gKGEgLyA0IHwgMCkgLSAoYiAvIDQgfCAwKTsKCSAgfSk7CgoJICBmb3IgKGluZGV4ID0gMDsgaW5kZXggPCA1MTY7IGluZGV4KyspIHsKCSAgICBpZiAoYXJyYXlbaW5kZXhdICE9PSBleHBlY3RlZFtpbmRleF0pIHJldHVybiB0cnVlOwoJICB9Cgl9KTsKCgl2YXIgZ2V0U29ydENvbXBhcmUgPSBmdW5jdGlvbiAoY29tcGFyZWZuKSB7CgkgIHJldHVybiBmdW5jdGlvbiAoeCwgeSkgewoJICAgIGlmIChjb21wYXJlZm4gIT09IHVuZGVmaW5lZCkgcmV0dXJuICtjb21wYXJlZm4oeCwgeSkgfHwgMDsKCSAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tc2VsZi1jb21wYXJlIC0tIE5hTiBjaGVjawoJICAgIGlmICh5ICE9PSB5KSByZXR1cm4gLTE7CgkgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXNlbGYtY29tcGFyZSAtLSBOYU4gY2hlY2sKCSAgICBpZiAoeCAhPT0geCkgcmV0dXJuIDE7CgkgICAgaWYgKHggPT09IDAgJiYgeSA9PT0gMCkgcmV0dXJuIDEgLyB4ID4gMCAmJiAxIC8geSA8IDAgPyAxIDogLTE7CgkgICAgcmV0dXJuIHggPiB5OwoJICB9OwoJfTsKCgkvLyBgJVR5cGVkQXJyYXklLnByb3RvdHlwZS5zb3J0YCBtZXRob2QKCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtJXR5cGVkYXJyYXklLnByb3RvdHlwZS5zb3J0CglleHBvcnRUeXBlZEFycmF5TWV0aG9kJDYoJ3NvcnQnLCBmdW5jdGlvbiBzb3J0KGNvbXBhcmVmbikgewoJICBpZiAoY29tcGFyZWZuICE9PSB1bmRlZmluZWQpIGFDYWxsYWJsZSQxKGNvbXBhcmVmbik7CgkgIGlmIChTVEFCTEVfU09SVCkgcmV0dXJuIHVuJFNvcnQodGhpcywgY29tcGFyZWZuKTsKCgkgIHJldHVybiBpbnRlcm5hbFNvcnQoYVR5cGVkQXJyYXkkNSh0aGlzKSwgZ2V0U29ydENvbXBhcmUoY29tcGFyZWZuKSk7Cgl9LCAhU1RBQkxFX1NPUlQgfHwgQUNDRVBUX0lOQ09SUkVDVF9BUkdVTUVOVFMpOwoKCXZhciBBcnJheUJ1ZmZlclZpZXdDb3JlJDQgPSBhcnJheUJ1ZmZlclZpZXdDb3JlOwoJdmFyIHRvTGVuZ3RoID0gdG9MZW5ndGgkNTsKCXZhciB0b0Fic29sdXRlSW5kZXggPSB0b0Fic29sdXRlSW5kZXgkNTsKCXZhciB0eXBlZEFycmF5U3BlY2llc0NvbnN0cnVjdG9yID0gdHlwZWRBcnJheVNwZWNpZXNDb25zdHJ1Y3RvciQ0OwoKCXZhciBhVHlwZWRBcnJheSQ0ID0gQXJyYXlCdWZmZXJWaWV3Q29yZSQ0LmFUeXBlZEFycmF5OwoJdmFyIGV4cG9ydFR5cGVkQXJyYXlNZXRob2QkNSA9IEFycmF5QnVmZmVyVmlld0NvcmUkNC5leHBvcnRUeXBlZEFycmF5TWV0aG9kOwoKCS8vIGAlVHlwZWRBcnJheSUucHJvdG90eXBlLnN1YmFycmF5YCBtZXRob2QKCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtJXR5cGVkYXJyYXklLnByb3RvdHlwZS5zdWJhcnJheQoJZXhwb3J0VHlwZWRBcnJheU1ldGhvZCQ1KCdzdWJhcnJheScsIGZ1bmN0aW9uIHN1YmFycmF5KGJlZ2luLCBlbmQpIHsKCSAgdmFyIE8gPSBhVHlwZWRBcnJheSQ0KHRoaXMpOwoJICB2YXIgbGVuZ3RoID0gTy5sZW5ndGg7CgkgIHZhciBiZWdpbkluZGV4ID0gdG9BYnNvbHV0ZUluZGV4KGJlZ2luLCBsZW5ndGgpOwoJICB2YXIgQyA9IHR5cGVkQXJyYXlTcGVjaWVzQ29uc3RydWN0b3IoTyk7CgkgIHJldHVybiBuZXcgQygKCSAgICBPLmJ1ZmZlciwKCSAgICBPLmJ5dGVPZmZzZXQgKyBiZWdpbkluZGV4ICogTy5CWVRFU19QRVJfRUxFTUVOVCwKCSAgICB0b0xlbmd0aCgoZW5kID09PSB1bmRlZmluZWQgPyBsZW5ndGggOiB0b0Fic29sdXRlSW5kZXgoZW5kLCBsZW5ndGgpKSAtIGJlZ2luSW5kZXgpCgkgICk7Cgl9KTsKCgl2YXIgZ2xvYmFsJDMgPSBnbG9iYWwkSTsKCXZhciBhcHBseSA9IGZ1bmN0aW9uQXBwbHk7Cgl2YXIgQXJyYXlCdWZmZXJWaWV3Q29yZSQzID0gYXJyYXlCdWZmZXJWaWV3Q29yZTsKCXZhciBmYWlscyQxID0gZmFpbHMkZzsKCXZhciBhcnJheVNsaWNlID0gYXJyYXlTbGljZSQzOwoKCXZhciBJbnQ4QXJyYXkkMSA9IGdsb2JhbCQzLkludDhBcnJheTsKCXZhciBhVHlwZWRBcnJheSQzID0gQXJyYXlCdWZmZXJWaWV3Q29yZSQzLmFUeXBlZEFycmF5OwoJdmFyIGV4cG9ydFR5cGVkQXJyYXlNZXRob2QkNCA9IEFycmF5QnVmZmVyVmlld0NvcmUkMy5leHBvcnRUeXBlZEFycmF5TWV0aG9kOwoJdmFyICR0b0xvY2FsZVN0cmluZyA9IFtdLnRvTG9jYWxlU3RyaW5nOwoKCS8vIGlPUyBTYWZhcmkgNi54IGZhaWxzIGhlcmUKCXZhciBUT19MT0NBTEVfU1RSSU5HX0JVRyA9ICEhSW50OEFycmF5JDEgJiYgZmFpbHMkMShmdW5jdGlvbiAoKSB7CgkgICR0b0xvY2FsZVN0cmluZy5jYWxsKG5ldyBJbnQ4QXJyYXkkMSgxKSk7Cgl9KTsKCgl2YXIgRk9SQ0VEID0gZmFpbHMkMShmdW5jdGlvbiAoKSB7CgkgIHJldHVybiBbMSwgMl0udG9Mb2NhbGVTdHJpbmcoKSAhPSBuZXcgSW50OEFycmF5JDEoWzEsIDJdKS50b0xvY2FsZVN0cmluZygpOwoJfSkgfHwgIWZhaWxzJDEoZnVuY3Rpb24gKCkgewoJICBJbnQ4QXJyYXkkMS5wcm90b3R5cGUudG9Mb2NhbGVTdHJpbmcuY2FsbChbMSwgMl0pOwoJfSk7CgoJLy8gYCVUeXBlZEFycmF5JS5wcm90b3R5cGUudG9Mb2NhbGVTdHJpbmdgIG1ldGhvZAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy0ldHlwZWRhcnJheSUucHJvdG90eXBlLnRvbG9jYWxlc3RyaW5nCglleHBvcnRUeXBlZEFycmF5TWV0aG9kJDQoJ3RvTG9jYWxlU3RyaW5nJywgZnVuY3Rpb24gdG9Mb2NhbGVTdHJpbmcoKSB7CgkgIHJldHVybiBhcHBseSgKCSAgICAkdG9Mb2NhbGVTdHJpbmcsCgkgICAgVE9fTE9DQUxFX1NUUklOR19CVUcgPyBhcnJheVNsaWNlKGFUeXBlZEFycmF5JDModGhpcykpIDogYVR5cGVkQXJyYXkkMyh0aGlzKSwKCSAgICBhcnJheVNsaWNlKGFyZ3VtZW50cykKCSAgKTsKCX0sIEZPUkNFRCk7CgoJdmFyIGV4cG9ydFR5cGVkQXJyYXlNZXRob2QkMyA9IGFycmF5QnVmZmVyVmlld0NvcmUuZXhwb3J0VHlwZWRBcnJheU1ldGhvZDsKCXZhciBmYWlscyA9IGZhaWxzJGc7Cgl2YXIgZ2xvYmFsJDIgPSBnbG9iYWwkSTsKCXZhciB1bmN1cnJ5VGhpcyQyID0gZnVuY3Rpb25VbmN1cnJ5VGhpczsKCgl2YXIgVWludDhBcnJheSQxID0gZ2xvYmFsJDIuVWludDhBcnJheTsKCXZhciBVaW50OEFycmF5UHJvdG90eXBlID0gVWludDhBcnJheSQxICYmIFVpbnQ4QXJyYXkkMS5wcm90b3R5cGUgfHwge307Cgl2YXIgYXJyYXlUb1N0cmluZyA9IFtdLnRvU3RyaW5nOwoJdmFyIGpvaW4gPSB1bmN1cnJ5VGhpcyQyKFtdLmpvaW4pOwoKCWlmIChmYWlscyhmdW5jdGlvbiAoKSB7IGFycmF5VG9TdHJpbmcuY2FsbCh7fSk7IH0pKSB7CgkgIGFycmF5VG9TdHJpbmcgPSBmdW5jdGlvbiB0b1N0cmluZygpIHsKCSAgICByZXR1cm4gam9pbih0aGlzKTsKCSAgfTsKCX0KCgl2YXIgSVNfTk9UX0FSUkFZX01FVEhPRCA9IFVpbnQ4QXJyYXlQcm90b3R5cGUudG9TdHJpbmcgIT0gYXJyYXlUb1N0cmluZzsKCgkvLyBgJVR5cGVkQXJyYXklLnByb3RvdHlwZS50b1N0cmluZ2AgbWV0aG9kCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLSV0eXBlZGFycmF5JS5wcm90b3R5cGUudG9zdHJpbmcKCWV4cG9ydFR5cGVkQXJyYXlNZXRob2QkMygndG9TdHJpbmcnLCBhcnJheVRvU3RyaW5nLCBJU19OT1RfQVJSQVlfTUVUSE9EKTsKCgl2YXIgYmluZCA9IGZ1bmN0aW9uQmluZENvbnRleHQ7Cgl2YXIgSW5kZXhlZE9iamVjdCA9IGluZGV4ZWRPYmplY3Q7Cgl2YXIgdG9PYmplY3QkMSA9IHRvT2JqZWN0JGE7Cgl2YXIgbGVuZ3RoT2ZBcnJheUxpa2UkMSA9IGxlbmd0aE9mQXJyYXlMaWtlJGM7CgoJLy8gYEFycmF5LnByb3RvdHlwZS57IGZpbmRMYXN0LCBmaW5kTGFzdEluZGV4IH1gIG1ldGhvZHMgaW1wbGVtZW50YXRpb24KCXZhciBjcmVhdGVNZXRob2QgPSBmdW5jdGlvbiAoVFlQRSkgewoJICB2YXIgSVNfRklORF9MQVNUX0lOREVYID0gVFlQRSA9PSAxOwoJICByZXR1cm4gZnVuY3Rpb24gKCR0aGlzLCBjYWxsYmFja2ZuLCB0aGF0KSB7CgkgICAgdmFyIE8gPSB0b09iamVjdCQxKCR0aGlzKTsKCSAgICB2YXIgc2VsZiA9IEluZGV4ZWRPYmplY3QoTyk7CgkgICAgdmFyIGJvdW5kRnVuY3Rpb24gPSBiaW5kKGNhbGxiYWNrZm4sIHRoYXQpOwoJICAgIHZhciBpbmRleCA9IGxlbmd0aE9mQXJyYXlMaWtlJDEoc2VsZik7CgkgICAgdmFyIHZhbHVlLCByZXN1bHQ7CgkgICAgd2hpbGUgKGluZGV4LS0gPiAwKSB7CgkgICAgICB2YWx1ZSA9IHNlbGZbaW5kZXhdOwoJICAgICAgcmVzdWx0ID0gYm91bmRGdW5jdGlvbih2YWx1ZSwgaW5kZXgsIE8pOwoJICAgICAgaWYgKHJlc3VsdCkgc3dpdGNoIChUWVBFKSB7CgkgICAgICAgIGNhc2UgMDogcmV0dXJuIHZhbHVlOyAvLyBmaW5kTGFzdAoJICAgICAgICBjYXNlIDE6IHJldHVybiBpbmRleDsgLy8gZmluZExhc3RJbmRleAoJICAgICAgfQoJICAgIH0KCSAgICByZXR1cm4gSVNfRklORF9MQVNUX0lOREVYID8gLTEgOiB1bmRlZmluZWQ7CgkgIH07Cgl9OwoKCXZhciBhcnJheUl0ZXJhdGlvbkZyb21MYXN0ID0gewoJICAvLyBgQXJyYXkucHJvdG90eXBlLmZpbmRMYXN0YCBtZXRob2QKCSAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3RjMzkvcHJvcG9zYWwtYXJyYXktZmluZC1mcm9tLWxhc3QKCSAgZmluZExhc3Q6IGNyZWF0ZU1ldGhvZCgwKSwKCSAgLy8gYEFycmF5LnByb3RvdHlwZS5maW5kTGFzdEluZGV4YCBtZXRob2QKCSAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3RjMzkvcHJvcG9zYWwtYXJyYXktZmluZC1mcm9tLWxhc3QKCSAgZmluZExhc3RJbmRleDogY3JlYXRlTWV0aG9kKDEpCgl9OwoKCXZhciBBcnJheUJ1ZmZlclZpZXdDb3JlJDIgPSBhcnJheUJ1ZmZlclZpZXdDb3JlOwoJdmFyICRmaW5kTGFzdCA9IGFycmF5SXRlcmF0aW9uRnJvbUxhc3QuZmluZExhc3Q7CgoJdmFyIGFUeXBlZEFycmF5JDIgPSBBcnJheUJ1ZmZlclZpZXdDb3JlJDIuYVR5cGVkQXJyYXk7Cgl2YXIgZXhwb3J0VHlwZWRBcnJheU1ldGhvZCQyID0gQXJyYXlCdWZmZXJWaWV3Q29yZSQyLmV4cG9ydFR5cGVkQXJyYXlNZXRob2Q7CgoJLy8gYCVUeXBlZEFycmF5JS5wcm90b3R5cGUuZmluZExhc3RgIG1ldGhvZAoJLy8gaHR0cHM6Ly9naXRodWIuY29tL3RjMzkvcHJvcG9zYWwtYXJyYXktZmluZC1mcm9tLWxhc3QKCWV4cG9ydFR5cGVkQXJyYXlNZXRob2QkMignZmluZExhc3QnLCBmdW5jdGlvbiBmaW5kTGFzdChwcmVkaWNhdGUgLyogLCB0aGlzQXJnICovKSB7CgkgIHJldHVybiAkZmluZExhc3QoYVR5cGVkQXJyYXkkMih0aGlzKSwgcHJlZGljYXRlLCBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZCk7Cgl9KTsKCgl2YXIgQXJyYXlCdWZmZXJWaWV3Q29yZSQxID0gYXJyYXlCdWZmZXJWaWV3Q29yZTsKCXZhciAkZmluZExhc3RJbmRleCA9IGFycmF5SXRlcmF0aW9uRnJvbUxhc3QuZmluZExhc3RJbmRleDsKCgl2YXIgYVR5cGVkQXJyYXkkMSA9IEFycmF5QnVmZmVyVmlld0NvcmUkMS5hVHlwZWRBcnJheTsKCXZhciBleHBvcnRUeXBlZEFycmF5TWV0aG9kJDEgPSBBcnJheUJ1ZmZlclZpZXdDb3JlJDEuZXhwb3J0VHlwZWRBcnJheU1ldGhvZDsKCgkvLyBgJVR5cGVkQXJyYXklLnByb3RvdHlwZS5maW5kTGFzdEluZGV4YCBtZXRob2QKCS8vIGh0dHBzOi8vZ2l0aHViLmNvbS90YzM5L3Byb3Bvc2FsLWFycmF5LWZpbmQtZnJvbS1sYXN0CglleHBvcnRUeXBlZEFycmF5TWV0aG9kJDEoJ2ZpbmRMYXN0SW5kZXgnLCBmdW5jdGlvbiBmaW5kTGFzdEluZGV4KHByZWRpY2F0ZSAvKiAsIHRoaXNBcmcgKi8pIHsKCSAgcmV0dXJuICRmaW5kTGFzdEluZGV4KGFUeXBlZEFycmF5JDEodGhpcyksIHByZWRpY2F0ZSwgYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQpOwoJfSk7CgoJdmFyIGdldEJ1aWx0SW4gPSBnZXRCdWlsdEluJDc7Cgl2YXIgdW5jdXJyeVRoaXMkMSA9IGZ1bmN0aW9uVW5jdXJyeVRoaXM7Cgl2YXIgYUNhbGxhYmxlID0gYUNhbGxhYmxlJDY7Cgl2YXIgbGVuZ3RoT2ZBcnJheUxpa2UgPSBsZW5ndGhPZkFycmF5TGlrZSRjOwoJdmFyIHRvT2JqZWN0ID0gdG9PYmplY3QkYTsKCXZhciBhcnJheVNwZWNpZXNDcmVhdGUgPSBhcnJheVNwZWNpZXNDcmVhdGUkMjsKCgl2YXIgTWFwID0gZ2V0QnVpbHRJbignTWFwJyk7Cgl2YXIgTWFwUHJvdG90eXBlID0gTWFwLnByb3RvdHlwZTsKCXZhciBtYXBGb3JFYWNoID0gdW5jdXJyeVRoaXMkMShNYXBQcm90b3R5cGUuZm9yRWFjaCk7Cgl2YXIgbWFwSGFzID0gdW5jdXJyeVRoaXMkMShNYXBQcm90b3R5cGUuaGFzKTsKCXZhciBtYXBTZXQgPSB1bmN1cnJ5VGhpcyQxKE1hcFByb3RvdHlwZS5zZXQpOwoJdmFyIHB1c2ggPSB1bmN1cnJ5VGhpcyQxKFtdLnB1c2gpOwoKCS8vIGBBcnJheS5wcm90b3R5cGUudW5pcXVlQnlgIG1ldGhvZAoJLy8gaHR0cHM6Ly9naXRodWIuY29tL3RjMzkvcHJvcG9zYWwtYXJyYXktdW5pcXVlCgl2YXIgYXJyYXlVbmlxdWVCeSQxID0gZnVuY3Rpb24gdW5pcXVlQnkocmVzb2x2ZXIpIHsKCSAgdmFyIHRoYXQgPSB0b09iamVjdCh0aGlzKTsKCSAgdmFyIGxlbmd0aCA9IGxlbmd0aE9mQXJyYXlMaWtlKHRoYXQpOwoJICB2YXIgcmVzdWx0ID0gYXJyYXlTcGVjaWVzQ3JlYXRlKHRoYXQsIDApOwoJICB2YXIgbWFwID0gbmV3IE1hcCgpOwoJICB2YXIgcmVzb2x2ZXJGdW5jdGlvbiA9IHJlc29sdmVyICE9IG51bGwgPyBhQ2FsbGFibGUocmVzb2x2ZXIpIDogZnVuY3Rpb24gKHZhbHVlKSB7CgkgICAgcmV0dXJuIHZhbHVlOwoJICB9OwoJICB2YXIgaW5kZXgsIGl0ZW0sIGtleTsKCSAgZm9yIChpbmRleCA9IDA7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrKSB7CgkgICAgaXRlbSA9IHRoYXRbaW5kZXhdOwoJICAgIGtleSA9IHJlc29sdmVyRnVuY3Rpb24oaXRlbSk7CgkgICAgaWYgKCFtYXBIYXMobWFwLCBrZXkpKSBtYXBTZXQobWFwLCBrZXksIGl0ZW0pOwoJICB9CgkgIG1hcEZvckVhY2gobWFwLCBmdW5jdGlvbiAodmFsdWUpIHsKCSAgICBwdXNoKHJlc3VsdCwgdmFsdWUpOwoJICB9KTsKCSAgcmV0dXJuIHJlc3VsdDsKCX07CgoJdmFyIHVuY3VycnlUaGlzID0gZnVuY3Rpb25VbmN1cnJ5VGhpczsKCXZhciBBcnJheUJ1ZmZlclZpZXdDb3JlID0gYXJyYXlCdWZmZXJWaWV3Q29yZTsKCXZhciAkYXJyYXlVbmlxdWVCeSA9IGFycmF5VW5pcXVlQnkkMTsKCXZhciBmcm9tU3BlY2llc0FuZExpc3QgPSB0eXBlZEFycmF5RnJvbVNwZWNpZXNBbmRMaXN0OwoKCXZhciBhVHlwZWRBcnJheSA9IEFycmF5QnVmZmVyVmlld0NvcmUuYVR5cGVkQXJyYXk7Cgl2YXIgZXhwb3J0VHlwZWRBcnJheU1ldGhvZCA9IEFycmF5QnVmZmVyVmlld0NvcmUuZXhwb3J0VHlwZWRBcnJheU1ldGhvZDsKCXZhciBhcnJheVVuaXF1ZUJ5ID0gdW5jdXJyeVRoaXMoJGFycmF5VW5pcXVlQnkpOwoKCS8vIGAlVHlwZWRBcnJheSUucHJvdG90eXBlLnVuaXF1ZUJ5YCBtZXRob2QKCS8vIGh0dHBzOi8vZ2l0aHViLmNvbS90YzM5L3Byb3Bvc2FsLWFycmF5LXVuaXF1ZQoJZXhwb3J0VHlwZWRBcnJheU1ldGhvZCgndW5pcXVlQnknLCBmdW5jdGlvbiB1bmlxdWVCeShyZXNvbHZlcikgewoJICByZXR1cm4gZnJvbVNwZWNpZXNBbmRMaXN0KHRoaXMsIGFycmF5VW5pcXVlQnkoYVR5cGVkQXJyYXkodGhpcyksIHJlc29sdmVyKSk7Cgl9KTsKCgl2YXIgY3JlYXRlVHlwZWRBcnJheUNvbnN0cnVjdG9yJDMgPSB0eXBlZEFycmF5Q29uc3RydWN0b3IuZXhwb3J0czsKCgkvLyBgSW50MTZBcnJheWAgY29uc3RydWN0b3IKCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtdHlwZWRhcnJheS1vYmplY3RzCgljcmVhdGVUeXBlZEFycmF5Q29uc3RydWN0b3IkMygnSW50MTYnLCBmdW5jdGlvbiAoaW5pdCkgewoJICByZXR1cm4gZnVuY3Rpb24gSW50MTZBcnJheShkYXRhLCBieXRlT2Zmc2V0LCBsZW5ndGgpIHsKCSAgICByZXR1cm4gaW5pdCh0aGlzLCBkYXRhLCBieXRlT2Zmc2V0LCBsZW5ndGgpOwoJICB9OwoJfSk7CgoJdmFyIGNyZWF0ZVR5cGVkQXJyYXlDb25zdHJ1Y3RvciQyID0gdHlwZWRBcnJheUNvbnN0cnVjdG9yLmV4cG9ydHM7CgoJLy8gYEludDMyQXJyYXlgIGNvbnN0cnVjdG9yCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLXR5cGVkYXJyYXktb2JqZWN0cwoJY3JlYXRlVHlwZWRBcnJheUNvbnN0cnVjdG9yJDIoJ0ludDMyJywgZnVuY3Rpb24gKGluaXQpIHsKCSAgcmV0dXJuIGZ1bmN0aW9uIEludDMyQXJyYXkoZGF0YSwgYnl0ZU9mZnNldCwgbGVuZ3RoKSB7CgkgICAgcmV0dXJuIGluaXQodGhpcywgZGF0YSwgYnl0ZU9mZnNldCwgbGVuZ3RoKTsKCSAgfTsKCX0pOwoKCXZhciBjcmVhdGVUeXBlZEFycmF5Q29uc3RydWN0b3IkMSA9IHR5cGVkQXJyYXlDb25zdHJ1Y3Rvci5leHBvcnRzOwoKCS8vIGBGbG9hdDMyQXJyYXlgIGNvbnN0cnVjdG9yCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLXR5cGVkYXJyYXktb2JqZWN0cwoJY3JlYXRlVHlwZWRBcnJheUNvbnN0cnVjdG9yJDEoJ0Zsb2F0MzInLCBmdW5jdGlvbiAoaW5pdCkgewoJICByZXR1cm4gZnVuY3Rpb24gRmxvYXQzMkFycmF5KGRhdGEsIGJ5dGVPZmZzZXQsIGxlbmd0aCkgewoJICAgIHJldHVybiBpbml0KHRoaXMsIGRhdGEsIGJ5dGVPZmZzZXQsIGxlbmd0aCk7CgkgIH07Cgl9KTsKCgl2YXIgJCA9IF9leHBvcnQ7Cgl2YXIgZ2xvYmFsJDEgPSBnbG9iYWwkSTsKCXZhciBhcnJheUJ1ZmZlck1vZHVsZSA9IGFycmF5QnVmZmVyOwoJdmFyIHNldFNwZWNpZXMgPSBzZXRTcGVjaWVzJDI7CgoJdmFyIEFSUkFZX0JVRkZFUiA9ICdBcnJheUJ1ZmZlcic7Cgl2YXIgQXJyYXlCdWZmZXIkMSA9IGFycmF5QnVmZmVyTW9kdWxlW0FSUkFZX0JVRkZFUl07Cgl2YXIgTmF0aXZlQXJyYXlCdWZmZXIgPSBnbG9iYWwkMVtBUlJBWV9CVUZGRVJdOwoKCS8vIGBBcnJheUJ1ZmZlcmAgY29uc3RydWN0b3IKCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtYXJyYXlidWZmZXItY29uc3RydWN0b3IKCSQoeyBnbG9iYWw6IHRydWUsIGZvcmNlZDogTmF0aXZlQXJyYXlCdWZmZXIgIT09IEFycmF5QnVmZmVyJDEgfSwgewoJICBBcnJheUJ1ZmZlcjogQXJyYXlCdWZmZXIkMQoJfSk7CgoJc2V0U3BlY2llcyhBUlJBWV9CVUZGRVIpOwoKCXZhciBjcmVhdGVUeXBlZEFycmF5Q29uc3RydWN0b3IgPSB0eXBlZEFycmF5Q29uc3RydWN0b3IuZXhwb3J0czsKCgkvLyBgVWludDhBcnJheWAgY29uc3RydWN0b3IKCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtdHlwZWRhcnJheS1vYmplY3RzCgljcmVhdGVUeXBlZEFycmF5Q29uc3RydWN0b3IoJ1VpbnQ4JywgZnVuY3Rpb24gKGluaXQpIHsKCSAgcmV0dXJuIGZ1bmN0aW9uIFVpbnQ4QXJyYXkoZGF0YSwgYnl0ZU9mZnNldCwgbGVuZ3RoKSB7CgkgICAgcmV0dXJuIGluaXQodGhpcywgZGF0YSwgYnl0ZU9mZnNldCwgbGVuZ3RoKTsKCSAgfTsKCX0pOwoKCWZ1bmN0aW9uIGdldENvbnZlcnRWYWx1ZShpbnB1dENvZGVjKSB7CgkgIC8vIOagueaNruS8oOWFpeeahOebruagh+e8lueggeS9jeaVsAoJICAvLyDpgInlrprovazmjaLmlbDmja7miYDpnIDopoHnmoTln7rmnKzlgLwKCSAgdmFyIGlucHV0Q29kZWNzID0gewoJICAgICdJbnQ4JzogMTI4LAoJICAgICdJbnQxNic6IDMyNzY4LAoJICAgICdJbnQzMic6IDIxNDc0ODM2NDgsCgkgICAgJ0Zsb2F0MzInOiAxCgkgIH07CgoJICBpZiAoIWlucHV0Q29kZWNzW2lucHV0Q29kZWNdKSB7CgkgICAgdGhyb3cgbmV3IEVycm9yKCd3cm9uZyBjb2RlYy5wbGVhc2UgaW5wdXQgb25lIG9mIHRoZXNlIGNvZGVjczpJbnQ4LEludDE2LEludDMyLEZsb2F0MzInKTsKCSAgfQoKCSAgcmV0dXJuIGlucHV0Q29kZWNzW2lucHV0Q29kZWNdOwoJfQoJLyoqCgkgKiDmoLnmja7kvKDlhaXnmoTnm67moIfnvJbnoIHkvY3mlbAKCSAqIOmAieWumuWJjeerr+eahOaJgOmcgOimgeeahOS/neWtmOeahOS6jOi/m+WItuaVsOaNruagvOW8jwoJICog5a6M5pW0VHlwZWRBcnJheeivt+eci+aWh+ahowoJICogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvVHlwZWRBcnJheQoJICogQHBhcmFtIHtzdHJpbmd9IGlucHV0Q29kZWMKCSAqLwoKCglmdW5jdGlvbiBnZXRUeXBlZEFycmF5KGlucHV0Q29kZWMpIHsKCSAgdmFyIHR5cGVkQXJyYXlzID0gewoJICAgICdJbnQ4JzogSW50OEFycmF5LAoJICAgICdJbnQxNic6IEludDE2QXJyYXksCgkgICAgJ0ludDMyJzogSW50MzJBcnJheSwKCSAgICAnRmxvYXQzMic6IEZsb2F0MzJBcnJheQoJICB9OwoKCSAgaWYgKCF0eXBlZEFycmF5c1tpbnB1dENvZGVjXSkgewoJICAgIHRocm93IG5ldyBFcnJvcignd3JvbmcgY29kZWMucGxlYXNlIGlucHV0IG9uZSBvZiB0aGVzZSBjb2RlY3M6SW50OCxJbnQxNixJbnQzMixGbG9hdDMyJyk7CgkgIH0KCgkgIHJldHVybiB0eXBlZEFycmF5c1tpbnB1dENvZGVjXTsKCX0KCS8qKgoJICogIOWwhuaVsOaNrui9rOaNouS4uuWPr+iiq+aSreaUvueahHBjbeaVsOaNrgoJICogQHBhcmFtIHtVaW50OEFycmF5fSBkYXRhIOmfs+mikeaVsOaNrgoJICogQHBhcmFtIHtzdHJpbmd9IGlucHV0Q29kZWMg5oyH5a6a57yW56CB5L2N5pWwCgkgKi8KCgoJZnVuY3Rpb24gZ2V0Rm9ybWF0ZWRWYWx1ZShkYXRhLCBpbnB1dENvZGVjKSB7CgkgIHZhciB0eXBlZEFycmF5ID0gZ2V0VHlwZWRBcnJheShpbnB1dENvZGVjKTsKCSAgdmFyIGNvbnZlcnRWYWx1ZSA9IGdldENvbnZlcnRWYWx1ZShpbnB1dENvZGVjKTsKCgkgIGlmIChkYXRhLmNvbnN0cnVjdG9yID09IEFycmF5QnVmZmVyKSB7CgkgICAgZGF0YSA9IG5ldyB0eXBlZEFycmF5KGRhdGEpOwoJICB9IGVsc2UgewoJICAgIGRhdGEgPSBuZXcgdHlwZWRBcnJheShkYXRhLmJ1ZmZlcik7CgkgIH0KCgkgIHZhciBmbG9hdDMyID0gbmV3IEZsb2F0MzJBcnJheShkYXRhLmxlbmd0aCk7CgoJICBmb3IgKHZhciBpID0gNDQ7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7CgkgICAgLy8gYnVmZmVyIOe8k+WGsuWMuueahOaVsOaNru+8jOmcgOimgeaYr0lFRUU3NTQg6YeMMzLkvY3nmoTnur/mgKdQQ03vvIzojIPlm7Tku44tMeWIsCsxCgkgICAgLy8g5omA5Lul5a+55pWw5o2u6L+b6KGM6Zmk5rOVCgkgICAgLy8g6Zmk5Lul5a+55bqU55qE5L2N5pWw6IyD5Zu077yM5b6X5YiwLTHliLArMeeahOaVsOaNrgoJICAgIC8vIGZsb2F0MzJbaV0gPSBkYXRhW2ldIC8gMHg4MDAwOwoJICAgIGZsb2F0MzJbaV0gPSBkYXRhW2ldIC8gY29udmVydFZhbHVlOwoJICB9CgoJICByZXR1cm4gZmxvYXQzMjsKCX0KCS8qKgoJICog5bCG5Y6f5aeL6Z+z6aKR5pWw5o2u6L2s5o2i5Li6YXJyYXlCdWZmZXLmlbDmja7vvIzkuLrkuIvkuIDmraXlpITnkIblgZrlh4blpIcKCSAqIEBwYXJhbSB7c3RyaW5nfSBiYXNlNjREYXRhIGJhc2U2NOWMlueahOmfs+mikeaVsOaNrgoJICovCgoKCWZ1bmN0aW9uIGJhc2U2NFRvQXJyYXlCdWZmZXIoYmFzZTY0RGF0YSkgewoJICAvLyBjb25zdCBwYWRkaW5nID0gIj0iLnJlcGVhdCgoNCAtIGJhc2U2NERhdGEubGVuZ3RoICUgNCklNCk7CgkgIC8vIGNvbnN0IGJhc2U2NCA9IChiYXNlNjREYXRhICsgcGFkZGluZykucmVwbGFjZSgvLS9nLCAnKycpLnJlcGxhY2UoL18vZywgJy8nKTsKCSAgdmFyIHJhd0RhdGEgPSBhdG9iKGJhc2U2NERhdGEpOwoJICB2YXIgb3V0cHV0QXJyYXkgPSBuZXcgVWludDhBcnJheShyYXdEYXRhLmxlbmd0aCk7IC8vIOWPr+S7peWKoOS4quWIpOaWrWJhc2U2NERhdGHkuK3mmK/lkKbmnIl3YXblpLTvvIzmnaXlhrPlrpppID0gMCDov5jmmK8gNDTvvIzov5nph4zkuI3lgZrliKTmlq3lpITnkIYKCgkgIGZvciAodmFyIGkgPSA0NDsgaSA8IHJhd0RhdGEubGVuZ3RoOyArK2kpIHsKCSAgICBvdXRwdXRBcnJheVtpXSA9IHJhd0RhdGEuY2hhckNvZGVBdChpKTsKCSAgfQoKCSAgcmV0dXJuIG91dHB1dEFycmF5OwoJfQoKCW9ubWVzc2FnZSA9IGZ1bmN0aW9uIG9ubWVzc2FnZShlKSB7CgkgIHZhciB0eXBlID0gZS5kYXRhLnR5cGU7CgoJICBzd2l0Y2ggKHR5cGUpIHsKCSAgICBjYXNlICJnZXRGb3JtYXRlZFZhbHVlIjoKCSAgICAgIHsKCSAgICAgICAgdmFyIF9lJGRhdGEgPSBlLmRhdGEsCgkgICAgICAgICAgICBpbnB1dENvZGVjID0gX2UkZGF0YS5pbnB1dENvZGVjLAoJICAgICAgICAgICAgdGltZU9iaiA9IF9lJGRhdGEudGltZU9iajsKCSAgICAgICAgdmFyIGRhdGEgPSBiYXNlNjRUb0FycmF5QnVmZmVyKGUuZGF0YS5kYXRhKTsKCSAgICAgICAgdmFyIGZkYXRhID0gZ2V0Rm9ybWF0ZWRWYWx1ZShkYXRhLCBpbnB1dENvZGVjKTsgLy8g5paw5bu65LiA5LiqRmxvYXQzMkFycmF555qE56m66Ze0CgoJICAgICAgICB2YXIgdG1wID0gbmV3IEZsb2F0MzJBcnJheShmZGF0YS5sZW5ndGgpOwoJICAgICAgICB0bXAuc2V0KGZkYXRhLCAwKTsgLy8g5bCG5paw55qE5a6M5pW0YnVmZuaVsOaNrui1i+WAvOe7mXNhbXBsZXMKCSAgICAgICAgLy8gaWYgKGUuZGF0YS5pc0xhc3RlZCkgewoJICAgICAgICAvLyAgICAgc3Rhc2hGdWxsRGF0YSA9IG51bGw7CgkgICAgICAgIC8vIH0gZWxzZSB7CgkgICAgICAgIC8vICAgICBzdGFzaEZ1bGxEYXRhID0gdG1wLmJ1ZmZlci5zbGljZSgpOwoJICAgICAgICAvLyB9CgoJICAgICAgICBwb3N0TWVzc2FnZSh7CgkgICAgICAgICAgdHlwZTogJ3NldEZvcm1hdGVkVmFsdWUnLAoJICAgICAgICAgIGRhdGE6IHRtcC5idWZmZXIsCgkgICAgICAgICAgdGltZU9iajogdGltZU9iaiwKCSAgICAgICAgICBpc0xhc3RlZDogZS5kYXRhLmlzTGFzdGVkCgkgICAgICAgIH0sIFt0bXAuYnVmZmVyXSk7CgkgICAgICAgIGJyZWFrOwoJICAgICAgfQoJICB9Cgl9OwoKfSkoKTsKCg==",null,!1),rN=co,aN=eZ,lN=io,cN=He,gN=ti,dN=function(t,e,n,i){try{return i?e(rN(n)[0],n[1]):e(n)}catch(e){aN(t,"throw",e)}},hN=Ty,mN=Zl,IN=Ko,uN=py,CN=jy,bN=Ly,pN=Ze.Array,yN=function(t){var e=gN(t),n=mN(this),i=arguments.length,o=i>1?arguments[1]:void 0,s=void 0!==o;s&&(o=lN(o,i>2?arguments[2]:void 0));var r,a,l,c,g,d,h=bN(e),m=0;if(!h||this==pN&&hN(h))for(r=IN(e),a=n?new this(r):pN(r);r>m;m++)d=s?o(e[m],m):e[m],uN(a,m,d);else for(g=(c=CN(e,h)).next,a=n?new this:[];!(l=cN(g,c)).done;m++)d=s?dN(c,o,[l.value,m],!0):l.value,uN(a,m,d);return a.length=m,a};Ao({target:"Array",stat:!0,forced:!iJ((function(t){Array.from(t)}))},{from:yN});var ZN=ln.Array.from;function JN(t){return"function"==typeof t}function GN(){}function VN(t,e){var n,i;void 0===t&&(t=GN),void 0===e&&(e=300);var o=this;return function(){var s=ZN(arguments),r=performance.now();n&&n+e>=r?0===e?(cancelAnimationFrame(i),i=requestAnimationFrame((function(){n=performance.now(),t.apply(o,s)}))):(clearTimeout(i),i=dB((function(){n=performance.now(),t.apply(o,s)}),e)):(n=r,t.apply(o,s))}}var SN=new sN,BN=null,XN=function(){function t(){this.audioDataTimeList=[],this.activeTimeRange={},this.bufferSource=null,this.buffer=null,this.hadFinishFeedData=!1,this.completed=!1,this.feedTimes=0,this.startPosition=0,this.lastTime=0,this.playedTime=0,this.allDuration=0,this.playState=!1,this.bindedHandleEnded=this.handleEnded.bind(this),this.retryReplayTimes=0,this.needContinueReplay=-1,this.audioTagPlaying=null}t.isTypedArray=function(t){return t.byteLength&&t.buffer&&t.buffer.constructor==ArrayBuffer||t.constructor==ArrayBuffer};var e=t.prototype;return e.isSupported=function(e){if(!t.isTypedArray(e))throw new Error("\u8bf7\u4f20\u5165ArrayBuffer\u6216\u8005\u4efb\u610fTypedArray");return!0},e.init=function(t){var e=this;if(!this.ac){var n={inputCodec:"Int16",channels:1,sampleRate:16e3,flushTime:1e3,handlePlaying:GN,handleFinished:GN};this.option=Zs({},n,t),this.initAudioContext(),this.initAudioTag(),this.sortAudioDataTimeList=VN((function(){var t;QS(t=e.audioDataTimeList).call(t,(function(t,e){return t.beginTime-e.beginTime}))}),500)}},e.initAudioTag=function(){var t=new Audio;t.setAttribute("loop",!0),t.volume=.1,this.audioTag=t,t.crossOrigin="anonymous"},e.initAudioContext=function(){var t=lS(gS.mark((function t(){return gS.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:BN||(BN=new(window.AudioContext||window.webkitAudioContext)),this.ac=BN,this.playStartTime=this.ac.currentTime,this.createVolumeNode();case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),e.createVolumeNode=function(){if(this.gainNode)return this.gainNode;this.gainNode=this.ac.createGain(),this.gainNode.gain.value=1,this.gainNode.connect(this.ac.destination)},e.createProcessNode=function(){var t=lS(gS.mark((function t(){var e,n;return gS.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.ac,!this.processorNode){t.next=3;break}return t.abrupt("return");case 3:n=e.createScriptProcessor(256),this.processorNode=n,this.processorNode.connect(this.gainNode);case 6:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),e.getCurrentTime=function(){return this.startPosition+this.getPlayedTime()},e.getPlayedTime=function(){return this.ac.currentTime-this.lastTime},e.addAudioProcess=function(){var t=this;this.processorNode&&(this.processorNode.onaudioprocess=function(){t.option.handlePlaying(t.getCurrentTime())})},e.removeAudioProcess=function(){this.processorNode&&(this.processorNode.onaudioprocess=null)},e.preprocessAudioData=function(t){var e=t.data,n=t.timeObj,i=n.beginTime,o=n.endTime,s=this.audioDataTimeList,r=this.createBuffer(new Float32Array(e)),a=0===s.length?r.duration:s[s.length-1].duration+r.duration;s.push({audioBuffer:r,duration:a,beginTime:i,endTime:o}),this.needContinueReplay>-1&&(this.handleReplay(this.needContinueReplay),this.needContinueReplay=-1),this.hadFinishFeedData&&this.feedTimes===s.length&&this.sortAudioDataTimeList()},e.buildAudioData=function(t){void 0===t&&(t=0);var e=this.audioDataTimeList,n=eB(e).call(e,(function(e){return t>=e.beginTime&&e.endTime>=t})),i=e[n];i&&(this.activeTimeRange={index:n,beginTime:i.beginTime,endTime:i.endTime},this.buffer=i.audioBuffer)},e.feed=function(t,e,n){var i=this;return new nB((function(o){i.feedTimes++,SN.onmessage=function(t){"setFormatedValue"===t.data.type&&(i.preprocessAudioData(t.data),0===t.data.timeObj.beginTime&&i.buildAudioData(0),i.hadFinishFeedData=t.data.isLasted,o())},SN.postMessage({type:"getFormatedValue",data:t,timeObj:e,isLasted:n,inputCodec:i.option.inputCodec})}))},e.createBuffer=function(t){for(var e=this.option,n=e.channels,i=e.sampleRate,o=i<22050?Math.ceil(32e3/i):1,s=t.length/n,r=this.ac.createBuffer(n,s*o,i*o),a=0;a<n;a++)for(var l=r.getChannelData(a),c=0;c<s;c++)for(var g=a+c*n,d=0;d<o;d++)l[c*o+d]=t[g]+((t[g+o-1]||0)-t[g])/o*d;return r},e.start=function(t){void 0===t&&(t=0),this.completed&&this.addAudioProcess(),this.completed=!1,this.buffer&&(this.bufferSource=this.ac.createBufferSource(),this.bufferSource.buffer=this.buffer,this.bufferSource.addEventListener("ended",this.bindedHandleEnded),this.bufferSource.disconnect(),this.bufferSource.connect(this.gainNode),this.bufferSource.start(0,t),"suspended"===this.ac.state&&this.ac.resume&&this.ac.resume())},e.handleEnded=function(){var t=this.audioDataTimeList,e=this.activeTimeRange;if(this.startPosition=t[e.index].duration,e.index<t.length-1){var n=t[e.index+1];this.activeTimeRange={index:e.index+1,beginTime:n.beginTime,endTime:n.endTime},this.buffer=n.audioBuffer,this.start(0),this.lastTime=this.ac.currentTime}else this.hadFinishFeedData?(this.completed=!0,this.removeAudioProcess(),this.option.handleFinished(this.startPosition),this.audioTag.pause()):e.index===t.length-1&&(this.needContinueReplay=this.startPosition)},e.seekTo=function(){var t=lS(gS.mark((function t(e){return gS.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.stop(),this.bufferSource.removeEventListener("ended",this.bindedHandleEnded),this.buildAudioData(e),t.next=5,this.start(e-this.activeTimeRange.beginTime);case 5:this.startPosition=e,this.lastTime=this.ac.currentTime;case 7:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),e.handleReplay=function(){var t=lS(gS.mark((function t(e){var n,i=this;return gS.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.audioDataTimeList,!this.hadFinishFeedData){t.next=12;break}if(this.retryReplayTimes=0,n.length&&!(e>=n[n.length-1].duration)){t.next=9;break}return this.startPosition=n.length?n[n.length-1].duration:0,this.completed=!0,this.removeAudioProcess(),this.option.handleFinished(this.startPosition),t.abrupt("return");case 9:this.seekTo(e),t.next=13;break;case 12:n.length&&e<n[n.length-1].duration?(this.retryReplayTimes=0,this.seekTo(e)):this.retryReplayTimes>2?this.retryReplayTimes=0:(this.retryReplayTimes++,dB((function(){i.handleReplay(e)}),500));case 13:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),e.stop=function(){this.bufferSource.stop(0),this.audioTag.pause()},e.play=function(){this.audioTagPlaying=this.audioTag.play(),this.start(0),this.addAudioProcess(),this.startPosition=0,this.lastTime=this.ac.currentTime},e.pause=function(){var t=lS(gS.mark((function t(){return gS.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.ac.suspend();case 2:this.audioTag.pause();case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),e.continue=function(){var t=lS(gS.mark((function t(){return gS.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.audioTag.play(),t.next=3,this.ac.resume();case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),e.destroy=function(){var t=this;this.stop(),this.bufferSource=null,this.buffer=null,this.removeAudioProcess(),this.audioTagPlaying&&this.audioTagPlaying.then((function(){t.audioTag.pause()})),this.ac=null},t}(),vN=Ao,fN=zo.indexOf,RN=Nl,WN=We([].indexOf),AN=!!WN&&1/WN([1],1,-0)<0,wN=RN("indexOf");vN({target:"Array",proto:!0,forced:AN||!wN},{indexOf:function(t){var e=arguments.length>1?arguments[1]:void 0;return AN?WN(this,t,e)||0:fN(this,t,e)}});var YN=Kl("Array").indexOf,kN=In,FN=YN,HN=Array.prototype,xN=function(t){var e=t.indexOf;return t===HN||kN(HN,t)&&e===HN.indexOf?FN:e},NN=Ye,TN=Gn,MN=yi("species"),UN=function(t){return TN>=51||!NN((function(){var e=[];return(e.constructor={})[MN]=function(){return{foo:1}},1!==e[t](Boolean).foo}))},KN=Ao,EN=Ze,LN=No,DN=ko,QN=Ko,zN=ti,PN=fl,_N=py,ON=UN("splice"),jN=EN.TypeError,qN=Math.max,$N=Math.min,tT=9007199254740991,eT="Maximum allowed length exceeded";KN({target:"Array",proto:!0,forced:!ON},{splice:function(t,e){var n,i,o,s,r,a,l=zN(this),c=QN(l),g=LN(t,c),d=arguments.length;if(0===d?n=i=0:1===d?(n=0,i=c-g):(n=d-2,i=$N(qN(DN(e),0),c-g)),c+n-i>tT)throw jN(eT);for(o=PN(l,i),s=0;s<i;s++)(r=g+s)in l&&_N(o,s,l[r]);if(o.length=i,n<i){for(s=g;s<c-i;s++)a=s+n,(r=s+i)in l?l[a]=l[r]:delete l[a];for(s=c;s>c-i+n;s--)delete l[s-1]}else if(n>i)for(s=c-i;s>g;s--)a=s+n-1,(r=s+i-1)in l?l[a]=l[r]:delete l[a];for(s=0;s<n;s++)l[s+g]=arguments[s+2];return l.length=c-i+n,o}});var nT=Kl("Array").splice,iT=In,oT=nT,sT=Array.prototype,rT=function(t){var e=t.splice;return t===sT||iT(sT,t)&&e===sT.splice?oT:e},aT=Hl.map;Ao({target:"Array",proto:!0,forced:!UN("map")},{map:function(t){return aT(this,t,arguments.length>1?arguments[1]:void 0)}});var lT=Kl("Array").map,cT=In,gT=lT,dT=Array.prototype,hT=function(t){var e=t.map;return t===dT||cT(dT,t)&&e===dT.map?gT:e},mT="1",IT="__opening_speech",uT="UNKNOWN",CT={x:0,y:1.1,z:2.2},bT={x:0,y:.7,z:0},pT={x:0,y:1,z:1.8},yT={x:0,y:.66,z:0},ZT={INIT:{name:"INIT"},IDLE:{name:"IDLE",action:mT},LISTEN:{name:"LISTEN",action:"8"},THINKING:{name:"THINKING",action:"23"},BROADCAST:{name:"BROADCAST"},TEST:{name:"TEST"},NONE:{name:"NONE",action:mT},AROUND:{name:"AROUND",action:"2"},SMILE:{name:"SMILE",action:"1"},HAPPY:{name:"HAPPY",action:"59"},CROUCH:{name:"CROUCH",action:"58"}},JT=["face.A","face.I","face.U","face.E","face.O","face.Closeyes"],GT={happy:"face.happy",sad:"face.sad",smile:"face.smile",surprise:"face.surprise",worry:"face.worry"},VT=function(){function t(){this._Init()}var e=t.prototype;return e._Init=function(){var t=this;this._keys={actionToTest:null,toolBarVisible:!1,openingSpeech:!1,dialogueMode:uT,fetching:!1,listen:!1,thinking:!1,broadcast:!1,feed:{compositeAnimation:null,taskQueue:[]}},document.addEventListener("keydown",(function(e){return t._onKeyDown(e)}),!1),document.addEventListener("keyup",(function(e){return t._onKeyUp(e)}),!1)},e._onKeyDown=function(t){switch(t.keyCode){case 87:this._keys.forward=!0;break;case 65:this._keys.left=!0;break;case 83:this._keys.backward=!0;break;case 68:this._keys.right=!0;break;case 32:this._keys.space=!0;break;case 16:this._keys.shift=!0;break;case 76:this._keys.listen=!0;break;case 84:this._keys.thinking=!0;break;case 66:this._keys.broadcast=!0}},e._onKeyUp=function(t){switch(t.keyCode){case 87:this._keys.forward=!1;break;case 65:this._keys.left=!1;break;case 83:this._keys.backward=!1;break;case 68:this._keys.right=!1;break;case 32:this._keys.space=!1;break;case 16:this._keys.shift=!1;break;case 76:this._keys.listen=!1;break;case 84:this._keys.thinking=!1;break;case 66:this._keys.broadcast=!1}},t}(),ST={exports:{}};Ao({target:"Object",stat:!0,forced:!ke,sham:!ke},{defineProperty:oo.f});var BT=ln.Object,XT=ST.exports=function(t,e,n){return BT.defineProperty(t,e,n)};BT.defineProperty.sham&&(XT.sham=!0);var vT=ST.exports;function fT(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),vT(t,i.key,i)}}function RT(t,e,n){return e&&fT(t.prototype,e),n&&fT(t,n),t}var WT=en,AT=pZ,wT=We("".replace),YT="[\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]",kT=RegExp("^"+YT+YT+"*"),FT=RegExp(YT+YT+"*$"),HT=function(t){return function(e){var n=AT(WT(e));return 1&t&&(n=wT(n,kT,"")),2&t&&(n=wT(n,FT,"")),n}},xT={start:HT(1),end:HT(2),trim:HT(3)},NT=Ze,TT=Ye,MT=pZ,UT=xT.trim,KT=We("".charAt),ET=NT.parseFloat,LT=NT.Symbol,DT=LT&&LT.iterator,QT=1/ET("\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff-0")!=-1/0||DT&&!TT((function(){ET(Object(DT))}))?function(t){var e=UT(MT(t)),n=ET(e);return 0===n&&"-"==KT(e,0)?-0:n}:ET;Ao({global:!0,forced:parseFloat!=QT},{parseFloat:QT});var zT=ln.parseFloat,PT=ke,_T=We,OT=os,jT=sn,qT=_T(xe.f),$T=_T([].push),tM=function(t){return function(e){for(var n,i=jT(e),o=OT(i),s=o.length,r=0,a=[];s>r;)n=o[r++],PT&&!qT(i,n)||$T(a,t?[n,i[n]]:i[n]);return a}},eM={entries:tM(!0),values:tM(!1)}.entries;Ao({target:"Object",stat:!0},{entries:function(t){return eM(t)}});var nM=ln.Object.entries,iM=function(){function t(t){var e=t.animations,n=t.speechAnimation,i=t.mouthMesh,o=t.onSubtitleChange,s=t.onBroadcastPre,r=t.onReadyTask;this._animations=e,this._speechAnimation=n,this._mouthMesh=i,this._taskQueue=[],this._compositeAnimation=null,this._onSubtitleChange=o,this._onBroadcastPre=s,this._onReadyTask=r}var e=t.prototype;return e.switchExpression=function(t,e){void 0===e&&(e=.99);var n=this._mouthMesh;if(t&&"none"!==t){t=t.toLowerCase();var i=GT[t],o=n.morphTargetDictionary[i];this.resetExpression(i),n.morphTargetInfluences[o]=zT(e)}else this.resetExpression()},e.resetExpression=function(t){void 0===t&&(t="");for(var e=0,n=nM(GT);e<n.length;e++){var i=n[e][1];if(i!==t){var o=this._mouthMesh.morphTargetDictionary[i];this._mouthMesh.morphTargetInfluences[o]=0}}},RT(t,[{key:"compositeAnimation",get:function(){return this._compositeAnimation},set:function(t){this._compositeAnimation=t}},{key:"taskQueue",get:function(){return this._taskQueue},set:function(t){this._taskQueue=t}},{key:"animations",get:function(){return this._animations}},{key:"speechAnimation",get:function(){return this._speechAnimation}}]),t}();Ao({target:"Object",stat:!0,sham:!ke},{create:fr});var oM=ln.Object,sM=function(t,e){return oM.create(t,e)};Ao({target:"Object",stat:!0},{setPrototypeOf:fa});var rM=ln.Object.setPrototypeOf;function aM(t,e){return aM=rM||function(t,e){return t.__proto__=e,t},aM(t,e)}function lM(t,e){t.prototype=sM(e.prototype),t.prototype.constructor=t,aM(t,e)}var cM=function(){function t(t){var e=t.onStateChange;this._states={},this._currentState=null,this._onStateChange=e}var e=t.prototype;return e._AddState=function(t,e){this._states[t]=e},e.SetState=function(t){var e=this._states[t];if(e){var n=this._currentState;if(console.log("SetState",t),n){if(n.name===t)return;n.Exit()}var i=new e(this);this._currentState=i,this._onStateChange&&this._onStateChange("name"),i.Enter(n)}else console.warn("no state:[",t,"], please check again!")},e.Update=function(t,e){this._currentState&&this._currentState.Update(t,e)},t}(),gM=function(){function t(t){this._parent=t}var e=t.prototype;return e.Enter=function(){},e.Exit=function(){},e.Update=function(){},t}(),dM=function(t){function e(e){return t.call(this,e)||this}lM(e,t);var n=e.prototype;return n.Enter=function(t){console.log("\u8fdb\u5165init\u72b6\u6001 prevState:",t)},n.Exit=function(){console.log("\u9000\u51fa\u521d\u59cb\u72b6\u6001")},n.Update=function(t,e){this._parent.SetState(ZT.IDLE.name)},RT(e,[{key:"Name",get:function(){return"INIT"}}]),e}(gM),hM=function(t){function e(e){return t.call(this,e)||this}lM(e,t);var n=e.prototype;return n.Enter=function(t){console.log("\u8fdb\u5165test\u72b6\u6001 prevState:",t),console.log("TODO \u955c\u5934\u62c9\u8fd1")},n.Exit=function(){console.log("\u9000\u51fatest\u72b6\u6001"),this._parent._proxy.resetExpression()},n.Update=function(t,e){if(e._keys.actionToTest){var n,i,o=e._keys.actionToTest,s=null==(n=this._parent._proxy._animations[o])?void 0:n.action;console.log("play",o,s);var r=null==(i=this._parent._proxy._animations[this.currentAction])?void 0:i.action;s&&(r&&this.currentAction!==o&&s.crossFadeFrom(r,.5,!0),s.time=0,s.stop(),s.play()),this.currentAction=e._keys.actionToTest,e._keys.actionToTest=null}},RT(e,[{key:"Name",get:function(){return"TEST"}},{key:"currentAction",get:function(){return this._currentAction},set:function(t){this._currentAction=t}}]),e}(gM),mM=8,IM=function(t){function e(e){return t.call(this,e)||this}lM(e,t);var n=e.prototype;return n.Enter=function(t){var e;this._duration=0,mM=9;var n=ZT[this.Name].action,i=null==(e=this._parent._proxy._animations[n])?void 0:e.action;i&&(console.log("\u8fdb\u5165idle\u72b6\u6001 prevState:"),i.loop=2201,i.stop(),i.setEffectiveWeight(.67))},n.Exit=function(){var t,e=ZT[this.Name].action,n=null==(t=this._parent._proxy._animations[e])?void 0:t.action;n&&(n.stop(),n.time=0,n.loop=Vc,console.log("\u9000\u51faidle"))},n.Update=function(t,e){if(this._duration+=t,e._keys.fetching&&this._parent.SetState(ZT.LISTEN.name),this._duration>1&&this._parent._proxy.taskQueue.length>0)return console.log("input",e),e._keys.broadcast=!0,void this._parent.SetState(ZT.BROADCAST.name);if(this._duration>mM&&0===this._parent._proxy.taskQueue.length&&!e._keys.fetching){if(this._duration<mM+1){var n,i=ZT[function(){var t="";switch(Math.floor(10*Math.random())){case 0:default:t="NONE";break;case 1:t="AROUND";break;case 2:case 8:t="SMILE";break;case 3:case 9:t="HAPPY";break;case 4:t="CROUCH";break;case 5:t="IDLE";break;case 6:t="LISTEN";break;case 7:t="THINKING"}return t}()].action,o=null==(n=this._parent._proxy._animations[i])?void 0:n.action;o&&(console.log("idle._duration",this._duration),o.stop(),o.play())}mM+=8}},RT(e,[{key:"Name",get:function(){return"IDLE"}}]),e}(gM),uM=function(t){function e(e){return t.call(this,e)||this}lM(e,t);var n=e.prototype;return n.Enter=function(t){this._duration=0},n.Exit=function(){console.log("\u9000\u51falisten\u72b6\u6001")},n.Update=function(t,e){if(this._duration+=t,this._duration>1&&this._parent._proxy.taskQueue.length>0)return e._keys.broadcast=!0,void this._parent.SetState(ZT.BROADCAST.name);this._duration>15&&this._parent._proxy.taskQueue.length<1&&this._parent.SetState(ZT.IDLE.name)},RT(e,[{key:"Name",get:function(){return"LISTEN"}}]),e}(gM),CM=function(t){function e(){return t.apply(this,arguments)||this}return lM(e,t),e}(gM),bM=Hl.filter;Ao({target:"Array",proto:!0,forced:!UN("filter")},{filter:function(t){return bM(this,t,arguments.length>1?arguments[1]:void 0)}});var pM,yM,ZM,JM,GM=Kl("Array").filter,VM=In,SM=GM,BM=Array.prototype,XM=function(t){var e=t.filter;return t===BM||VM(BM,t)&&e===BM.filter?SM:e},vM=function(t){function e(e){var n;return(n=t.call(this,e)||this).Update=VN(n.Update.bind(function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(n)),500),n}lM(e,t);var n=e.prototype;return n.Enter=function(t){this._duration=0,console.log("\u8fdb\u5165broadcast\u72b6\u6001");var e=this._parent._proxy,n=e.compositeAnimation,i=e.taskQueue;if(e._onBroadcastPre,null==n){if(i.length>0){e.compositeAnimation=i.shift();var o=e.compositeAnimation,s=o.audioPlayer,r=o.voiceAnimation,a=o.voiceData;dB((function(){r.play()})),a&&s.play()}}else console.log("already played:",n,i)},n.Exit=function(){console.log("\u9000\u51fa\u64ad\u62a5\u72b6\u6001")},n.Update=function(t,e){var n=this;this._duration+=t;var i=this._parent._proxy,o=i.compositeAnimation,s=i.animations,r=i._onSubtitleChange;if(o){var a,l=o.actionTimeLine,c=void 0===l?[]:l,g=o.textTimeLine,d=void 0===g?[]:g;if(Ol(a=XM(c).call(c,(function(t){return n._duration>t.startTime&&n._duration<t.endTime&&!t.played}))).call(a,(function(t){var e,n;t&&(t.name,null==(e=s[t.name])||e.action.stop(),null==(n=s[t.name])||n.action.play(),t.played=!0)})),d.length>0)for(var h=0;h<d.length;h++)d[h].startTime<this._duration&&this._duration<d[h].endTime&&r&&r(d[h].txt)}e._keys.broadcast||this._parent.SetState(ZT.LISTEN.name)},RT(e,[{key:"Name",get:function(){return"BROADCAST"}}]),e}(gM),fM=function(t){function e(e){var n,i=e.proxy,o=e.onStateChange;return(n=t.call(this,{onStateChange:o})||this)._proxy=i,n._Init(),n}return lM(e,t),e.prototype._Init=function(){this._AddState(ZT.INIT.name,dM),this._AddState(ZT.TEST.name,hM),this._AddState(ZT.IDLE.name,IM),this._AddState(ZT.LISTEN.name,uM),this._AddState(ZT.THINKING.name,CM),this._AddState(ZT.BROADCAST.name,vM)},e}(cM),RM=d.Promise,WM=K,AM=M,wM=yt,YM=Rw,kM=K,FM=M,HM=mt,xM=lY,NM=QX,TM=z,MM=oY,UM=jw,KM=function(t,e,n){var i,o;AM(t);try{if(!(i=wM(t,"return"))){if("throw"===e)throw n;return n}i=WM(i,t)}catch(t){o=!0,i=t}if("throw"===e)throw n;if(o)throw i;return AM(i),n},EM=d.TypeError,LM=function(t,e){this.stopped=t,this.result=e},DM=LM.prototype,QM=/(?:ipad|iphone|ipod).*applewebkit/i.test(P),zM="process"==JB(d.process),PM=d,_M=DF,OM=Rw,jM=v,qM=y,$M=i,tU=mW,eU=WH,nU=Y,iU=QM,oU=zM,sU=PM.setImmediate,rU=PM.clearImmediate,aU=PM.process,lU=PM.Dispatch,cU=PM.Function,gU=PM.MessageChannel,dU=PM.String,hU=0,mU={},IU="onreadystatechange";try{pM=PM.location}catch(t){}var uU=function(t){if(qM(mU,t)){var e=mU[t];delete mU[t],e()}},CU=function(t){return function(){uU(t)}},bU=function(t){uU(t.data)},pU=function(t){PM.postMessage(dU(t),pM.protocol+"//"+pM.host)};sU&&rU||(sU=function(t){var e=eU(arguments,1);return mU[++hU]=function(){_M(jM(t)?t:cU(t),void 0,e)},yM(hU),hU},rU=function(t){delete mU[t]},oU?yM=function(t){aU.nextTick(CU(t))}:lU&&lU.now?yM=function(t){lU.now(CU(t))}:gU&&!iU?(JM=(ZM=new gU).port2,ZM.port1.onmessage=bU,yM=OM(JM.postMessage,JM)):PM.addEventListener&&jM(PM.postMessage)&&!PM.importScripts&&pM&&"file:"!==pM.protocol&&!$M(pU)?(yM=pU,PM.addEventListener("message",bU,!1)):yM=IU in nU("script")?function(t){tU.appendChild(nU("script")).onreadystatechange=function(){tU.removeChild(this),uU(t)}}:function(t){setTimeout(CU(t),0)});var yU,ZU,JU,GU,VU,SU,BU,XU,vU={set:sU,clear:rU},fU=d,RU=/ipad|iphone|ipod/i.test(P)&&void 0!==fU.Pebble,WU=/web0s(?!.*chrome)/i.test(P),AU=d,wU=Rw,YU=hB.f,kU=vU.set,FU=QM,HU=RU,xU=WU,NU=zM,TU=AU.MutationObserver||AU.WebKitMutationObserver,MU=AU.document,UU=AU.process,KU=AU.Promise,EU=YU(AU,"queueMicrotask"),LU=EU&&EU.value;LU||(yU=function(){var t,e;for(NU&&(t=UU.domain)&&t.exit();ZU;){e=ZU.fn,ZU=ZU.next;try{e()}catch(t){throw ZU?GU():JU=void 0,t}}JU=void 0,t&&t.enter()},FU||NU||xU||!TU||!MU?!HU&&KU&&KU.resolve?((BU=KU.resolve(void 0)).constructor=KU,XU=wU(BU.then,BU),GU=function(){XU(yU)}):NU?GU=function(){UU.nextTick(yU)}:(kU=wU(kU,AU),GU=function(){kU(yU)}):(VU=!0,SU=MU.createTextNode(""),new TU(yU).observe(SU,{characterData:!0}),GU=function(){SU.data=VU=!VU}));var DU=LU||function(t){var e={fn:t,next:void 0};JU&&(JU.next=e),ZU||(ZU=e,GU()),JU=e},QU={},zU=bt,PU=function(t){var e,n;this.promise=new t((function(t,i){if(void 0!==e||void 0!==n)throw TypeError("Bad Promise constructor");e=t,n=i})),this.resolve=zU(e),this.reject=zU(n)};QU.f=function(t){return new PU(t)};var _U,OU,jU,qU,$U=M,tK=R,eK=QU,nK=d,iK="object"==typeof window,oK=kv,sK=d,rK=Q,aK=K,lK=RM,cK=EB.exports,gK=xv,dK=Cf,hK=Yf,mK=TR,IK=bt,uK=v,CK=R,bK=Mv,pK=OB,yK=function(t,e,n){var i,o,s,r,a,l,c,g=n&&n.that,d=!(!n||!n.AS_ENTRIES),h=!(!n||!n.IS_ITERATOR),m=!(!n||!n.INTERRUPTED),I=YM(e,g),u=function(t){return i&&KM(i,"normal",t),new LM(!0,t)},C=function(t){return d?(FM(t),m?I(t[0],t[1],u):I(t[0],t[1])):m?I(t,u):I(t)};if(h)i=t;else{if(!(o=UM(t)))throw EM(HM(t)+" is not iterable");if(xM(o)){for(s=0,r=NM(t);r>s;s++)if((a=C(t[s]))&&TM(DM,a))return a;return new LM(!1)}i=MM(t,o)}for(l=i.next;!(c=kM(l,i)).done;){try{a=C(c.value)}catch(t){KM(i,"throw",t)}if("object"==typeof a&&a&&TM(DM,a))return a}return new LM(!1)},ZK=wA,JK=nF,GK=vU.set,VK=DU,SK=function(t,e){if($U(t),tK(e)&&e.constructor===t)return e;var n=eK.f(t);return(0,n.resolve)(e),n.promise},BK=function(t,e){var n=nK.console;n&&n.error&&(1==arguments.length?n.error(t):n.error(t,e))},XK=QU,vK=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},fK=VX,RK=Xv,WK=iK,AK=zM,wK=et,YK=zt("species"),kK="Promise",FK=fK.get,HK=fK.set,xK=fK.getterFor(kK),NK=lK&&lK.prototype,TK=lK,MK=NK,UK=sK.TypeError,KK=sK.document,EK=sK.process,LK=XK.f,DK=LK,QK=!!(KK&&KK.createEvent&&sK.dispatchEvent),zK=uK(sK.PromiseRejectionEvent),PK="unhandledrejection",_K=!1,OK=RK(kK,(function(){var t=pK(TK),e=t!==String(TK);if(!e&&66===wK)return!0;if(wK>=51&&/native code/.test(t))return!1;var n=new TK((function(t){t(1)})),i=function(t){t((function(){}),(function(){}))};return(n.constructor={})[YK]=i,!(_K=n.then((function(){}))instanceof i)||!e&&WK&&!zK})),jK=OK||!ZK((function(t){TK.all(t).catch((function(){}))})),qK=function(t){var e;return!(!CK(t)||!uK(e=t.then))&&e},$K=function(t,e){if(!t.notified){t.notified=!0;var n=t.reactions;VK((function(){for(var i=t.value,o=1==t.state,s=0;n.length>s;){var r,a,l,c=n[s++],g=o?c.ok:c.fail,d=c.resolve,h=c.reject,m=c.domain;try{g?(o||(2===t.rejection&&iE(t),t.rejection=1),!0===g?r=i:(m&&m.enter(),r=g(i),m&&(m.exit(),l=!0)),r===c.promise?h(UK("Promise-chain cycle")):(a=qK(r))?aK(a,r,d,h):d(r)):h(i)}catch(t){m&&!l&&m.exit(),h(t)}}t.reactions=[],t.notified=!1,e&&!t.rejection&&eE(t)}))}},tE=function(t,e,n){var i,o;QK?((i=KK.createEvent("Event")).promise=e,i.reason=n,i.initEvent(t,!1,!0),sK.dispatchEvent(i)):i={promise:e,reason:n},!zK&&(o=sK["on"+t])?o(i):t===PK&&BK("Unhandled promise rejection",n)},eE=function(t){aK(GK,sK,(function(){var e,n=t.facade,i=t.value;if(nE(t)&&(e=vK((function(){AK?EK.emit("unhandledRejection",i,n):tE(PK,n,i)})),t.rejection=AK||nE(t)?2:1,e.error))throw e.value}))},nE=function(t){return 1!==t.rejection&&!t.parent},iE=function(t){aK(GK,sK,(function(){var e=t.facade;AK?EK.emit("rejectionHandled",e):tE("rejectionhandled",e,t.value)}))},oE=function(t,e,n){return function(i){t(e,i,n)}},sE=function(t,e,n){t.done||(t.done=!0,n&&(t=n),t.value=e,t.state=2,$K(t,!0))},rE=function(t,e,n){if(!t.done){t.done=!0,n&&(t=n);try{if(t.facade===e)throw UK("Promise can't be resolved itself");var i=qK(e);i?VK((function(){var n={done:!1};try{aK(i,e,oE(rE,n,t),oE(sE,n,t))}catch(e){sE(n,e,t)}})):(t.value=e,t.state=1,$K(t,!1))}catch(e){sE({done:!1},e,t)}}};if(OK&&(MK=(TK=function(t){bK(this,MK),IK(t),aK(_U,this);var e=FK(this);try{t(oE(rE,e),oE(sE,e))}catch(t){sE(e,t)}}).prototype,(_U=function(t){HK(this,{type:kK,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=gK(MK,{then:function(t,e){var n=xK(this),i=n.reactions,o=LK(JK(this,TK));return o.ok=!uK(t)||t,o.fail=uK(e)&&e,o.domain=AK?EK.domain:void 0,n.parent=!0,i[i.length]=o,0!=n.state&&$K(n,!1),o.promise},catch:function(t){return this.then(void 0,t)}}),OU=function(){var t=new _U,e=FK(t);this.promise=t,this.resolve=oE(rE,e),this.reject=oE(sE,e)},XK.f=LK=function(t){return t===TK||t===jU?new OU(t):DK(t)},uK(lK)&&NK!==Object.prototype)){qU=NK.then,_K||(cK(NK,"then",(function(t,e){var n=this;return new TK((function(t,e){aK(qU,n,t,e)})).then(t,e)}),{unsafe:!0}),cK(NK,"catch",MK.catch,{unsafe:!0}));try{delete NK.constructor}catch(t){}dK&&dK(NK,MK)}oK({global:!0,wrap:!0,forced:OK},{Promise:TK}),hK(TK,kK,!1),mK(kK),jU=rK(kK),oK({target:kK,stat:!0,forced:OK},{reject:function(t){var e=LK(this);return aK(e.reject,void 0,t),e.promise}}),oK({target:kK,stat:!0,forced:OK},{resolve:function(t){return SK(this,t)}}),oK({target:kK,stat:!0,forced:jK},{all:function(t){var e=this,n=LK(e),i=n.resolve,o=n.reject,s=vK((function(){var n=IK(e.resolve),s=[],r=0,a=1;yK(t,(function(t){var l=r++,c=!1;a++,aK(n,e,t).then((function(t){c||(c=!0,s[l]=t,--a||i(s))}),o)})),--a||i(s)}));return s.error&&o(s.value),n.promise},race:function(t){var e=this,n=LK(e),i=n.reject,o=vK((function(){var o=IK(e.resolve);yK(t,(function(t){aK(o,e,t).then(n.resolve,i)}))}));return o.error&&i(o.value),n.promise}});var aE=qR,lE=d.String,cE=function(t){if("Symbol"===aE(t))throw TypeError("Cannot convert a Symbol value to a string");return lE(t)},gE=c,dE=xX,hE=cE,mE=m,IE=gE("".charAt),uE=gE("".charCodeAt),CE=gE("".slice),bE=function(t){return function(e,n){var i,o,s=hE(mE(e)),r=dE(n),a=s.length;return r<0||r>=a?t?"":void 0:(i=uE(s,r))<55296||i>56319||r+1===a||(o=uE(s,r+1))<56320||o>57343?t?IE(s,r):i:t?CE(s,r,r+2):o-56320+(i-55296<<10)+65536}},pE={codeAt:bE(!1),charAt:bE(!0)}.charAt,yE=cE,ZE=VX,JE=IA,GE="String Iterator",VE=ZE.set,SE=ZE.getterFor(GE);JE(String,"String",(function(t){VE(this,{type:GE,string:yE(t),index:0})}),(function(){var t,e=SE(this),n=e.string,i=e.index;return i>=n.length?{value:void 0,done:!0}:(t=pE(n,i),e.index+=t.length,{value:t,done:!1})}));var BE=Y("span").classList,XE=BE&&BE.constructor&&BE.constructor.prototype,vE=XE===Object.prototype?void 0:XE,fE=d,RE={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},WE=vE,AE=VA,wE=KB,YE=zt,kE=YE("iterator"),FE=YE("toStringTag"),HE=AE.values,xE=function(t,e){if(t){if(t[kE]!==HE)try{wE(t,kE,HE)}catch(e){t[kE]=HE}if(t[FE]||wE(t,FE,e),RE[e])for(var n in AE)if(t[n]!==AE[n])try{wE(t,n,AE[n])}catch(e){t[n]=AE[n]}}};for(var NE in RE)xE(fE[NE]&&fE[NE].prototype,NE);xE(WE,"DOMTokenList");var TE=al,ME=Ko,UE=io,KE=Ze.TypeError,EE=function(t,e,n,i,o,s,r,a){for(var l,c,g=o,d=0,h=!!r&&UE(r,a);d<i;){if(d in n){if(l=h?h(n[d],d,e):n[d],s>0&&TE(l))c=ME(l),g=EE(t,e,l,c,g,s-1)-1;else{if(g>=9007199254740991)throw KE("Exceed the acceptable array length");t[g]=l}g++}d++}return g},LE=EE,DE=Nn,QE=ti,zE=Ko,PE=fl;Ao({target:"Array",proto:!0},{flatMap:function(t){var e,n=QE(this),i=zE(n);return DE(t),(e=PE(n,0)).length=LE(e,n,n,i,0,1,t,arguments.length>1?arguments[1]:void 0),e}});var _E=Kl("Array").flatMap,OE=In,jE=_E,qE=Array.prototype,$E=function(t){var e=t.flatMap;return t===qE||OE(qE,t)&&e===qE.flatMap?jE:e},tL=Ao,eL=Ze,nL=al,iL=Zl,oL=an,sL=No,rL=Ko,aL=sn,lL=py,cL=yi,gL=dJ,dL=UN("slice"),hL=cL("species"),mL=eL.Array,IL=Math.max;tL({target:"Array",proto:!0,forced:!dL},{slice:function(t,e){var n,i,o,s=aL(this),r=rL(s),a=sL(t,r),l=sL(void 0===e?r:e,r);if(nL(s)&&(n=s.constructor,(iL(n)&&(n===mL||nL(n.prototype))||oL(n)&&null===(n=n[hL]))&&(n=void 0),n===mL||void 0===n))return gL(s,a,l);for(i=new(void 0===n?mL:n)(IL(l-a,0)),o=0;a<l;a++,o++)a in s&&lL(i,o,s[a]);return i.length=o,i}});var uL=Kl("Array").slice,CL=In,bL=uL,pL=Array.prototype,yL=function(t){var e=t.slice;return t===pL||CL(pL,t)&&e===pL.slice?bL:e},ZL=ti,JL=No,GL=Ko,VL=function(t){for(var e=ZL(this),n=GL(e),i=arguments.length,o=JL(i>1?arguments[1]:void 0,n),s=i>2?arguments[2]:void 0,r=void 0===s?n:JL(s,n);r>o;)e[o++]=t;return e};Ao({target:"Array",proto:!0},{fill:VL});var SL,BL=Kl("Array").fill,XL=In,vL=BL,fL=Array.prototype,RL=function(t){var e=t.fill;return t===fL||XL(fL,t)&&e===fL.fill?vL:e},WL=oN("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwp2YXIgd29ya2VyX2NvZGUgPSAoZnVuY3Rpb24gKCkgewoJJ3VzZSBzdHJpY3QnOwoKCXZhciBjb21tb25qc0dsb2JhbCA9IHR5cGVvZiBnbG9iYWxUaGlzICE9PSAndW5kZWZpbmVkJyA/IGdsb2JhbFRoaXMgOiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnID8gZ2xvYmFsIDogdHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnID8gc2VsZiA6IHt9OwoKCXZhciBjaGVjayQxID0gZnVuY3Rpb24gKGl0KSB7CgkgIHJldHVybiBpdCAmJiBpdC5NYXRoID09IE1hdGggJiYgaXQ7Cgl9OwoKCS8vIGh0dHBzOi8vZ2l0aHViLmNvbS96bG9pcm9jay9jb3JlLWpzL2lzc3Vlcy84NiNpc3N1ZWNvbW1lbnQtMTE1NzU5MDI4Cgl2YXIgZ2xvYmFsJDE4ID0KCSAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGVzL25vLWdsb2JhbC10aGlzIC0tIHNhZmUKCSAgY2hlY2skMSh0eXBlb2YgZ2xvYmFsVGhpcyA9PSAnb2JqZWN0JyAmJiBnbG9iYWxUaGlzKSB8fAoJICBjaGVjayQxKHR5cGVvZiB3aW5kb3cgPT0gJ29iamVjdCcgJiYgd2luZG93KSB8fAoJICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1nbG9iYWxzIC0tIHNhZmUKCSAgY2hlY2skMSh0eXBlb2Ygc2VsZiA9PSAnb2JqZWN0JyAmJiBzZWxmKSB8fAoJICBjaGVjayQxKHR5cGVvZiBjb21tb25qc0dsb2JhbCA9PSAnb2JqZWN0JyAmJiBjb21tb25qc0dsb2JhbCkgfHwKCSAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLW5ldy1mdW5jIC0tIGZhbGxiYWNrCgkgIChmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzOyB9KSgpIHx8IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKCk7CgoJdmFyIG9iamVjdEdldE93blByb3BlcnR5RGVzY3JpcHRvciQxID0ge307CgoJdmFyIGZhaWxzJHQgPSBmdW5jdGlvbiAoZXhlYykgewoJICB0cnkgewoJICAgIHJldHVybiAhIWV4ZWMoKTsKCSAgfSBjYXRjaCAoZXJyb3IpIHsKCSAgICByZXR1cm4gdHJ1ZTsKCSAgfQoJfTsKCgl2YXIgZmFpbHMkcyA9IGZhaWxzJHQ7CgoJLy8gRGV0ZWN0IElFOCdzIGluY29tcGxldGUgZGVmaW5lUHJvcGVydHkgaW1wbGVtZW50YXRpb24KCXZhciBkZXNjcmlwdG9ycyQxID0gIWZhaWxzJHMoZnVuY3Rpb24gKCkgewoJICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZXMvbm8tb2JqZWN0LWRlZmluZXByb3BlcnR5IC0tIHJlcXVpcmVkIGZvciB0ZXN0aW5nCgkgIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkoe30sIDEsIHsgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiA3OyB9IH0pWzFdICE9IDc7Cgl9KTsKCgl2YXIgY2FsbCRsID0gRnVuY3Rpb24ucHJvdG90eXBlLmNhbGw7CgoJdmFyIGZ1bmN0aW9uQ2FsbCQxID0gY2FsbCRsLmJpbmQgPyBjYWxsJGwuYmluZChjYWxsJGwpIDogZnVuY3Rpb24gKCkgewoJICByZXR1cm4gY2FsbCRsLmFwcGx5KGNhbGwkbCwgYXJndW1lbnRzKTsKCX07CgoJdmFyIG9iamVjdFByb3BlcnR5SXNFbnVtZXJhYmxlJDEgPSB7fTsKCgl2YXIgJHByb3BlcnR5SXNFbnVtZXJhYmxlJDIgPSB7fS5wcm9wZXJ0eUlzRW51bWVyYWJsZTsKCS8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBlcy9uby1vYmplY3QtZ2V0b3ducHJvcGVydHlkZXNjcmlwdG9yIC0tIHNhZmUKCXZhciBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IkNCA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7CgoJLy8gTmFzaG9ybiB+IEpESzggYnVnCgl2YXIgTkFTSE9STl9CVUckMSA9IGdldE93blByb3BlcnR5RGVzY3JpcHRvciQ0ICYmICEkcHJvcGVydHlJc0VudW1lcmFibGUkMi5jYWxsKHsgMTogMiB9LCAxKTsKCgkvLyBgT2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZWAgbWV0aG9kIGltcGxlbWVudGF0aW9uCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLW9iamVjdC5wcm90b3R5cGUucHJvcGVydHlpc2VudW1lcmFibGUKCW9iamVjdFByb3BlcnR5SXNFbnVtZXJhYmxlJDEuZiA9IE5BU0hPUk5fQlVHJDEgPyBmdW5jdGlvbiBwcm9wZXJ0eUlzRW51bWVyYWJsZShWKSB7CgkgIHZhciBkZXNjcmlwdG9yID0gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yJDQodGhpcywgVik7CgkgIHJldHVybiAhIWRlc2NyaXB0b3IgJiYgZGVzY3JpcHRvci5lbnVtZXJhYmxlOwoJfSA6ICRwcm9wZXJ0eUlzRW51bWVyYWJsZSQyOwoKCXZhciBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IkOSA9IGZ1bmN0aW9uIChiaXRtYXAsIHZhbHVlKSB7CgkgIHJldHVybiB7CgkgICAgZW51bWVyYWJsZTogIShiaXRtYXAgJiAxKSwKCSAgICBjb25maWd1cmFibGU6ICEoYml0bWFwICYgMiksCgkgICAgd3JpdGFibGU6ICEoYml0bWFwICYgNCksCgkgICAgdmFsdWU6IHZhbHVlCgkgIH07Cgl9OwoKCXZhciBGdW5jdGlvblByb3RvdHlwZSQ2ID0gRnVuY3Rpb24ucHJvdG90eXBlOwoJdmFyIGJpbmQkNyA9IEZ1bmN0aW9uUHJvdG90eXBlJDYuYmluZDsKCXZhciBjYWxsJGsgPSBGdW5jdGlvblByb3RvdHlwZSQ2LmNhbGw7Cgl2YXIgY2FsbEJpbmQkMSA9IGJpbmQkNyAmJiBiaW5kJDcuYmluZChjYWxsJGspOwoKCXZhciBmdW5jdGlvblVuY3VycnlUaGlzJDEgPSBiaW5kJDcgPyBmdW5jdGlvbiAoZm4pIHsKCSAgcmV0dXJuIGZuICYmIGNhbGxCaW5kJDEoY2FsbCRrLCBmbik7Cgl9IDogZnVuY3Rpb24gKGZuKSB7CgkgIHJldHVybiBmbiAmJiBmdW5jdGlvbiAoKSB7CgkgICAgcmV0dXJuIGNhbGwkay5hcHBseShmbiwgYXJndW1lbnRzKTsKCSAgfTsKCX07CgoJdmFyIHVuY3VycnlUaGlzJEYgPSBmdW5jdGlvblVuY3VycnlUaGlzJDE7CgoJdmFyIHRvU3RyaW5nJGogPSB1bmN1cnJ5VGhpcyRGKHt9LnRvU3RyaW5nKTsKCXZhciBzdHJpbmdTbGljZSQ2ID0gdW5jdXJyeVRoaXMkRignJy5zbGljZSk7CgoJdmFyIGNsYXNzb2ZSYXckMyA9IGZ1bmN0aW9uIChpdCkgewoJICByZXR1cm4gc3RyaW5nU2xpY2UkNih0b1N0cmluZyRqKGl0KSwgOCwgLTEpOwoJfTsKCgl2YXIgZ2xvYmFsJDE3ID0gZ2xvYmFsJDE4OwoJdmFyIHVuY3VycnlUaGlzJEUgPSBmdW5jdGlvblVuY3VycnlUaGlzJDE7Cgl2YXIgZmFpbHMkciA9IGZhaWxzJHQ7Cgl2YXIgY2xhc3NvZiRoID0gY2xhc3NvZlJhdyQzOwoKCXZhciBPYmplY3QkOSA9IGdsb2JhbCQxNy5PYmplY3Q7Cgl2YXIgc3BsaXQkMSA9IHVuY3VycnlUaGlzJEUoJycuc3BsaXQpOwoKCS8vIGZhbGxiYWNrIGZvciBub24tYXJyYXktbGlrZSBFUzMgYW5kIG5vbi1lbnVtZXJhYmxlIG9sZCBWOCBzdHJpbmdzCgl2YXIgaW5kZXhlZE9iamVjdCQxID0gZmFpbHMkcihmdW5jdGlvbiAoKSB7CgkgIC8vIHRocm93cyBhbiBlcnJvciBpbiByaGlubywgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9tb3ppbGxhL3JoaW5vL2lzc3Vlcy8zNDYKCSAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXByb3RvdHlwZS1idWlsdGlucyAtLSBzYWZlCgkgIHJldHVybiAhT2JqZWN0JDkoJ3onKS5wcm9wZXJ0eUlzRW51bWVyYWJsZSgwKTsKCX0pID8gZnVuY3Rpb24gKGl0KSB7CgkgIHJldHVybiBjbGFzc29mJGgoaXQpID09ICdTdHJpbmcnID8gc3BsaXQkMShpdCwgJycpIDogT2JqZWN0JDkoaXQpOwoJfSA6IE9iamVjdCQ5OwoKCXZhciBnbG9iYWwkMTYgPSBnbG9iYWwkMTg7CgoJdmFyIFR5cGVFcnJvciRvID0gZ2xvYmFsJDE2LlR5cGVFcnJvcjsKCgkvLyBgUmVxdWlyZU9iamVjdENvZXJjaWJsZWAgYWJzdHJhY3Qgb3BlcmF0aW9uCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLXJlcXVpcmVvYmplY3Rjb2VyY2libGUKCXZhciByZXF1aXJlT2JqZWN0Q29lcmNpYmxlJGQgPSBmdW5jdGlvbiAoaXQpIHsKCSAgaWYgKGl0ID09IHVuZGVmaW5lZCkgdGhyb3cgVHlwZUVycm9yJG8oIkNhbid0IGNhbGwgbWV0aG9kIG9uICIgKyBpdCk7CgkgIHJldHVybiBpdDsKCX07CgoJLy8gdG9PYmplY3Qgd2l0aCBmYWxsYmFjayBmb3Igbm9uLWFycmF5LWxpa2UgRVMzIHN0cmluZ3MKCXZhciBJbmRleGVkT2JqZWN0JDMgPSBpbmRleGVkT2JqZWN0JDE7Cgl2YXIgcmVxdWlyZU9iamVjdENvZXJjaWJsZSRjID0gcmVxdWlyZU9iamVjdENvZXJjaWJsZSRkOwoKCXZhciB0b0luZGV4ZWRPYmplY3QkZCA9IGZ1bmN0aW9uIChpdCkgewoJICByZXR1cm4gSW5kZXhlZE9iamVjdCQzKHJlcXVpcmVPYmplY3RDb2VyY2libGUkYyhpdCkpOwoJfTsKCgkvLyBgSXNDYWxsYWJsZWAgYWJzdHJhY3Qgb3BlcmF0aW9uCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLWlzY2FsbGFibGUKCXZhciBpc0NhbGxhYmxlJHYgPSBmdW5jdGlvbiAoYXJndW1lbnQpIHsKCSAgcmV0dXJuIHR5cGVvZiBhcmd1bWVudCA9PSAnZnVuY3Rpb24nOwoJfTsKCgl2YXIgaXNDYWxsYWJsZSR1ID0gaXNDYWxsYWJsZSR2OwoKCXZhciBpc09iamVjdCRpID0gZnVuY3Rpb24gKGl0KSB7CgkgIHJldHVybiB0eXBlb2YgaXQgPT0gJ29iamVjdCcgPyBpdCAhPT0gbnVsbCA6IGlzQ2FsbGFibGUkdShpdCk7Cgl9OwoKCXZhciBnbG9iYWwkMTUgPSBnbG9iYWwkMTg7Cgl2YXIgaXNDYWxsYWJsZSR0ID0gaXNDYWxsYWJsZSR2OwoKCXZhciBhRnVuY3Rpb24kMSA9IGZ1bmN0aW9uIChhcmd1bWVudCkgewoJICByZXR1cm4gaXNDYWxsYWJsZSR0KGFyZ3VtZW50KSA/IGFyZ3VtZW50IDogdW5kZWZpbmVkOwoJfTsKCgl2YXIgZ2V0QnVpbHRJbiRiID0gZnVuY3Rpb24gKG5hbWVzcGFjZSwgbWV0aG9kKSB7CgkgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoIDwgMiA/IGFGdW5jdGlvbiQxKGdsb2JhbCQxNVtuYW1lc3BhY2VdKSA6IGdsb2JhbCQxNVtuYW1lc3BhY2VdICYmIGdsb2JhbCQxNVtuYW1lc3BhY2VdW21ldGhvZF07Cgl9OwoKCXZhciB1bmN1cnJ5VGhpcyREID0gZnVuY3Rpb25VbmN1cnJ5VGhpcyQxOwoKCXZhciBvYmplY3RJc1Byb3RvdHlwZU9mJDEgPSB1bmN1cnJ5VGhpcyREKHt9LmlzUHJvdG90eXBlT2YpOwoKCXZhciBnZXRCdWlsdEluJGEgPSBnZXRCdWlsdEluJGI7CgoJdmFyIGVuZ2luZVVzZXJBZ2VudCQxID0gZ2V0QnVpbHRJbiRhKCduYXZpZ2F0b3InLCAndXNlckFnZW50JykgfHwgJyc7CgoJdmFyIGdsb2JhbCQxNCA9IGdsb2JhbCQxODsKCXZhciB1c2VyQWdlbnQkMSA9IGVuZ2luZVVzZXJBZ2VudCQxOwoKCXZhciBwcm9jZXNzJDEgPSBnbG9iYWwkMTQucHJvY2VzczsKCXZhciBEZW5vJDEgPSBnbG9iYWwkMTQuRGVubzsKCXZhciB2ZXJzaW9ucyQxID0gcHJvY2VzcyQxICYmIHByb2Nlc3MkMS52ZXJzaW9ucyB8fCBEZW5vJDEgJiYgRGVubyQxLnZlcnNpb247Cgl2YXIgdjgkMSA9IHZlcnNpb25zJDEgJiYgdmVyc2lvbnMkMS52ODsKCXZhciBtYXRjaCQxLCB2ZXJzaW9uJDE7CgoJaWYgKHY4JDEpIHsKCSAgbWF0Y2gkMSA9IHY4JDEuc3BsaXQoJy4nKTsKCSAgLy8gaW4gb2xkIENocm9tZSwgdmVyc2lvbnMgb2YgVjggaXNuJ3QgVjggPSBDaHJvbWUgLyAxMAoJICAvLyBidXQgdGhlaXIgY29ycmVjdCB2ZXJzaW9ucyBhcmUgbm90IGludGVyZXN0aW5nIGZvciB1cwoJICB2ZXJzaW9uJDEgPSBtYXRjaCQxWzBdID4gMCAmJiBtYXRjaCQxWzBdIDwgNCA/IDEgOiArKG1hdGNoJDFbMF0gKyBtYXRjaCQxWzFdKTsKCX0KCgkvLyBCcm93c2VyRlMgTm9kZUpTIGBwcm9jZXNzYCBwb2x5ZmlsbCBpbmNvcnJlY3RseSBzZXQgYC52OGAgdG8gYDAuMGAKCS8vIHNvIGNoZWNrIGB1c2VyQWdlbnRgIGV2ZW4gaWYgYC52OGAgZXhpc3RzLCBidXQgMAoJaWYgKCF2ZXJzaW9uJDEgJiYgdXNlckFnZW50JDEpIHsKCSAgbWF0Y2gkMSA9IHVzZXJBZ2VudCQxLm1hdGNoKC9FZGdlXC8oXGQrKS8pOwoJICBpZiAoIW1hdGNoJDEgfHwgbWF0Y2gkMVsxXSA+PSA3NCkgewoJICAgIG1hdGNoJDEgPSB1c2VyQWdlbnQkMS5tYXRjaCgvQ2hyb21lXC8oXGQrKS8pOwoJICAgIGlmIChtYXRjaCQxKSB2ZXJzaW9uJDEgPSArbWF0Y2gkMVsxXTsKCSAgfQoJfQoKCXZhciBlbmdpbmVWOFZlcnNpb24kMSA9IHZlcnNpb24kMTsKCgkvKiBlc2xpbnQtZGlzYWJsZSBlcy9uby1zeW1ib2wgLS0gcmVxdWlyZWQgZm9yIHRlc3RpbmcgKi8KCgl2YXIgVjhfVkVSU0lPTiQzID0gZW5naW5lVjhWZXJzaW9uJDE7Cgl2YXIgZmFpbHMkcSA9IGZhaWxzJHQ7CgoJLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGVzL25vLW9iamVjdC1nZXRvd25wcm9wZXJ0eXN5bWJvbHMgLS0gcmVxdWlyZWQgZm9yIHRlc3RpbmcKCXZhciBuYXRpdmVTeW1ib2wkMSA9ICEhT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyAmJiAhZmFpbHMkcShmdW5jdGlvbiAoKSB7CgkgIHZhciBzeW1ib2wgPSBTeW1ib2woKTsKCSAgLy8gQ2hyb21lIDM4IFN5bWJvbCBoYXMgaW5jb3JyZWN0IHRvU3RyaW5nIGNvbnZlcnNpb24KCSAgLy8gYGdldC1vd24tcHJvcGVydHktc3ltYm9sc2AgcG9seWZpbGwgc3ltYm9scyBjb252ZXJ0ZWQgdG8gb2JqZWN0IGFyZSBub3QgU3ltYm9sIGluc3RhbmNlcwoJICByZXR1cm4gIVN0cmluZyhzeW1ib2wpIHx8ICEoT2JqZWN0KHN5bWJvbCkgaW5zdGFuY2VvZiBTeW1ib2wpIHx8CgkgICAgLy8gQ2hyb21lIDM4LTQwIHN5bWJvbHMgYXJlIG5vdCBpbmhlcml0ZWQgZnJvbSBET00gY29sbGVjdGlvbnMgcHJvdG90eXBlcyB0byBpbnN0YW5jZXMKCSAgICAhU3ltYm9sLnNoYW0gJiYgVjhfVkVSU0lPTiQzICYmIFY4X1ZFUlNJT04kMyA8IDQxOwoJfSk7CgoJLyogZXNsaW50LWRpc2FibGUgZXMvbm8tc3ltYm9sIC0tIHJlcXVpcmVkIGZvciB0ZXN0aW5nICovCgoJdmFyIE5BVElWRV9TWU1CT0wkNCA9IG5hdGl2ZVN5bWJvbCQxOwoKCXZhciB1c2VTeW1ib2xBc1VpZCQxID0gTkFUSVZFX1NZTUJPTCQ0CgkgICYmICFTeW1ib2wuc2hhbQoJICAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09ICdzeW1ib2wnOwoKCXZhciBnbG9iYWwkMTMgPSBnbG9iYWwkMTg7Cgl2YXIgZ2V0QnVpbHRJbiQ5ID0gZ2V0QnVpbHRJbiRiOwoJdmFyIGlzQ2FsbGFibGUkcyA9IGlzQ2FsbGFibGUkdjsKCXZhciBpc1Byb3RvdHlwZU9mJGIgPSBvYmplY3RJc1Byb3RvdHlwZU9mJDE7Cgl2YXIgVVNFX1NZTUJPTF9BU19VSUQkMyA9IHVzZVN5bWJvbEFzVWlkJDE7CgoJdmFyIE9iamVjdCQ4ID0gZ2xvYmFsJDEzLk9iamVjdDsKCgl2YXIgaXNTeW1ib2wkNyA9IFVTRV9TWU1CT0xfQVNfVUlEJDMgPyBmdW5jdGlvbiAoaXQpIHsKCSAgcmV0dXJuIHR5cGVvZiBpdCA9PSAnc3ltYm9sJzsKCX0gOiBmdW5jdGlvbiAoaXQpIHsKCSAgdmFyICRTeW1ib2wgPSBnZXRCdWlsdEluJDkoJ1N5bWJvbCcpOwoJICByZXR1cm4gaXNDYWxsYWJsZSRzKCRTeW1ib2wpICYmIGlzUHJvdG90eXBlT2YkYigkU3ltYm9sLnByb3RvdHlwZSwgT2JqZWN0JDgoaXQpKTsKCX07CgoJdmFyIGdsb2JhbCQxMiA9IGdsb2JhbCQxODsKCgl2YXIgU3RyaW5nJDkgPSBnbG9iYWwkMTIuU3RyaW5nOwoKCXZhciB0cnlUb1N0cmluZyQ1ID0gZnVuY3Rpb24gKGFyZ3VtZW50KSB7CgkgIHRyeSB7CgkgICAgcmV0dXJuIFN0cmluZyQ5KGFyZ3VtZW50KTsKCSAgfSBjYXRjaCAoZXJyb3IpIHsKCSAgICByZXR1cm4gJ09iamVjdCc7CgkgIH0KCX07CgoJdmFyIGdsb2JhbCQxMSA9IGdsb2JhbCQxODsKCXZhciBpc0NhbGxhYmxlJHIgPSBpc0NhbGxhYmxlJHY7Cgl2YXIgdHJ5VG9TdHJpbmckNCA9IHRyeVRvU3RyaW5nJDU7CgoJdmFyIFR5cGVFcnJvciRuID0gZ2xvYmFsJDExLlR5cGVFcnJvcjsKCgkvLyBgQXNzZXJ0OiBJc0NhbGxhYmxlKGFyZ3VtZW50KSBpcyB0cnVlYAoJdmFyIGFDYWxsYWJsZSQ2ID0gZnVuY3Rpb24gKGFyZ3VtZW50KSB7CgkgIGlmIChpc0NhbGxhYmxlJHIoYXJndW1lbnQpKSByZXR1cm4gYXJndW1lbnQ7CgkgIHRocm93IFR5cGVFcnJvciRuKHRyeVRvU3RyaW5nJDQoYXJndW1lbnQpICsgJyBpcyBub3QgYSBmdW5jdGlvbicpOwoJfTsKCgl2YXIgYUNhbGxhYmxlJDUgPSBhQ2FsbGFibGUkNjsKCgkvLyBgR2V0TWV0aG9kYCBhYnN0cmFjdCBvcGVyYXRpb24KCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtZ2V0bWV0aG9kCgl2YXIgZ2V0TWV0aG9kJDcgPSBmdW5jdGlvbiAoViwgUCkgewoJICB2YXIgZnVuYyA9IFZbUF07CgkgIHJldHVybiBmdW5jID09IG51bGwgPyB1bmRlZmluZWQgOiBhQ2FsbGFibGUkNShmdW5jKTsKCX07CgoJdmFyIGdsb2JhbCQxMCA9IGdsb2JhbCQxODsKCXZhciBjYWxsJGogPSBmdW5jdGlvbkNhbGwkMTsKCXZhciBpc0NhbGxhYmxlJHEgPSBpc0NhbGxhYmxlJHY7Cgl2YXIgaXNPYmplY3QkaCA9IGlzT2JqZWN0JGk7CgoJdmFyIFR5cGVFcnJvciRtID0gZ2xvYmFsJDEwLlR5cGVFcnJvcjsKCgkvLyBgT3JkaW5hcnlUb1ByaW1pdGl2ZWAgYWJzdHJhY3Qgb3BlcmF0aW9uCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLW9yZGluYXJ5dG9wcmltaXRpdmUKCXZhciBvcmRpbmFyeVRvUHJpbWl0aXZlJDMgPSBmdW5jdGlvbiAoaW5wdXQsIHByZWYpIHsKCSAgdmFyIGZuLCB2YWw7CgkgIGlmIChwcmVmID09PSAnc3RyaW5nJyAmJiBpc0NhbGxhYmxlJHEoZm4gPSBpbnB1dC50b1N0cmluZykgJiYgIWlzT2JqZWN0JGgodmFsID0gY2FsbCRqKGZuLCBpbnB1dCkpKSByZXR1cm4gdmFsOwoJICBpZiAoaXNDYWxsYWJsZSRxKGZuID0gaW5wdXQudmFsdWVPZikgJiYgIWlzT2JqZWN0JGgodmFsID0gY2FsbCRqKGZuLCBpbnB1dCkpKSByZXR1cm4gdmFsOwoJICBpZiAocHJlZiAhPT0gJ3N0cmluZycgJiYgaXNDYWxsYWJsZSRxKGZuID0gaW5wdXQudG9TdHJpbmcpICYmICFpc09iamVjdCRoKHZhbCA9IGNhbGwkaihmbiwgaW5wdXQpKSkgcmV0dXJuIHZhbDsKCSAgdGhyb3cgVHlwZUVycm9yJG0oIkNhbid0IGNvbnZlcnQgb2JqZWN0IHRvIHByaW1pdGl2ZSB2YWx1ZSIpOwoJfTsKCgl2YXIgc2hhcmVkJDkgPSB7ZXhwb3J0czoge319OwoKCXZhciBnbG9iYWwkJCA9IGdsb2JhbCQxODsKCgkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZXMvbm8tb2JqZWN0LWRlZmluZXByb3BlcnR5IC0tIHNhZmUKCXZhciBkZWZpbmVQcm9wZXJ0eSQ1ID0gT2JqZWN0LmRlZmluZVByb3BlcnR5OwoKCXZhciBzZXRHbG9iYWwkNSA9IGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CgkgIHRyeSB7CgkgICAgZGVmaW5lUHJvcGVydHkkNShnbG9iYWwkJCwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTsKCSAgfSBjYXRjaCAoZXJyb3IpIHsKCSAgICBnbG9iYWwkJFtrZXldID0gdmFsdWU7CgkgIH0gcmV0dXJuIHZhbHVlOwoJfTsKCgl2YXIgZ2xvYmFsJF8gPSBnbG9iYWwkMTg7Cgl2YXIgc2V0R2xvYmFsJDQgPSBzZXRHbG9iYWwkNTsKCgl2YXIgU0hBUkVEJDEgPSAnX19jb3JlLWpzX3NoYXJlZF9fJzsKCXZhciBzdG9yZSQ3ID0gZ2xvYmFsJF9bU0hBUkVEJDFdIHx8IHNldEdsb2JhbCQ0KFNIQVJFRCQxLCB7fSk7CgoJdmFyIHNoYXJlZFN0b3JlJDEgPSBzdG9yZSQ3OwoKCXZhciBzdG9yZSQ2ID0gc2hhcmVkU3RvcmUkMTsKCgkoc2hhcmVkJDkuZXhwb3J0cyA9IGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CgkgIHJldHVybiBzdG9yZSQ2W2tleV0gfHwgKHN0b3JlJDZba2V5XSA9IHZhbHVlICE9PSB1bmRlZmluZWQgPyB2YWx1ZSA6IHt9KTsKCX0pKCd2ZXJzaW9ucycsIFtdKS5wdXNoKHsKCSAgdmVyc2lvbjogJzMuMTkuMicsCgkgIG1vZGU6ICdnbG9iYWwnLAoJICBjb3B5cmlnaHQ6ICfCqSAyMDIxIERlbmlzIFB1c2hrYXJldiAoemxvaXJvY2sucnUpJwoJfSk7CgoJdmFyIGdsb2JhbCRaID0gZ2xvYmFsJDE4OwoJdmFyIHJlcXVpcmVPYmplY3RDb2VyY2libGUkYiA9IHJlcXVpcmVPYmplY3RDb2VyY2libGUkZDsKCgl2YXIgT2JqZWN0JDcgPSBnbG9iYWwkWi5PYmplY3Q7CgoJLy8gYFRvT2JqZWN0YCBhYnN0cmFjdCBvcGVyYXRpb24KCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtdG9vYmplY3QKCXZhciB0b09iamVjdCRiID0gZnVuY3Rpb24gKGFyZ3VtZW50KSB7CgkgIHJldHVybiBPYmplY3QkNyhyZXF1aXJlT2JqZWN0Q29lcmNpYmxlJGIoYXJndW1lbnQpKTsKCX07CgoJdmFyIHVuY3VycnlUaGlzJEMgPSBmdW5jdGlvblVuY3VycnlUaGlzJDE7Cgl2YXIgdG9PYmplY3QkYSA9IHRvT2JqZWN0JGI7CgoJdmFyIGhhc093blByb3BlcnR5JDEgPSB1bmN1cnJ5VGhpcyRDKHt9Lmhhc093blByb3BlcnR5KTsKCgkvLyBgSGFzT3duUHJvcGVydHlgIGFic3RyYWN0IG9wZXJhdGlvbgoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1oYXNvd25wcm9wZXJ0eQoJdmFyIGhhc093blByb3BlcnR5XzEkMSA9IE9iamVjdC5oYXNPd24gfHwgZnVuY3Rpb24gaGFzT3duKGl0LCBrZXkpIHsKCSAgcmV0dXJuIGhhc093blByb3BlcnR5JDEodG9PYmplY3QkYShpdCksIGtleSk7Cgl9OwoKCXZhciB1bmN1cnJ5VGhpcyRCID0gZnVuY3Rpb25VbmN1cnJ5VGhpcyQxOwoKCXZhciBpZCQxID0gMDsKCXZhciBwb3N0Zml4JDEgPSBNYXRoLnJhbmRvbSgpOwoJdmFyIHRvU3RyaW5nJGkgPSB1bmN1cnJ5VGhpcyRCKDEuMC50b1N0cmluZyk7CgoJdmFyIHVpZCQ2ID0gZnVuY3Rpb24gKGtleSkgewoJICByZXR1cm4gJ1N5bWJvbCgnICsgKGtleSA9PT0gdW5kZWZpbmVkID8gJycgOiBrZXkpICsgJylfJyArIHRvU3RyaW5nJGkoKytpZCQxICsgcG9zdGZpeCQxLCAzNik7Cgl9OwoKCXZhciBnbG9iYWwkWSA9IGdsb2JhbCQxODsKCXZhciBzaGFyZWQkOCA9IHNoYXJlZCQ5LmV4cG9ydHM7Cgl2YXIgaGFzT3duJGkgPSBoYXNPd25Qcm9wZXJ0eV8xJDE7Cgl2YXIgdWlkJDUgPSB1aWQkNjsKCXZhciBOQVRJVkVfU1lNQk9MJDMgPSBuYXRpdmVTeW1ib2wkMTsKCXZhciBVU0VfU1lNQk9MX0FTX1VJRCQyID0gdXNlU3ltYm9sQXNVaWQkMTsKCgl2YXIgV2VsbEtub3duU3ltYm9sc1N0b3JlJDIgPSBzaGFyZWQkOCgnd2tzJyk7Cgl2YXIgU3ltYm9sJDQgPSBnbG9iYWwkWS5TeW1ib2w7Cgl2YXIgc3ltYm9sRm9yJDEgPSBTeW1ib2wkNCAmJiBTeW1ib2wkNFsnZm9yJ107Cgl2YXIgY3JlYXRlV2VsbEtub3duU3ltYm9sJDEgPSBVU0VfU1lNQk9MX0FTX1VJRCQyID8gU3ltYm9sJDQgOiBTeW1ib2wkNCAmJiBTeW1ib2wkNC53aXRob3V0U2V0dGVyIHx8IHVpZCQ1OwoKCXZhciB3ZWxsS25vd25TeW1ib2wkbiA9IGZ1bmN0aW9uIChuYW1lKSB7CgkgIGlmICghaGFzT3duJGkoV2VsbEtub3duU3ltYm9sc1N0b3JlJDIsIG5hbWUpIHx8ICEoTkFUSVZFX1NZTUJPTCQzIHx8IHR5cGVvZiBXZWxsS25vd25TeW1ib2xzU3RvcmUkMltuYW1lXSA9PSAnc3RyaW5nJykpIHsKCSAgICB2YXIgZGVzY3JpcHRpb24gPSAnU3ltYm9sLicgKyBuYW1lOwoJICAgIGlmIChOQVRJVkVfU1lNQk9MJDMgJiYgaGFzT3duJGkoU3ltYm9sJDQsIG5hbWUpKSB7CgkgICAgICBXZWxsS25vd25TeW1ib2xzU3RvcmUkMltuYW1lXSA9IFN5bWJvbCQ0W25hbWVdOwoJICAgIH0gZWxzZSBpZiAoVVNFX1NZTUJPTF9BU19VSUQkMiAmJiBzeW1ib2xGb3IkMSkgewoJICAgICAgV2VsbEtub3duU3ltYm9sc1N0b3JlJDJbbmFtZV0gPSBzeW1ib2xGb3IkMShkZXNjcmlwdGlvbik7CgkgICAgfSBlbHNlIHsKCSAgICAgIFdlbGxLbm93blN5bWJvbHNTdG9yZSQyW25hbWVdID0gY3JlYXRlV2VsbEtub3duU3ltYm9sJDEoZGVzY3JpcHRpb24pOwoJICAgIH0KCSAgfSByZXR1cm4gV2VsbEtub3duU3ltYm9sc1N0b3JlJDJbbmFtZV07Cgl9OwoKCXZhciBnbG9iYWwkWCA9IGdsb2JhbCQxODsKCXZhciBjYWxsJGkgPSBmdW5jdGlvbkNhbGwkMTsKCXZhciBpc09iamVjdCRnID0gaXNPYmplY3QkaTsKCXZhciBpc1N5bWJvbCQ2ID0gaXNTeW1ib2wkNzsKCXZhciBnZXRNZXRob2QkNiA9IGdldE1ldGhvZCQ3OwoJdmFyIG9yZGluYXJ5VG9QcmltaXRpdmUkMiA9IG9yZGluYXJ5VG9QcmltaXRpdmUkMzsKCXZhciB3ZWxsS25vd25TeW1ib2wkbSA9IHdlbGxLbm93blN5bWJvbCRuOwoKCXZhciBUeXBlRXJyb3IkbCA9IGdsb2JhbCRYLlR5cGVFcnJvcjsKCXZhciBUT19QUklNSVRJVkUkMiA9IHdlbGxLbm93blN5bWJvbCRtKCd0b1ByaW1pdGl2ZScpOwoKCS8vIGBUb1ByaW1pdGl2ZWAgYWJzdHJhY3Qgb3BlcmF0aW9uCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLXRvcHJpbWl0aXZlCgl2YXIgdG9QcmltaXRpdmUkNCA9IGZ1bmN0aW9uIChpbnB1dCwgcHJlZikgewoJICBpZiAoIWlzT2JqZWN0JGcoaW5wdXQpIHx8IGlzU3ltYm9sJDYoaW5wdXQpKSByZXR1cm4gaW5wdXQ7CgkgIHZhciBleG90aWNUb1ByaW0gPSBnZXRNZXRob2QkNihpbnB1dCwgVE9fUFJJTUlUSVZFJDIpOwoJICB2YXIgcmVzdWx0OwoJICBpZiAoZXhvdGljVG9QcmltKSB7CgkgICAgaWYgKHByZWYgPT09IHVuZGVmaW5lZCkgcHJlZiA9ICdkZWZhdWx0JzsKCSAgICByZXN1bHQgPSBjYWxsJGkoZXhvdGljVG9QcmltLCBpbnB1dCwgcHJlZik7CgkgICAgaWYgKCFpc09iamVjdCRnKHJlc3VsdCkgfHwgaXNTeW1ib2wkNihyZXN1bHQpKSByZXR1cm4gcmVzdWx0OwoJICAgIHRocm93IFR5cGVFcnJvciRsKCJDYW4ndCBjb252ZXJ0IG9iamVjdCB0byBwcmltaXRpdmUgdmFsdWUiKTsKCSAgfQoJICBpZiAocHJlZiA9PT0gdW5kZWZpbmVkKSBwcmVmID0gJ251bWJlcic7CgkgIHJldHVybiBvcmRpbmFyeVRvUHJpbWl0aXZlJDIoaW5wdXQsIHByZWYpOwoJfTsKCgl2YXIgdG9QcmltaXRpdmUkMyA9IHRvUHJpbWl0aXZlJDQ7Cgl2YXIgaXNTeW1ib2wkNSA9IGlzU3ltYm9sJDc7CgoJLy8gYFRvUHJvcGVydHlLZXlgIGFic3RyYWN0IG9wZXJhdGlvbgoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy10b3Byb3BlcnR5a2V5Cgl2YXIgdG9Qcm9wZXJ0eUtleSQ4ID0gZnVuY3Rpb24gKGFyZ3VtZW50KSB7CgkgIHZhciBrZXkgPSB0b1ByaW1pdGl2ZSQzKGFyZ3VtZW50LCAnc3RyaW5nJyk7CgkgIHJldHVybiBpc1N5bWJvbCQ1KGtleSkgPyBrZXkgOiBrZXkgKyAnJzsKCX07CgoJdmFyIGdsb2JhbCRXID0gZ2xvYmFsJDE4OwoJdmFyIGlzT2JqZWN0JGYgPSBpc09iamVjdCRpOwoKCXZhciBkb2N1bWVudCQyID0gZ2xvYmFsJFcuZG9jdW1lbnQ7CgkvLyB0eXBlb2YgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCBpcyAnb2JqZWN0JyBpbiBvbGQgSUUKCXZhciBFWElTVFMkMyA9IGlzT2JqZWN0JGYoZG9jdW1lbnQkMikgJiYgaXNPYmplY3QkZihkb2N1bWVudCQyLmNyZWF0ZUVsZW1lbnQpOwoKCXZhciBkb2N1bWVudENyZWF0ZUVsZW1lbnQkMyA9IGZ1bmN0aW9uIChpdCkgewoJICByZXR1cm4gRVhJU1RTJDMgPyBkb2N1bWVudCQyLmNyZWF0ZUVsZW1lbnQoaXQpIDoge307Cgl9OwoKCXZhciBERVNDUklQVE9SUyRlID0gZGVzY3JpcHRvcnMkMTsKCXZhciBmYWlscyRwID0gZmFpbHMkdDsKCXZhciBjcmVhdGVFbGVtZW50JDEgPSBkb2N1bWVudENyZWF0ZUVsZW1lbnQkMzsKCgkvLyBUaGFuaydzIElFOCBmb3IgaGlzIGZ1bm55IGRlZmluZVByb3BlcnR5Cgl2YXIgaWU4RG9tRGVmaW5lJDEgPSAhREVTQ1JJUFRPUlMkZSAmJiAhZmFpbHMkcChmdW5jdGlvbiAoKSB7CgkgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBlcy9uby1vYmplY3QtZGVmaW5lcHJvcGVydHkgLS0gcmVxdWllZCBmb3IgdGVzdGluZwoJICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KGNyZWF0ZUVsZW1lbnQkMSgnZGl2JyksICdhJywgewoJICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gNzsgfQoJICB9KS5hICE9IDc7Cgl9KTsKCgl2YXIgREVTQ1JJUFRPUlMkZCA9IGRlc2NyaXB0b3JzJDE7Cgl2YXIgY2FsbCRoID0gZnVuY3Rpb25DYWxsJDE7Cgl2YXIgcHJvcGVydHlJc0VudW1lcmFibGVNb2R1bGUkMiA9IG9iamVjdFByb3BlcnR5SXNFbnVtZXJhYmxlJDE7Cgl2YXIgY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yJDggPSBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IkOTsKCXZhciB0b0luZGV4ZWRPYmplY3QkYyA9IHRvSW5kZXhlZE9iamVjdCRkOwoJdmFyIHRvUHJvcGVydHlLZXkkNyA9IHRvUHJvcGVydHlLZXkkODsKCXZhciBoYXNPd24kaCA9IGhhc093blByb3BlcnR5XzEkMTsKCXZhciBJRThfRE9NX0RFRklORSQzID0gaWU4RG9tRGVmaW5lJDE7CgoJLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGVzL25vLW9iamVjdC1nZXRvd25wcm9wZXJ0eWRlc2NyaXB0b3IgLS0gc2FmZQoJdmFyICRnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IkMiA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7CgoJLy8gYE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JgIG1ldGhvZAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1vYmplY3QuZ2V0b3ducHJvcGVydHlkZXNjcmlwdG9yCglvYmplY3RHZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IkMS5mID0gREVTQ1JJUFRPUlMkZCA/ICRnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IkMiA6IGZ1bmN0aW9uIGdldE93blByb3BlcnR5RGVzY3JpcHRvcihPLCBQKSB7CgkgIE8gPSB0b0luZGV4ZWRPYmplY3QkYyhPKTsKCSAgUCA9IHRvUHJvcGVydHlLZXkkNyhQKTsKCSAgaWYgKElFOF9ET01fREVGSU5FJDMpIHRyeSB7CgkgICAgcmV0dXJuICRnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IkMihPLCBQKTsKCSAgfSBjYXRjaCAoZXJyb3IpIHsgLyogZW1wdHkgKi8gfQoJICBpZiAoaGFzT3duJGgoTywgUCkpIHJldHVybiBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IkOCghY2FsbCRoKHByb3BlcnR5SXNFbnVtZXJhYmxlTW9kdWxlJDIuZiwgTywgUCksIE9bUF0pOwoJfTsKCgl2YXIgb2JqZWN0RGVmaW5lUHJvcGVydHkkMSA9IHt9OwoKCXZhciBnbG9iYWwkViA9IGdsb2JhbCQxODsKCXZhciBpc09iamVjdCRlID0gaXNPYmplY3QkaTsKCgl2YXIgU3RyaW5nJDggPSBnbG9iYWwkVi5TdHJpbmc7Cgl2YXIgVHlwZUVycm9yJGsgPSBnbG9iYWwkVi5UeXBlRXJyb3I7CgoJLy8gYEFzc2VydDogVHlwZShhcmd1bWVudCkgaXMgT2JqZWN0YAoJdmFyIGFuT2JqZWN0JGogPSBmdW5jdGlvbiAoYXJndW1lbnQpIHsKCSAgaWYgKGlzT2JqZWN0JGUoYXJndW1lbnQpKSByZXR1cm4gYXJndW1lbnQ7CgkgIHRocm93IFR5cGVFcnJvciRrKFN0cmluZyQ4KGFyZ3VtZW50KSArICcgaXMgbm90IGFuIG9iamVjdCcpOwoJfTsKCgl2YXIgZ2xvYmFsJFUgPSBnbG9iYWwkMTg7Cgl2YXIgREVTQ1JJUFRPUlMkYyA9IGRlc2NyaXB0b3JzJDE7Cgl2YXIgSUU4X0RPTV9ERUZJTkUkMiA9IGllOERvbURlZmluZSQxOwoJdmFyIGFuT2JqZWN0JGkgPSBhbk9iamVjdCRqOwoJdmFyIHRvUHJvcGVydHlLZXkkNiA9IHRvUHJvcGVydHlLZXkkODsKCgl2YXIgVHlwZUVycm9yJGogPSBnbG9iYWwkVS5UeXBlRXJyb3I7CgkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZXMvbm8tb2JqZWN0LWRlZmluZXByb3BlcnR5IC0tIHNhZmUKCXZhciAkZGVmaW5lUHJvcGVydHkkMiA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eTsKCgkvLyBgT2JqZWN0LmRlZmluZVByb3BlcnR5YCBtZXRob2QKCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtb2JqZWN0LmRlZmluZXByb3BlcnR5CglvYmplY3REZWZpbmVQcm9wZXJ0eSQxLmYgPSBERVNDUklQVE9SUyRjID8gJGRlZmluZVByb3BlcnR5JDIgOiBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0eShPLCBQLCBBdHRyaWJ1dGVzKSB7CgkgIGFuT2JqZWN0JGkoTyk7CgkgIFAgPSB0b1Byb3BlcnR5S2V5JDYoUCk7CgkgIGFuT2JqZWN0JGkoQXR0cmlidXRlcyk7CgkgIGlmIChJRThfRE9NX0RFRklORSQyKSB0cnkgewoJICAgIHJldHVybiAkZGVmaW5lUHJvcGVydHkkMihPLCBQLCBBdHRyaWJ1dGVzKTsKCSAgfSBjYXRjaCAoZXJyb3IpIHsgLyogZW1wdHkgKi8gfQoJICBpZiAoJ2dldCcgaW4gQXR0cmlidXRlcyB8fCAnc2V0JyBpbiBBdHRyaWJ1dGVzKSB0aHJvdyBUeXBlRXJyb3IkaignQWNjZXNzb3JzIG5vdCBzdXBwb3J0ZWQnKTsKCSAgaWYgKCd2YWx1ZScgaW4gQXR0cmlidXRlcykgT1tQXSA9IEF0dHJpYnV0ZXMudmFsdWU7CgkgIHJldHVybiBPOwoJfTsKCgl2YXIgREVTQ1JJUFRPUlMkYiA9IGRlc2NyaXB0b3JzJDE7Cgl2YXIgZGVmaW5lUHJvcGVydHlNb2R1bGUkNyA9IG9iamVjdERlZmluZVByb3BlcnR5JDE7Cgl2YXIgY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yJDcgPSBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IkOTsKCgl2YXIgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5JGEgPSBERVNDUklQVE9SUyRiID8gZnVuY3Rpb24gKG9iamVjdCwga2V5LCB2YWx1ZSkgewoJICByZXR1cm4gZGVmaW5lUHJvcGVydHlNb2R1bGUkNy5mKG9iamVjdCwga2V5LCBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IkNygxLCB2YWx1ZSkpOwoJfSA6IGZ1bmN0aW9uIChvYmplY3QsIGtleSwgdmFsdWUpIHsKCSAgb2JqZWN0W2tleV0gPSB2YWx1ZTsKCSAgcmV0dXJuIG9iamVjdDsKCX07CgoJdmFyIHJlZGVmaW5lJDggPSB7ZXhwb3J0czoge319OwoKCXZhciB1bmN1cnJ5VGhpcyRBID0gZnVuY3Rpb25VbmN1cnJ5VGhpcyQxOwoJdmFyIGlzQ2FsbGFibGUkcCA9IGlzQ2FsbGFibGUkdjsKCXZhciBzdG9yZSQ1ID0gc2hhcmVkU3RvcmUkMTsKCgl2YXIgZnVuY3Rpb25Ub1N0cmluZyQyID0gdW5jdXJyeVRoaXMkQShGdW5jdGlvbi50b1N0cmluZyk7CgoJLy8gdGhpcyBoZWxwZXIgYnJva2VuIGluIGBjb3JlLWpzQDMuNC4xLTMuNC40YCwgc28gd2UgY2FuJ3QgdXNlIGBzaGFyZWRgIGhlbHBlcgoJaWYgKCFpc0NhbGxhYmxlJHAoc3RvcmUkNS5pbnNwZWN0U291cmNlKSkgewoJICBzdG9yZSQ1Lmluc3BlY3RTb3VyY2UgPSBmdW5jdGlvbiAoaXQpIHsKCSAgICByZXR1cm4gZnVuY3Rpb25Ub1N0cmluZyQyKGl0KTsKCSAgfTsKCX0KCgl2YXIgaW5zcGVjdFNvdXJjZSQ2ID0gc3RvcmUkNS5pbnNwZWN0U291cmNlOwoKCXZhciBnbG9iYWwkVCA9IGdsb2JhbCQxODsKCXZhciBpc0NhbGxhYmxlJG8gPSBpc0NhbGxhYmxlJHY7Cgl2YXIgaW5zcGVjdFNvdXJjZSQ1ID0gaW5zcGVjdFNvdXJjZSQ2OwoKCXZhciBXZWFrTWFwJDMgPSBnbG9iYWwkVC5XZWFrTWFwOwoKCXZhciBuYXRpdmVXZWFrTWFwJDEgPSBpc0NhbGxhYmxlJG8oV2Vha01hcCQzKSAmJiAvbmF0aXZlIGNvZGUvLnRlc3QoaW5zcGVjdFNvdXJjZSQ1KFdlYWtNYXAkMykpOwoKCXZhciBzaGFyZWQkNyA9IHNoYXJlZCQ5LmV4cG9ydHM7Cgl2YXIgdWlkJDQgPSB1aWQkNjsKCgl2YXIga2V5cyQyID0gc2hhcmVkJDcoJ2tleXMnKTsKCgl2YXIgc2hhcmVkS2V5JDcgPSBmdW5jdGlvbiAoa2V5KSB7CgkgIHJldHVybiBrZXlzJDJba2V5XSB8fCAoa2V5cyQyW2tleV0gPSB1aWQkNChrZXkpKTsKCX07CgoJdmFyIGhpZGRlbktleXMkYSA9IHt9OwoKCXZhciBOQVRJVkVfV0VBS19NQVAkMSA9IG5hdGl2ZVdlYWtNYXAkMTsKCXZhciBnbG9iYWwkUyA9IGdsb2JhbCQxODsKCXZhciB1bmN1cnJ5VGhpcyR6ID0gZnVuY3Rpb25VbmN1cnJ5VGhpcyQxOwoJdmFyIGlzT2JqZWN0JGQgPSBpc09iamVjdCRpOwoJdmFyIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSQ5ID0gY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5JGE7Cgl2YXIgaGFzT3duJGcgPSBoYXNPd25Qcm9wZXJ0eV8xJDE7Cgl2YXIgc2hhcmVkJDYgPSBzaGFyZWRTdG9yZSQxOwoJdmFyIHNoYXJlZEtleSQ2ID0gc2hhcmVkS2V5JDc7Cgl2YXIgaGlkZGVuS2V5cyQ5ID0gaGlkZGVuS2V5cyRhOwoKCXZhciBPQkpFQ1RfQUxSRUFEWV9JTklUSUFMSVpFRCQxID0gJ09iamVjdCBhbHJlYWR5IGluaXRpYWxpemVkJzsKCXZhciBUeXBlRXJyb3IkaSA9IGdsb2JhbCRTLlR5cGVFcnJvcjsKCXZhciBXZWFrTWFwJDIgPSBnbG9iYWwkUy5XZWFrTWFwOwoJdmFyIHNldCQxLCBnZXQkMSwgaGFzJDE7CgoJdmFyIGVuZm9yY2UkMSA9IGZ1bmN0aW9uIChpdCkgewoJICByZXR1cm4gaGFzJDEoaXQpID8gZ2V0JDEoaXQpIDogc2V0JDEoaXQsIHt9KTsKCX07CgoJdmFyIGdldHRlckZvciQxID0gZnVuY3Rpb24gKFRZUEUpIHsKCSAgcmV0dXJuIGZ1bmN0aW9uIChpdCkgewoJICAgIHZhciBzdGF0ZTsKCSAgICBpZiAoIWlzT2JqZWN0JGQoaXQpIHx8IChzdGF0ZSA9IGdldCQxKGl0KSkudHlwZSAhPT0gVFlQRSkgewoJICAgICAgdGhyb3cgVHlwZUVycm9yJGkoJ0luY29tcGF0aWJsZSByZWNlaXZlciwgJyArIFRZUEUgKyAnIHJlcXVpcmVkJyk7CgkgICAgfSByZXR1cm4gc3RhdGU7CgkgIH07Cgl9OwoKCWlmIChOQVRJVkVfV0VBS19NQVAkMSB8fCBzaGFyZWQkNi5zdGF0ZSkgewoJICB2YXIgc3RvcmUkNCA9IHNoYXJlZCQ2LnN0YXRlIHx8IChzaGFyZWQkNi5zdGF0ZSA9IG5ldyBXZWFrTWFwJDIoKSk7CgkgIHZhciB3bWdldCQxID0gdW5jdXJyeVRoaXMkeihzdG9yZSQ0LmdldCk7CgkgIHZhciB3bWhhcyQxID0gdW5jdXJyeVRoaXMkeihzdG9yZSQ0Lmhhcyk7CgkgIHZhciB3bXNldCQxID0gdW5jdXJyeVRoaXMkeihzdG9yZSQ0LnNldCk7CgkgIHNldCQxID0gZnVuY3Rpb24gKGl0LCBtZXRhZGF0YSkgewoJICAgIGlmICh3bWhhcyQxKHN0b3JlJDQsIGl0KSkgdGhyb3cgbmV3IFR5cGVFcnJvciRpKE9CSkVDVF9BTFJFQURZX0lOSVRJQUxJWkVEJDEpOwoJICAgIG1ldGFkYXRhLmZhY2FkZSA9IGl0OwoJICAgIHdtc2V0JDEoc3RvcmUkNCwgaXQsIG1ldGFkYXRhKTsKCSAgICByZXR1cm4gbWV0YWRhdGE7CgkgIH07CgkgIGdldCQxID0gZnVuY3Rpb24gKGl0KSB7CgkgICAgcmV0dXJuIHdtZ2V0JDEoc3RvcmUkNCwgaXQpIHx8IHt9OwoJICB9OwoJICBoYXMkMSA9IGZ1bmN0aW9uIChpdCkgewoJICAgIHJldHVybiB3bWhhcyQxKHN0b3JlJDQsIGl0KTsKCSAgfTsKCX0gZWxzZSB7CgkgIHZhciBTVEFURSQxID0gc2hhcmVkS2V5JDYoJ3N0YXRlJyk7CgkgIGhpZGRlbktleXMkOVtTVEFURSQxXSA9IHRydWU7CgkgIHNldCQxID0gZnVuY3Rpb24gKGl0LCBtZXRhZGF0YSkgewoJICAgIGlmIChoYXNPd24kZyhpdCwgU1RBVEUkMSkpIHRocm93IG5ldyBUeXBlRXJyb3IkaShPQkpFQ1RfQUxSRUFEWV9JTklUSUFMSVpFRCQxKTsKCSAgICBtZXRhZGF0YS5mYWNhZGUgPSBpdDsKCSAgICBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkkOShpdCwgU1RBVEUkMSwgbWV0YWRhdGEpOwoJICAgIHJldHVybiBtZXRhZGF0YTsKCSAgfTsKCSAgZ2V0JDEgPSBmdW5jdGlvbiAoaXQpIHsKCSAgICByZXR1cm4gaGFzT3duJGcoaXQsIFNUQVRFJDEpID8gaXRbU1RBVEUkMV0gOiB7fTsKCSAgfTsKCSAgaGFzJDEgPSBmdW5jdGlvbiAoaXQpIHsKCSAgICByZXR1cm4gaGFzT3duJGcoaXQsIFNUQVRFJDEpOwoJICB9OwoJfQoKCXZhciBpbnRlcm5hbFN0YXRlJDEgPSB7CgkgIHNldDogc2V0JDEsCgkgIGdldDogZ2V0JDEsCgkgIGhhczogaGFzJDEsCgkgIGVuZm9yY2U6IGVuZm9yY2UkMSwKCSAgZ2V0dGVyRm9yOiBnZXR0ZXJGb3IkMQoJfTsKCgl2YXIgREVTQ1JJUFRPUlMkYSA9IGRlc2NyaXB0b3JzJDE7Cgl2YXIgaGFzT3duJGYgPSBoYXNPd25Qcm9wZXJ0eV8xJDE7CgoJdmFyIEZ1bmN0aW9uUHJvdG90eXBlJDUgPSBGdW5jdGlvbi5wcm90b3R5cGU7CgkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZXMvbm8tb2JqZWN0LWdldG93bnByb3BlcnR5ZGVzY3JpcHRvciAtLSBzYWZlCgl2YXIgZ2V0RGVzY3JpcHRvciQxID0gREVTQ1JJUFRPUlMkYSAmJiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOwoKCXZhciBFWElTVFMkMiA9IGhhc093biRmKEZ1bmN0aW9uUHJvdG90eXBlJDUsICduYW1lJyk7CgkvLyBhZGRpdGlvbmFsIHByb3RlY3Rpb24gZnJvbSBtaW5pZmllZCAvIG1hbmdsZWQgLyBkcm9wcGVkIGZ1bmN0aW9uIG5hbWVzCgl2YXIgUFJPUEVSJDEgPSBFWElTVFMkMiAmJiAoZnVuY3Rpb24gc29tZXRoaW5nKCkgeyAvKiBlbXB0eSAqLyB9KS5uYW1lID09PSAnc29tZXRoaW5nJzsKCXZhciBDT05GSUdVUkFCTEUkMSA9IEVYSVNUUyQyICYmICghREVTQ1JJUFRPUlMkYSB8fCAoREVTQ1JJUFRPUlMkYSAmJiBnZXREZXNjcmlwdG9yJDEoRnVuY3Rpb25Qcm90b3R5cGUkNSwgJ25hbWUnKS5jb25maWd1cmFibGUpKTsKCgl2YXIgZnVuY3Rpb25OYW1lJDEgPSB7CgkgIEVYSVNUUzogRVhJU1RTJDIsCgkgIFBST1BFUjogUFJPUEVSJDEsCgkgIENPTkZJR1VSQUJMRTogQ09ORklHVVJBQkxFJDEKCX07CgoJdmFyIGdsb2JhbCRSID0gZ2xvYmFsJDE4OwoJdmFyIGlzQ2FsbGFibGUkbiA9IGlzQ2FsbGFibGUkdjsKCXZhciBoYXNPd24kZSA9IGhhc093blByb3BlcnR5XzEkMTsKCXZhciBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkkOCA9IGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSRhOwoJdmFyIHNldEdsb2JhbCQzID0gc2V0R2xvYmFsJDU7Cgl2YXIgaW5zcGVjdFNvdXJjZSQ0ID0gaW5zcGVjdFNvdXJjZSQ2OwoJdmFyIEludGVybmFsU3RhdGVNb2R1bGUkMyA9IGludGVybmFsU3RhdGUkMTsKCXZhciBDT05GSUdVUkFCTEVfRlVOQ1RJT05fTkFNRSA9IGZ1bmN0aW9uTmFtZSQxLkNPTkZJR1VSQUJMRTsKCgl2YXIgZ2V0SW50ZXJuYWxTdGF0ZSQ0ID0gSW50ZXJuYWxTdGF0ZU1vZHVsZSQzLmdldDsKCXZhciBlbmZvcmNlSW50ZXJuYWxTdGF0ZSA9IEludGVybmFsU3RhdGVNb2R1bGUkMy5lbmZvcmNlOwoJdmFyIFRFTVBMQVRFID0gU3RyaW5nKFN0cmluZykuc3BsaXQoJ1N0cmluZycpOwoKCShyZWRlZmluZSQ4LmV4cG9ydHMgPSBmdW5jdGlvbiAoTywga2V5LCB2YWx1ZSwgb3B0aW9ucykgewoJICB2YXIgdW5zYWZlID0gb3B0aW9ucyA/ICEhb3B0aW9ucy51bnNhZmUgOiBmYWxzZTsKCSAgdmFyIHNpbXBsZSA9IG9wdGlvbnMgPyAhIW9wdGlvbnMuZW51bWVyYWJsZSA6IGZhbHNlOwoJICB2YXIgbm9UYXJnZXRHZXQgPSBvcHRpb25zID8gISFvcHRpb25zLm5vVGFyZ2V0R2V0IDogZmFsc2U7CgkgIHZhciBuYW1lID0gb3B0aW9ucyAmJiBvcHRpb25zLm5hbWUgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMubmFtZSA6IGtleTsKCSAgdmFyIHN0YXRlOwoJICBpZiAoaXNDYWxsYWJsZSRuKHZhbHVlKSkgewoJICAgIGlmIChTdHJpbmcobmFtZSkuc2xpY2UoMCwgNykgPT09ICdTeW1ib2woJykgewoJICAgICAgbmFtZSA9ICdbJyArIFN0cmluZyhuYW1lKS5yZXBsYWNlKC9eU3ltYm9sXCgoW14pXSopXCkvLCAnJDEnKSArICddJzsKCSAgICB9CgkgICAgaWYgKCFoYXNPd24kZSh2YWx1ZSwgJ25hbWUnKSB8fCAoQ09ORklHVVJBQkxFX0ZVTkNUSU9OX05BTUUgJiYgdmFsdWUubmFtZSAhPT0gbmFtZSkpIHsKCSAgICAgIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSQ4KHZhbHVlLCAnbmFtZScsIG5hbWUpOwoJICAgIH0KCSAgICBzdGF0ZSA9IGVuZm9yY2VJbnRlcm5hbFN0YXRlKHZhbHVlKTsKCSAgICBpZiAoIXN0YXRlLnNvdXJjZSkgewoJICAgICAgc3RhdGUuc291cmNlID0gVEVNUExBVEUuam9pbih0eXBlb2YgbmFtZSA9PSAnc3RyaW5nJyA/IG5hbWUgOiAnJyk7CgkgICAgfQoJICB9CgkgIGlmIChPID09PSBnbG9iYWwkUikgewoJICAgIGlmIChzaW1wbGUpIE9ba2V5XSA9IHZhbHVlOwoJICAgIGVsc2Ugc2V0R2xvYmFsJDMoa2V5LCB2YWx1ZSk7CgkgICAgcmV0dXJuOwoJICB9IGVsc2UgaWYgKCF1bnNhZmUpIHsKCSAgICBkZWxldGUgT1trZXldOwoJICB9IGVsc2UgaWYgKCFub1RhcmdldEdldCAmJiBPW2tleV0pIHsKCSAgICBzaW1wbGUgPSB0cnVlOwoJICB9CgkgIGlmIChzaW1wbGUpIE9ba2V5XSA9IHZhbHVlOwoJICBlbHNlIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSQ4KE8sIGtleSwgdmFsdWUpOwoJLy8gYWRkIGZha2UgRnVuY3Rpb24jdG9TdHJpbmcgZm9yIGNvcnJlY3Qgd29yayB3cmFwcGVkIG1ldGhvZHMgLyBjb25zdHJ1Y3RvcnMgd2l0aCBtZXRob2RzIGxpa2UgTG9EYXNoIGlzTmF0aXZlCgl9KShGdW5jdGlvbi5wcm90b3R5cGUsICd0b1N0cmluZycsIGZ1bmN0aW9uIHRvU3RyaW5nKCkgewoJICByZXR1cm4gaXNDYWxsYWJsZSRuKHRoaXMpICYmIGdldEludGVybmFsU3RhdGUkNCh0aGlzKS5zb3VyY2UgfHwgaW5zcGVjdFNvdXJjZSQ0KHRoaXMpOwoJfSk7CgoJdmFyIG9iamVjdEdldE93blByb3BlcnR5TmFtZXMkMSA9IHt9OwoKCXZhciBjZWlsJDEgPSBNYXRoLmNlaWw7Cgl2YXIgZmxvb3IkMiA9IE1hdGguZmxvb3I7CgoJLy8gYFRvSW50ZWdlck9ySW5maW5pdHlgIGFic3RyYWN0IG9wZXJhdGlvbgoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy10b2ludGVnZXJvcmluZmluaXR5Cgl2YXIgdG9JbnRlZ2VyT3JJbmZpbml0eSRhID0gZnVuY3Rpb24gKGFyZ3VtZW50KSB7CgkgIHZhciBudW1iZXIgPSArYXJndW1lbnQ7CgkgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1zZWxmLWNvbXBhcmUgLS0gc2FmZQoJICByZXR1cm4gbnVtYmVyICE9PSBudW1iZXIgfHwgbnVtYmVyID09PSAwID8gMCA6IChudW1iZXIgPiAwID8gZmxvb3IkMiA6IGNlaWwkMSkobnVtYmVyKTsKCX07CgoJdmFyIHRvSW50ZWdlck9ySW5maW5pdHkkOSA9IHRvSW50ZWdlck9ySW5maW5pdHkkYTsKCgl2YXIgbWF4JDUgPSBNYXRoLm1heDsKCXZhciBtaW4kNSA9IE1hdGgubWluOwoKCS8vIEhlbHBlciBmb3IgYSBwb3B1bGFyIHJlcGVhdGluZyBjYXNlIG9mIHRoZSBzcGVjOgoJLy8gTGV0IGludGVnZXIgYmUgPyBUb0ludGVnZXIoaW5kZXgpLgoJLy8gSWYgaW50ZWdlciA8IDAsIGxldCByZXN1bHQgYmUgbWF4KChsZW5ndGggKyBpbnRlZ2VyKSwgMCk7IGVsc2UgbGV0IHJlc3VsdCBiZSBtaW4oaW50ZWdlciwgbGVuZ3RoKS4KCXZhciB0b0Fic29sdXRlSW5kZXgkOCA9IGZ1bmN0aW9uIChpbmRleCwgbGVuZ3RoKSB7CgkgIHZhciBpbnRlZ2VyID0gdG9JbnRlZ2VyT3JJbmZpbml0eSQ5KGluZGV4KTsKCSAgcmV0dXJuIGludGVnZXIgPCAwID8gbWF4JDUoaW50ZWdlciArIGxlbmd0aCwgMCkgOiBtaW4kNShpbnRlZ2VyLCBsZW5ndGgpOwoJfTsKCgl2YXIgdG9JbnRlZ2VyT3JJbmZpbml0eSQ4ID0gdG9JbnRlZ2VyT3JJbmZpbml0eSRhOwoKCXZhciBtaW4kNCA9IE1hdGgubWluOwoKCS8vIGBUb0xlbmd0aGAgYWJzdHJhY3Qgb3BlcmF0aW9uCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLXRvbGVuZ3RoCgl2YXIgdG9MZW5ndGgkNSA9IGZ1bmN0aW9uIChhcmd1bWVudCkgewoJICByZXR1cm4gYXJndW1lbnQgPiAwID8gbWluJDQodG9JbnRlZ2VyT3JJbmZpbml0eSQ4KGFyZ3VtZW50KSwgMHgxRkZGRkZGRkZGRkZGRikgOiAwOyAvLyAyICoqIDUzIC0gMSA9PSA5MDA3MTk5MjU0NzQwOTkxCgl9OwoKCXZhciB0b0xlbmd0aCQ0ID0gdG9MZW5ndGgkNTsKCgkvLyBgTGVuZ3RoT2ZBcnJheUxpa2VgIGFic3RyYWN0IG9wZXJhdGlvbgoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1sZW5ndGhvZmFycmF5bGlrZQoJdmFyIGxlbmd0aE9mQXJyYXlMaWtlJGMgPSBmdW5jdGlvbiAob2JqKSB7CgkgIHJldHVybiB0b0xlbmd0aCQ0KG9iai5sZW5ndGgpOwoJfTsKCgl2YXIgdG9JbmRleGVkT2JqZWN0JGIgPSB0b0luZGV4ZWRPYmplY3QkZDsKCXZhciB0b0Fic29sdXRlSW5kZXgkNyA9IHRvQWJzb2x1dGVJbmRleCQ4OwoJdmFyIGxlbmd0aE9mQXJyYXlMaWtlJGIgPSBsZW5ndGhPZkFycmF5TGlrZSRjOwoKCS8vIGBBcnJheS5wcm90b3R5cGUueyBpbmRleE9mLCBpbmNsdWRlcyB9YCBtZXRob2RzIGltcGxlbWVudGF0aW9uCgl2YXIgY3JlYXRlTWV0aG9kJDcgPSBmdW5jdGlvbiAoSVNfSU5DTFVERVMpIHsKCSAgcmV0dXJuIGZ1bmN0aW9uICgkdGhpcywgZWwsIGZyb21JbmRleCkgewoJICAgIHZhciBPID0gdG9JbmRleGVkT2JqZWN0JGIoJHRoaXMpOwoJICAgIHZhciBsZW5ndGggPSBsZW5ndGhPZkFycmF5TGlrZSRiKE8pOwoJICAgIHZhciBpbmRleCA9IHRvQWJzb2x1dGVJbmRleCQ3KGZyb21JbmRleCwgbGVuZ3RoKTsKCSAgICB2YXIgdmFsdWU7CgkgICAgLy8gQXJyYXkjaW5jbHVkZXMgdXNlcyBTYW1lVmFsdWVaZXJvIGVxdWFsaXR5IGFsZ29yaXRobQoJICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1zZWxmLWNvbXBhcmUgLS0gTmFOIGNoZWNrCgkgICAgaWYgKElTX0lOQ0xVREVTICYmIGVsICE9IGVsKSB3aGlsZSAobGVuZ3RoID4gaW5kZXgpIHsKCSAgICAgIHZhbHVlID0gT1tpbmRleCsrXTsKCSAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1zZWxmLWNvbXBhcmUgLS0gTmFOIGNoZWNrCgkgICAgICBpZiAodmFsdWUgIT0gdmFsdWUpIHJldHVybiB0cnVlOwoJICAgIC8vIEFycmF5I2luZGV4T2YgaWdub3JlcyBob2xlcywgQXJyYXkjaW5jbHVkZXMgLSBub3QKCSAgICB9IGVsc2UgZm9yICg7bGVuZ3RoID4gaW5kZXg7IGluZGV4KyspIHsKCSAgICAgIGlmICgoSVNfSU5DTFVERVMgfHwgaW5kZXggaW4gTykgJiYgT1tpbmRleF0gPT09IGVsKSByZXR1cm4gSVNfSU5DTFVERVMgfHwgaW5kZXggfHwgMDsKCSAgICB9IHJldHVybiAhSVNfSU5DTFVERVMgJiYgLTE7CgkgIH07Cgl9OwoKCXZhciBhcnJheUluY2x1ZGVzJDEgPSB7CgkgIC8vIGBBcnJheS5wcm90b3R5cGUuaW5jbHVkZXNgIG1ldGhvZAoJICAvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLWFycmF5LnByb3RvdHlwZS5pbmNsdWRlcwoJICBpbmNsdWRlczogY3JlYXRlTWV0aG9kJDcodHJ1ZSksCgkgIC8vIGBBcnJheS5wcm90b3R5cGUuaW5kZXhPZmAgbWV0aG9kCgkgIC8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtYXJyYXkucHJvdG90eXBlLmluZGV4b2YKCSAgaW5kZXhPZjogY3JlYXRlTWV0aG9kJDcoZmFsc2UpCgl9OwoKCXZhciB1bmN1cnJ5VGhpcyR5ID0gZnVuY3Rpb25VbmN1cnJ5VGhpcyQxOwoJdmFyIGhhc093biRkID0gaGFzT3duUHJvcGVydHlfMSQxOwoJdmFyIHRvSW5kZXhlZE9iamVjdCRhID0gdG9JbmRleGVkT2JqZWN0JGQ7Cgl2YXIgaW5kZXhPZiQyID0gYXJyYXlJbmNsdWRlcyQxLmluZGV4T2Y7Cgl2YXIgaGlkZGVuS2V5cyQ4ID0gaGlkZGVuS2V5cyRhOwoKCXZhciBwdXNoJDQgPSB1bmN1cnJ5VGhpcyR5KFtdLnB1c2gpOwoKCXZhciBvYmplY3RLZXlzSW50ZXJuYWwkMSA9IGZ1bmN0aW9uIChvYmplY3QsIG5hbWVzKSB7CgkgIHZhciBPID0gdG9JbmRleGVkT2JqZWN0JGEob2JqZWN0KTsKCSAgdmFyIGkgPSAwOwoJICB2YXIgcmVzdWx0ID0gW107CgkgIHZhciBrZXk7CgkgIGZvciAoa2V5IGluIE8pICFoYXNPd24kZChoaWRkZW5LZXlzJDgsIGtleSkgJiYgaGFzT3duJGQoTywga2V5KSAmJiBwdXNoJDQocmVzdWx0LCBrZXkpOwoJICAvLyBEb24ndCBlbnVtIGJ1ZyAmIGhpZGRlbiBrZXlzCgkgIHdoaWxlIChuYW1lcy5sZW5ndGggPiBpKSBpZiAoaGFzT3duJGQoTywga2V5ID0gbmFtZXNbaSsrXSkpIHsKCSAgICB+aW5kZXhPZiQyKHJlc3VsdCwga2V5KSB8fCBwdXNoJDQocmVzdWx0LCBrZXkpOwoJICB9CgkgIHJldHVybiByZXN1bHQ7Cgl9OwoKCS8vIElFOC0gZG9uJ3QgZW51bSBidWcga2V5cwoJdmFyIGVudW1CdWdLZXlzJDcgPSBbCgkgICdjb25zdHJ1Y3RvcicsCgkgICdoYXNPd25Qcm9wZXJ0eScsCgkgICdpc1Byb3RvdHlwZU9mJywKCSAgJ3Byb3BlcnR5SXNFbnVtZXJhYmxlJywKCSAgJ3RvTG9jYWxlU3RyaW5nJywKCSAgJ3RvU3RyaW5nJywKCSAgJ3ZhbHVlT2YnCgldOwoKCXZhciBpbnRlcm5hbE9iamVjdEtleXMkMyA9IG9iamVjdEtleXNJbnRlcm5hbCQxOwoJdmFyIGVudW1CdWdLZXlzJDYgPSBlbnVtQnVnS2V5cyQ3OwoKCXZhciBoaWRkZW5LZXlzJDcgPSBlbnVtQnVnS2V5cyQ2LmNvbmNhdCgnbGVuZ3RoJywgJ3Byb3RvdHlwZScpOwoKCS8vIGBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lc2AgbWV0aG9kCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLW9iamVjdC5nZXRvd25wcm9wZXJ0eW5hbWVzCgkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZXMvbm8tb2JqZWN0LWdldG93bnByb3BlcnR5bmFtZXMgLS0gc2FmZQoJb2JqZWN0R2V0T3duUHJvcGVydHlOYW1lcyQxLmYgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyB8fCBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eU5hbWVzKE8pIHsKCSAgcmV0dXJuIGludGVybmFsT2JqZWN0S2V5cyQzKE8sIGhpZGRlbktleXMkNyk7Cgl9OwoKCXZhciBvYmplY3RHZXRPd25Qcm9wZXJ0eVN5bWJvbHMkMSA9IHt9OwoKCS8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBlcy9uby1vYmplY3QtZ2V0b3ducHJvcGVydHlzeW1ib2xzIC0tIHNhZmUKCW9iamVjdEdldE93blByb3BlcnR5U3ltYm9scyQxLmYgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzOwoKCXZhciBnZXRCdWlsdEluJDggPSBnZXRCdWlsdEluJGI7Cgl2YXIgdW5jdXJyeVRoaXMkeCA9IGZ1bmN0aW9uVW5jdXJyeVRoaXMkMTsKCXZhciBnZXRPd25Qcm9wZXJ0eU5hbWVzTW9kdWxlJDEgPSBvYmplY3RHZXRPd25Qcm9wZXJ0eU5hbWVzJDE7Cgl2YXIgZ2V0T3duUHJvcGVydHlTeW1ib2xzTW9kdWxlJDEgPSBvYmplY3RHZXRPd25Qcm9wZXJ0eVN5bWJvbHMkMTsKCXZhciBhbk9iamVjdCRoID0gYW5PYmplY3QkajsKCgl2YXIgY29uY2F0JDQgPSB1bmN1cnJ5VGhpcyR4KFtdLmNvbmNhdCk7CgoJLy8gYWxsIG9iamVjdCBrZXlzLCBpbmNsdWRlcyBub24tZW51bWVyYWJsZSBhbmQgc3ltYm9scwoJdmFyIG93bktleXMkMSA9IGdldEJ1aWx0SW4kOCgnUmVmbGVjdCcsICdvd25LZXlzJykgfHwgZnVuY3Rpb24gb3duS2V5cyhpdCkgewoJICB2YXIga2V5cyA9IGdldE93blByb3BlcnR5TmFtZXNNb2R1bGUkMS5mKGFuT2JqZWN0JGgoaXQpKTsKCSAgdmFyIGdldE93blByb3BlcnR5U3ltYm9scyA9IGdldE93blByb3BlcnR5U3ltYm9sc01vZHVsZSQxLmY7CgkgIHJldHVybiBnZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPyBjb25jYXQkNChrZXlzLCBnZXRPd25Qcm9wZXJ0eVN5bWJvbHMoaXQpKSA6IGtleXM7Cgl9OwoKCXZhciBoYXNPd24kYyA9IGhhc093blByb3BlcnR5XzEkMTsKCXZhciBvd25LZXlzID0gb3duS2V5cyQxOwoJdmFyIGdldE93blByb3BlcnR5RGVzY3JpcHRvck1vZHVsZSQxID0gb2JqZWN0R2V0T3duUHJvcGVydHlEZXNjcmlwdG9yJDE7Cgl2YXIgZGVmaW5lUHJvcGVydHlNb2R1bGUkNiA9IG9iamVjdERlZmluZVByb3BlcnR5JDE7CgoJdmFyIGNvcHlDb25zdHJ1Y3RvclByb3BlcnRpZXMkMSA9IGZ1bmN0aW9uICh0YXJnZXQsIHNvdXJjZSkgewoJICB2YXIga2V5cyA9IG93bktleXMoc291cmNlKTsKCSAgdmFyIGRlZmluZVByb3BlcnR5ID0gZGVmaW5lUHJvcGVydHlNb2R1bGUkNi5mOwoJICB2YXIgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID0gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yTW9kdWxlJDEuZjsKCSAgZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7CgkgICAgdmFyIGtleSA9IGtleXNbaV07CgkgICAgaWYgKCFoYXNPd24kYyh0YXJnZXQsIGtleSkpIGRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsKCSAgfQoJfTsKCgl2YXIgZmFpbHMkbyA9IGZhaWxzJHQ7Cgl2YXIgaXNDYWxsYWJsZSRtID0gaXNDYWxsYWJsZSR2OwoKCXZhciByZXBsYWNlbWVudCQxID0gLyN8XC5wcm90b3R5cGVcLi87CgoJdmFyIGlzRm9yY2VkJDQgPSBmdW5jdGlvbiAoZmVhdHVyZSwgZGV0ZWN0aW9uKSB7CgkgIHZhciB2YWx1ZSA9IGRhdGEkMVtub3JtYWxpemUkMShmZWF0dXJlKV07CgkgIHJldHVybiB2YWx1ZSA9PSBQT0xZRklMTCQxID8gdHJ1ZQoJICAgIDogdmFsdWUgPT0gTkFUSVZFJDEgPyBmYWxzZQoJICAgIDogaXNDYWxsYWJsZSRtKGRldGVjdGlvbikgPyBmYWlscyRvKGRldGVjdGlvbikKCSAgICA6ICEhZGV0ZWN0aW9uOwoJfTsKCgl2YXIgbm9ybWFsaXplJDEgPSBpc0ZvcmNlZCQ0Lm5vcm1hbGl6ZSA9IGZ1bmN0aW9uIChzdHJpbmcpIHsKCSAgcmV0dXJuIFN0cmluZyhzdHJpbmcpLnJlcGxhY2UocmVwbGFjZW1lbnQkMSwgJy4nKS50b0xvd2VyQ2FzZSgpOwoJfTsKCgl2YXIgZGF0YSQxID0gaXNGb3JjZWQkNC5kYXRhID0ge307Cgl2YXIgTkFUSVZFJDEgPSBpc0ZvcmNlZCQ0Lk5BVElWRSA9ICdOJzsKCXZhciBQT0xZRklMTCQxID0gaXNGb3JjZWQkNC5QT0xZRklMTCA9ICdQJzsKCgl2YXIgaXNGb3JjZWRfMSQxID0gaXNGb3JjZWQkNDsKCgl2YXIgZ2xvYmFsJFEgPSBnbG9iYWwkMTg7Cgl2YXIgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yJDMgPSBvYmplY3RHZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IkMS5mOwoJdmFyIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSQ3ID0gY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5JGE7Cgl2YXIgcmVkZWZpbmUkNyA9IHJlZGVmaW5lJDguZXhwb3J0czsKCXZhciBzZXRHbG9iYWwkMiA9IHNldEdsb2JhbCQ1OwoJdmFyIGNvcHlDb25zdHJ1Y3RvclByb3BlcnRpZXMgPSBjb3B5Q29uc3RydWN0b3JQcm9wZXJ0aWVzJDE7Cgl2YXIgaXNGb3JjZWQkMyA9IGlzRm9yY2VkXzEkMTsKCgkvKgoJICBvcHRpb25zLnRhcmdldCAgICAgIC0gbmFtZSBvZiB0aGUgdGFyZ2V0IG9iamVjdAoJICBvcHRpb25zLmdsb2JhbCAgICAgIC0gdGFyZ2V0IGlzIHRoZSBnbG9iYWwgb2JqZWN0CgkgIG9wdGlvbnMuc3RhdCAgICAgICAgLSBleHBvcnQgYXMgc3RhdGljIG1ldGhvZHMgb2YgdGFyZ2V0CgkgIG9wdGlvbnMucHJvdG8gICAgICAgLSBleHBvcnQgYXMgcHJvdG90eXBlIG1ldGhvZHMgb2YgdGFyZ2V0CgkgIG9wdGlvbnMucmVhbCAgICAgICAgLSByZWFsIHByb3RvdHlwZSBtZXRob2QgZm9yIHRoZSBgcHVyZWAgdmVyc2lvbgoJICBvcHRpb25zLmZvcmNlZCAgICAgIC0gZXhwb3J0IGV2ZW4gaWYgdGhlIG5hdGl2ZSBmZWF0dXJlIGlzIGF2YWlsYWJsZQoJICBvcHRpb25zLmJpbmQgICAgICAgIC0gYmluZCBtZXRob2RzIHRvIHRoZSB0YXJnZXQsIHJlcXVpcmVkIGZvciB0aGUgYHB1cmVgIHZlcnNpb24KCSAgb3B0aW9ucy53cmFwICAgICAgICAtIHdyYXAgY29uc3RydWN0b3JzIHRvIHByZXZlbnRpbmcgZ2xvYmFsIHBvbGx1dGlvbiwgcmVxdWlyZWQgZm9yIHRoZSBgcHVyZWAgdmVyc2lvbgoJICBvcHRpb25zLnVuc2FmZSAgICAgIC0gdXNlIHRoZSBzaW1wbGUgYXNzaWdubWVudCBvZiBwcm9wZXJ0eSBpbnN0ZWFkIG9mIGRlbGV0ZSArIGRlZmluZVByb3BlcnR5CgkgIG9wdGlvbnMuc2hhbSAgICAgICAgLSBhZGQgYSBmbGFnIHRvIG5vdCBjb21wbGV0ZWx5IGZ1bGwgcG9seWZpbGxzCgkgIG9wdGlvbnMuZW51bWVyYWJsZSAgLSBleHBvcnQgYXMgZW51bWVyYWJsZSBwcm9wZXJ0eQoJICBvcHRpb25zLm5vVGFyZ2V0R2V0IC0gcHJldmVudCBjYWxsaW5nIGEgZ2V0dGVyIG9uIHRhcmdldAoJICBvcHRpb25zLm5hbWUgICAgICAgIC0gdGhlIC5uYW1lIG9mIHRoZSBmdW5jdGlvbiBpZiBpdCBkb2VzIG5vdCBtYXRjaCB0aGUga2V5CgkqLwoJdmFyIF9leHBvcnQkMSA9IGZ1bmN0aW9uIChvcHRpb25zLCBzb3VyY2UpIHsKCSAgdmFyIFRBUkdFVCA9IG9wdGlvbnMudGFyZ2V0OwoJICB2YXIgR0xPQkFMID0gb3B0aW9ucy5nbG9iYWw7CgkgIHZhciBTVEFUSUMgPSBvcHRpb25zLnN0YXQ7CgkgIHZhciBGT1JDRUQsIHRhcmdldCwga2V5LCB0YXJnZXRQcm9wZXJ0eSwgc291cmNlUHJvcGVydHksIGRlc2NyaXB0b3I7CgkgIGlmIChHTE9CQUwpIHsKCSAgICB0YXJnZXQgPSBnbG9iYWwkUTsKCSAgfSBlbHNlIGlmIChTVEFUSUMpIHsKCSAgICB0YXJnZXQgPSBnbG9iYWwkUVtUQVJHRVRdIHx8IHNldEdsb2JhbCQyKFRBUkdFVCwge30pOwoJICB9IGVsc2UgewoJICAgIHRhcmdldCA9IChnbG9iYWwkUVtUQVJHRVRdIHx8IHt9KS5wcm90b3R5cGU7CgkgIH0KCSAgaWYgKHRhcmdldCkgZm9yIChrZXkgaW4gc291cmNlKSB7CgkgICAgc291cmNlUHJvcGVydHkgPSBzb3VyY2Vba2V5XTsKCSAgICBpZiAob3B0aW9ucy5ub1RhcmdldEdldCkgewoJICAgICAgZGVzY3JpcHRvciA9IGdldE93blByb3BlcnR5RGVzY3JpcHRvciQzKHRhcmdldCwga2V5KTsKCSAgICAgIHRhcmdldFByb3BlcnR5ID0gZGVzY3JpcHRvciAmJiBkZXNjcmlwdG9yLnZhbHVlOwoJICAgIH0gZWxzZSB0YXJnZXRQcm9wZXJ0eSA9IHRhcmdldFtrZXldOwoJICAgIEZPUkNFRCA9IGlzRm9yY2VkJDMoR0xPQkFMID8ga2V5IDogVEFSR0VUICsgKFNUQVRJQyA/ICcuJyA6ICcjJykgKyBrZXksIG9wdGlvbnMuZm9yY2VkKTsKCSAgICAvLyBjb250YWluZWQgaW4gdGFyZ2V0CgkgICAgaWYgKCFGT1JDRUQgJiYgdGFyZ2V0UHJvcGVydHkgIT09IHVuZGVmaW5lZCkgewoJICAgICAgaWYgKHR5cGVvZiBzb3VyY2VQcm9wZXJ0eSA9PSB0eXBlb2YgdGFyZ2V0UHJvcGVydHkpIGNvbnRpbnVlOwoJICAgICAgY29weUNvbnN0cnVjdG9yUHJvcGVydGllcyhzb3VyY2VQcm9wZXJ0eSwgdGFyZ2V0UHJvcGVydHkpOwoJICAgIH0KCSAgICAvLyBhZGQgYSBmbGFnIHRvIG5vdCBjb21wbGV0ZWx5IGZ1bGwgcG9seWZpbGxzCgkgICAgaWYgKG9wdGlvbnMuc2hhbSB8fCAodGFyZ2V0UHJvcGVydHkgJiYgdGFyZ2V0UHJvcGVydHkuc2hhbSkpIHsKCSAgICAgIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSQ3KHNvdXJjZVByb3BlcnR5LCAnc2hhbScsIHRydWUpOwoJICAgIH0KCSAgICAvLyBleHRlbmQgZ2xvYmFsCgkgICAgcmVkZWZpbmUkNyh0YXJnZXQsIGtleSwgc291cmNlUHJvcGVydHksIG9wdGlvbnMpOwoJICB9Cgl9OwoKCXZhciB3ZWxsS25vd25TeW1ib2wkbCA9IHdlbGxLbm93blN5bWJvbCRuOwoKCXZhciBUT19TVFJJTkdfVEFHJDUgPSB3ZWxsS25vd25TeW1ib2wkbCgndG9TdHJpbmdUYWcnKTsKCXZhciB0ZXN0JDIgPSB7fTsKCgl0ZXN0JDJbVE9fU1RSSU5HX1RBRyQ1XSA9ICd6JzsKCgl2YXIgdG9TdHJpbmdUYWdTdXBwb3J0JDEgPSBTdHJpbmcodGVzdCQyKSA9PT0gJ1tvYmplY3Qgel0nOwoKCXZhciBnbG9iYWwkUCA9IGdsb2JhbCQxODsKCXZhciBUT19TVFJJTkdfVEFHX1NVUFBPUlQkNSA9IHRvU3RyaW5nVGFnU3VwcG9ydCQxOwoJdmFyIGlzQ2FsbGFibGUkbCA9IGlzQ2FsbGFibGUkdjsKCXZhciBjbGFzc29mUmF3JDIgPSBjbGFzc29mUmF3JDM7Cgl2YXIgd2VsbEtub3duU3ltYm9sJGsgPSB3ZWxsS25vd25TeW1ib2wkbjsKCgl2YXIgVE9fU1RSSU5HX1RBRyQ0ID0gd2VsbEtub3duU3ltYm9sJGsoJ3RvU3RyaW5nVGFnJyk7Cgl2YXIgT2JqZWN0JDYgPSBnbG9iYWwkUC5PYmplY3Q7CgoJLy8gRVMzIHdyb25nIGhlcmUKCXZhciBDT1JSRUNUX0FSR1VNRU5UUyQxID0gY2xhc3NvZlJhdyQyKGZ1bmN0aW9uICgpIHsgcmV0dXJuIGFyZ3VtZW50czsgfSgpKSA9PSAnQXJndW1lbnRzJzsKCgkvLyBmYWxsYmFjayBmb3IgSUUxMSBTY3JpcHQgQWNjZXNzIERlbmllZCBlcnJvcgoJdmFyIHRyeUdldCQxID0gZnVuY3Rpb24gKGl0LCBrZXkpIHsKCSAgdHJ5IHsKCSAgICByZXR1cm4gaXRba2V5XTsKCSAgfSBjYXRjaCAoZXJyb3IpIHsgLyogZW1wdHkgKi8gfQoJfTsKCgkvLyBnZXR0aW5nIHRhZyBmcm9tIEVTNisgYE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmdgCgl2YXIgY2xhc3NvZiRnID0gVE9fU1RSSU5HX1RBR19TVVBQT1JUJDUgPyBjbGFzc29mUmF3JDIgOiBmdW5jdGlvbiAoaXQpIHsKCSAgdmFyIE8sIHRhZywgcmVzdWx0OwoJICByZXR1cm4gaXQgPT09IHVuZGVmaW5lZCA/ICdVbmRlZmluZWQnIDogaXQgPT09IG51bGwgPyAnTnVsbCcKCSAgICAvLyBAQHRvU3RyaW5nVGFnIGNhc2UKCSAgICA6IHR5cGVvZiAodGFnID0gdHJ5R2V0JDEoTyA9IE9iamVjdCQ2KGl0KSwgVE9fU1RSSU5HX1RBRyQ0KSkgPT0gJ3N0cmluZycgPyB0YWcKCSAgICAvLyBidWlsdGluVGFnIGNhc2UKCSAgICA6IENPUlJFQ1RfQVJHVU1FTlRTJDEgPyBjbGFzc29mUmF3JDIoTykKCSAgICAvLyBFUzMgYXJndW1lbnRzIGZhbGxiYWNrCgkgICAgOiAocmVzdWx0ID0gY2xhc3NvZlJhdyQyKE8pKSA9PSAnT2JqZWN0JyAmJiBpc0NhbGxhYmxlJGwoTy5jYWxsZWUpID8gJ0FyZ3VtZW50cycgOiByZXN1bHQ7Cgl9OwoKCXZhciBnbG9iYWwkTyA9IGdsb2JhbCQxODsKCXZhciBjbGFzc29mJGYgPSBjbGFzc29mJGc7CgoJdmFyIFN0cmluZyQ3ID0gZ2xvYmFsJE8uU3RyaW5nOwoKCXZhciB0b1N0cmluZyRoID0gZnVuY3Rpb24gKGFyZ3VtZW50KSB7CgkgIGlmIChjbGFzc29mJGYoYXJndW1lbnQpID09PSAnU3ltYm9sJykgdGhyb3cgVHlwZUVycm9yKCdDYW5ub3QgY29udmVydCBhIFN5bWJvbCB2YWx1ZSB0byBhIHN0cmluZycpOwoJICByZXR1cm4gU3RyaW5nJDcoYXJndW1lbnQpOwoJfTsKCgl2YXIgYW5PYmplY3QkZyA9IGFuT2JqZWN0JGo7CgoJLy8gYFJlZ0V4cC5wcm90b3R5cGUuZmxhZ3NgIGdldHRlciBpbXBsZW1lbnRhdGlvbgoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1nZXQtcmVnZXhwLnByb3RvdHlwZS5mbGFncwoJdmFyIHJlZ2V4cEZsYWdzJDEgPSBmdW5jdGlvbiAoKSB7CgkgIHZhciB0aGF0ID0gYW5PYmplY3QkZyh0aGlzKTsKCSAgdmFyIHJlc3VsdCA9ICcnOwoJICBpZiAodGhhdC5nbG9iYWwpIHJlc3VsdCArPSAnZyc7CgkgIGlmICh0aGF0Lmlnbm9yZUNhc2UpIHJlc3VsdCArPSAnaSc7CgkgIGlmICh0aGF0Lm11bHRpbGluZSkgcmVzdWx0ICs9ICdtJzsKCSAgaWYgKHRoYXQuZG90QWxsKSByZXN1bHQgKz0gJ3MnOwoJICBpZiAodGhhdC51bmljb2RlKSByZXN1bHQgKz0gJ3UnOwoJICBpZiAodGhhdC5zdGlja3kpIHJlc3VsdCArPSAneSc7CgkgIHJldHVybiByZXN1bHQ7Cgl9OwoKCXZhciBmYWlscyRuID0gZmFpbHMkdDsKCXZhciBnbG9iYWwkTiA9IGdsb2JhbCQxODsKCgkvLyBiYWJlbC1taW5pZnkgYW5kIENsb3N1cmUgQ29tcGlsZXIgdHJhbnNwaWxlcyBSZWdFeHAoJ2EnLCAneScpIC0+IC9hL3kgYW5kIGl0IGNhdXNlcyBTeW50YXhFcnJvcgoJdmFyICRSZWdFeHAkMiA9IGdsb2JhbCROLlJlZ0V4cDsKCgl2YXIgVU5TVVBQT1JURURfWSQyID0gZmFpbHMkbihmdW5jdGlvbiAoKSB7CgkgIHZhciByZSA9ICRSZWdFeHAkMignYScsICd5Jyk7CgkgIHJlLmxhc3RJbmRleCA9IDI7CgkgIHJldHVybiByZS5leGVjKCdhYmNkJykgIT0gbnVsbDsKCX0pOwoKCS8vIFVDIEJyb3dzZXIgYnVnCgkvLyBodHRwczovL2dpdGh1Yi5jb20vemxvaXJvY2svY29yZS1qcy9pc3N1ZXMvMTAwOAoJdmFyIE1JU1NFRF9TVElDS1kgPSBVTlNVUFBPUlRFRF9ZJDIgfHwgZmFpbHMkbihmdW5jdGlvbiAoKSB7CgkgIHJldHVybiAhJFJlZ0V4cCQyKCdhJywgJ3knKS5zdGlja3k7Cgl9KTsKCgl2YXIgQlJPS0VOX0NBUkVUID0gVU5TVVBQT1JURURfWSQyIHx8IGZhaWxzJG4oZnVuY3Rpb24gKCkgewoJICAvLyBodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnL3Nob3dfYnVnLmNnaT9pZD03NzM2ODcKCSAgdmFyIHJlID0gJFJlZ0V4cCQyKCdecicsICdneScpOwoJICByZS5sYXN0SW5kZXggPSAyOwoJICByZXR1cm4gcmUuZXhlYygnc3RyJykgIT0gbnVsbDsKCX0pOwoKCXZhciByZWdleHBTdGlja3lIZWxwZXJzID0gewoJICBCUk9LRU5fQ0FSRVQ6IEJST0tFTl9DQVJFVCwKCSAgTUlTU0VEX1NUSUNLWTogTUlTU0VEX1NUSUNLWSwKCSAgVU5TVVBQT1JURURfWTogVU5TVVBQT1JURURfWSQyCgl9OwoKCXZhciBpbnRlcm5hbE9iamVjdEtleXMkMiA9IG9iamVjdEtleXNJbnRlcm5hbCQxOwoJdmFyIGVudW1CdWdLZXlzJDUgPSBlbnVtQnVnS2V5cyQ3OwoKCS8vIGBPYmplY3Qua2V5c2AgbWV0aG9kCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLW9iamVjdC5rZXlzCgkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZXMvbm8tb2JqZWN0LWtleXMgLS0gc2FmZQoJdmFyIG9iamVjdEtleXMkNCA9IE9iamVjdC5rZXlzIHx8IGZ1bmN0aW9uIGtleXMoTykgewoJICByZXR1cm4gaW50ZXJuYWxPYmplY3RLZXlzJDIoTywgZW51bUJ1Z0tleXMkNSk7Cgl9OwoKCXZhciBERVNDUklQVE9SUyQ5ID0gZGVzY3JpcHRvcnMkMTsKCXZhciBkZWZpbmVQcm9wZXJ0eU1vZHVsZSQ1ID0gb2JqZWN0RGVmaW5lUHJvcGVydHkkMTsKCXZhciBhbk9iamVjdCRmID0gYW5PYmplY3QkajsKCXZhciB0b0luZGV4ZWRPYmplY3QkOSA9IHRvSW5kZXhlZE9iamVjdCRkOwoJdmFyIG9iamVjdEtleXMkMyA9IG9iamVjdEtleXMkNDsKCgkvLyBgT2JqZWN0LmRlZmluZVByb3BlcnRpZXNgIG1ldGhvZAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1vYmplY3QuZGVmaW5lcHJvcGVydGllcwoJLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGVzL25vLW9iamVjdC1kZWZpbmVwcm9wZXJ0aWVzIC0tIHNhZmUKCXZhciBvYmplY3REZWZpbmVQcm9wZXJ0aWVzJDEgPSBERVNDUklQVE9SUyQ5ID8gT2JqZWN0LmRlZmluZVByb3BlcnRpZXMgOiBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKE8sIFByb3BlcnRpZXMpIHsKCSAgYW5PYmplY3QkZihPKTsKCSAgdmFyIHByb3BzID0gdG9JbmRleGVkT2JqZWN0JDkoUHJvcGVydGllcyk7CgkgIHZhciBrZXlzID0gb2JqZWN0S2V5cyQzKFByb3BlcnRpZXMpOwoJICB2YXIgbGVuZ3RoID0ga2V5cy5sZW5ndGg7CgkgIHZhciBpbmRleCA9IDA7CgkgIHZhciBrZXk7CgkgIHdoaWxlIChsZW5ndGggPiBpbmRleCkgZGVmaW5lUHJvcGVydHlNb2R1bGUkNS5mKE8sIGtleSA9IGtleXNbaW5kZXgrK10sIHByb3BzW2tleV0pOwoJICByZXR1cm4gTzsKCX07CgoJdmFyIGdldEJ1aWx0SW4kNyA9IGdldEJ1aWx0SW4kYjsKCgl2YXIgaHRtbCQzID0gZ2V0QnVpbHRJbiQ3KCdkb2N1bWVudCcsICdkb2N1bWVudEVsZW1lbnQnKTsKCgkvKiBnbG9iYWwgQWN0aXZlWE9iamVjdCAtLSBvbGQgSUUsIFdTSCAqLwoKCXZhciBhbk9iamVjdCRlID0gYW5PYmplY3QkajsKCXZhciBkZWZpbmVQcm9wZXJ0aWVzJDEgPSBvYmplY3REZWZpbmVQcm9wZXJ0aWVzJDE7Cgl2YXIgZW51bUJ1Z0tleXMkNCA9IGVudW1CdWdLZXlzJDc7Cgl2YXIgaGlkZGVuS2V5cyQ2ID0gaGlkZGVuS2V5cyRhOwoJdmFyIGh0bWwkMiA9IGh0bWwkMzsKCXZhciBkb2N1bWVudENyZWF0ZUVsZW1lbnQkMiA9IGRvY3VtZW50Q3JlYXRlRWxlbWVudCQzOwoJdmFyIHNoYXJlZEtleSQ1ID0gc2hhcmVkS2V5JDc7CgoJdmFyIEdUJDEgPSAnPic7Cgl2YXIgTFQkMSA9ICc8JzsKCXZhciBQUk9UT1RZUEUkMiA9ICdwcm90b3R5cGUnOwoJdmFyIFNDUklQVCQxID0gJ3NjcmlwdCc7Cgl2YXIgSUVfUFJPVE8kMiA9IHNoYXJlZEtleSQ1KCdJRV9QUk9UTycpOwoKCXZhciBFbXB0eUNvbnN0cnVjdG9yJDEgPSBmdW5jdGlvbiAoKSB7IC8qIGVtcHR5ICovIH07CgoJdmFyIHNjcmlwdFRhZyQxID0gZnVuY3Rpb24gKGNvbnRlbnQpIHsKCSAgcmV0dXJuIExUJDEgKyBTQ1JJUFQkMSArIEdUJDEgKyBjb250ZW50ICsgTFQkMSArICcvJyArIFNDUklQVCQxICsgR1QkMTsKCX07CgoJLy8gQ3JlYXRlIG9iamVjdCB3aXRoIGZha2UgYG51bGxgIHByb3RvdHlwZTogdXNlIEFjdGl2ZVggT2JqZWN0IHdpdGggY2xlYXJlZCBwcm90b3R5cGUKCXZhciBOdWxsUHJvdG9PYmplY3RWaWFBY3RpdmVYJDEgPSBmdW5jdGlvbiAoYWN0aXZlWERvY3VtZW50KSB7CgkgIGFjdGl2ZVhEb2N1bWVudC53cml0ZShzY3JpcHRUYWckMSgnJykpOwoJICBhY3RpdmVYRG9jdW1lbnQuY2xvc2UoKTsKCSAgdmFyIHRlbXAgPSBhY3RpdmVYRG9jdW1lbnQucGFyZW50V2luZG93Lk9iamVjdDsKCSAgYWN0aXZlWERvY3VtZW50ID0gbnVsbDsgLy8gYXZvaWQgbWVtb3J5IGxlYWsKCSAgcmV0dXJuIHRlbXA7Cgl9OwoKCS8vIENyZWF0ZSBvYmplY3Qgd2l0aCBmYWtlIGBudWxsYCBwcm90b3R5cGU6IHVzZSBpZnJhbWUgT2JqZWN0IHdpdGggY2xlYXJlZCBwcm90b3R5cGUKCXZhciBOdWxsUHJvdG9PYmplY3RWaWFJRnJhbWUkMSA9IGZ1bmN0aW9uICgpIHsKCSAgLy8gVGhyYXNoLCB3YXN0ZSBhbmQgc29kb215OiBJRSBHQyBidWcKCSAgdmFyIGlmcmFtZSA9IGRvY3VtZW50Q3JlYXRlRWxlbWVudCQyKCdpZnJhbWUnKTsKCSAgdmFyIEpTID0gJ2phdmEnICsgU0NSSVBUJDEgKyAnOic7CgkgIHZhciBpZnJhbWVEb2N1bWVudDsKCSAgaWZyYW1lLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CgkgIGh0bWwkMi5hcHBlbmRDaGlsZChpZnJhbWUpOwoJICAvLyBodHRwczovL2dpdGh1Yi5jb20vemxvaXJvY2svY29yZS1qcy9pc3N1ZXMvNDc1CgkgIGlmcmFtZS5zcmMgPSBTdHJpbmcoSlMpOwoJICBpZnJhbWVEb2N1bWVudCA9IGlmcmFtZS5jb250ZW50V2luZG93LmRvY3VtZW50OwoJICBpZnJhbWVEb2N1bWVudC5vcGVuKCk7CgkgIGlmcmFtZURvY3VtZW50LndyaXRlKHNjcmlwdFRhZyQxKCdkb2N1bWVudC5GPU9iamVjdCcpKTsKCSAgaWZyYW1lRG9jdW1lbnQuY2xvc2UoKTsKCSAgcmV0dXJuIGlmcmFtZURvY3VtZW50LkY7Cgl9OwoKCS8vIENoZWNrIGZvciBkb2N1bWVudC5kb21haW4gYW5kIGFjdGl2ZSB4IHN1cHBvcnQKCS8vIE5vIG5lZWQgdG8gdXNlIGFjdGl2ZSB4IGFwcHJvYWNoIHdoZW4gZG9jdW1lbnQuZG9tYWluIGlzIG5vdCBzZXQKCS8vIHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXMtc2hpbXMvZXM1LXNoaW0vaXNzdWVzLzE1MAoJLy8gdmFyaWF0aW9uIG9mIGh0dHBzOi8vZ2l0aHViLmNvbS9raXRjYW1icmlkZ2UvZXM1LXNoaW0vY29tbWl0LzRmNzM4YWMwNjYzNDYKCS8vIGF2b2lkIElFIEdDIGJ1ZwoJdmFyIGFjdGl2ZVhEb2N1bWVudCQxOwoJdmFyIE51bGxQcm90b09iamVjdCQxID0gZnVuY3Rpb24gKCkgewoJICB0cnkgewoJICAgIGFjdGl2ZVhEb2N1bWVudCQxID0gbmV3IEFjdGl2ZVhPYmplY3QoJ2h0bWxmaWxlJyk7CgkgIH0gY2F0Y2ggKGVycm9yKSB7IC8qIGlnbm9yZSAqLyB9CgkgIE51bGxQcm90b09iamVjdCQxID0gdHlwZW9mIGRvY3VtZW50ICE9ICd1bmRlZmluZWQnCgkgICAgPyBkb2N1bWVudC5kb21haW4gJiYgYWN0aXZlWERvY3VtZW50JDEKCSAgICAgID8gTnVsbFByb3RvT2JqZWN0VmlhQWN0aXZlWCQxKGFjdGl2ZVhEb2N1bWVudCQxKSAvLyBvbGQgSUUKCSAgICAgIDogTnVsbFByb3RvT2JqZWN0VmlhSUZyYW1lJDEoKQoJICAgIDogTnVsbFByb3RvT2JqZWN0VmlhQWN0aXZlWCQxKGFjdGl2ZVhEb2N1bWVudCQxKTsgLy8gV1NICgkgIHZhciBsZW5ndGggPSBlbnVtQnVnS2V5cyQ0Lmxlbmd0aDsKCSAgd2hpbGUgKGxlbmd0aC0tKSBkZWxldGUgTnVsbFByb3RvT2JqZWN0JDFbUFJPVE9UWVBFJDJdW2VudW1CdWdLZXlzJDRbbGVuZ3RoXV07CgkgIHJldHVybiBOdWxsUHJvdG9PYmplY3QkMSgpOwoJfTsKCgloaWRkZW5LZXlzJDZbSUVfUFJPVE8kMl0gPSB0cnVlOwoKCS8vIGBPYmplY3QuY3JlYXRlYCBtZXRob2QKCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtb2JqZWN0LmNyZWF0ZQoJdmFyIG9iamVjdENyZWF0ZSQxID0gT2JqZWN0LmNyZWF0ZSB8fCBmdW5jdGlvbiBjcmVhdGUoTywgUHJvcGVydGllcykgewoJICB2YXIgcmVzdWx0OwoJICBpZiAoTyAhPT0gbnVsbCkgewoJICAgIEVtcHR5Q29uc3RydWN0b3IkMVtQUk9UT1RZUEUkMl0gPSBhbk9iamVjdCRlKE8pOwoJICAgIHJlc3VsdCA9IG5ldyBFbXB0eUNvbnN0cnVjdG9yJDEoKTsKCSAgICBFbXB0eUNvbnN0cnVjdG9yJDFbUFJPVE9UWVBFJDJdID0gbnVsbDsKCSAgICAvLyBhZGQgIl9fcHJvdG9fXyIgZm9yIE9iamVjdC5nZXRQcm90b3R5cGVPZiBwb2x5ZmlsbAoJICAgIHJlc3VsdFtJRV9QUk9UTyQyXSA9IE87CgkgIH0gZWxzZSByZXN1bHQgPSBOdWxsUHJvdG9PYmplY3QkMSgpOwoJICByZXR1cm4gUHJvcGVydGllcyA9PT0gdW5kZWZpbmVkID8gcmVzdWx0IDogZGVmaW5lUHJvcGVydGllcyQxKHJlc3VsdCwgUHJvcGVydGllcyk7Cgl9OwoKCXZhciBmYWlscyRtID0gZmFpbHMkdDsKCXZhciBnbG9iYWwkTSA9IGdsb2JhbCQxODsKCgkvLyBiYWJlbC1taW5pZnkgYW5kIENsb3N1cmUgQ29tcGlsZXIgdHJhbnNwaWxlcyBSZWdFeHAoJy4nLCAncycpIC0+IC8uL3MgYW5kIGl0IGNhdXNlcyBTeW50YXhFcnJvcgoJdmFyICRSZWdFeHAkMSA9IGdsb2JhbCRNLlJlZ0V4cDsKCgl2YXIgcmVnZXhwVW5zdXBwb3J0ZWREb3RBbGwgPSBmYWlscyRtKGZ1bmN0aW9uICgpIHsKCSAgdmFyIHJlID0gJFJlZ0V4cCQxKCcuJywgJ3MnKTsKCSAgcmV0dXJuICEocmUuZG90QWxsICYmIHJlLmV4ZWMoJ1xuJykgJiYgcmUuZmxhZ3MgPT09ICdzJyk7Cgl9KTsKCgl2YXIgZmFpbHMkbCA9IGZhaWxzJHQ7Cgl2YXIgZ2xvYmFsJEwgPSBnbG9iYWwkMTg7CgoJLy8gYmFiZWwtbWluaWZ5IGFuZCBDbG9zdXJlIENvbXBpbGVyIHRyYW5zcGlsZXMgUmVnRXhwKCcoPzxhPmIpJywgJ2cnKSAtPiAvKD88YT5iKS9nIGFuZCBpdCBjYXVzZXMgU3ludGF4RXJyb3IKCXZhciAkUmVnRXhwID0gZ2xvYmFsJEwuUmVnRXhwOwoKCXZhciByZWdleHBVbnN1cHBvcnRlZE5jZyA9IGZhaWxzJGwoZnVuY3Rpb24gKCkgewoJICB2YXIgcmUgPSAkUmVnRXhwKCcoPzxhPmIpJywgJ2cnKTsKCSAgcmV0dXJuIHJlLmV4ZWMoJ2InKS5ncm91cHMuYSAhPT0gJ2InIHx8CgkgICAgJ2InLnJlcGxhY2UocmUsICckPGE+YycpICE9PSAnYmMnOwoJfSk7CgoJLyogZXNsaW50LWRpc2FibGUgcmVnZXhwL25vLWVtcHR5LWNhcHR1cmluZy1ncm91cCwgcmVnZXhwL25vLWVtcHR5LWdyb3VwLCByZWdleHAvbm8tbGF6eS1lbmRzIC0tIHRlc3RpbmcgKi8KCS8qIGVzbGludC1kaXNhYmxlIHJlZ2V4cC9uby11c2VsZXNzLXF1YW50aWZpZXIgLS0gdGVzdGluZyAqLwoJdmFyIGNhbGwkZyA9IGZ1bmN0aW9uQ2FsbCQxOwoJdmFyIHVuY3VycnlUaGlzJHcgPSBmdW5jdGlvblVuY3VycnlUaGlzJDE7Cgl2YXIgdG9TdHJpbmckZyA9IHRvU3RyaW5nJGg7Cgl2YXIgcmVnZXhwRmxhZ3MgPSByZWdleHBGbGFncyQxOwoJdmFyIHN0aWNreUhlbHBlcnMkMSA9IHJlZ2V4cFN0aWNreUhlbHBlcnM7Cgl2YXIgc2hhcmVkJDUgPSBzaGFyZWQkOS5leHBvcnRzOwoJdmFyIGNyZWF0ZSQyID0gb2JqZWN0Q3JlYXRlJDE7Cgl2YXIgZ2V0SW50ZXJuYWxTdGF0ZSQzID0gaW50ZXJuYWxTdGF0ZSQxLmdldDsKCXZhciBVTlNVUFBPUlRFRF9ET1RfQUxMID0gcmVnZXhwVW5zdXBwb3J0ZWREb3RBbGw7Cgl2YXIgVU5TVVBQT1JURURfTkNHID0gcmVnZXhwVW5zdXBwb3J0ZWROY2c7CgoJdmFyIG5hdGl2ZVJlcGxhY2UgPSBzaGFyZWQkNSgnbmF0aXZlLXN0cmluZy1yZXBsYWNlJywgU3RyaW5nLnByb3RvdHlwZS5yZXBsYWNlKTsKCXZhciBuYXRpdmVFeGVjID0gUmVnRXhwLnByb3RvdHlwZS5leGVjOwoJdmFyIHBhdGNoZWRFeGVjID0gbmF0aXZlRXhlYzsKCXZhciBjaGFyQXQkNSA9IHVuY3VycnlUaGlzJHcoJycuY2hhckF0KTsKCXZhciBpbmRleE9mJDEgPSB1bmN1cnJ5VGhpcyR3KCcnLmluZGV4T2YpOwoJdmFyIHJlcGxhY2UkMyA9IHVuY3VycnlUaGlzJHcoJycucmVwbGFjZSk7Cgl2YXIgc3RyaW5nU2xpY2UkNSA9IHVuY3VycnlUaGlzJHcoJycuc2xpY2UpOwoKCXZhciBVUERBVEVTX0xBU1RfSU5ERVhfV1JPTkcgPSAoZnVuY3Rpb24gKCkgewoJICB2YXIgcmUxID0gL2EvOwoJICB2YXIgcmUyID0gL2IqL2c7CgkgIGNhbGwkZyhuYXRpdmVFeGVjLCByZTEsICdhJyk7CgkgIGNhbGwkZyhuYXRpdmVFeGVjLCByZTIsICdhJyk7CgkgIHJldHVybiByZTEubGFzdEluZGV4ICE9PSAwIHx8IHJlMi5sYXN0SW5kZXggIT09IDA7Cgl9KSgpOwoKCXZhciBVTlNVUFBPUlRFRF9ZJDEgPSBzdGlja3lIZWxwZXJzJDEuQlJPS0VOX0NBUkVUOwoKCS8vIG5vbnBhcnRpY2lwYXRpbmcgY2FwdHVyaW5nIGdyb3VwLCBjb3BpZWQgZnJvbSBlczUtc2hpbSdzIFN0cmluZyNzcGxpdCBwYXRjaC4KCXZhciBOUENHX0lOQ0xVREVEID0gLygpPz8vLmV4ZWMoJycpWzFdICE9PSB1bmRlZmluZWQ7CgoJdmFyIFBBVENIID0gVVBEQVRFU19MQVNUX0lOREVYX1dST05HIHx8IE5QQ0dfSU5DTFVERUQgfHwgVU5TVVBQT1JURURfWSQxIHx8IFVOU1VQUE9SVEVEX0RPVF9BTEwgfHwgVU5TVVBQT1JURURfTkNHOwoKCWlmIChQQVRDSCkgewoJICBwYXRjaGVkRXhlYyA9IGZ1bmN0aW9uIGV4ZWMoc3RyaW5nKSB7CgkgICAgdmFyIHJlID0gdGhpczsKCSAgICB2YXIgc3RhdGUgPSBnZXRJbnRlcm5hbFN0YXRlJDMocmUpOwoJICAgIHZhciBzdHIgPSB0b1N0cmluZyRnKHN0cmluZyk7CgkgICAgdmFyIHJhdyA9IHN0YXRlLnJhdzsKCSAgICB2YXIgcmVzdWx0LCByZUNvcHksIGxhc3RJbmRleCwgbWF0Y2gsIGksIG9iamVjdCwgZ3JvdXA7CgoJICAgIGlmIChyYXcpIHsKCSAgICAgIHJhdy5sYXN0SW5kZXggPSByZS5sYXN0SW5kZXg7CgkgICAgICByZXN1bHQgPSBjYWxsJGcocGF0Y2hlZEV4ZWMsIHJhdywgc3RyKTsKCSAgICAgIHJlLmxhc3RJbmRleCA9IHJhdy5sYXN0SW5kZXg7CgkgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH0KCgkgICAgdmFyIGdyb3VwcyA9IHN0YXRlLmdyb3VwczsKCSAgICB2YXIgc3RpY2t5ID0gVU5TVVBQT1JURURfWSQxICYmIHJlLnN0aWNreTsKCSAgICB2YXIgZmxhZ3MgPSBjYWxsJGcocmVnZXhwRmxhZ3MsIHJlKTsKCSAgICB2YXIgc291cmNlID0gcmUuc291cmNlOwoJICAgIHZhciBjaGFyc0FkZGVkID0gMDsKCSAgICB2YXIgc3RyQ29weSA9IHN0cjsKCgkgICAgaWYgKHN0aWNreSkgewoJICAgICAgZmxhZ3MgPSByZXBsYWNlJDMoZmxhZ3MsICd5JywgJycpOwoJICAgICAgaWYgKGluZGV4T2YkMShmbGFncywgJ2cnKSA9PT0gLTEpIHsKCSAgICAgICAgZmxhZ3MgKz0gJ2cnOwoJICAgICAgfQoKCSAgICAgIHN0ckNvcHkgPSBzdHJpbmdTbGljZSQ1KHN0ciwgcmUubGFzdEluZGV4KTsKCSAgICAgIC8vIFN1cHBvcnQgYW5jaG9yZWQgc3RpY2t5IGJlaGF2aW9yLgoJICAgICAgaWYgKHJlLmxhc3RJbmRleCA+IDAgJiYgKCFyZS5tdWx0aWxpbmUgfHwgcmUubXVsdGlsaW5lICYmIGNoYXJBdCQ1KHN0ciwgcmUubGFzdEluZGV4IC0gMSkgIT09ICdcbicpKSB7CgkgICAgICAgIHNvdXJjZSA9ICcoPzogJyArIHNvdXJjZSArICcpJzsKCSAgICAgICAgc3RyQ29weSA9ICcgJyArIHN0ckNvcHk7CgkgICAgICAgIGNoYXJzQWRkZWQrKzsKCSAgICAgIH0KCSAgICAgIC8vIF4oPyArIHJ4ICsgKSBpcyBuZWVkZWQsIGluIGNvbWJpbmF0aW9uIHdpdGggc29tZSBzdHIgc2xpY2luZywgdG8KCSAgICAgIC8vIHNpbXVsYXRlIHRoZSAneScgZmxhZy4KCSAgICAgIHJlQ29weSA9IG5ldyBSZWdFeHAoJ14oPzonICsgc291cmNlICsgJyknLCBmbGFncyk7CgkgICAgfQoKCSAgICBpZiAoTlBDR19JTkNMVURFRCkgewoJICAgICAgcmVDb3B5ID0gbmV3IFJlZ0V4cCgnXicgKyBzb3VyY2UgKyAnJCg/IVxccyknLCBmbGFncyk7CgkgICAgfQoJICAgIGlmIChVUERBVEVTX0xBU1RfSU5ERVhfV1JPTkcpIGxhc3RJbmRleCA9IHJlLmxhc3RJbmRleDsKCgkgICAgbWF0Y2ggPSBjYWxsJGcobmF0aXZlRXhlYywgc3RpY2t5ID8gcmVDb3B5IDogcmUsIHN0ckNvcHkpOwoKCSAgICBpZiAoc3RpY2t5KSB7CgkgICAgICBpZiAobWF0Y2gpIHsKCSAgICAgICAgbWF0Y2guaW5wdXQgPSBzdHJpbmdTbGljZSQ1KG1hdGNoLmlucHV0LCBjaGFyc0FkZGVkKTsKCSAgICAgICAgbWF0Y2hbMF0gPSBzdHJpbmdTbGljZSQ1KG1hdGNoWzBdLCBjaGFyc0FkZGVkKTsKCSAgICAgICAgbWF0Y2guaW5kZXggPSByZS5sYXN0SW5kZXg7CgkgICAgICAgIHJlLmxhc3RJbmRleCArPSBtYXRjaFswXS5sZW5ndGg7CgkgICAgICB9IGVsc2UgcmUubGFzdEluZGV4ID0gMDsKCSAgICB9IGVsc2UgaWYgKFVQREFURVNfTEFTVF9JTkRFWF9XUk9ORyAmJiBtYXRjaCkgewoJICAgICAgcmUubGFzdEluZGV4ID0gcmUuZ2xvYmFsID8gbWF0Y2guaW5kZXggKyBtYXRjaFswXS5sZW5ndGggOiBsYXN0SW5kZXg7CgkgICAgfQoJICAgIGlmIChOUENHX0lOQ0xVREVEICYmIG1hdGNoICYmIG1hdGNoLmxlbmd0aCA+IDEpIHsKCSAgICAgIC8vIEZpeCBicm93c2VycyB3aG9zZSBgZXhlY2AgbWV0aG9kcyBkb24ndCBjb25zaXN0ZW50bHkgcmV0dXJuIGB1bmRlZmluZWRgCgkgICAgICAvLyBmb3IgTlBDRywgbGlrZSBJRTguIE5PVEU6IFRoaXMgZG9lc24nIHdvcmsgZm9yIC8oLj8pPy8KCSAgICAgIGNhbGwkZyhuYXRpdmVSZXBsYWNlLCBtYXRjaFswXSwgcmVDb3B5LCBmdW5jdGlvbiAoKSB7CgkgICAgICAgIGZvciAoaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoIC0gMjsgaSsrKSB7CgkgICAgICAgICAgaWYgKGFyZ3VtZW50c1tpXSA9PT0gdW5kZWZpbmVkKSBtYXRjaFtpXSA9IHVuZGVmaW5lZDsKCSAgICAgICAgfQoJICAgICAgfSk7CgkgICAgfQoKCSAgICBpZiAobWF0Y2ggJiYgZ3JvdXBzKSB7CgkgICAgICBtYXRjaC5ncm91cHMgPSBvYmplY3QgPSBjcmVhdGUkMihudWxsKTsKCSAgICAgIGZvciAoaSA9IDA7IGkgPCBncm91cHMubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgZ3JvdXAgPSBncm91cHNbaV07CgkgICAgICAgIG9iamVjdFtncm91cFswXV0gPSBtYXRjaFtncm91cFsxXV07CgkgICAgICB9CgkgICAgfQoKCSAgICByZXR1cm4gbWF0Y2g7CgkgIH07Cgl9CgoJdmFyIHJlZ2V4cEV4ZWMkMyA9IHBhdGNoZWRFeGVjOwoKCXZhciAkJGcgPSBfZXhwb3J0JDE7Cgl2YXIgZXhlYyQ0ID0gcmVnZXhwRXhlYyQzOwoKCS8vIGBSZWdFeHAucHJvdG90eXBlLmV4ZWNgIG1ldGhvZAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1yZWdleHAucHJvdG90eXBlLmV4ZWMKCSQkZyh7IHRhcmdldDogJ1JlZ0V4cCcsIHByb3RvOiB0cnVlLCBmb3JjZWQ6IC8uLy5leGVjICE9PSBleGVjJDQgfSwgewoJICBleGVjOiBleGVjJDQKCX0pOwoKCS8vIFRPRE86IFJlbW92ZSBmcm9tIGBjb3JlLWpzQDRgIHNpbmNlIGl0J3MgbW92ZWQgdG8gZW50cnkgcG9pbnRzCgoJdmFyIHVuY3VycnlUaGlzJHYgPSBmdW5jdGlvblVuY3VycnlUaGlzJDE7Cgl2YXIgcmVkZWZpbmUkNiA9IHJlZGVmaW5lJDguZXhwb3J0czsKCXZhciByZWdleHBFeGVjJDIgPSByZWdleHBFeGVjJDM7Cgl2YXIgZmFpbHMkayA9IGZhaWxzJHQ7Cgl2YXIgd2VsbEtub3duU3ltYm9sJGogPSB3ZWxsS25vd25TeW1ib2wkbjsKCXZhciBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkkNiA9IGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSRhOwoKCXZhciBTUEVDSUVTJDQgPSB3ZWxsS25vd25TeW1ib2wkaignc3BlY2llcycpOwoJdmFyIFJlZ0V4cFByb3RvdHlwZSA9IFJlZ0V4cC5wcm90b3R5cGU7CgoJdmFyIGZpeFJlZ2V4cFdlbGxLbm93blN5bWJvbExvZ2ljID0gZnVuY3Rpb24gKEtFWSwgZXhlYywgRk9SQ0VELCBTSEFNKSB7CgkgIHZhciBTWU1CT0wgPSB3ZWxsS25vd25TeW1ib2wkaihLRVkpOwoKCSAgdmFyIERFTEVHQVRFU19UT19TWU1CT0wgPSAhZmFpbHMkayhmdW5jdGlvbiAoKSB7CgkgICAgLy8gU3RyaW5nIG1ldGhvZHMgY2FsbCBzeW1ib2wtbmFtZWQgUmVnRXAgbWV0aG9kcwoJICAgIHZhciBPID0ge307CgkgICAgT1tTWU1CT0xdID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gNzsgfTsKCSAgICByZXR1cm4gJydbS0VZXShPKSAhPSA3OwoJICB9KTsKCgkgIHZhciBERUxFR0FURVNfVE9fRVhFQyA9IERFTEVHQVRFU19UT19TWU1CT0wgJiYgIWZhaWxzJGsoZnVuY3Rpb24gKCkgewoJICAgIC8vIFN5bWJvbC1uYW1lZCBSZWdFeHAgbWV0aG9kcyBjYWxsIC5leGVjCgkgICAgdmFyIGV4ZWNDYWxsZWQgPSBmYWxzZTsKCSAgICB2YXIgcmUgPSAvYS87CgoJICAgIGlmIChLRVkgPT09ICdzcGxpdCcpIHsKCSAgICAgIC8vIFdlIGNhbid0IHVzZSByZWFsIHJlZ2V4IGhlcmUgc2luY2UgaXQgY2F1c2VzIGRlb3B0aW1pemF0aW9uCgkgICAgICAvLyBhbmQgc2VyaW91cyBwZXJmb3JtYW5jZSBkZWdyYWRhdGlvbiBpbiBWOAoJICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3psb2lyb2NrL2NvcmUtanMvaXNzdWVzLzMwNgoJICAgICAgcmUgPSB7fTsKCSAgICAgIC8vIFJlZ0V4cFtAQHNwbGl0XSBkb2Vzbid0IGNhbGwgdGhlIHJlZ2V4J3MgZXhlYyBtZXRob2QsIGJ1dCBmaXJzdCBjcmVhdGVzCgkgICAgICAvLyBhIG5ldyBvbmUuIFdlIG5lZWQgdG8gcmV0dXJuIHRoZSBwYXRjaGVkIHJlZ2V4IHdoZW4gY3JlYXRpbmcgdGhlIG5ldyBvbmUuCgkgICAgICByZS5jb25zdHJ1Y3RvciA9IHt9OwoJICAgICAgcmUuY29uc3RydWN0b3JbU1BFQ0lFUyQ0XSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHJlOyB9OwoJICAgICAgcmUuZmxhZ3MgPSAnJzsKCSAgICAgIHJlW1NZTUJPTF0gPSAvLi9bU1lNQk9MXTsKCSAgICB9CgoJICAgIHJlLmV4ZWMgPSBmdW5jdGlvbiAoKSB7IGV4ZWNDYWxsZWQgPSB0cnVlOyByZXR1cm4gbnVsbDsgfTsKCgkgICAgcmVbU1lNQk9MXSgnJyk7CgkgICAgcmV0dXJuICFleGVjQ2FsbGVkOwoJICB9KTsKCgkgIGlmICgKCSAgICAhREVMRUdBVEVTX1RPX1NZTUJPTCB8fAoJICAgICFERUxFR0FURVNfVE9fRVhFQyB8fAoJICAgIEZPUkNFRAoJICApIHsKCSAgICB2YXIgdW5jdXJyaWVkTmF0aXZlUmVnRXhwTWV0aG9kID0gdW5jdXJyeVRoaXMkdigvLi9bU1lNQk9MXSk7CgkgICAgdmFyIG1ldGhvZHMgPSBleGVjKFNZTUJPTCwgJydbS0VZXSwgZnVuY3Rpb24gKG5hdGl2ZU1ldGhvZCwgcmVnZXhwLCBzdHIsIGFyZzIsIGZvcmNlU3RyaW5nTWV0aG9kKSB7CgkgICAgICB2YXIgdW5jdXJyaWVkTmF0aXZlTWV0aG9kID0gdW5jdXJyeVRoaXMkdihuYXRpdmVNZXRob2QpOwoJICAgICAgdmFyICRleGVjID0gcmVnZXhwLmV4ZWM7CgkgICAgICBpZiAoJGV4ZWMgPT09IHJlZ2V4cEV4ZWMkMiB8fCAkZXhlYyA9PT0gUmVnRXhwUHJvdG90eXBlLmV4ZWMpIHsKCSAgICAgICAgaWYgKERFTEVHQVRFU19UT19TWU1CT0wgJiYgIWZvcmNlU3RyaW5nTWV0aG9kKSB7CgkgICAgICAgICAgLy8gVGhlIG5hdGl2ZSBTdHJpbmcgbWV0aG9kIGFscmVhZHkgZGVsZWdhdGVzIHRvIEBAbWV0aG9kICh0aGlzCgkgICAgICAgICAgLy8gcG9seWZpbGxlZCBmdW5jdGlvbiksIGxlYXNpbmcgdG8gaW5maW5pdGUgcmVjdXJzaW9uLgoJICAgICAgICAgIC8vIFdlIGF2b2lkIGl0IGJ5IGRpcmVjdGx5IGNhbGxpbmcgdGhlIG5hdGl2ZSBAQG1ldGhvZCBtZXRob2QuCgkgICAgICAgICAgcmV0dXJuIHsgZG9uZTogdHJ1ZSwgdmFsdWU6IHVuY3VycmllZE5hdGl2ZVJlZ0V4cE1ldGhvZChyZWdleHAsIHN0ciwgYXJnMikgfTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4geyBkb25lOiB0cnVlLCB2YWx1ZTogdW5jdXJyaWVkTmF0aXZlTWV0aG9kKHN0ciwgcmVnZXhwLCBhcmcyKSB9OwoJICAgICAgfQoJICAgICAgcmV0dXJuIHsgZG9uZTogZmFsc2UgfTsKCSAgICB9KTsKCgkgICAgcmVkZWZpbmUkNihTdHJpbmcucHJvdG90eXBlLCBLRVksIG1ldGhvZHNbMF0pOwoJICAgIHJlZGVmaW5lJDYoUmVnRXhwUHJvdG90eXBlLCBTWU1CT0wsIG1ldGhvZHNbMV0pOwoJICB9CgoJICBpZiAoU0hBTSkgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5JDYoUmVnRXhwUHJvdG90eXBlW1NZTUJPTF0sICdzaGFtJywgdHJ1ZSk7Cgl9OwoKCXZhciB1bmN1cnJ5VGhpcyR1ID0gZnVuY3Rpb25VbmN1cnJ5VGhpcyQxOwoJdmFyIHRvSW50ZWdlck9ySW5maW5pdHkkNyA9IHRvSW50ZWdlck9ySW5maW5pdHkkYTsKCXZhciB0b1N0cmluZyRmID0gdG9TdHJpbmckaDsKCXZhciByZXF1aXJlT2JqZWN0Q29lcmNpYmxlJGEgPSByZXF1aXJlT2JqZWN0Q29lcmNpYmxlJGQ7CgoJdmFyIGNoYXJBdCQ0ID0gdW5jdXJyeVRoaXMkdSgnJy5jaGFyQXQpOwoJdmFyIGNoYXJDb2RlQXQkMiA9IHVuY3VycnlUaGlzJHUoJycuY2hhckNvZGVBdCk7Cgl2YXIgc3RyaW5nU2xpY2UkNCA9IHVuY3VycnlUaGlzJHUoJycuc2xpY2UpOwoKCXZhciBjcmVhdGVNZXRob2QkNiA9IGZ1bmN0aW9uIChDT05WRVJUX1RPX1NUUklORykgewoJICByZXR1cm4gZnVuY3Rpb24gKCR0aGlzLCBwb3MpIHsKCSAgICB2YXIgUyA9IHRvU3RyaW5nJGYocmVxdWlyZU9iamVjdENvZXJjaWJsZSRhKCR0aGlzKSk7CgkgICAgdmFyIHBvc2l0aW9uID0gdG9JbnRlZ2VyT3JJbmZpbml0eSQ3KHBvcyk7CgkgICAgdmFyIHNpemUgPSBTLmxlbmd0aDsKCSAgICB2YXIgZmlyc3QsIHNlY29uZDsKCSAgICBpZiAocG9zaXRpb24gPCAwIHx8IHBvc2l0aW9uID49IHNpemUpIHJldHVybiBDT05WRVJUX1RPX1NUUklORyA/ICcnIDogdW5kZWZpbmVkOwoJICAgIGZpcnN0ID0gY2hhckNvZGVBdCQyKFMsIHBvc2l0aW9uKTsKCSAgICByZXR1cm4gZmlyc3QgPCAweEQ4MDAgfHwgZmlyc3QgPiAweERCRkYgfHwgcG9zaXRpb24gKyAxID09PSBzaXplCgkgICAgICB8fCAoc2Vjb25kID0gY2hhckNvZGVBdCQyKFMsIHBvc2l0aW9uICsgMSkpIDwgMHhEQzAwIHx8IHNlY29uZCA+IDB4REZGRgoJICAgICAgICA/IENPTlZFUlRfVE9fU1RSSU5HCgkgICAgICAgICAgPyBjaGFyQXQkNChTLCBwb3NpdGlvbikKCSAgICAgICAgICA6IGZpcnN0CgkgICAgICAgIDogQ09OVkVSVF9UT19TVFJJTkcKCSAgICAgICAgICA/IHN0cmluZ1NsaWNlJDQoUywgcG9zaXRpb24sIHBvc2l0aW9uICsgMikKCSAgICAgICAgICA6IChmaXJzdCAtIDB4RDgwMCA8PCAxMCkgKyAoc2Vjb25kIC0gMHhEQzAwKSArIDB4MTAwMDA7CgkgIH07Cgl9OwoKCXZhciBzdHJpbmdNdWx0aWJ5dGUkMSA9IHsKCSAgLy8gYFN0cmluZy5wcm90b3R5cGUuY29kZVBvaW50QXRgIG1ldGhvZAoJICAvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLXN0cmluZy5wcm90b3R5cGUuY29kZXBvaW50YXQKCSAgY29kZUF0OiBjcmVhdGVNZXRob2QkNihmYWxzZSksCgkgIC8vIGBTdHJpbmcucHJvdG90eXBlLmF0YCBtZXRob2QKCSAgLy8gaHR0cHM6Ly9naXRodWIuY29tL21hdGhpYXNieW5lbnMvU3RyaW5nLnByb3RvdHlwZS5hdAoJICBjaGFyQXQ6IGNyZWF0ZU1ldGhvZCQ2KHRydWUpCgl9OwoKCXZhciBjaGFyQXQkMyA9IHN0cmluZ011bHRpYnl0ZSQxLmNoYXJBdDsKCgkvLyBgQWR2YW5jZVN0cmluZ0luZGV4YCBhYnN0cmFjdCBvcGVyYXRpb24KCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtYWR2YW5jZXN0cmluZ2luZGV4Cgl2YXIgYWR2YW5jZVN0cmluZ0luZGV4JDIgPSBmdW5jdGlvbiAoUywgaW5kZXgsIHVuaWNvZGUpIHsKCSAgcmV0dXJuIGluZGV4ICsgKHVuaWNvZGUgPyBjaGFyQXQkMyhTLCBpbmRleCkubGVuZ3RoIDogMSk7Cgl9OwoKCXZhciBnbG9iYWwkSyA9IGdsb2JhbCQxODsKCXZhciBjYWxsJGYgPSBmdW5jdGlvbkNhbGwkMTsKCXZhciBhbk9iamVjdCRkID0gYW5PYmplY3QkajsKCXZhciBpc0NhbGxhYmxlJGsgPSBpc0NhbGxhYmxlJHY7Cgl2YXIgY2xhc3NvZiRlID0gY2xhc3NvZlJhdyQzOwoJdmFyIHJlZ2V4cEV4ZWMkMSA9IHJlZ2V4cEV4ZWMkMzsKCgl2YXIgVHlwZUVycm9yJGggPSBnbG9iYWwkSy5UeXBlRXJyb3I7CgoJLy8gYFJlZ0V4cEV4ZWNgIGFic3RyYWN0IG9wZXJhdGlvbgoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1yZWdleHBleGVjCgl2YXIgcmVnZXhwRXhlY0Fic3RyYWN0ID0gZnVuY3Rpb24gKFIsIFMpIHsKCSAgdmFyIGV4ZWMgPSBSLmV4ZWM7CgkgIGlmIChpc0NhbGxhYmxlJGsoZXhlYykpIHsKCSAgICB2YXIgcmVzdWx0ID0gY2FsbCRmKGV4ZWMsIFIsIFMpOwoJICAgIGlmIChyZXN1bHQgIT09IG51bGwpIGFuT2JqZWN0JGQocmVzdWx0KTsKCSAgICByZXR1cm4gcmVzdWx0OwoJICB9CgkgIGlmIChjbGFzc29mJGUoUikgPT09ICdSZWdFeHAnKSByZXR1cm4gY2FsbCRmKHJlZ2V4cEV4ZWMkMSwgUiwgUyk7CgkgIHRocm93IFR5cGVFcnJvciRoKCdSZWdFeHAjZXhlYyBjYWxsZWQgb24gaW5jb21wYXRpYmxlIHJlY2VpdmVyJyk7Cgl9OwoKCXZhciBjYWxsJGUgPSBmdW5jdGlvbkNhbGwkMTsKCXZhciBmaXhSZWdFeHBXZWxsS25vd25TeW1ib2xMb2dpYyQxID0gZml4UmVnZXhwV2VsbEtub3duU3ltYm9sTG9naWM7Cgl2YXIgYW5PYmplY3QkYyA9IGFuT2JqZWN0JGo7Cgl2YXIgdG9MZW5ndGgkMyA9IHRvTGVuZ3RoJDU7Cgl2YXIgdG9TdHJpbmckZSA9IHRvU3RyaW5nJGg7Cgl2YXIgcmVxdWlyZU9iamVjdENvZXJjaWJsZSQ5ID0gcmVxdWlyZU9iamVjdENvZXJjaWJsZSRkOwoJdmFyIGdldE1ldGhvZCQ1ID0gZ2V0TWV0aG9kJDc7Cgl2YXIgYWR2YW5jZVN0cmluZ0luZGV4JDEgPSBhZHZhbmNlU3RyaW5nSW5kZXgkMjsKCXZhciByZWdFeHBFeGVjJDEgPSByZWdleHBFeGVjQWJzdHJhY3Q7CgoJLy8gQEBtYXRjaCBsb2dpYwoJZml4UmVnRXhwV2VsbEtub3duU3ltYm9sTG9naWMkMSgnbWF0Y2gnLCBmdW5jdGlvbiAoTUFUQ0gsIG5hdGl2ZU1hdGNoLCBtYXliZUNhbGxOYXRpdmUpIHsKCSAgcmV0dXJuIFsKCSAgICAvLyBgU3RyaW5nLnByb3RvdHlwZS5tYXRjaGAgbWV0aG9kCgkgICAgLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1zdHJpbmcucHJvdG90eXBlLm1hdGNoCgkgICAgZnVuY3Rpb24gbWF0Y2gocmVnZXhwKSB7CgkgICAgICB2YXIgTyA9IHJlcXVpcmVPYmplY3RDb2VyY2libGUkOSh0aGlzKTsKCSAgICAgIHZhciBtYXRjaGVyID0gcmVnZXhwID09IHVuZGVmaW5lZCA/IHVuZGVmaW5lZCA6IGdldE1ldGhvZCQ1KHJlZ2V4cCwgTUFUQ0gpOwoJICAgICAgcmV0dXJuIG1hdGNoZXIgPyBjYWxsJGUobWF0Y2hlciwgcmVnZXhwLCBPKSA6IG5ldyBSZWdFeHAocmVnZXhwKVtNQVRDSF0odG9TdHJpbmckZShPKSk7CgkgICAgfSwKCSAgICAvLyBgUmVnRXhwLnByb3RvdHlwZVtAQG1hdGNoXWAgbWV0aG9kCgkgICAgLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1yZWdleHAucHJvdG90eXBlLUBAbWF0Y2gKCSAgICBmdW5jdGlvbiAoc3RyaW5nKSB7CgkgICAgICB2YXIgcnggPSBhbk9iamVjdCRjKHRoaXMpOwoJICAgICAgdmFyIFMgPSB0b1N0cmluZyRlKHN0cmluZyk7CgkgICAgICB2YXIgcmVzID0gbWF5YmVDYWxsTmF0aXZlKG5hdGl2ZU1hdGNoLCByeCwgUyk7CgoJICAgICAgaWYgKHJlcy5kb25lKSByZXR1cm4gcmVzLnZhbHVlOwoKCSAgICAgIGlmICghcnguZ2xvYmFsKSByZXR1cm4gcmVnRXhwRXhlYyQxKHJ4LCBTKTsKCgkgICAgICB2YXIgZnVsbFVuaWNvZGUgPSByeC51bmljb2RlOwoJICAgICAgcngubGFzdEluZGV4ID0gMDsKCSAgICAgIHZhciBBID0gW107CgkgICAgICB2YXIgbiA9IDA7CgkgICAgICB2YXIgcmVzdWx0OwoJICAgICAgd2hpbGUgKChyZXN1bHQgPSByZWdFeHBFeGVjJDEocngsIFMpKSAhPT0gbnVsbCkgewoJICAgICAgICB2YXIgbWF0Y2hTdHIgPSB0b1N0cmluZyRlKHJlc3VsdFswXSk7CgkgICAgICAgIEFbbl0gPSBtYXRjaFN0cjsKCSAgICAgICAgaWYgKG1hdGNoU3RyID09PSAnJykgcngubGFzdEluZGV4ID0gYWR2YW5jZVN0cmluZ0luZGV4JDEoUywgdG9MZW5ndGgkMyhyeC5sYXN0SW5kZXgpLCBmdWxsVW5pY29kZSk7CgkgICAgICAgIG4rKzsKCSAgICAgIH0KCSAgICAgIHJldHVybiBuID09PSAwID8gbnVsbCA6IEE7CgkgICAgfQoJICBdOwoJfSk7CgoJdmFyIEZ1bmN0aW9uUHJvdG90eXBlJDQgPSBGdW5jdGlvbi5wcm90b3R5cGU7Cgl2YXIgYXBwbHkkNCA9IEZ1bmN0aW9uUHJvdG90eXBlJDQuYXBwbHk7Cgl2YXIgYmluZCQ2ID0gRnVuY3Rpb25Qcm90b3R5cGUkNC5iaW5kOwoJdmFyIGNhbGwkZCA9IEZ1bmN0aW9uUHJvdG90eXBlJDQuY2FsbDsKCgkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZXMvbm8tcmVmbGVjdCAtLSBzYWZlCgl2YXIgZnVuY3Rpb25BcHBseSQxID0gdHlwZW9mIFJlZmxlY3QgPT0gJ29iamVjdCcgJiYgUmVmbGVjdC5hcHBseSB8fCAoYmluZCQ2ID8gY2FsbCRkLmJpbmQoYXBwbHkkNCkgOiBmdW5jdGlvbiAoKSB7CgkgIHJldHVybiBjYWxsJGQuYXBwbHkoYXBwbHkkNCwgYXJndW1lbnRzKTsKCX0pOwoKCXZhciBpc09iamVjdCRjID0gaXNPYmplY3QkaTsKCXZhciBjbGFzc29mJGQgPSBjbGFzc29mUmF3JDM7Cgl2YXIgd2VsbEtub3duU3ltYm9sJGkgPSB3ZWxsS25vd25TeW1ib2wkbjsKCgl2YXIgTUFUQ0ggPSB3ZWxsS25vd25TeW1ib2wkaSgnbWF0Y2gnKTsKCgkvLyBgSXNSZWdFeHBgIGFic3RyYWN0IG9wZXJhdGlvbgoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1pc3JlZ2V4cAoJdmFyIGlzUmVnZXhwID0gZnVuY3Rpb24gKGl0KSB7CgkgIHZhciBpc1JlZ0V4cDsKCSAgcmV0dXJuIGlzT2JqZWN0JGMoaXQpICYmICgoaXNSZWdFeHAgPSBpdFtNQVRDSF0pICE9PSB1bmRlZmluZWQgPyAhIWlzUmVnRXhwIDogY2xhc3NvZiRkKGl0KSA9PSAnUmVnRXhwJyk7Cgl9OwoKCXZhciB1bmN1cnJ5VGhpcyR0ID0gZnVuY3Rpb25VbmN1cnJ5VGhpcyQxOwoJdmFyIGZhaWxzJGogPSBmYWlscyR0OwoJdmFyIGlzQ2FsbGFibGUkaiA9IGlzQ2FsbGFibGUkdjsKCXZhciBjbGFzc29mJGMgPSBjbGFzc29mJGc7Cgl2YXIgZ2V0QnVpbHRJbiQ2ID0gZ2V0QnVpbHRJbiRiOwoJdmFyIGluc3BlY3RTb3VyY2UkMyA9IGluc3BlY3RTb3VyY2UkNjsKCgl2YXIgbm9vcCQxID0gZnVuY3Rpb24gKCkgeyAvKiBlbXB0eSAqLyB9OwoJdmFyIGVtcHR5JDEgPSBbXTsKCXZhciBjb25zdHJ1Y3QkMSA9IGdldEJ1aWx0SW4kNignUmVmbGVjdCcsICdjb25zdHJ1Y3QnKTsKCXZhciBjb25zdHJ1Y3RvclJlZ0V4cCQxID0gL15ccyooPzpjbGFzc3xmdW5jdGlvbilcYi87Cgl2YXIgZXhlYyQzID0gdW5jdXJyeVRoaXMkdChjb25zdHJ1Y3RvclJlZ0V4cCQxLmV4ZWMpOwoJdmFyIElOQ09SUkVDVF9UT19TVFJJTkckMSA9ICFjb25zdHJ1Y3RvclJlZ0V4cCQxLmV4ZWMobm9vcCQxKTsKCgl2YXIgaXNDb25zdHJ1Y3Rvck1vZGVybiQxID0gZnVuY3Rpb24gKGFyZ3VtZW50KSB7CgkgIGlmICghaXNDYWxsYWJsZSRqKGFyZ3VtZW50KSkgcmV0dXJuIGZhbHNlOwoJICB0cnkgewoJICAgIGNvbnN0cnVjdCQxKG5vb3AkMSwgZW1wdHkkMSwgYXJndW1lbnQpOwoJICAgIHJldHVybiB0cnVlOwoJICB9IGNhdGNoIChlcnJvcikgewoJICAgIHJldHVybiBmYWxzZTsKCSAgfQoJfTsKCgl2YXIgaXNDb25zdHJ1Y3RvckxlZ2FjeSQxID0gZnVuY3Rpb24gKGFyZ3VtZW50KSB7CgkgIGlmICghaXNDYWxsYWJsZSRqKGFyZ3VtZW50KSkgcmV0dXJuIGZhbHNlOwoJICBzd2l0Y2ggKGNsYXNzb2YkYyhhcmd1bWVudCkpIHsKCSAgICBjYXNlICdBc3luY0Z1bmN0aW9uJzoKCSAgICBjYXNlICdHZW5lcmF0b3JGdW5jdGlvbic6CgkgICAgY2FzZSAnQXN5bmNHZW5lcmF0b3JGdW5jdGlvbic6IHJldHVybiBmYWxzZTsKCSAgICAvLyB3ZSBjYW4ndCBjaGVjayAucHJvdG90eXBlIHNpbmNlIGNvbnN0cnVjdG9ycyBwcm9kdWNlZCBieSAuYmluZCBoYXZlbid0IGl0CgkgIH0gcmV0dXJuIElOQ09SUkVDVF9UT19TVFJJTkckMSB8fCAhIWV4ZWMkMyhjb25zdHJ1Y3RvclJlZ0V4cCQxLCBpbnNwZWN0U291cmNlJDMoYXJndW1lbnQpKTsKCX07CgoJLy8gYElzQ29uc3RydWN0b3JgIGFic3RyYWN0IG9wZXJhdGlvbgoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1pc2NvbnN0cnVjdG9yCgl2YXIgaXNDb25zdHJ1Y3RvciQ1ID0gIWNvbnN0cnVjdCQxIHx8IGZhaWxzJGooZnVuY3Rpb24gKCkgewoJICB2YXIgY2FsbGVkOwoJICByZXR1cm4gaXNDb25zdHJ1Y3Rvck1vZGVybiQxKGlzQ29uc3RydWN0b3JNb2Rlcm4kMS5jYWxsKQoJICAgIHx8ICFpc0NvbnN0cnVjdG9yTW9kZXJuJDEoT2JqZWN0KQoJICAgIHx8ICFpc0NvbnN0cnVjdG9yTW9kZXJuJDEoZnVuY3Rpb24gKCkgeyBjYWxsZWQgPSB0cnVlOyB9KQoJICAgIHx8IGNhbGxlZDsKCX0pID8gaXNDb25zdHJ1Y3RvckxlZ2FjeSQxIDogaXNDb25zdHJ1Y3Rvck1vZGVybiQxOwoKCXZhciBnbG9iYWwkSiA9IGdsb2JhbCQxODsKCXZhciBpc0NvbnN0cnVjdG9yJDQgPSBpc0NvbnN0cnVjdG9yJDU7Cgl2YXIgdHJ5VG9TdHJpbmckMyA9IHRyeVRvU3RyaW5nJDU7CgoJdmFyIFR5cGVFcnJvciRnID0gZ2xvYmFsJEouVHlwZUVycm9yOwoKCS8vIGBBc3NlcnQ6IElzQ29uc3RydWN0b3IoYXJndW1lbnQpIGlzIHRydWVgCgl2YXIgYUNvbnN0cnVjdG9yJDEgPSBmdW5jdGlvbiAoYXJndW1lbnQpIHsKCSAgaWYgKGlzQ29uc3RydWN0b3IkNChhcmd1bWVudCkpIHJldHVybiBhcmd1bWVudDsKCSAgdGhyb3cgVHlwZUVycm9yJGcodHJ5VG9TdHJpbmckMyhhcmd1bWVudCkgKyAnIGlzIG5vdCBhIGNvbnN0cnVjdG9yJyk7Cgl9OwoKCXZhciBhbk9iamVjdCRiID0gYW5PYmplY3QkajsKCXZhciBhQ29uc3RydWN0b3IgPSBhQ29uc3RydWN0b3IkMTsKCXZhciB3ZWxsS25vd25TeW1ib2wkaCA9IHdlbGxLbm93blN5bWJvbCRuOwoKCXZhciBTUEVDSUVTJDMgPSB3ZWxsS25vd25TeW1ib2wkaCgnc3BlY2llcycpOwoKCS8vIGBTcGVjaWVzQ29uc3RydWN0b3JgIGFic3RyYWN0IG9wZXJhdGlvbgoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1zcGVjaWVzY29uc3RydWN0b3IKCXZhciBzcGVjaWVzQ29uc3RydWN0b3IkMSA9IGZ1bmN0aW9uIChPLCBkZWZhdWx0Q29uc3RydWN0b3IpIHsKCSAgdmFyIEMgPSBhbk9iamVjdCRiKE8pLmNvbnN0cnVjdG9yOwoJICB2YXIgUzsKCSAgcmV0dXJuIEMgPT09IHVuZGVmaW5lZCB8fCAoUyA9IGFuT2JqZWN0JGIoQylbU1BFQ0lFUyQzXSkgPT0gdW5kZWZpbmVkID8gZGVmYXVsdENvbnN0cnVjdG9yIDogYUNvbnN0cnVjdG9yKFMpOwoJfTsKCgl2YXIgdG9Qcm9wZXJ0eUtleSQ1ID0gdG9Qcm9wZXJ0eUtleSQ4OwoJdmFyIGRlZmluZVByb3BlcnR5TW9kdWxlJDQgPSBvYmplY3REZWZpbmVQcm9wZXJ0eSQxOwoJdmFyIGNyZWF0ZVByb3BlcnR5RGVzY3JpcHRvciQ2ID0gY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yJDk7CgoJdmFyIGNyZWF0ZVByb3BlcnR5JDcgPSBmdW5jdGlvbiAob2JqZWN0LCBrZXksIHZhbHVlKSB7CgkgIHZhciBwcm9wZXJ0eUtleSA9IHRvUHJvcGVydHlLZXkkNShrZXkpOwoJICBpZiAocHJvcGVydHlLZXkgaW4gb2JqZWN0KSBkZWZpbmVQcm9wZXJ0eU1vZHVsZSQ0LmYob2JqZWN0LCBwcm9wZXJ0eUtleSwgY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yJDYoMCwgdmFsdWUpKTsKCSAgZWxzZSBvYmplY3RbcHJvcGVydHlLZXldID0gdmFsdWU7Cgl9OwoKCXZhciBnbG9iYWwkSSA9IGdsb2JhbCQxODsKCXZhciB0b0Fic29sdXRlSW5kZXgkNiA9IHRvQWJzb2x1dGVJbmRleCQ4OwoJdmFyIGxlbmd0aE9mQXJyYXlMaWtlJGEgPSBsZW5ndGhPZkFycmF5TGlrZSRjOwoJdmFyIGNyZWF0ZVByb3BlcnR5JDYgPSBjcmVhdGVQcm9wZXJ0eSQ3OwoKCXZhciBBcnJheSQ1ID0gZ2xvYmFsJEkuQXJyYXk7Cgl2YXIgbWF4JDQgPSBNYXRoLm1heDsKCgl2YXIgYXJyYXlTbGljZVNpbXBsZSQxID0gZnVuY3Rpb24gKE8sIHN0YXJ0LCBlbmQpIHsKCSAgdmFyIGxlbmd0aCA9IGxlbmd0aE9mQXJyYXlMaWtlJGEoTyk7CgkgIHZhciBrID0gdG9BYnNvbHV0ZUluZGV4JDYoc3RhcnQsIGxlbmd0aCk7CgkgIHZhciBmaW4gPSB0b0Fic29sdXRlSW5kZXgkNihlbmQgPT09IHVuZGVmaW5lZCA/IGxlbmd0aCA6IGVuZCwgbGVuZ3RoKTsKCSAgdmFyIHJlc3VsdCA9IEFycmF5JDUobWF4JDQoZmluIC0gaywgMCkpOwoJICBmb3IgKHZhciBuID0gMDsgayA8IGZpbjsgaysrLCBuKyspIGNyZWF0ZVByb3BlcnR5JDYocmVzdWx0LCBuLCBPW2tdKTsKCSAgcmVzdWx0Lmxlbmd0aCA9IG47CgkgIHJldHVybiByZXN1bHQ7Cgl9OwoKCXZhciBhcHBseSQzID0gZnVuY3Rpb25BcHBseSQxOwoJdmFyIGNhbGwkYyA9IGZ1bmN0aW9uQ2FsbCQxOwoJdmFyIHVuY3VycnlUaGlzJHMgPSBmdW5jdGlvblVuY3VycnlUaGlzJDE7Cgl2YXIgZml4UmVnRXhwV2VsbEtub3duU3ltYm9sTG9naWMgPSBmaXhSZWdleHBXZWxsS25vd25TeW1ib2xMb2dpYzsKCXZhciBpc1JlZ0V4cCA9IGlzUmVnZXhwOwoJdmFyIGFuT2JqZWN0JGEgPSBhbk9iamVjdCRqOwoJdmFyIHJlcXVpcmVPYmplY3RDb2VyY2libGUkOCA9IHJlcXVpcmVPYmplY3RDb2VyY2libGUkZDsKCXZhciBzcGVjaWVzQ29uc3RydWN0b3IgPSBzcGVjaWVzQ29uc3RydWN0b3IkMTsKCXZhciBhZHZhbmNlU3RyaW5nSW5kZXggPSBhZHZhbmNlU3RyaW5nSW5kZXgkMjsKCXZhciB0b0xlbmd0aCQyID0gdG9MZW5ndGgkNTsKCXZhciB0b1N0cmluZyRkID0gdG9TdHJpbmckaDsKCXZhciBnZXRNZXRob2QkNCA9IGdldE1ldGhvZCQ3OwoJdmFyIGFycmF5U2xpY2UkNCA9IGFycmF5U2xpY2VTaW1wbGUkMTsKCXZhciBjYWxsUmVnRXhwRXhlYyA9IHJlZ2V4cEV4ZWNBYnN0cmFjdDsKCXZhciByZWdleHBFeGVjID0gcmVnZXhwRXhlYyQzOwoJdmFyIHN0aWNreUhlbHBlcnMgPSByZWdleHBTdGlja3lIZWxwZXJzOwoJdmFyIGZhaWxzJGkgPSBmYWlscyR0OwoKCXZhciBVTlNVUFBPUlRFRF9ZID0gc3RpY2t5SGVscGVycy5VTlNVUFBPUlRFRF9ZOwoJdmFyIE1BWF9VSU5UMzIgPSAweEZGRkZGRkZGOwoJdmFyIG1pbiQzID0gTWF0aC5taW47Cgl2YXIgJHB1c2ggPSBbXS5wdXNoOwoJdmFyIGV4ZWMkMiA9IHVuY3VycnlUaGlzJHMoLy4vLmV4ZWMpOwoJdmFyIHB1c2gkMyA9IHVuY3VycnlUaGlzJHMoJHB1c2gpOwoJdmFyIHN0cmluZ1NsaWNlJDMgPSB1bmN1cnJ5VGhpcyRzKCcnLnNsaWNlKTsKCgkvLyBDaHJvbWUgNTEgaGFzIGEgYnVnZ3kgInNwbGl0IiBpbXBsZW1lbnRhdGlvbiB3aGVuIFJlZ0V4cCNleGVjICE9PSBuYXRpdmVFeGVjCgkvLyBXZWV4IEpTIGhhcyBmcm96ZW4gYnVpbHQtaW4gcHJvdG90eXBlcywgc28gdXNlIHRyeSAvIGNhdGNoIHdyYXBwZXIKCXZhciBTUExJVF9XT1JLU19XSVRIX09WRVJXUklUVEVOX0VYRUMgPSAhZmFpbHMkaShmdW5jdGlvbiAoKSB7CgkgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWdleHAvbm8tZW1wdHktZ3JvdXAgLS0gcmVxdWlyZWQgZm9yIHRlc3RpbmcKCSAgdmFyIHJlID0gLyg/OikvOwoJICB2YXIgb3JpZ2luYWxFeGVjID0gcmUuZXhlYzsKCSAgcmUuZXhlYyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIG9yaWdpbmFsRXhlYy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9OwoJICB2YXIgcmVzdWx0ID0gJ2FiJy5zcGxpdChyZSk7CgkgIHJldHVybiByZXN1bHQubGVuZ3RoICE9PSAyIHx8IHJlc3VsdFswXSAhPT0gJ2EnIHx8IHJlc3VsdFsxXSAhPT0gJ2InOwoJfSk7CgoJLy8gQEBzcGxpdCBsb2dpYwoJZml4UmVnRXhwV2VsbEtub3duU3ltYm9sTG9naWMoJ3NwbGl0JywgZnVuY3Rpb24gKFNQTElULCBuYXRpdmVTcGxpdCwgbWF5YmVDYWxsTmF0aXZlKSB7CgkgIHZhciBpbnRlcm5hbFNwbGl0OwoJICBpZiAoCgkgICAgJ2FiYmMnLnNwbGl0KC8oYikqLylbMV0gPT0gJ2MnIHx8CgkgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlZ2V4cC9uby1lbXB0eS1ncm91cCAtLSByZXF1aXJlZCBmb3IgdGVzdGluZwoJICAgICd0ZXN0Jy5zcGxpdCgvKD86KS8sIC0xKS5sZW5ndGggIT0gNCB8fAoJICAgICdhYicuc3BsaXQoLyg/OmFiKSovKS5sZW5ndGggIT0gMiB8fAoJICAgICcuJy5zcGxpdCgvKC4/KSguPykvKS5sZW5ndGggIT0gNCB8fAoJICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWdleHAvbm8tZW1wdHktY2FwdHVyaW5nLWdyb3VwLCByZWdleHAvbm8tZW1wdHktZ3JvdXAgLS0gcmVxdWlyZWQgZm9yIHRlc3RpbmcKCSAgICAnLicuc3BsaXQoLygpKCkvKS5sZW5ndGggPiAxIHx8CgkgICAgJycuc3BsaXQoLy4/LykubGVuZ3RoCgkgICkgewoJICAgIC8vIGJhc2VkIG9uIGVzNS1zaGltIGltcGxlbWVudGF0aW9uLCBuZWVkIHRvIHJld29yayBpdAoJICAgIGludGVybmFsU3BsaXQgPSBmdW5jdGlvbiAoc2VwYXJhdG9yLCBsaW1pdCkgewoJICAgICAgdmFyIHN0cmluZyA9IHRvU3RyaW5nJGQocmVxdWlyZU9iamVjdENvZXJjaWJsZSQ4KHRoaXMpKTsKCSAgICAgIHZhciBsaW0gPSBsaW1pdCA9PT0gdW5kZWZpbmVkID8gTUFYX1VJTlQzMiA6IGxpbWl0ID4+PiAwOwoJICAgICAgaWYgKGxpbSA9PT0gMCkgcmV0dXJuIFtdOwoJICAgICAgaWYgKHNlcGFyYXRvciA9PT0gdW5kZWZpbmVkKSByZXR1cm4gW3N0cmluZ107CgkgICAgICAvLyBJZiBgc2VwYXJhdG9yYCBpcyBub3QgYSByZWdleCwgdXNlIG5hdGl2ZSBzcGxpdAoJICAgICAgaWYgKCFpc1JlZ0V4cChzZXBhcmF0b3IpKSB7CgkgICAgICAgIHJldHVybiBjYWxsJGMobmF0aXZlU3BsaXQsIHN0cmluZywgc2VwYXJhdG9yLCBsaW0pOwoJICAgICAgfQoJICAgICAgdmFyIG91dHB1dCA9IFtdOwoJICAgICAgdmFyIGZsYWdzID0gKHNlcGFyYXRvci5pZ25vcmVDYXNlID8gJ2knIDogJycpICsKCSAgICAgICAgICAgICAgICAgIChzZXBhcmF0b3IubXVsdGlsaW5lID8gJ20nIDogJycpICsKCSAgICAgICAgICAgICAgICAgIChzZXBhcmF0b3IudW5pY29kZSA/ICd1JyA6ICcnKSArCgkgICAgICAgICAgICAgICAgICAoc2VwYXJhdG9yLnN0aWNreSA/ICd5JyA6ICcnKTsKCSAgICAgIHZhciBsYXN0TGFzdEluZGV4ID0gMDsKCSAgICAgIC8vIE1ha2UgYGdsb2JhbGAgYW5kIGF2b2lkIGBsYXN0SW5kZXhgIGlzc3VlcyBieSB3b3JraW5nIHdpdGggYSBjb3B5CgkgICAgICB2YXIgc2VwYXJhdG9yQ29weSA9IG5ldyBSZWdFeHAoc2VwYXJhdG9yLnNvdXJjZSwgZmxhZ3MgKyAnZycpOwoJICAgICAgdmFyIG1hdGNoLCBsYXN0SW5kZXgsIGxhc3RMZW5ndGg7CgkgICAgICB3aGlsZSAobWF0Y2ggPSBjYWxsJGMocmVnZXhwRXhlYywgc2VwYXJhdG9yQ29weSwgc3RyaW5nKSkgewoJICAgICAgICBsYXN0SW5kZXggPSBzZXBhcmF0b3JDb3B5Lmxhc3RJbmRleDsKCSAgICAgICAgaWYgKGxhc3RJbmRleCA+IGxhc3RMYXN0SW5kZXgpIHsKCSAgICAgICAgICBwdXNoJDMob3V0cHV0LCBzdHJpbmdTbGljZSQzKHN0cmluZywgbGFzdExhc3RJbmRleCwgbWF0Y2guaW5kZXgpKTsKCSAgICAgICAgICBpZiAobWF0Y2gubGVuZ3RoID4gMSAmJiBtYXRjaC5pbmRleCA8IHN0cmluZy5sZW5ndGgpIGFwcGx5JDMoJHB1c2gsIG91dHB1dCwgYXJyYXlTbGljZSQ0KG1hdGNoLCAxKSk7CgkgICAgICAgICAgbGFzdExlbmd0aCA9IG1hdGNoWzBdLmxlbmd0aDsKCSAgICAgICAgICBsYXN0TGFzdEluZGV4ID0gbGFzdEluZGV4OwoJICAgICAgICAgIGlmIChvdXRwdXQubGVuZ3RoID49IGxpbSkgYnJlYWs7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHNlcGFyYXRvckNvcHkubGFzdEluZGV4ID09PSBtYXRjaC5pbmRleCkgc2VwYXJhdG9yQ29weS5sYXN0SW5kZXgrKzsgLy8gQXZvaWQgYW4gaW5maW5pdGUgbG9vcAoJICAgICAgfQoJICAgICAgaWYgKGxhc3RMYXN0SW5kZXggPT09IHN0cmluZy5sZW5ndGgpIHsKCSAgICAgICAgaWYgKGxhc3RMZW5ndGggfHwgIWV4ZWMkMihzZXBhcmF0b3JDb3B5LCAnJykpIHB1c2gkMyhvdXRwdXQsICcnKTsKCSAgICAgIH0gZWxzZSBwdXNoJDMob3V0cHV0LCBzdHJpbmdTbGljZSQzKHN0cmluZywgbGFzdExhc3RJbmRleCkpOwoJICAgICAgcmV0dXJuIG91dHB1dC5sZW5ndGggPiBsaW0gPyBhcnJheVNsaWNlJDQob3V0cHV0LCAwLCBsaW0pIDogb3V0cHV0OwoJICAgIH07CgkgIC8vIENoYWtyYSwgVjgKCSAgfSBlbHNlIGlmICgnMCcuc3BsaXQodW5kZWZpbmVkLCAwKS5sZW5ndGgpIHsKCSAgICBpbnRlcm5hbFNwbGl0ID0gZnVuY3Rpb24gKHNlcGFyYXRvciwgbGltaXQpIHsKCSAgICAgIHJldHVybiBzZXBhcmF0b3IgPT09IHVuZGVmaW5lZCAmJiBsaW1pdCA9PT0gMCA/IFtdIDogY2FsbCRjKG5hdGl2ZVNwbGl0LCB0aGlzLCBzZXBhcmF0b3IsIGxpbWl0KTsKCSAgICB9OwoJICB9IGVsc2UgaW50ZXJuYWxTcGxpdCA9IG5hdGl2ZVNwbGl0OwoKCSAgcmV0dXJuIFsKCSAgICAvLyBgU3RyaW5nLnByb3RvdHlwZS5zcGxpdGAgbWV0aG9kCgkgICAgLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1zdHJpbmcucHJvdG90eXBlLnNwbGl0CgkgICAgZnVuY3Rpb24gc3BsaXQoc2VwYXJhdG9yLCBsaW1pdCkgewoJICAgICAgdmFyIE8gPSByZXF1aXJlT2JqZWN0Q29lcmNpYmxlJDgodGhpcyk7CgkgICAgICB2YXIgc3BsaXR0ZXIgPSBzZXBhcmF0b3IgPT0gdW5kZWZpbmVkID8gdW5kZWZpbmVkIDogZ2V0TWV0aG9kJDQoc2VwYXJhdG9yLCBTUExJVCk7CgkgICAgICByZXR1cm4gc3BsaXR0ZXIKCSAgICAgICAgPyBjYWxsJGMoc3BsaXR0ZXIsIHNlcGFyYXRvciwgTywgbGltaXQpCgkgICAgICAgIDogY2FsbCRjKGludGVybmFsU3BsaXQsIHRvU3RyaW5nJGQoTyksIHNlcGFyYXRvciwgbGltaXQpOwoJICAgIH0sCgkgICAgLy8gYFJlZ0V4cC5wcm90b3R5cGVbQEBzcGxpdF1gIG1ldGhvZAoJICAgIC8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtcmVnZXhwLnByb3RvdHlwZS1AQHNwbGl0CgkgICAgLy8KCSAgICAvLyBOT1RFOiBUaGlzIGNhbm5vdCBiZSBwcm9wZXJseSBwb2x5ZmlsbGVkIGluIGVuZ2luZXMgdGhhdCBkb24ndCBzdXBwb3J0CgkgICAgLy8gdGhlICd5JyBmbGFnLgoJICAgIGZ1bmN0aW9uIChzdHJpbmcsIGxpbWl0KSB7CgkgICAgICB2YXIgcnggPSBhbk9iamVjdCRhKHRoaXMpOwoJICAgICAgdmFyIFMgPSB0b1N0cmluZyRkKHN0cmluZyk7CgkgICAgICB2YXIgcmVzID0gbWF5YmVDYWxsTmF0aXZlKGludGVybmFsU3BsaXQsIHJ4LCBTLCBsaW1pdCwgaW50ZXJuYWxTcGxpdCAhPT0gbmF0aXZlU3BsaXQpOwoKCSAgICAgIGlmIChyZXMuZG9uZSkgcmV0dXJuIHJlcy52YWx1ZTsKCgkgICAgICB2YXIgQyA9IHNwZWNpZXNDb25zdHJ1Y3RvcihyeCwgUmVnRXhwKTsKCgkgICAgICB2YXIgdW5pY29kZU1hdGNoaW5nID0gcngudW5pY29kZTsKCSAgICAgIHZhciBmbGFncyA9IChyeC5pZ25vcmVDYXNlID8gJ2knIDogJycpICsKCSAgICAgICAgICAgICAgICAgIChyeC5tdWx0aWxpbmUgPyAnbScgOiAnJykgKwoJICAgICAgICAgICAgICAgICAgKHJ4LnVuaWNvZGUgPyAndScgOiAnJykgKwoJICAgICAgICAgICAgICAgICAgKFVOU1VQUE9SVEVEX1kgPyAnZycgOiAneScpOwoKCSAgICAgIC8vIF4oPyArIHJ4ICsgKSBpcyBuZWVkZWQsIGluIGNvbWJpbmF0aW9uIHdpdGggc29tZSBTIHNsaWNpbmcsIHRvCgkgICAgICAvLyBzaW11bGF0ZSB0aGUgJ3knIGZsYWcuCgkgICAgICB2YXIgc3BsaXR0ZXIgPSBuZXcgQyhVTlNVUFBPUlRFRF9ZID8gJ14oPzonICsgcnguc291cmNlICsgJyknIDogcngsIGZsYWdzKTsKCSAgICAgIHZhciBsaW0gPSBsaW1pdCA9PT0gdW5kZWZpbmVkID8gTUFYX1VJTlQzMiA6IGxpbWl0ID4+PiAwOwoJICAgICAgaWYgKGxpbSA9PT0gMCkgcmV0dXJuIFtdOwoJICAgICAgaWYgKFMubGVuZ3RoID09PSAwKSByZXR1cm4gY2FsbFJlZ0V4cEV4ZWMoc3BsaXR0ZXIsIFMpID09PSBudWxsID8gW1NdIDogW107CgkgICAgICB2YXIgcCA9IDA7CgkgICAgICB2YXIgcSA9IDA7CgkgICAgICB2YXIgQSA9IFtdOwoJICAgICAgd2hpbGUgKHEgPCBTLmxlbmd0aCkgewoJICAgICAgICBzcGxpdHRlci5sYXN0SW5kZXggPSBVTlNVUFBPUlRFRF9ZID8gMCA6IHE7CgkgICAgICAgIHZhciB6ID0gY2FsbFJlZ0V4cEV4ZWMoc3BsaXR0ZXIsIFVOU1VQUE9SVEVEX1kgPyBzdHJpbmdTbGljZSQzKFMsIHEpIDogUyk7CgkgICAgICAgIHZhciBlOwoJICAgICAgICBpZiAoCgkgICAgICAgICAgeiA9PT0gbnVsbCB8fAoJICAgICAgICAgIChlID0gbWluJDModG9MZW5ndGgkMihzcGxpdHRlci5sYXN0SW5kZXggKyAoVU5TVVBQT1JURURfWSA/IHEgOiAwKSksIFMubGVuZ3RoKSkgPT09IHAKCSAgICAgICAgKSB7CgkgICAgICAgICAgcSA9IGFkdmFuY2VTdHJpbmdJbmRleChTLCBxLCB1bmljb2RlTWF0Y2hpbmcpOwoJICAgICAgICB9IGVsc2UgewoJICAgICAgICAgIHB1c2gkMyhBLCBzdHJpbmdTbGljZSQzKFMsIHAsIHEpKTsKCSAgICAgICAgICBpZiAoQS5sZW5ndGggPT09IGxpbSkgcmV0dXJuIEE7CgkgICAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPD0gei5sZW5ndGggLSAxOyBpKyspIHsKCSAgICAgICAgICAgIHB1c2gkMyhBLCB6W2ldKTsKCSAgICAgICAgICAgIGlmIChBLmxlbmd0aCA9PT0gbGltKSByZXR1cm4gQTsKCSAgICAgICAgICB9CgkgICAgICAgICAgcSA9IHAgPSBlOwoJICAgICAgICB9CgkgICAgICB9CgkgICAgICBwdXNoJDMoQSwgc3RyaW5nU2xpY2UkMyhTLCBwKSk7CgkgICAgICByZXR1cm4gQTsKCSAgICB9CgkgIF07Cgl9LCAhU1BMSVRfV09SS1NfV0lUSF9PVkVSV1JJVFRFTl9FWEVDLCBVTlNVUFBPUlRFRF9ZKTsKCgl2YXIgdW5jdXJyeVRoaXMkciA9IGZ1bmN0aW9uVW5jdXJyeVRoaXMkMTsKCXZhciByZXF1aXJlT2JqZWN0Q29lcmNpYmxlJDcgPSByZXF1aXJlT2JqZWN0Q29lcmNpYmxlJGQ7Cgl2YXIgdG9TdHJpbmckYyA9IHRvU3RyaW5nJGg7CgoJdmFyIHF1b3QgPSAvIi9nOwoJdmFyIHJlcGxhY2UkMiA9IHVuY3VycnlUaGlzJHIoJycucmVwbGFjZSk7CgoJLy8gYENyZWF0ZUhUTUxgIGFic3RyYWN0IG9wZXJhdGlvbgoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1jcmVhdGVodG1sCgl2YXIgY3JlYXRlSHRtbCA9IGZ1bmN0aW9uIChzdHJpbmcsIHRhZywgYXR0cmlidXRlLCB2YWx1ZSkgewoJICB2YXIgUyA9IHRvU3RyaW5nJGMocmVxdWlyZU9iamVjdENvZXJjaWJsZSQ3KHN0cmluZykpOwoJICB2YXIgcDEgPSAnPCcgKyB0YWc7CgkgIGlmIChhdHRyaWJ1dGUgIT09ICcnKSBwMSArPSAnICcgKyBhdHRyaWJ1dGUgKyAnPSInICsgcmVwbGFjZSQyKHRvU3RyaW5nJGModmFsdWUpLCBxdW90LCAnJnF1b3Q7JykgKyAnIic7CgkgIHJldHVybiBwMSArICc+JyArIFMgKyAnPC8nICsgdGFnICsgJz4nOwoJfTsKCgl2YXIgZmFpbHMkaCA9IGZhaWxzJHQ7CgoJLy8gY2hlY2sgdGhlIGV4aXN0ZW5jZSBvZiBhIG1ldGhvZCwgbG93ZXJjYXNlCgkvLyBvZiBhIHRhZyBhbmQgZXNjYXBpbmcgcXVvdGVzIGluIGFyZ3VtZW50cwoJdmFyIHN0cmluZ0h0bWxGb3JjZWQgPSBmdW5jdGlvbiAoTUVUSE9EX05BTUUpIHsKCSAgcmV0dXJuIGZhaWxzJGgoZnVuY3Rpb24gKCkgewoJICAgIHZhciB0ZXN0ID0gJydbTUVUSE9EX05BTUVdKCciJyk7CgkgICAgcmV0dXJuIHRlc3QgIT09IHRlc3QudG9Mb3dlckNhc2UoKSB8fCB0ZXN0LnNwbGl0KCciJykubGVuZ3RoID4gMzsKCSAgfSk7Cgl9OwoKCXZhciAkJGYgPSBfZXhwb3J0JDE7Cgl2YXIgY3JlYXRlSFRNTCA9IGNyZWF0ZUh0bWw7Cgl2YXIgZm9yY2VkU3RyaW5nSFRNTE1ldGhvZCA9IHN0cmluZ0h0bWxGb3JjZWQ7CgoJLy8gYFN0cmluZy5wcm90b3R5cGUuYmxpbmtgIG1ldGhvZAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1zdHJpbmcucHJvdG90eXBlLmJsaW5rCgkkJGYoeyB0YXJnZXQ6ICdTdHJpbmcnLCBwcm90bzogdHJ1ZSwgZm9yY2VkOiBmb3JjZWRTdHJpbmdIVE1MTWV0aG9kKCdibGluaycpIH0sIHsKCSAgYmxpbms6IGZ1bmN0aW9uIGJsaW5rKCkgewoJICAgIHJldHVybiBjcmVhdGVIVE1MKHRoaXMsICdibGluaycsICcnLCAnJyk7CgkgIH0KCX0pOwoKCXZhciBUT19TVFJJTkdfVEFHX1NVUFBPUlQkNCA9IHRvU3RyaW5nVGFnU3VwcG9ydCQxOwoJdmFyIGNsYXNzb2YkYiA9IGNsYXNzb2YkZzsKCgkvLyBgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZ2AgbWV0aG9kIGltcGxlbWVudGF0aW9uCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLW9iamVjdC5wcm90b3R5cGUudG9zdHJpbmcKCXZhciBvYmplY3RUb1N0cmluZyQxID0gVE9fU1RSSU5HX1RBR19TVVBQT1JUJDQgPyB7fS50b1N0cmluZyA6IGZ1bmN0aW9uIHRvU3RyaW5nKCkgewoJICByZXR1cm4gJ1tvYmplY3QgJyArIGNsYXNzb2YkYih0aGlzKSArICddJzsKCX07CgoJdmFyIFRPX1NUUklOR19UQUdfU1VQUE9SVCQzID0gdG9TdHJpbmdUYWdTdXBwb3J0JDE7Cgl2YXIgcmVkZWZpbmUkNSA9IHJlZGVmaW5lJDguZXhwb3J0czsKCXZhciB0b1N0cmluZyRiID0gb2JqZWN0VG9TdHJpbmckMTsKCgkvLyBgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZ2AgbWV0aG9kCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLW9iamVjdC5wcm90b3R5cGUudG9zdHJpbmcKCWlmICghVE9fU1RSSU5HX1RBR19TVVBQT1JUJDMpIHsKCSAgcmVkZWZpbmUkNShPYmplY3QucHJvdG90eXBlLCAndG9TdHJpbmcnLCB0b1N0cmluZyRiLCB7IHVuc2FmZTogdHJ1ZSB9KTsKCX0KCgl2YXIgREVTQ1JJUFRPUlMkOCA9IGRlc2NyaXB0b3JzJDE7Cgl2YXIgRlVOQ1RJT05fTkFNRV9FWElTVFMgPSBmdW5jdGlvbk5hbWUkMS5FWElTVFM7Cgl2YXIgdW5jdXJyeVRoaXMkcSA9IGZ1bmN0aW9uVW5jdXJyeVRoaXMkMTsKCXZhciBkZWZpbmVQcm9wZXJ0eSQ0ID0gb2JqZWN0RGVmaW5lUHJvcGVydHkkMS5mOwoKCXZhciBGdW5jdGlvblByb3RvdHlwZSQzID0gRnVuY3Rpb24ucHJvdG90eXBlOwoJdmFyIGZ1bmN0aW9uVG9TdHJpbmckMSA9IHVuY3VycnlUaGlzJHEoRnVuY3Rpb25Qcm90b3R5cGUkMy50b1N0cmluZyk7Cgl2YXIgbmFtZVJFID0gL2Z1bmN0aW9uXGIoPzpcc3xcL1wqW1xTXHNdKj9cKlwvfFwvXC9bXlxuXHJdKltcblxyXSspKihbXlxzKC9dKikvOwoJdmFyIHJlZ0V4cEV4ZWMgPSB1bmN1cnJ5VGhpcyRxKG5hbWVSRS5leGVjKTsKCXZhciBOQU1FID0gJ25hbWUnOwoKCS8vIEZ1bmN0aW9uIGluc3RhbmNlcyBgLm5hbWVgIHByb3BlcnR5CgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLWZ1bmN0aW9uLWluc3RhbmNlcy1uYW1lCglpZiAoREVTQ1JJUFRPUlMkOCAmJiAhRlVOQ1RJT05fTkFNRV9FWElTVFMpIHsKCSAgZGVmaW5lUHJvcGVydHkkNChGdW5jdGlvblByb3RvdHlwZSQzLCBOQU1FLCB7CgkgICAgY29uZmlndXJhYmxlOiB0cnVlLAoJICAgIGdldDogZnVuY3Rpb24gKCkgewoJICAgICAgdHJ5IHsKCSAgICAgICAgcmV0dXJuIHJlZ0V4cEV4ZWMobmFtZVJFLCBmdW5jdGlvblRvU3RyaW5nJDEodGhpcykpWzFdOwoJICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKCSAgICAgICAgcmV0dXJuICcnOwoJICAgICAgfQoJICAgIH0KCSAgfSk7Cgl9CgoJLy8gVE9ETzogUmVtb3ZlIGZyb20gYGNvcmUtanNANGAgc2luY2UgaXQncyBtb3ZlZCB0byBlbnRyeSBwb2ludHMKCgl2YXIgJCRlID0gX2V4cG9ydCQxOwoJdmFyIGdsb2JhbCRIID0gZ2xvYmFsJDE4OwoJdmFyIGNhbGwkYiA9IGZ1bmN0aW9uQ2FsbCQxOwoJdmFyIHVuY3VycnlUaGlzJHAgPSBmdW5jdGlvblVuY3VycnlUaGlzJDE7Cgl2YXIgaXNDYWxsYWJsZSRpID0gaXNDYWxsYWJsZSR2OwoJdmFyIGlzT2JqZWN0JGIgPSBpc09iamVjdCRpOwoKCXZhciBERUxFR0FURVNfVE9fRVhFQyA9IGZ1bmN0aW9uICgpIHsKCSAgdmFyIGV4ZWNDYWxsZWQgPSBmYWxzZTsKCSAgdmFyIHJlID0gL1thY10vOwoJICByZS5leGVjID0gZnVuY3Rpb24gKCkgewoJICAgIGV4ZWNDYWxsZWQgPSB0cnVlOwoJICAgIHJldHVybiAvLi8uZXhlYy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoJICB9OwoJICByZXR1cm4gcmUudGVzdCgnYWJjJykgPT09IHRydWUgJiYgZXhlY0NhbGxlZDsKCX0oKTsKCgl2YXIgRXJyb3IkMSA9IGdsb2JhbCRILkVycm9yOwoJdmFyIHVuJFRlc3QgPSB1bmN1cnJ5VGhpcyRwKC8uLy50ZXN0KTsKCgkvLyBgUmVnRXhwLnByb3RvdHlwZS50ZXN0YCBtZXRob2QKCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtcmVnZXhwLnByb3RvdHlwZS50ZXN0CgkkJGUoeyB0YXJnZXQ6ICdSZWdFeHAnLCBwcm90bzogdHJ1ZSwgZm9yY2VkOiAhREVMRUdBVEVTX1RPX0VYRUMgfSwgewoJICB0ZXN0OiBmdW5jdGlvbiAoc3RyKSB7CgkgICAgdmFyIGV4ZWMgPSB0aGlzLmV4ZWM7CgkgICAgaWYgKCFpc0NhbGxhYmxlJGkoZXhlYykpIHJldHVybiB1biRUZXN0KHRoaXMsIHN0cik7CgkgICAgdmFyIHJlc3VsdCA9IGNhbGwkYihleGVjLCB0aGlzLCBzdHIpOwoJICAgIGlmIChyZXN1bHQgIT09IG51bGwgJiYgIWlzT2JqZWN0JGIocmVzdWx0KSkgewoJICAgICAgdGhyb3cgbmV3IEVycm9yJDEoJ1JlZ0V4cCBleGVjIG1ldGhvZCByZXR1cm5lZCBzb21ldGhpbmcgb3RoZXIgdGhhbiBhbiBPYmplY3Qgb3IgbnVsbCcpOwoJICAgIH0KCSAgICByZXR1cm4gISFyZXN1bHQ7CgkgIH0KCX0pOwoKCXZhciBjaGVjayA9IGZ1bmN0aW9uIChpdCkgewoJICByZXR1cm4gaXQgJiYgaXQuTWF0aCA9PSBNYXRoICYmIGl0OwoJfTsKCgkvLyBodHRwczovL2dpdGh1Yi5jb20vemxvaXJvY2svY29yZS1qcy9pc3N1ZXMvODYjaXNzdWVjb21tZW50LTExNTc1OTAyOAoJdmFyIGdsb2JhbCRHID0KCSAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGVzL25vLWdsb2JhbC10aGlzIC0tIHNhZmUKCSAgY2hlY2sodHlwZW9mIGdsb2JhbFRoaXMgPT0gJ29iamVjdCcgJiYgZ2xvYmFsVGhpcykgfHwKCSAgY2hlY2sodHlwZW9mIHdpbmRvdyA9PSAnb2JqZWN0JyAmJiB3aW5kb3cpIHx8CgkgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1yZXN0cmljdGVkLWdsb2JhbHMgLS0gc2FmZQoJICBjaGVjayh0eXBlb2Ygc2VsZiA9PSAnb2JqZWN0JyAmJiBzZWxmKSB8fAoJICBjaGVjayh0eXBlb2YgY29tbW9uanNHbG9iYWwgPT0gJ29iamVjdCcgJiYgY29tbW9uanNHbG9iYWwpIHx8CgkgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1uZXctZnVuYyAtLSBmYWxsYmFjawoJICAoZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpczsgfSkoKSB8fCBGdW5jdGlvbigncmV0dXJuIHRoaXMnKSgpOwoKCXZhciBGdW5jdGlvblByb3RvdHlwZSQyID0gRnVuY3Rpb24ucHJvdG90eXBlOwoJdmFyIGJpbmQkNSA9IEZ1bmN0aW9uUHJvdG90eXBlJDIuYmluZDsKCXZhciBjYWxsJGEgPSBGdW5jdGlvblByb3RvdHlwZSQyLmNhbGw7Cgl2YXIgY2FsbEJpbmQgPSBiaW5kJDUgJiYgYmluZCQ1LmJpbmQoY2FsbCRhKTsKCgl2YXIgZnVuY3Rpb25VbmN1cnJ5VGhpcyA9IGJpbmQkNSA/IGZ1bmN0aW9uIChmbikgewoJICByZXR1cm4gZm4gJiYgY2FsbEJpbmQoY2FsbCRhLCBmbik7Cgl9IDogZnVuY3Rpb24gKGZuKSB7CgkgIHJldHVybiBmbiAmJiBmdW5jdGlvbiAoKSB7CgkgICAgcmV0dXJuIGNhbGwkYS5hcHBseShmbiwgYXJndW1lbnRzKTsKCSAgfTsKCX07CgoJdmFyIGZhaWxzJGcgPSBmdW5jdGlvbiAoZXhlYykgewoJICB0cnkgewoJICAgIHJldHVybiAhIWV4ZWMoKTsKCSAgfSBjYXRjaCAoZXJyb3IpIHsKCSAgICByZXR1cm4gdHJ1ZTsKCSAgfQoJfTsKCgl2YXIgdW5jdXJyeVRoaXMkbyA9IGZ1bmN0aW9uVW5jdXJyeVRoaXM7CgoJdmFyIHRvU3RyaW5nJGEgPSB1bmN1cnJ5VGhpcyRvKHt9LnRvU3RyaW5nKTsKCXZhciBzdHJpbmdTbGljZSQyID0gdW5jdXJyeVRoaXMkbygnJy5zbGljZSk7CgoJdmFyIGNsYXNzb2ZSYXckMSA9IGZ1bmN0aW9uIChpdCkgewoJICByZXR1cm4gc3RyaW5nU2xpY2UkMih0b1N0cmluZyRhKGl0KSwgOCwgLTEpOwoJfTsKCgl2YXIgZ2xvYmFsJEYgPSBnbG9iYWwkRzsKCXZhciB1bmN1cnJ5VGhpcyRuID0gZnVuY3Rpb25VbmN1cnJ5VGhpczsKCXZhciBmYWlscyRmID0gZmFpbHMkZzsKCXZhciBjbGFzc29mJGEgPSBjbGFzc29mUmF3JDE7CgoJdmFyIE9iamVjdCQ1ID0gZ2xvYmFsJEYuT2JqZWN0OwoJdmFyIHNwbGl0ID0gdW5jdXJyeVRoaXMkbignJy5zcGxpdCk7CgoJLy8gZmFsbGJhY2sgZm9yIG5vbi1hcnJheS1saWtlIEVTMyBhbmQgbm9uLWVudW1lcmFibGUgb2xkIFY4IHN0cmluZ3MKCXZhciBpbmRleGVkT2JqZWN0ID0gZmFpbHMkZihmdW5jdGlvbiAoKSB7CgkgIC8vIHRocm93cyBhbiBlcnJvciBpbiByaGlubywgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9tb3ppbGxhL3JoaW5vL2lzc3Vlcy8zNDYKCSAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXByb3RvdHlwZS1idWlsdGlucyAtLSBzYWZlCgkgIHJldHVybiAhT2JqZWN0JDUoJ3onKS5wcm9wZXJ0eUlzRW51bWVyYWJsZSgwKTsKCX0pID8gZnVuY3Rpb24gKGl0KSB7CgkgIHJldHVybiBjbGFzc29mJGEoaXQpID09ICdTdHJpbmcnID8gc3BsaXQoaXQsICcnKSA6IE9iamVjdCQ1KGl0KTsKCX0gOiBPYmplY3QkNTsKCgl2YXIgZ2xvYmFsJEUgPSBnbG9iYWwkRzsKCgl2YXIgVHlwZUVycm9yJGYgPSBnbG9iYWwkRS5UeXBlRXJyb3I7CgoJLy8gYFJlcXVpcmVPYmplY3RDb2VyY2libGVgIGFic3RyYWN0IG9wZXJhdGlvbgoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1yZXF1aXJlb2JqZWN0Y29lcmNpYmxlCgl2YXIgcmVxdWlyZU9iamVjdENvZXJjaWJsZSQ2ID0gZnVuY3Rpb24gKGl0KSB7CgkgIGlmIChpdCA9PSB1bmRlZmluZWQpIHRocm93IFR5cGVFcnJvciRmKCJDYW4ndCBjYWxsIG1ldGhvZCBvbiAiICsgaXQpOwoJICByZXR1cm4gaXQ7Cgl9OwoKCS8vIHRvT2JqZWN0IHdpdGggZmFsbGJhY2sgZm9yIG5vbi1hcnJheS1saWtlIEVTMyBzdHJpbmdzCgl2YXIgSW5kZXhlZE9iamVjdCQyID0gaW5kZXhlZE9iamVjdDsKCXZhciByZXF1aXJlT2JqZWN0Q29lcmNpYmxlJDUgPSByZXF1aXJlT2JqZWN0Q29lcmNpYmxlJDY7CgoJdmFyIHRvSW5kZXhlZE9iamVjdCQ4ID0gZnVuY3Rpb24gKGl0KSB7CgkgIHJldHVybiBJbmRleGVkT2JqZWN0JDIocmVxdWlyZU9iamVjdENvZXJjaWJsZSQ1KGl0KSk7Cgl9OwoKCXZhciBpdGVyYXRvcnMgPSB7fTsKCgkvLyBgSXNDYWxsYWJsZWAgYWJzdHJhY3Qgb3BlcmF0aW9uCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLWlzY2FsbGFibGUKCXZhciBpc0NhbGxhYmxlJGggPSBmdW5jdGlvbiAoYXJndW1lbnQpIHsKCSAgcmV0dXJuIHR5cGVvZiBhcmd1bWVudCA9PSAnZnVuY3Rpb24nOwoJfTsKCgl2YXIgZ2xvYmFsJEQgPSBnbG9iYWwkRzsKCgkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZXMvbm8tb2JqZWN0LWRlZmluZXByb3BlcnR5IC0tIHNhZmUKCXZhciBkZWZpbmVQcm9wZXJ0eSQzID0gT2JqZWN0LmRlZmluZVByb3BlcnR5OwoKCXZhciBzZXRHbG9iYWwkMSA9IGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CgkgIHRyeSB7CgkgICAgZGVmaW5lUHJvcGVydHkkMyhnbG9iYWwkRCwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTsKCSAgfSBjYXRjaCAoZXJyb3IpIHsKCSAgICBnbG9iYWwkRFtrZXldID0gdmFsdWU7CgkgIH0gcmV0dXJuIHZhbHVlOwoJfTsKCgl2YXIgZ2xvYmFsJEMgPSBnbG9iYWwkRzsKCXZhciBzZXRHbG9iYWwgPSBzZXRHbG9iYWwkMTsKCgl2YXIgU0hBUkVEID0gJ19fY29yZS1qc19zaGFyZWRfXyc7Cgl2YXIgc3RvcmUkMyA9IGdsb2JhbCRDW1NIQVJFRF0gfHwgc2V0R2xvYmFsKFNIQVJFRCwge30pOwoKCXZhciBzaGFyZWRTdG9yZSA9IHN0b3JlJDM7CgoJdmFyIHVuY3VycnlUaGlzJG0gPSBmdW5jdGlvblVuY3VycnlUaGlzOwoJdmFyIGlzQ2FsbGFibGUkZyA9IGlzQ2FsbGFibGUkaDsKCXZhciBzdG9yZSQyID0gc2hhcmVkU3RvcmU7CgoJdmFyIGZ1bmN0aW9uVG9TdHJpbmcgPSB1bmN1cnJ5VGhpcyRtKEZ1bmN0aW9uLnRvU3RyaW5nKTsKCgkvLyB0aGlzIGhlbHBlciBicm9rZW4gaW4gYGNvcmUtanNAMy40LjEtMy40LjRgLCBzbyB3ZSBjYW4ndCB1c2UgYHNoYXJlZGAgaGVscGVyCglpZiAoIWlzQ2FsbGFibGUkZyhzdG9yZSQyLmluc3BlY3RTb3VyY2UpKSB7CgkgIHN0b3JlJDIuaW5zcGVjdFNvdXJjZSA9IGZ1bmN0aW9uIChpdCkgewoJICAgIHJldHVybiBmdW5jdGlvblRvU3RyaW5nKGl0KTsKCSAgfTsKCX0KCgl2YXIgaW5zcGVjdFNvdXJjZSQyID0gc3RvcmUkMi5pbnNwZWN0U291cmNlOwoKCXZhciBnbG9iYWwkQiA9IGdsb2JhbCRHOwoJdmFyIGlzQ2FsbGFibGUkZiA9IGlzQ2FsbGFibGUkaDsKCXZhciBpbnNwZWN0U291cmNlJDEgPSBpbnNwZWN0U291cmNlJDI7CgoJdmFyIFdlYWtNYXAkMSA9IGdsb2JhbCRCLldlYWtNYXA7CgoJdmFyIG5hdGl2ZVdlYWtNYXAgPSBpc0NhbGxhYmxlJGYoV2Vha01hcCQxKSAmJiAvbmF0aXZlIGNvZGUvLnRlc3QoaW5zcGVjdFNvdXJjZSQxKFdlYWtNYXAkMSkpOwoKCXZhciBpc0NhbGxhYmxlJGUgPSBpc0NhbGxhYmxlJGg7CgoJdmFyIGlzT2JqZWN0JGEgPSBmdW5jdGlvbiAoaXQpIHsKCSAgcmV0dXJuIHR5cGVvZiBpdCA9PSAnb2JqZWN0JyA/IGl0ICE9PSBudWxsIDogaXNDYWxsYWJsZSRlKGl0KTsKCX07CgoJdmFyIGZhaWxzJGUgPSBmYWlscyRnOwoKCS8vIERldGVjdCBJRTgncyBpbmNvbXBsZXRlIGRlZmluZVByb3BlcnR5IGltcGxlbWVudGF0aW9uCgl2YXIgZGVzY3JpcHRvcnMgPSAhZmFpbHMkZShmdW5jdGlvbiAoKSB7CgkgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBlcy9uby1vYmplY3QtZGVmaW5lcHJvcGVydHkgLS0gcmVxdWlyZWQgZm9yIHRlc3RpbmcKCSAgcmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh7fSwgMSwgeyBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIDc7IH0gfSlbMV0gIT0gNzsKCX0pOwoKCXZhciBvYmplY3REZWZpbmVQcm9wZXJ0eSA9IHt9OwoKCXZhciBnbG9iYWwkQSA9IGdsb2JhbCRHOwoJdmFyIGlzT2JqZWN0JDkgPSBpc09iamVjdCRhOwoKCXZhciBkb2N1bWVudCQxID0gZ2xvYmFsJEEuZG9jdW1lbnQ7CgkvLyB0eXBlb2YgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCBpcyAnb2JqZWN0JyBpbiBvbGQgSUUKCXZhciBFWElTVFMkMSA9IGlzT2JqZWN0JDkoZG9jdW1lbnQkMSkgJiYgaXNPYmplY3QkOShkb2N1bWVudCQxLmNyZWF0ZUVsZW1lbnQpOwoKCXZhciBkb2N1bWVudENyZWF0ZUVsZW1lbnQkMSA9IGZ1bmN0aW9uIChpdCkgewoJICByZXR1cm4gRVhJU1RTJDEgPyBkb2N1bWVudCQxLmNyZWF0ZUVsZW1lbnQoaXQpIDoge307Cgl9OwoKCXZhciBERVNDUklQVE9SUyQ3ID0gZGVzY3JpcHRvcnM7Cgl2YXIgZmFpbHMkZCA9IGZhaWxzJGc7Cgl2YXIgY3JlYXRlRWxlbWVudCA9IGRvY3VtZW50Q3JlYXRlRWxlbWVudCQxOwoKCS8vIFRoYW5rJ3MgSUU4IGZvciBoaXMgZnVubnkgZGVmaW5lUHJvcGVydHkKCXZhciBpZThEb21EZWZpbmUgPSAhREVTQ1JJUFRPUlMkNyAmJiAhZmFpbHMkZChmdW5jdGlvbiAoKSB7CgkgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBlcy9uby1vYmplY3QtZGVmaW5lcHJvcGVydHkgLS0gcmVxdWllZCBmb3IgdGVzdGluZwoJICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KGNyZWF0ZUVsZW1lbnQoJ2RpdicpLCAnYScsIHsKCSAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIDc7IH0KCSAgfSkuYSAhPSA3OwoJfSk7CgoJdmFyIGdsb2JhbCR6ID0gZ2xvYmFsJEc7Cgl2YXIgaXNPYmplY3QkOCA9IGlzT2JqZWN0JGE7CgoJdmFyIFN0cmluZyQ2ID0gZ2xvYmFsJHouU3RyaW5nOwoJdmFyIFR5cGVFcnJvciRlID0gZ2xvYmFsJHouVHlwZUVycm9yOwoKCS8vIGBBc3NlcnQ6IFR5cGUoYXJndW1lbnQpIGlzIE9iamVjdGAKCXZhciBhbk9iamVjdCQ5ID0gZnVuY3Rpb24gKGFyZ3VtZW50KSB7CgkgIGlmIChpc09iamVjdCQ4KGFyZ3VtZW50KSkgcmV0dXJuIGFyZ3VtZW50OwoJICB0aHJvdyBUeXBlRXJyb3IkZShTdHJpbmckNihhcmd1bWVudCkgKyAnIGlzIG5vdCBhbiBvYmplY3QnKTsKCX07CgoJdmFyIGNhbGwkOSA9IEZ1bmN0aW9uLnByb3RvdHlwZS5jYWxsOwoKCXZhciBmdW5jdGlvbkNhbGwgPSBjYWxsJDkuYmluZCA/IGNhbGwkOS5iaW5kKGNhbGwkOSkgOiBmdW5jdGlvbiAoKSB7CgkgIHJldHVybiBjYWxsJDkuYXBwbHkoY2FsbCQ5LCBhcmd1bWVudHMpOwoJfTsKCgl2YXIgcGF0aCQ4ID0ge307CgoJdmFyIHBhdGgkNyA9IHBhdGgkODsKCXZhciBnbG9iYWwkeSA9IGdsb2JhbCRHOwoJdmFyIGlzQ2FsbGFibGUkZCA9IGlzQ2FsbGFibGUkaDsKCgl2YXIgYUZ1bmN0aW9uID0gZnVuY3Rpb24gKHZhcmlhYmxlKSB7CgkgIHJldHVybiBpc0NhbGxhYmxlJGQodmFyaWFibGUpID8gdmFyaWFibGUgOiB1bmRlZmluZWQ7Cgl9OwoKCXZhciBnZXRCdWlsdEluJDUgPSBmdW5jdGlvbiAobmFtZXNwYWNlLCBtZXRob2QpIHsKCSAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPCAyID8gYUZ1bmN0aW9uKHBhdGgkN1tuYW1lc3BhY2VdKSB8fCBhRnVuY3Rpb24oZ2xvYmFsJHlbbmFtZXNwYWNlXSkKCSAgICA6IHBhdGgkN1tuYW1lc3BhY2VdICYmIHBhdGgkN1tuYW1lc3BhY2VdW21ldGhvZF0gfHwgZ2xvYmFsJHlbbmFtZXNwYWNlXSAmJiBnbG9iYWwkeVtuYW1lc3BhY2VdW21ldGhvZF07Cgl9OwoKCXZhciB1bmN1cnJ5VGhpcyRsID0gZnVuY3Rpb25VbmN1cnJ5VGhpczsKCgl2YXIgb2JqZWN0SXNQcm90b3R5cGVPZiA9IHVuY3VycnlUaGlzJGwoe30uaXNQcm90b3R5cGVPZik7CgoJdmFyIGdldEJ1aWx0SW4kNCA9IGdldEJ1aWx0SW4kNTsKCgl2YXIgZW5naW5lVXNlckFnZW50ID0gZ2V0QnVpbHRJbiQ0KCduYXZpZ2F0b3InLCAndXNlckFnZW50JykgfHwgJyc7CgoJdmFyIGdsb2JhbCR4ID0gZ2xvYmFsJEc7Cgl2YXIgdXNlckFnZW50ID0gZW5naW5lVXNlckFnZW50OwoKCXZhciBwcm9jZXNzID0gZ2xvYmFsJHgucHJvY2VzczsKCXZhciBEZW5vID0gZ2xvYmFsJHguRGVubzsKCXZhciB2ZXJzaW9ucyA9IHByb2Nlc3MgJiYgcHJvY2Vzcy52ZXJzaW9ucyB8fCBEZW5vICYmIERlbm8udmVyc2lvbjsKCXZhciB2OCA9IHZlcnNpb25zICYmIHZlcnNpb25zLnY4OwoJdmFyIG1hdGNoLCB2ZXJzaW9uOwoKCWlmICh2OCkgewoJICBtYXRjaCA9IHY4LnNwbGl0KCcuJyk7CgkgIC8vIGluIG9sZCBDaHJvbWUsIHZlcnNpb25zIG9mIFY4IGlzbid0IFY4ID0gQ2hyb21lIC8gMTAKCSAgLy8gYnV0IHRoZWlyIGNvcnJlY3QgdmVyc2lvbnMgYXJlIG5vdCBpbnRlcmVzdGluZyBmb3IgdXMKCSAgdmVyc2lvbiA9IG1hdGNoWzBdID4gMCAmJiBtYXRjaFswXSA8IDQgPyAxIDogKyhtYXRjaFswXSArIG1hdGNoWzFdKTsKCX0KCgkvLyBCcm93c2VyRlMgTm9kZUpTIGBwcm9jZXNzYCBwb2x5ZmlsbCBpbmNvcnJlY3RseSBzZXQgYC52OGAgdG8gYDAuMGAKCS8vIHNvIGNoZWNrIGB1c2VyQWdlbnRgIGV2ZW4gaWYgYC52OGAgZXhpc3RzLCBidXQgMAoJaWYgKCF2ZXJzaW9uICYmIHVzZXJBZ2VudCkgewoJICBtYXRjaCA9IHVzZXJBZ2VudC5tYXRjaCgvRWRnZVwvKFxkKykvKTsKCSAgaWYgKCFtYXRjaCB8fCBtYXRjaFsxXSA+PSA3NCkgewoJICAgIG1hdGNoID0gdXNlckFnZW50Lm1hdGNoKC9DaHJvbWVcLyhcZCspLyk7CgkgICAgaWYgKG1hdGNoKSB2ZXJzaW9uID0gK21hdGNoWzFdOwoJICB9Cgl9CgoJdmFyIGVuZ2luZVY4VmVyc2lvbiA9IHZlcnNpb247CgoJLyogZXNsaW50LWRpc2FibGUgZXMvbm8tc3ltYm9sIC0tIHJlcXVpcmVkIGZvciB0ZXN0aW5nICovCgoJdmFyIFY4X1ZFUlNJT04kMiA9IGVuZ2luZVY4VmVyc2lvbjsKCXZhciBmYWlscyRjID0gZmFpbHMkZzsKCgkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZXMvbm8tb2JqZWN0LWdldG93bnByb3BlcnR5c3ltYm9scyAtLSByZXF1aXJlZCBmb3IgdGVzdGluZwoJdmFyIG5hdGl2ZVN5bWJvbCA9ICEhT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyAmJiAhZmFpbHMkYyhmdW5jdGlvbiAoKSB7CgkgIHZhciBzeW1ib2wgPSBTeW1ib2woKTsKCSAgLy8gQ2hyb21lIDM4IFN5bWJvbCBoYXMgaW5jb3JyZWN0IHRvU3RyaW5nIGNvbnZlcnNpb24KCSAgLy8gYGdldC1vd24tcHJvcGVydHktc3ltYm9sc2AgcG9seWZpbGwgc3ltYm9scyBjb252ZXJ0ZWQgdG8gb2JqZWN0IGFyZSBub3QgU3ltYm9sIGluc3RhbmNlcwoJICByZXR1cm4gIVN0cmluZyhzeW1ib2wpIHx8ICEoT2JqZWN0KHN5bWJvbCkgaW5zdGFuY2VvZiBTeW1ib2wpIHx8CgkgICAgLy8gQ2hyb21lIDM4LTQwIHN5bWJvbHMgYXJlIG5vdCBpbmhlcml0ZWQgZnJvbSBET00gY29sbGVjdGlvbnMgcHJvdG90eXBlcyB0byBpbnN0YW5jZXMKCSAgICAhU3ltYm9sLnNoYW0gJiYgVjhfVkVSU0lPTiQyICYmIFY4X1ZFUlNJT04kMiA8IDQxOwoJfSk7CgoJLyogZXNsaW50LWRpc2FibGUgZXMvbm8tc3ltYm9sIC0tIHJlcXVpcmVkIGZvciB0ZXN0aW5nICovCgoJdmFyIE5BVElWRV9TWU1CT0wkMiA9IG5hdGl2ZVN5bWJvbDsKCgl2YXIgdXNlU3ltYm9sQXNVaWQgPSBOQVRJVkVfU1lNQk9MJDIKCSAgJiYgIVN5bWJvbC5zaGFtCgkgICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT0gJ3N5bWJvbCc7CgoJdmFyIGdsb2JhbCR3ID0gZ2xvYmFsJEc7Cgl2YXIgZ2V0QnVpbHRJbiQzID0gZ2V0QnVpbHRJbiQ1OwoJdmFyIGlzQ2FsbGFibGUkYyA9IGlzQ2FsbGFibGUkaDsKCXZhciBpc1Byb3RvdHlwZU9mJGEgPSBvYmplY3RJc1Byb3RvdHlwZU9mOwoJdmFyIFVTRV9TWU1CT0xfQVNfVUlEJDEgPSB1c2VTeW1ib2xBc1VpZDsKCgl2YXIgT2JqZWN0JDQgPSBnbG9iYWwkdy5PYmplY3Q7CgoJdmFyIGlzU3ltYm9sJDQgPSBVU0VfU1lNQk9MX0FTX1VJRCQxID8gZnVuY3Rpb24gKGl0KSB7CgkgIHJldHVybiB0eXBlb2YgaXQgPT0gJ3N5bWJvbCc7Cgl9IDogZnVuY3Rpb24gKGl0KSB7CgkgIHZhciAkU3ltYm9sID0gZ2V0QnVpbHRJbiQzKCdTeW1ib2wnKTsKCSAgcmV0dXJuIGlzQ2FsbGFibGUkYygkU3ltYm9sKSAmJiBpc1Byb3RvdHlwZU9mJGEoJFN5bWJvbC5wcm90b3R5cGUsIE9iamVjdCQ0KGl0KSk7Cgl9OwoKCXZhciBnbG9iYWwkdiA9IGdsb2JhbCRHOwoKCXZhciBTdHJpbmckNSA9IGdsb2JhbCR2LlN0cmluZzsKCgl2YXIgdHJ5VG9TdHJpbmckMiA9IGZ1bmN0aW9uIChhcmd1bWVudCkgewoJICB0cnkgewoJICAgIHJldHVybiBTdHJpbmckNShhcmd1bWVudCk7CgkgIH0gY2F0Y2ggKGVycm9yKSB7CgkgICAgcmV0dXJuICdPYmplY3QnOwoJICB9Cgl9OwoKCXZhciBnbG9iYWwkdSA9IGdsb2JhbCRHOwoJdmFyIGlzQ2FsbGFibGUkYiA9IGlzQ2FsbGFibGUkaDsKCXZhciB0cnlUb1N0cmluZyQxID0gdHJ5VG9TdHJpbmckMjsKCgl2YXIgVHlwZUVycm9yJGQgPSBnbG9iYWwkdS5UeXBlRXJyb3I7CgoJLy8gYEFzc2VydDogSXNDYWxsYWJsZShhcmd1bWVudCkgaXMgdHJ1ZWAKCXZhciBhQ2FsbGFibGUkNCA9IGZ1bmN0aW9uIChhcmd1bWVudCkgewoJICBpZiAoaXNDYWxsYWJsZSRiKGFyZ3VtZW50KSkgcmV0dXJuIGFyZ3VtZW50OwoJICB0aHJvdyBUeXBlRXJyb3IkZCh0cnlUb1N0cmluZyQxKGFyZ3VtZW50KSArICcgaXMgbm90IGEgZnVuY3Rpb24nKTsKCX07CgoJdmFyIGFDYWxsYWJsZSQzID0gYUNhbGxhYmxlJDQ7CgoJLy8gYEdldE1ldGhvZGAgYWJzdHJhY3Qgb3BlcmF0aW9uCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLWdldG1ldGhvZAoJdmFyIGdldE1ldGhvZCQzID0gZnVuY3Rpb24gKFYsIFApIHsKCSAgdmFyIGZ1bmMgPSBWW1BdOwoJICByZXR1cm4gZnVuYyA9PSBudWxsID8gdW5kZWZpbmVkIDogYUNhbGxhYmxlJDMoZnVuYyk7Cgl9OwoKCXZhciBnbG9iYWwkdCA9IGdsb2JhbCRHOwoJdmFyIGNhbGwkOCA9IGZ1bmN0aW9uQ2FsbDsKCXZhciBpc0NhbGxhYmxlJGEgPSBpc0NhbGxhYmxlJGg7Cgl2YXIgaXNPYmplY3QkNyA9IGlzT2JqZWN0JGE7CgoJdmFyIFR5cGVFcnJvciRjID0gZ2xvYmFsJHQuVHlwZUVycm9yOwoKCS8vIGBPcmRpbmFyeVRvUHJpbWl0aXZlYCBhYnN0cmFjdCBvcGVyYXRpb24KCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtb3JkaW5hcnl0b3ByaW1pdGl2ZQoJdmFyIG9yZGluYXJ5VG9QcmltaXRpdmUkMSA9IGZ1bmN0aW9uIChpbnB1dCwgcHJlZikgewoJICB2YXIgZm4sIHZhbDsKCSAgaWYgKHByZWYgPT09ICdzdHJpbmcnICYmIGlzQ2FsbGFibGUkYShmbiA9IGlucHV0LnRvU3RyaW5nKSAmJiAhaXNPYmplY3QkNyh2YWwgPSBjYWxsJDgoZm4sIGlucHV0KSkpIHJldHVybiB2YWw7CgkgIGlmIChpc0NhbGxhYmxlJGEoZm4gPSBpbnB1dC52YWx1ZU9mKSAmJiAhaXNPYmplY3QkNyh2YWwgPSBjYWxsJDgoZm4sIGlucHV0KSkpIHJldHVybiB2YWw7CgkgIGlmIChwcmVmICE9PSAnc3RyaW5nJyAmJiBpc0NhbGxhYmxlJGEoZm4gPSBpbnB1dC50b1N0cmluZykgJiYgIWlzT2JqZWN0JDcodmFsID0gY2FsbCQ4KGZuLCBpbnB1dCkpKSByZXR1cm4gdmFsOwoJICB0aHJvdyBUeXBlRXJyb3IkYygiQ2FuJ3QgY29udmVydCBvYmplY3QgdG8gcHJpbWl0aXZlIHZhbHVlIik7Cgl9OwoKCXZhciBzaGFyZWQkNCA9IHtleHBvcnRzOiB7fX07CgoJdmFyIHN0b3JlJDEgPSBzaGFyZWRTdG9yZTsKCgkoc2hhcmVkJDQuZXhwb3J0cyA9IGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CgkgIHJldHVybiBzdG9yZSQxW2tleV0gfHwgKHN0b3JlJDFba2V5XSA9IHZhbHVlICE9PSB1bmRlZmluZWQgPyB2YWx1ZSA6IHt9KTsKCX0pKCd2ZXJzaW9ucycsIFtdKS5wdXNoKHsKCSAgdmVyc2lvbjogJzMuMTkuMicsCgkgIG1vZGU6ICdwdXJlJyAsCgkgIGNvcHlyaWdodDogJ8KpIDIwMjEgRGVuaXMgUHVzaGthcmV2ICh6bG9pcm9jay5ydSknCgl9KTsKCgl2YXIgZ2xvYmFsJHMgPSBnbG9iYWwkRzsKCXZhciByZXF1aXJlT2JqZWN0Q29lcmNpYmxlJDQgPSByZXF1aXJlT2JqZWN0Q29lcmNpYmxlJDY7CgoJdmFyIE9iamVjdCQzID0gZ2xvYmFsJHMuT2JqZWN0OwoKCS8vIGBUb09iamVjdGAgYWJzdHJhY3Qgb3BlcmF0aW9uCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLXRvb2JqZWN0Cgl2YXIgdG9PYmplY3QkOSA9IGZ1bmN0aW9uIChhcmd1bWVudCkgewoJICByZXR1cm4gT2JqZWN0JDMocmVxdWlyZU9iamVjdENvZXJjaWJsZSQ0KGFyZ3VtZW50KSk7Cgl9OwoKCXZhciB1bmN1cnJ5VGhpcyRrID0gZnVuY3Rpb25VbmN1cnJ5VGhpczsKCXZhciB0b09iamVjdCQ4ID0gdG9PYmplY3QkOTsKCgl2YXIgaGFzT3duUHJvcGVydHkgPSB1bmN1cnJ5VGhpcyRrKHt9Lmhhc093blByb3BlcnR5KTsKCgkvLyBgSGFzT3duUHJvcGVydHlgIGFic3RyYWN0IG9wZXJhdGlvbgoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1oYXNvd25wcm9wZXJ0eQoJdmFyIGhhc093blByb3BlcnR5XzEgPSBPYmplY3QuaGFzT3duIHx8IGZ1bmN0aW9uIGhhc093bihpdCwga2V5KSB7CgkgIHJldHVybiBoYXNPd25Qcm9wZXJ0eSh0b09iamVjdCQ4KGl0KSwga2V5KTsKCX07CgoJdmFyIHVuY3VycnlUaGlzJGogPSBmdW5jdGlvblVuY3VycnlUaGlzOwoKCXZhciBpZCA9IDA7Cgl2YXIgcG9zdGZpeCA9IE1hdGgucmFuZG9tKCk7Cgl2YXIgdG9TdHJpbmckOSA9IHVuY3VycnlUaGlzJGooMS4wLnRvU3RyaW5nKTsKCgl2YXIgdWlkJDMgPSBmdW5jdGlvbiAoa2V5KSB7CgkgIHJldHVybiAnU3ltYm9sKCcgKyAoa2V5ID09PSB1bmRlZmluZWQgPyAnJyA6IGtleSkgKyAnKV8nICsgdG9TdHJpbmckOSgrK2lkICsgcG9zdGZpeCwgMzYpOwoJfTsKCgl2YXIgZ2xvYmFsJHIgPSBnbG9iYWwkRzsKCXZhciBzaGFyZWQkMyA9IHNoYXJlZCQ0LmV4cG9ydHM7Cgl2YXIgaGFzT3duJGIgPSBoYXNPd25Qcm9wZXJ0eV8xOwoJdmFyIHVpZCQyID0gdWlkJDM7Cgl2YXIgTkFUSVZFX1NZTUJPTCQxID0gbmF0aXZlU3ltYm9sOwoJdmFyIFVTRV9TWU1CT0xfQVNfVUlEID0gdXNlU3ltYm9sQXNVaWQ7CgoJdmFyIFdlbGxLbm93blN5bWJvbHNTdG9yZSQxID0gc2hhcmVkJDMoJ3drcycpOwoJdmFyIFN5bWJvbCQzID0gZ2xvYmFsJHIuU3ltYm9sOwoJdmFyIHN5bWJvbEZvciA9IFN5bWJvbCQzICYmIFN5bWJvbCQzWydmb3InXTsKCXZhciBjcmVhdGVXZWxsS25vd25TeW1ib2wgPSBVU0VfU1lNQk9MX0FTX1VJRCA/IFN5bWJvbCQzIDogU3ltYm9sJDMgJiYgU3ltYm9sJDMud2l0aG91dFNldHRlciB8fCB1aWQkMjsKCgl2YXIgd2VsbEtub3duU3ltYm9sJGcgPSBmdW5jdGlvbiAobmFtZSkgewoJICBpZiAoIWhhc093biRiKFdlbGxLbm93blN5bWJvbHNTdG9yZSQxLCBuYW1lKSB8fCAhKE5BVElWRV9TWU1CT0wkMSB8fCB0eXBlb2YgV2VsbEtub3duU3ltYm9sc1N0b3JlJDFbbmFtZV0gPT0gJ3N0cmluZycpKSB7CgkgICAgdmFyIGRlc2NyaXB0aW9uID0gJ1N5bWJvbC4nICsgbmFtZTsKCSAgICBpZiAoTkFUSVZFX1NZTUJPTCQxICYmIGhhc093biRiKFN5bWJvbCQzLCBuYW1lKSkgewoJICAgICAgV2VsbEtub3duU3ltYm9sc1N0b3JlJDFbbmFtZV0gPSBTeW1ib2wkM1tuYW1lXTsKCSAgICB9IGVsc2UgaWYgKFVTRV9TWU1CT0xfQVNfVUlEICYmIHN5bWJvbEZvcikgewoJICAgICAgV2VsbEtub3duU3ltYm9sc1N0b3JlJDFbbmFtZV0gPSBzeW1ib2xGb3IoZGVzY3JpcHRpb24pOwoJICAgIH0gZWxzZSB7CgkgICAgICBXZWxsS25vd25TeW1ib2xzU3RvcmUkMVtuYW1lXSA9IGNyZWF0ZVdlbGxLbm93blN5bWJvbChkZXNjcmlwdGlvbik7CgkgICAgfQoJICB9IHJldHVybiBXZWxsS25vd25TeW1ib2xzU3RvcmUkMVtuYW1lXTsKCX07CgoJdmFyIGdsb2JhbCRxID0gZ2xvYmFsJEc7Cgl2YXIgY2FsbCQ3ID0gZnVuY3Rpb25DYWxsOwoJdmFyIGlzT2JqZWN0JDYgPSBpc09iamVjdCRhOwoJdmFyIGlzU3ltYm9sJDMgPSBpc1N5bWJvbCQ0OwoJdmFyIGdldE1ldGhvZCQyID0gZ2V0TWV0aG9kJDM7Cgl2YXIgb3JkaW5hcnlUb1ByaW1pdGl2ZSA9IG9yZGluYXJ5VG9QcmltaXRpdmUkMTsKCXZhciB3ZWxsS25vd25TeW1ib2wkZiA9IHdlbGxLbm93blN5bWJvbCRnOwoKCXZhciBUeXBlRXJyb3IkYiA9IGdsb2JhbCRxLlR5cGVFcnJvcjsKCXZhciBUT19QUklNSVRJVkUkMSA9IHdlbGxLbm93blN5bWJvbCRmKCd0b1ByaW1pdGl2ZScpOwoKCS8vIGBUb1ByaW1pdGl2ZWAgYWJzdHJhY3Qgb3BlcmF0aW9uCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLXRvcHJpbWl0aXZlCgl2YXIgdG9QcmltaXRpdmUkMiA9IGZ1bmN0aW9uIChpbnB1dCwgcHJlZikgewoJICBpZiAoIWlzT2JqZWN0JDYoaW5wdXQpIHx8IGlzU3ltYm9sJDMoaW5wdXQpKSByZXR1cm4gaW5wdXQ7CgkgIHZhciBleG90aWNUb1ByaW0gPSBnZXRNZXRob2QkMihpbnB1dCwgVE9fUFJJTUlUSVZFJDEpOwoJICB2YXIgcmVzdWx0OwoJICBpZiAoZXhvdGljVG9QcmltKSB7CgkgICAgaWYgKHByZWYgPT09IHVuZGVmaW5lZCkgcHJlZiA9ICdkZWZhdWx0JzsKCSAgICByZXN1bHQgPSBjYWxsJDcoZXhvdGljVG9QcmltLCBpbnB1dCwgcHJlZik7CgkgICAgaWYgKCFpc09iamVjdCQ2KHJlc3VsdCkgfHwgaXNTeW1ib2wkMyhyZXN1bHQpKSByZXR1cm4gcmVzdWx0OwoJICAgIHRocm93IFR5cGVFcnJvciRiKCJDYW4ndCBjb252ZXJ0IG9iamVjdCB0byBwcmltaXRpdmUgdmFsdWUiKTsKCSAgfQoJICBpZiAocHJlZiA9PT0gdW5kZWZpbmVkKSBwcmVmID0gJ251bWJlcic7CgkgIHJldHVybiBvcmRpbmFyeVRvUHJpbWl0aXZlKGlucHV0LCBwcmVmKTsKCX07CgoJdmFyIHRvUHJpbWl0aXZlJDEgPSB0b1ByaW1pdGl2ZSQyOwoJdmFyIGlzU3ltYm9sJDIgPSBpc1N5bWJvbCQ0OwoKCS8vIGBUb1Byb3BlcnR5S2V5YCBhYnN0cmFjdCBvcGVyYXRpb24KCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtdG9wcm9wZXJ0eWtleQoJdmFyIHRvUHJvcGVydHlLZXkkNCA9IGZ1bmN0aW9uIChhcmd1bWVudCkgewoJICB2YXIga2V5ID0gdG9QcmltaXRpdmUkMShhcmd1bWVudCwgJ3N0cmluZycpOwoJICByZXR1cm4gaXNTeW1ib2wkMihrZXkpID8ga2V5IDoga2V5ICsgJyc7Cgl9OwoKCXZhciBnbG9iYWwkcCA9IGdsb2JhbCRHOwoJdmFyIERFU0NSSVBUT1JTJDYgPSBkZXNjcmlwdG9yczsKCXZhciBJRThfRE9NX0RFRklORSQxID0gaWU4RG9tRGVmaW5lOwoJdmFyIGFuT2JqZWN0JDggPSBhbk9iamVjdCQ5OwoJdmFyIHRvUHJvcGVydHlLZXkkMyA9IHRvUHJvcGVydHlLZXkkNDsKCgl2YXIgVHlwZUVycm9yJGEgPSBnbG9iYWwkcC5UeXBlRXJyb3I7CgkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZXMvbm8tb2JqZWN0LWRlZmluZXByb3BlcnR5IC0tIHNhZmUKCXZhciAkZGVmaW5lUHJvcGVydHkkMSA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eTsKCgkvLyBgT2JqZWN0LmRlZmluZVByb3BlcnR5YCBtZXRob2QKCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtb2JqZWN0LmRlZmluZXByb3BlcnR5CglvYmplY3REZWZpbmVQcm9wZXJ0eS5mID0gREVTQ1JJUFRPUlMkNiA/ICRkZWZpbmVQcm9wZXJ0eSQxIDogZnVuY3Rpb24gZGVmaW5lUHJvcGVydHkoTywgUCwgQXR0cmlidXRlcykgewoJICBhbk9iamVjdCQ4KE8pOwoJICBQID0gdG9Qcm9wZXJ0eUtleSQzKFApOwoJICBhbk9iamVjdCQ4KEF0dHJpYnV0ZXMpOwoJICBpZiAoSUU4X0RPTV9ERUZJTkUkMSkgdHJ5IHsKCSAgICByZXR1cm4gJGRlZmluZVByb3BlcnR5JDEoTywgUCwgQXR0cmlidXRlcyk7CgkgIH0gY2F0Y2ggKGVycm9yKSB7IC8qIGVtcHR5ICovIH0KCSAgaWYgKCdnZXQnIGluIEF0dHJpYnV0ZXMgfHwgJ3NldCcgaW4gQXR0cmlidXRlcykgdGhyb3cgVHlwZUVycm9yJGEoJ0FjY2Vzc29ycyBub3Qgc3VwcG9ydGVkJyk7CgkgIGlmICgndmFsdWUnIGluIEF0dHJpYnV0ZXMpIE9bUF0gPSBBdHRyaWJ1dGVzLnZhbHVlOwoJICByZXR1cm4gTzsKCX07CgoJdmFyIGNyZWF0ZVByb3BlcnR5RGVzY3JpcHRvciQ1ID0gZnVuY3Rpb24gKGJpdG1hcCwgdmFsdWUpIHsKCSAgcmV0dXJuIHsKCSAgICBlbnVtZXJhYmxlOiAhKGJpdG1hcCAmIDEpLAoJICAgIGNvbmZpZ3VyYWJsZTogIShiaXRtYXAgJiAyKSwKCSAgICB3cml0YWJsZTogIShiaXRtYXAgJiA0KSwKCSAgICB2YWx1ZTogdmFsdWUKCSAgfTsKCX07CgoJdmFyIERFU0NSSVBUT1JTJDUgPSBkZXNjcmlwdG9yczsKCXZhciBkZWZpbmVQcm9wZXJ0eU1vZHVsZSQzID0gb2JqZWN0RGVmaW5lUHJvcGVydHk7Cgl2YXIgY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yJDQgPSBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IkNTsKCgl2YXIgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5JDUgPSBERVNDUklQVE9SUyQ1ID8gZnVuY3Rpb24gKG9iamVjdCwga2V5LCB2YWx1ZSkgewoJICByZXR1cm4gZGVmaW5lUHJvcGVydHlNb2R1bGUkMy5mKG9iamVjdCwga2V5LCBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IkNCgxLCB2YWx1ZSkpOwoJfSA6IGZ1bmN0aW9uIChvYmplY3QsIGtleSwgdmFsdWUpIHsKCSAgb2JqZWN0W2tleV0gPSB2YWx1ZTsKCSAgcmV0dXJuIG9iamVjdDsKCX07CgoJdmFyIHNoYXJlZCQyID0gc2hhcmVkJDQuZXhwb3J0czsKCXZhciB1aWQkMSA9IHVpZCQzOwoKCXZhciBrZXlzJDEgPSBzaGFyZWQkMigna2V5cycpOwoKCXZhciBzaGFyZWRLZXkkNCA9IGZ1bmN0aW9uIChrZXkpIHsKCSAgcmV0dXJuIGtleXMkMVtrZXldIHx8IChrZXlzJDFba2V5XSA9IHVpZCQxKGtleSkpOwoJfTsKCgl2YXIgaGlkZGVuS2V5cyQ1ID0ge307CgoJdmFyIE5BVElWRV9XRUFLX01BUCA9IG5hdGl2ZVdlYWtNYXA7Cgl2YXIgZ2xvYmFsJG8gPSBnbG9iYWwkRzsKCXZhciB1bmN1cnJ5VGhpcyRpID0gZnVuY3Rpb25VbmN1cnJ5VGhpczsKCXZhciBpc09iamVjdCQ1ID0gaXNPYmplY3QkYTsKCXZhciBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkkNCA9IGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSQ1OwoJdmFyIGhhc093biRhID0gaGFzT3duUHJvcGVydHlfMTsKCXZhciBzaGFyZWQkMSA9IHNoYXJlZFN0b3JlOwoJdmFyIHNoYXJlZEtleSQzID0gc2hhcmVkS2V5JDQ7Cgl2YXIgaGlkZGVuS2V5cyQ0ID0gaGlkZGVuS2V5cyQ1OwoKCXZhciBPQkpFQ1RfQUxSRUFEWV9JTklUSUFMSVpFRCA9ICdPYmplY3QgYWxyZWFkeSBpbml0aWFsaXplZCc7Cgl2YXIgVHlwZUVycm9yJDkgPSBnbG9iYWwkby5UeXBlRXJyb3I7Cgl2YXIgV2Vha01hcCA9IGdsb2JhbCRvLldlYWtNYXA7Cgl2YXIgc2V0LCBnZXQsIGhhczsKCgl2YXIgZW5mb3JjZSA9IGZ1bmN0aW9uIChpdCkgewoJICByZXR1cm4gaGFzKGl0KSA/IGdldChpdCkgOiBzZXQoaXQsIHt9KTsKCX07CgoJdmFyIGdldHRlckZvciA9IGZ1bmN0aW9uIChUWVBFKSB7CgkgIHJldHVybiBmdW5jdGlvbiAoaXQpIHsKCSAgICB2YXIgc3RhdGU7CgkgICAgaWYgKCFpc09iamVjdCQ1KGl0KSB8fCAoc3RhdGUgPSBnZXQoaXQpKS50eXBlICE9PSBUWVBFKSB7CgkgICAgICB0aHJvdyBUeXBlRXJyb3IkOSgnSW5jb21wYXRpYmxlIHJlY2VpdmVyLCAnICsgVFlQRSArICcgcmVxdWlyZWQnKTsKCSAgICB9IHJldHVybiBzdGF0ZTsKCSAgfTsKCX07CgoJaWYgKE5BVElWRV9XRUFLX01BUCB8fCBzaGFyZWQkMS5zdGF0ZSkgewoJICB2YXIgc3RvcmUgPSBzaGFyZWQkMS5zdGF0ZSB8fCAoc2hhcmVkJDEuc3RhdGUgPSBuZXcgV2Vha01hcCgpKTsKCSAgdmFyIHdtZ2V0ID0gdW5jdXJyeVRoaXMkaShzdG9yZS5nZXQpOwoJICB2YXIgd21oYXMgPSB1bmN1cnJ5VGhpcyRpKHN0b3JlLmhhcyk7CgkgIHZhciB3bXNldCA9IHVuY3VycnlUaGlzJGkoc3RvcmUuc2V0KTsKCSAgc2V0ID0gZnVuY3Rpb24gKGl0LCBtZXRhZGF0YSkgewoJICAgIGlmICh3bWhhcyhzdG9yZSwgaXQpKSB0aHJvdyBuZXcgVHlwZUVycm9yJDkoT0JKRUNUX0FMUkVBRFlfSU5JVElBTElaRUQpOwoJICAgIG1ldGFkYXRhLmZhY2FkZSA9IGl0OwoJICAgIHdtc2V0KHN0b3JlLCBpdCwgbWV0YWRhdGEpOwoJICAgIHJldHVybiBtZXRhZGF0YTsKCSAgfTsKCSAgZ2V0ID0gZnVuY3Rpb24gKGl0KSB7CgkgICAgcmV0dXJuIHdtZ2V0KHN0b3JlLCBpdCkgfHwge307CgkgIH07CgkgIGhhcyA9IGZ1bmN0aW9uIChpdCkgewoJICAgIHJldHVybiB3bWhhcyhzdG9yZSwgaXQpOwoJICB9OwoJfSBlbHNlIHsKCSAgdmFyIFNUQVRFID0gc2hhcmVkS2V5JDMoJ3N0YXRlJyk7CgkgIGhpZGRlbktleXMkNFtTVEFURV0gPSB0cnVlOwoJICBzZXQgPSBmdW5jdGlvbiAoaXQsIG1ldGFkYXRhKSB7CgkgICAgaWYgKGhhc093biRhKGl0LCBTVEFURSkpIHRocm93IG5ldyBUeXBlRXJyb3IkOShPQkpFQ1RfQUxSRUFEWV9JTklUSUFMSVpFRCk7CgkgICAgbWV0YWRhdGEuZmFjYWRlID0gaXQ7CgkgICAgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5JDQoaXQsIFNUQVRFLCBtZXRhZGF0YSk7CgkgICAgcmV0dXJuIG1ldGFkYXRhOwoJICB9OwoJICBnZXQgPSBmdW5jdGlvbiAoaXQpIHsKCSAgICByZXR1cm4gaGFzT3duJGEoaXQsIFNUQVRFKSA/IGl0W1NUQVRFXSA6IHt9OwoJICB9OwoJICBoYXMgPSBmdW5jdGlvbiAoaXQpIHsKCSAgICByZXR1cm4gaGFzT3duJGEoaXQsIFNUQVRFKTsKCSAgfTsKCX0KCgl2YXIgaW50ZXJuYWxTdGF0ZSA9IHsKCSAgc2V0OiBzZXQsCgkgIGdldDogZ2V0LAoJICBoYXM6IGhhcywKCSAgZW5mb3JjZTogZW5mb3JjZSwKCSAgZ2V0dGVyRm9yOiBnZXR0ZXJGb3IKCX07CgoJdmFyIEZ1bmN0aW9uUHJvdG90eXBlJDEgPSBGdW5jdGlvbi5wcm90b3R5cGU7Cgl2YXIgYXBwbHkkMiA9IEZ1bmN0aW9uUHJvdG90eXBlJDEuYXBwbHk7Cgl2YXIgYmluZCQ0ID0gRnVuY3Rpb25Qcm90b3R5cGUkMS5iaW5kOwoJdmFyIGNhbGwkNiA9IEZ1bmN0aW9uUHJvdG90eXBlJDEuY2FsbDsKCgkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZXMvbm8tcmVmbGVjdCAtLSBzYWZlCgl2YXIgZnVuY3Rpb25BcHBseSA9IHR5cGVvZiBSZWZsZWN0ID09ICdvYmplY3QnICYmIFJlZmxlY3QuYXBwbHkgfHwgKGJpbmQkNCA/IGNhbGwkNi5iaW5kKGFwcGx5JDIpIDogZnVuY3Rpb24gKCkgewoJICByZXR1cm4gY2FsbCQ2LmFwcGx5KGFwcGx5JDIsIGFyZ3VtZW50cyk7Cgl9KTsKCgl2YXIgb2JqZWN0R2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID0ge307CgoJdmFyIG9iamVjdFByb3BlcnR5SXNFbnVtZXJhYmxlID0ge307CgoJdmFyICRwcm9wZXJ0eUlzRW51bWVyYWJsZSQxID0ge30ucHJvcGVydHlJc0VudW1lcmFibGU7CgkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZXMvbm8tb2JqZWN0LWdldG93bnByb3BlcnR5ZGVzY3JpcHRvciAtLSBzYWZlCgl2YXIgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yJDIgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOwoKCS8vIE5hc2hvcm4gfiBKREs4IGJ1ZwoJdmFyIE5BU0hPUk5fQlVHID0gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yJDIgJiYgISRwcm9wZXJ0eUlzRW51bWVyYWJsZSQxLmNhbGwoeyAxOiAyIH0sIDEpOwoKCS8vIGBPYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlYCBtZXRob2QgaW1wbGVtZW50YXRpb24KCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtb2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eWlzZW51bWVyYWJsZQoJb2JqZWN0UHJvcGVydHlJc0VudW1lcmFibGUuZiA9IE5BU0hPUk5fQlVHID8gZnVuY3Rpb24gcHJvcGVydHlJc0VudW1lcmFibGUoVikgewoJICB2YXIgZGVzY3JpcHRvciA9IGdldE93blByb3BlcnR5RGVzY3JpcHRvciQyKHRoaXMsIFYpOwoJICByZXR1cm4gISFkZXNjcmlwdG9yICYmIGRlc2NyaXB0b3IuZW51bWVyYWJsZTsKCX0gOiAkcHJvcGVydHlJc0VudW1lcmFibGUkMTsKCgl2YXIgREVTQ1JJUFRPUlMkNCA9IGRlc2NyaXB0b3JzOwoJdmFyIGNhbGwkNSA9IGZ1bmN0aW9uQ2FsbDsKCXZhciBwcm9wZXJ0eUlzRW51bWVyYWJsZU1vZHVsZSQxID0gb2JqZWN0UHJvcGVydHlJc0VudW1lcmFibGU7Cgl2YXIgY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yJDMgPSBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IkNTsKCXZhciB0b0luZGV4ZWRPYmplY3QkNyA9IHRvSW5kZXhlZE9iamVjdCQ4OwoJdmFyIHRvUHJvcGVydHlLZXkkMiA9IHRvUHJvcGVydHlLZXkkNDsKCXZhciBoYXNPd24kOSA9IGhhc093blByb3BlcnR5XzE7Cgl2YXIgSUU4X0RPTV9ERUZJTkUgPSBpZThEb21EZWZpbmU7CgoJLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGVzL25vLW9iamVjdC1nZXRvd25wcm9wZXJ0eWRlc2NyaXB0b3IgLS0gc2FmZQoJdmFyICRnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IkMSA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7CgoJLy8gYE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JgIG1ldGhvZAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1vYmplY3QuZ2V0b3ducHJvcGVydHlkZXNjcmlwdG9yCglvYmplY3RHZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IuZiA9IERFU0NSSVBUT1JTJDQgPyAkZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yJDEgOiBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTywgUCkgewoJICBPID0gdG9JbmRleGVkT2JqZWN0JDcoTyk7CgkgIFAgPSB0b1Byb3BlcnR5S2V5JDIoUCk7CgkgIGlmIChJRThfRE9NX0RFRklORSkgdHJ5IHsKCSAgICByZXR1cm4gJGdldE93blByb3BlcnR5RGVzY3JpcHRvciQxKE8sIFApOwoJICB9IGNhdGNoIChlcnJvcikgeyAvKiBlbXB0eSAqLyB9CgkgIGlmIChoYXNPd24kOShPLCBQKSkgcmV0dXJuIGNyZWF0ZVByb3BlcnR5RGVzY3JpcHRvciQzKCFjYWxsJDUocHJvcGVydHlJc0VudW1lcmFibGVNb2R1bGUkMS5mLCBPLCBQKSwgT1tQXSk7Cgl9OwoKCXZhciBmYWlscyRiID0gZmFpbHMkZzsKCXZhciBpc0NhbGxhYmxlJDkgPSBpc0NhbGxhYmxlJGg7CgoJdmFyIHJlcGxhY2VtZW50ID0gLyN8XC5wcm90b3R5cGVcLi87CgoJdmFyIGlzRm9yY2VkJDIgPSBmdW5jdGlvbiAoZmVhdHVyZSwgZGV0ZWN0aW9uKSB7CgkgIHZhciB2YWx1ZSA9IGRhdGFbbm9ybWFsaXplKGZlYXR1cmUpXTsKCSAgcmV0dXJuIHZhbHVlID09IFBPTFlGSUxMID8gdHJ1ZQoJICAgIDogdmFsdWUgPT0gTkFUSVZFID8gZmFsc2UKCSAgICA6IGlzQ2FsbGFibGUkOShkZXRlY3Rpb24pID8gZmFpbHMkYihkZXRlY3Rpb24pCgkgICAgOiAhIWRldGVjdGlvbjsKCX07CgoJdmFyIG5vcm1hbGl6ZSA9IGlzRm9yY2VkJDIubm9ybWFsaXplID0gZnVuY3Rpb24gKHN0cmluZykgewoJICByZXR1cm4gU3RyaW5nKHN0cmluZykucmVwbGFjZShyZXBsYWNlbWVudCwgJy4nKS50b0xvd2VyQ2FzZSgpOwoJfTsKCgl2YXIgZGF0YSA9IGlzRm9yY2VkJDIuZGF0YSA9IHt9OwoJdmFyIE5BVElWRSA9IGlzRm9yY2VkJDIuTkFUSVZFID0gJ04nOwoJdmFyIFBPTFlGSUxMID0gaXNGb3JjZWQkMi5QT0xZRklMTCA9ICdQJzsKCgl2YXIgaXNGb3JjZWRfMSA9IGlzRm9yY2VkJDI7CgoJdmFyIHVuY3VycnlUaGlzJGggPSBmdW5jdGlvblVuY3VycnlUaGlzOwoJdmFyIGFDYWxsYWJsZSQyID0gYUNhbGxhYmxlJDQ7CgoJdmFyIGJpbmQkMyA9IHVuY3VycnlUaGlzJGgodW5jdXJyeVRoaXMkaC5iaW5kKTsKCgkvLyBvcHRpb25hbCAvIHNpbXBsZSBjb250ZXh0IGJpbmRpbmcKCXZhciBmdW5jdGlvbkJpbmRDb250ZXh0ID0gZnVuY3Rpb24gKGZuLCB0aGF0KSB7CgkgIGFDYWxsYWJsZSQyKGZuKTsKCSAgcmV0dXJuIHRoYXQgPT09IHVuZGVmaW5lZCA/IGZuIDogYmluZCQzID8gYmluZCQzKGZuLCB0aGF0KSA6IGZ1bmN0aW9uICgvKiAuLi5hcmdzICovKSB7CgkgICAgcmV0dXJuIGZuLmFwcGx5KHRoYXQsIGFyZ3VtZW50cyk7CgkgIH07Cgl9OwoKCXZhciBnbG9iYWwkbiA9IGdsb2JhbCRHOwoJdmFyIGFwcGx5JDEgPSBmdW5jdGlvbkFwcGx5OwoJdmFyIHVuY3VycnlUaGlzJGcgPSBmdW5jdGlvblVuY3VycnlUaGlzOwoJdmFyIGlzQ2FsbGFibGUkOCA9IGlzQ2FsbGFibGUkaDsKCXZhciBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IkMSA9IG9iamVjdEdldE93blByb3BlcnR5RGVzY3JpcHRvci5mOwoJdmFyIGlzRm9yY2VkJDEgPSBpc0ZvcmNlZF8xOwoJdmFyIHBhdGgkNiA9IHBhdGgkODsKCXZhciBiaW5kJDIgPSBmdW5jdGlvbkJpbmRDb250ZXh0OwoJdmFyIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSQzID0gY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5JDU7Cgl2YXIgaGFzT3duJDggPSBoYXNPd25Qcm9wZXJ0eV8xOwoKCXZhciB3cmFwQ29uc3RydWN0b3IgPSBmdW5jdGlvbiAoTmF0aXZlQ29uc3RydWN0b3IpIHsKCSAgdmFyIFdyYXBwZXIgPSBmdW5jdGlvbiAoYSwgYiwgYykgewoJICAgIGlmICh0aGlzIGluc3RhbmNlb2YgV3JhcHBlcikgewoJICAgICAgc3dpdGNoIChhcmd1bWVudHMubGVuZ3RoKSB7CgkgICAgICAgIGNhc2UgMDogcmV0dXJuIG5ldyBOYXRpdmVDb25zdHJ1Y3RvcigpOwoJICAgICAgICBjYXNlIDE6IHJldHVybiBuZXcgTmF0aXZlQ29uc3RydWN0b3IoYSk7CgkgICAgICAgIGNhc2UgMjogcmV0dXJuIG5ldyBOYXRpdmVDb25zdHJ1Y3RvcihhLCBiKTsKCSAgICAgIH0gcmV0dXJuIG5ldyBOYXRpdmVDb25zdHJ1Y3RvcihhLCBiLCBjKTsKCSAgICB9IHJldHVybiBhcHBseSQxKE5hdGl2ZUNvbnN0cnVjdG9yLCB0aGlzLCBhcmd1bWVudHMpOwoJICB9OwoJICBXcmFwcGVyLnByb3RvdHlwZSA9IE5hdGl2ZUNvbnN0cnVjdG9yLnByb3RvdHlwZTsKCSAgcmV0dXJuIFdyYXBwZXI7Cgl9OwoKCS8qCgkgIG9wdGlvbnMudGFyZ2V0ICAgICAgLSBuYW1lIG9mIHRoZSB0YXJnZXQgb2JqZWN0CgkgIG9wdGlvbnMuZ2xvYmFsICAgICAgLSB0YXJnZXQgaXMgdGhlIGdsb2JhbCBvYmplY3QKCSAgb3B0aW9ucy5zdGF0ICAgICAgICAtIGV4cG9ydCBhcyBzdGF0aWMgbWV0aG9kcyBvZiB0YXJnZXQKCSAgb3B0aW9ucy5wcm90byAgICAgICAtIGV4cG9ydCBhcyBwcm90b3R5cGUgbWV0aG9kcyBvZiB0YXJnZXQKCSAgb3B0aW9ucy5yZWFsICAgICAgICAtIHJlYWwgcHJvdG90eXBlIG1ldGhvZCBmb3IgdGhlIGBwdXJlYCB2ZXJzaW9uCgkgIG9wdGlvbnMuZm9yY2VkICAgICAgLSBleHBvcnQgZXZlbiBpZiB0aGUgbmF0aXZlIGZlYXR1cmUgaXMgYXZhaWxhYmxlCgkgIG9wdGlvbnMuYmluZCAgICAgICAgLSBiaW5kIG1ldGhvZHMgdG8gdGhlIHRhcmdldCwgcmVxdWlyZWQgZm9yIHRoZSBgcHVyZWAgdmVyc2lvbgoJICBvcHRpb25zLndyYXAgICAgICAgIC0gd3JhcCBjb25zdHJ1Y3RvcnMgdG8gcHJldmVudGluZyBnbG9iYWwgcG9sbHV0aW9uLCByZXF1aXJlZCBmb3IgdGhlIGBwdXJlYCB2ZXJzaW9uCgkgIG9wdGlvbnMudW5zYWZlICAgICAgLSB1c2UgdGhlIHNpbXBsZSBhc3NpZ25tZW50IG9mIHByb3BlcnR5IGluc3RlYWQgb2YgZGVsZXRlICsgZGVmaW5lUHJvcGVydHkKCSAgb3B0aW9ucy5zaGFtICAgICAgICAtIGFkZCBhIGZsYWcgdG8gbm90IGNvbXBsZXRlbHkgZnVsbCBwb2x5ZmlsbHMKCSAgb3B0aW9ucy5lbnVtZXJhYmxlICAtIGV4cG9ydCBhcyBlbnVtZXJhYmxlIHByb3BlcnR5CgkgIG9wdGlvbnMubm9UYXJnZXRHZXQgLSBwcmV2ZW50IGNhbGxpbmcgYSBnZXR0ZXIgb24gdGFyZ2V0CgkgIG9wdGlvbnMubmFtZSAgICAgICAgLSB0aGUgLm5hbWUgb2YgdGhlIGZ1bmN0aW9uIGlmIGl0IGRvZXMgbm90IG1hdGNoIHRoZSBrZXkKCSovCgl2YXIgX2V4cG9ydCA9IGZ1bmN0aW9uIChvcHRpb25zLCBzb3VyY2UpIHsKCSAgdmFyIFRBUkdFVCA9IG9wdGlvbnMudGFyZ2V0OwoJICB2YXIgR0xPQkFMID0gb3B0aW9ucy5nbG9iYWw7CgkgIHZhciBTVEFUSUMgPSBvcHRpb25zLnN0YXQ7CgkgIHZhciBQUk9UTyA9IG9wdGlvbnMucHJvdG87CgoJICB2YXIgbmF0aXZlU291cmNlID0gR0xPQkFMID8gZ2xvYmFsJG4gOiBTVEFUSUMgPyBnbG9iYWwkbltUQVJHRVRdIDogKGdsb2JhbCRuW1RBUkdFVF0gfHwge30pLnByb3RvdHlwZTsKCgkgIHZhciB0YXJnZXQgPSBHTE9CQUwgPyBwYXRoJDYgOiBwYXRoJDZbVEFSR0VUXSB8fCBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkkMyhwYXRoJDYsIFRBUkdFVCwge30pW1RBUkdFVF07CgkgIHZhciB0YXJnZXRQcm90b3R5cGUgPSB0YXJnZXQucHJvdG90eXBlOwoKCSAgdmFyIEZPUkNFRCwgVVNFX05BVElWRSwgVklSVFVBTF9QUk9UT1RZUEU7CgkgIHZhciBrZXksIHNvdXJjZVByb3BlcnR5LCB0YXJnZXRQcm9wZXJ0eSwgbmF0aXZlUHJvcGVydHksIHJlc3VsdFByb3BlcnR5LCBkZXNjcmlwdG9yOwoKCSAgZm9yIChrZXkgaW4gc291cmNlKSB7CgkgICAgRk9SQ0VEID0gaXNGb3JjZWQkMShHTE9CQUwgPyBrZXkgOiBUQVJHRVQgKyAoU1RBVElDID8gJy4nIDogJyMnKSArIGtleSwgb3B0aW9ucy5mb3JjZWQpOwoJICAgIC8vIGNvbnRhaW5zIGluIG5hdGl2ZQoJICAgIFVTRV9OQVRJVkUgPSAhRk9SQ0VEICYmIG5hdGl2ZVNvdXJjZSAmJiBoYXNPd24kOChuYXRpdmVTb3VyY2UsIGtleSk7CgoJICAgIHRhcmdldFByb3BlcnR5ID0gdGFyZ2V0W2tleV07CgoJICAgIGlmIChVU0VfTkFUSVZFKSBpZiAob3B0aW9ucy5ub1RhcmdldEdldCkgewoJICAgICAgZGVzY3JpcHRvciA9IGdldE93blByb3BlcnR5RGVzY3JpcHRvciQxKG5hdGl2ZVNvdXJjZSwga2V5KTsKCSAgICAgIG5hdGl2ZVByb3BlcnR5ID0gZGVzY3JpcHRvciAmJiBkZXNjcmlwdG9yLnZhbHVlOwoJICAgIH0gZWxzZSBuYXRpdmVQcm9wZXJ0eSA9IG5hdGl2ZVNvdXJjZVtrZXldOwoKCSAgICAvLyBleHBvcnQgbmF0aXZlIG9yIGltcGxlbWVudGF0aW9uCgkgICAgc291cmNlUHJvcGVydHkgPSAoVVNFX05BVElWRSAmJiBuYXRpdmVQcm9wZXJ0eSkgPyBuYXRpdmVQcm9wZXJ0eSA6IHNvdXJjZVtrZXldOwoKCSAgICBpZiAoVVNFX05BVElWRSAmJiB0eXBlb2YgdGFyZ2V0UHJvcGVydHkgPT0gdHlwZW9mIHNvdXJjZVByb3BlcnR5KSBjb250aW51ZTsKCgkgICAgLy8gYmluZCB0aW1lcnMgdG8gZ2xvYmFsIGZvciBjYWxsIGZyb20gZXhwb3J0IGNvbnRleHQKCSAgICBpZiAob3B0aW9ucy5iaW5kICYmIFVTRV9OQVRJVkUpIHJlc3VsdFByb3BlcnR5ID0gYmluZCQyKHNvdXJjZVByb3BlcnR5LCBnbG9iYWwkbik7CgkgICAgLy8gd3JhcCBnbG9iYWwgY29uc3RydWN0b3JzIGZvciBwcmV2ZW50IGNoYW5ncyBpbiB0aGlzIHZlcnNpb24KCSAgICBlbHNlIGlmIChvcHRpb25zLndyYXAgJiYgVVNFX05BVElWRSkgcmVzdWx0UHJvcGVydHkgPSB3cmFwQ29uc3RydWN0b3Ioc291cmNlUHJvcGVydHkpOwoJICAgIC8vIG1ha2Ugc3RhdGljIHZlcnNpb25zIGZvciBwcm90b3R5cGUgbWV0aG9kcwoJICAgIGVsc2UgaWYgKFBST1RPICYmIGlzQ2FsbGFibGUkOChzb3VyY2VQcm9wZXJ0eSkpIHJlc3VsdFByb3BlcnR5ID0gdW5jdXJyeVRoaXMkZyhzb3VyY2VQcm9wZXJ0eSk7CgkgICAgLy8gZGVmYXVsdCBjYXNlCgkgICAgZWxzZSByZXN1bHRQcm9wZXJ0eSA9IHNvdXJjZVByb3BlcnR5OwoKCSAgICAvLyBhZGQgYSBmbGFnIHRvIG5vdCBjb21wbGV0ZWx5IGZ1bGwgcG9seWZpbGxzCgkgICAgaWYgKG9wdGlvbnMuc2hhbSB8fCAoc291cmNlUHJvcGVydHkgJiYgc291cmNlUHJvcGVydHkuc2hhbSkgfHwgKHRhcmdldFByb3BlcnR5ICYmIHRhcmdldFByb3BlcnR5LnNoYW0pKSB7CgkgICAgICBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkkMyhyZXN1bHRQcm9wZXJ0eSwgJ3NoYW0nLCB0cnVlKTsKCSAgICB9CgoJICAgIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSQzKHRhcmdldCwga2V5LCByZXN1bHRQcm9wZXJ0eSk7CgoJICAgIGlmIChQUk9UTykgewoJICAgICAgVklSVFVBTF9QUk9UT1RZUEUgPSBUQVJHRVQgKyAnUHJvdG90eXBlJzsKCSAgICAgIGlmICghaGFzT3duJDgocGF0aCQ2LCBWSVJUVUFMX1BST1RPVFlQRSkpIHsKCSAgICAgICAgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5JDMocGF0aCQ2LCBWSVJUVUFMX1BST1RPVFlQRSwge30pOwoJICAgICAgfQoJICAgICAgLy8gZXhwb3J0IHZpcnR1YWwgcHJvdG90eXBlIG1ldGhvZHMKCSAgICAgIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSQzKHBhdGgkNltWSVJUVUFMX1BST1RPVFlQRV0sIGtleSwgc291cmNlUHJvcGVydHkpOwoJICAgICAgLy8gZXhwb3J0IHJlYWwgcHJvdG90eXBlIG1ldGhvZHMKCSAgICAgIGlmIChvcHRpb25zLnJlYWwgJiYgdGFyZ2V0UHJvdG90eXBlICYmICF0YXJnZXRQcm90b3R5cGVba2V5XSkgewoJICAgICAgICBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkkMyh0YXJnZXRQcm90b3R5cGUsIGtleSwgc291cmNlUHJvcGVydHkpOwoJICAgICAgfQoJICAgIH0KCSAgfQoJfTsKCgl2YXIgREVTQ1JJUFRPUlMkMyA9IGRlc2NyaXB0b3JzOwoJdmFyIGhhc093biQ3ID0gaGFzT3duUHJvcGVydHlfMTsKCgl2YXIgRnVuY3Rpb25Qcm90b3R5cGUgPSBGdW5jdGlvbi5wcm90b3R5cGU7CgkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZXMvbm8tb2JqZWN0LWdldG93bnByb3BlcnR5ZGVzY3JpcHRvciAtLSBzYWZlCgl2YXIgZ2V0RGVzY3JpcHRvciA9IERFU0NSSVBUT1JTJDMgJiYgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcjsKCgl2YXIgRVhJU1RTID0gaGFzT3duJDcoRnVuY3Rpb25Qcm90b3R5cGUsICduYW1lJyk7CgkvLyBhZGRpdGlvbmFsIHByb3RlY3Rpb24gZnJvbSBtaW5pZmllZCAvIG1hbmdsZWQgLyBkcm9wcGVkIGZ1bmN0aW9uIG5hbWVzCgl2YXIgUFJPUEVSID0gRVhJU1RTICYmIChmdW5jdGlvbiBzb21ldGhpbmcoKSB7IC8qIGVtcHR5ICovIH0pLm5hbWUgPT09ICdzb21ldGhpbmcnOwoJdmFyIENPTkZJR1VSQUJMRSA9IEVYSVNUUyAmJiAoIURFU0NSSVBUT1JTJDMgfHwgKERFU0NSSVBUT1JTJDMgJiYgZ2V0RGVzY3JpcHRvcihGdW5jdGlvblByb3RvdHlwZSwgJ25hbWUnKS5jb25maWd1cmFibGUpKTsKCgl2YXIgZnVuY3Rpb25OYW1lID0gewoJICBFWElTVFM6IEVYSVNUUywKCSAgUFJPUEVSOiBQUk9QRVIsCgkgIENPTkZJR1VSQUJMRTogQ09ORklHVVJBQkxFCgl9OwoKCXZhciBjZWlsID0gTWF0aC5jZWlsOwoJdmFyIGZsb29yJDEgPSBNYXRoLmZsb29yOwoKCS8vIGBUb0ludGVnZXJPckluZmluaXR5YCBhYnN0cmFjdCBvcGVyYXRpb24KCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtdG9pbnRlZ2Vyb3JpbmZpbml0eQoJdmFyIHRvSW50ZWdlck9ySW5maW5pdHkkNiA9IGZ1bmN0aW9uIChhcmd1bWVudCkgewoJICB2YXIgbnVtYmVyID0gK2FyZ3VtZW50OwoJICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tc2VsZi1jb21wYXJlIC0tIHNhZmUKCSAgcmV0dXJuIG51bWJlciAhPT0gbnVtYmVyIHx8IG51bWJlciA9PT0gMCA/IDAgOiAobnVtYmVyID4gMCA/IGZsb29yJDEgOiBjZWlsKShudW1iZXIpOwoJfTsKCgl2YXIgdG9JbnRlZ2VyT3JJbmZpbml0eSQ1ID0gdG9JbnRlZ2VyT3JJbmZpbml0eSQ2OwoKCXZhciBtYXgkMyA9IE1hdGgubWF4OwoJdmFyIG1pbiQyID0gTWF0aC5taW47CgoJLy8gSGVscGVyIGZvciBhIHBvcHVsYXIgcmVwZWF0aW5nIGNhc2Ugb2YgdGhlIHNwZWM6CgkvLyBMZXQgaW50ZWdlciBiZSA/IFRvSW50ZWdlcihpbmRleCkuCgkvLyBJZiBpbnRlZ2VyIDwgMCwgbGV0IHJlc3VsdCBiZSBtYXgoKGxlbmd0aCArIGludGVnZXIpLCAwKTsgZWxzZSBsZXQgcmVzdWx0IGJlIG1pbihpbnRlZ2VyLCBsZW5ndGgpLgoJdmFyIHRvQWJzb2x1dGVJbmRleCQ1ID0gZnVuY3Rpb24gKGluZGV4LCBsZW5ndGgpIHsKCSAgdmFyIGludGVnZXIgPSB0b0ludGVnZXJPckluZmluaXR5JDUoaW5kZXgpOwoJICByZXR1cm4gaW50ZWdlciA8IDAgPyBtYXgkMyhpbnRlZ2VyICsgbGVuZ3RoLCAwKSA6IG1pbiQyKGludGVnZXIsIGxlbmd0aCk7Cgl9OwoKCXZhciB0b0ludGVnZXJPckluZmluaXR5JDQgPSB0b0ludGVnZXJPckluZmluaXR5JDY7CgoJdmFyIG1pbiQxID0gTWF0aC5taW47CgoJLy8gYFRvTGVuZ3RoYCBhYnN0cmFjdCBvcGVyYXRpb24KCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtdG9sZW5ndGgKCXZhciB0b0xlbmd0aCQxID0gZnVuY3Rpb24gKGFyZ3VtZW50KSB7CgkgIHJldHVybiBhcmd1bWVudCA+IDAgPyBtaW4kMSh0b0ludGVnZXJPckluZmluaXR5JDQoYXJndW1lbnQpLCAweDFGRkZGRkZGRkZGRkZGKSA6IDA7IC8vIDIgKiogNTMgLSAxID09IDkwMDcxOTkyNTQ3NDA5OTEKCX07CgoJdmFyIHRvTGVuZ3RoID0gdG9MZW5ndGgkMTsKCgkvLyBgTGVuZ3RoT2ZBcnJheUxpa2VgIGFic3RyYWN0IG9wZXJhdGlvbgoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1sZW5ndGhvZmFycmF5bGlrZQoJdmFyIGxlbmd0aE9mQXJyYXlMaWtlJDkgPSBmdW5jdGlvbiAob2JqKSB7CgkgIHJldHVybiB0b0xlbmd0aChvYmoubGVuZ3RoKTsKCX07CgoJdmFyIHRvSW5kZXhlZE9iamVjdCQ2ID0gdG9JbmRleGVkT2JqZWN0JDg7Cgl2YXIgdG9BYnNvbHV0ZUluZGV4JDQgPSB0b0Fic29sdXRlSW5kZXgkNTsKCXZhciBsZW5ndGhPZkFycmF5TGlrZSQ4ID0gbGVuZ3RoT2ZBcnJheUxpa2UkOTsKCgkvLyBgQXJyYXkucHJvdG90eXBlLnsgaW5kZXhPZiwgaW5jbHVkZXMgfWAgbWV0aG9kcyBpbXBsZW1lbnRhdGlvbgoJdmFyIGNyZWF0ZU1ldGhvZCQ1ID0gZnVuY3Rpb24gKElTX0lOQ0xVREVTKSB7CgkgIHJldHVybiBmdW5jdGlvbiAoJHRoaXMsIGVsLCBmcm9tSW5kZXgpIHsKCSAgICB2YXIgTyA9IHRvSW5kZXhlZE9iamVjdCQ2KCR0aGlzKTsKCSAgICB2YXIgbGVuZ3RoID0gbGVuZ3RoT2ZBcnJheUxpa2UkOChPKTsKCSAgICB2YXIgaW5kZXggPSB0b0Fic29sdXRlSW5kZXgkNChmcm9tSW5kZXgsIGxlbmd0aCk7CgkgICAgdmFyIHZhbHVlOwoJICAgIC8vIEFycmF5I2luY2x1ZGVzIHVzZXMgU2FtZVZhbHVlWmVybyBlcXVhbGl0eSBhbGdvcml0aG0KCSAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tc2VsZi1jb21wYXJlIC0tIE5hTiBjaGVjawoJICAgIGlmIChJU19JTkNMVURFUyAmJiBlbCAhPSBlbCkgd2hpbGUgKGxlbmd0aCA+IGluZGV4KSB7CgkgICAgICB2YWx1ZSA9IE9baW5kZXgrK107CgkgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tc2VsZi1jb21wYXJlIC0tIE5hTiBjaGVjawoJICAgICAgaWYgKHZhbHVlICE9IHZhbHVlKSByZXR1cm4gdHJ1ZTsKCSAgICAvLyBBcnJheSNpbmRleE9mIGlnbm9yZXMgaG9sZXMsIEFycmF5I2luY2x1ZGVzIC0gbm90CgkgICAgfSBlbHNlIGZvciAoO2xlbmd0aCA+IGluZGV4OyBpbmRleCsrKSB7CgkgICAgICBpZiAoKElTX0lOQ0xVREVTIHx8IGluZGV4IGluIE8pICYmIE9baW5kZXhdID09PSBlbCkgcmV0dXJuIElTX0lOQ0xVREVTIHx8IGluZGV4IHx8IDA7CgkgICAgfSByZXR1cm4gIUlTX0lOQ0xVREVTICYmIC0xOwoJICB9OwoJfTsKCgl2YXIgYXJyYXlJbmNsdWRlcyA9IHsKCSAgLy8gYEFycmF5LnByb3RvdHlwZS5pbmNsdWRlc2AgbWV0aG9kCgkgIC8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtYXJyYXkucHJvdG90eXBlLmluY2x1ZGVzCgkgIGluY2x1ZGVzOiBjcmVhdGVNZXRob2QkNSh0cnVlKSwKCSAgLy8gYEFycmF5LnByb3RvdHlwZS5pbmRleE9mYCBtZXRob2QKCSAgLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1hcnJheS5wcm90b3R5cGUuaW5kZXhvZgoJICBpbmRleE9mOiBjcmVhdGVNZXRob2QkNShmYWxzZSkKCX07CgoJdmFyIHVuY3VycnlUaGlzJGYgPSBmdW5jdGlvblVuY3VycnlUaGlzOwoJdmFyIGhhc093biQ2ID0gaGFzT3duUHJvcGVydHlfMTsKCXZhciB0b0luZGV4ZWRPYmplY3QkNSA9IHRvSW5kZXhlZE9iamVjdCQ4OwoJdmFyIGluZGV4T2YgPSBhcnJheUluY2x1ZGVzLmluZGV4T2Y7Cgl2YXIgaGlkZGVuS2V5cyQzID0gaGlkZGVuS2V5cyQ1OwoKCXZhciBwdXNoJDIgPSB1bmN1cnJ5VGhpcyRmKFtdLnB1c2gpOwoKCXZhciBvYmplY3RLZXlzSW50ZXJuYWwgPSBmdW5jdGlvbiAob2JqZWN0LCBuYW1lcykgewoJICB2YXIgTyA9IHRvSW5kZXhlZE9iamVjdCQ1KG9iamVjdCk7CgkgIHZhciBpID0gMDsKCSAgdmFyIHJlc3VsdCA9IFtdOwoJICB2YXIga2V5OwoJICBmb3IgKGtleSBpbiBPKSAhaGFzT3duJDYoaGlkZGVuS2V5cyQzLCBrZXkpICYmIGhhc093biQ2KE8sIGtleSkgJiYgcHVzaCQyKHJlc3VsdCwga2V5KTsKCSAgLy8gRG9uJ3QgZW51bSBidWcgJiBoaWRkZW4ga2V5cwoJICB3aGlsZSAobmFtZXMubGVuZ3RoID4gaSkgaWYgKGhhc093biQ2KE8sIGtleSA9IG5hbWVzW2krK10pKSB7CgkgICAgfmluZGV4T2YocmVzdWx0LCBrZXkpIHx8IHB1c2gkMihyZXN1bHQsIGtleSk7CgkgIH0KCSAgcmV0dXJuIHJlc3VsdDsKCX07CgoJLy8gSUU4LSBkb24ndCBlbnVtIGJ1ZyBrZXlzCgl2YXIgZW51bUJ1Z0tleXMkMyA9IFsKCSAgJ2NvbnN0cnVjdG9yJywKCSAgJ2hhc093blByb3BlcnR5JywKCSAgJ2lzUHJvdG90eXBlT2YnLAoJICAncHJvcGVydHlJc0VudW1lcmFibGUnLAoJICAndG9Mb2NhbGVTdHJpbmcnLAoJICAndG9TdHJpbmcnLAoJICAndmFsdWVPZicKCV07CgoJdmFyIGludGVybmFsT2JqZWN0S2V5cyQxID0gb2JqZWN0S2V5c0ludGVybmFsOwoJdmFyIGVudW1CdWdLZXlzJDIgPSBlbnVtQnVnS2V5cyQzOwoKCS8vIGBPYmplY3Qua2V5c2AgbWV0aG9kCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLW9iamVjdC5rZXlzCgkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZXMvbm8tb2JqZWN0LWtleXMgLS0gc2FmZQoJdmFyIG9iamVjdEtleXMkMiA9IE9iamVjdC5rZXlzIHx8IGZ1bmN0aW9uIGtleXMoTykgewoJICByZXR1cm4gaW50ZXJuYWxPYmplY3RLZXlzJDEoTywgZW51bUJ1Z0tleXMkMik7Cgl9OwoKCXZhciBERVNDUklQVE9SUyQyID0gZGVzY3JpcHRvcnM7Cgl2YXIgZGVmaW5lUHJvcGVydHlNb2R1bGUkMiA9IG9iamVjdERlZmluZVByb3BlcnR5OwoJdmFyIGFuT2JqZWN0JDcgPSBhbk9iamVjdCQ5OwoJdmFyIHRvSW5kZXhlZE9iamVjdCQ0ID0gdG9JbmRleGVkT2JqZWN0JDg7Cgl2YXIgb2JqZWN0S2V5cyQxID0gb2JqZWN0S2V5cyQyOwoKCS8vIGBPYmplY3QuZGVmaW5lUHJvcGVydGllc2AgbWV0aG9kCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLW9iamVjdC5kZWZpbmVwcm9wZXJ0aWVzCgkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZXMvbm8tb2JqZWN0LWRlZmluZXByb3BlcnRpZXMgLS0gc2FmZQoJdmFyIG9iamVjdERlZmluZVByb3BlcnRpZXMgPSBERVNDUklQVE9SUyQyID8gT2JqZWN0LmRlZmluZVByb3BlcnRpZXMgOiBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKE8sIFByb3BlcnRpZXMpIHsKCSAgYW5PYmplY3QkNyhPKTsKCSAgdmFyIHByb3BzID0gdG9JbmRleGVkT2JqZWN0JDQoUHJvcGVydGllcyk7CgkgIHZhciBrZXlzID0gb2JqZWN0S2V5cyQxKFByb3BlcnRpZXMpOwoJICB2YXIgbGVuZ3RoID0ga2V5cy5sZW5ndGg7CgkgIHZhciBpbmRleCA9IDA7CgkgIHZhciBrZXk7CgkgIHdoaWxlIChsZW5ndGggPiBpbmRleCkgZGVmaW5lUHJvcGVydHlNb2R1bGUkMi5mKE8sIGtleSA9IGtleXNbaW5kZXgrK10sIHByb3BzW2tleV0pOwoJICByZXR1cm4gTzsKCX07CgoJdmFyIGdldEJ1aWx0SW4kMiA9IGdldEJ1aWx0SW4kNTsKCgl2YXIgaHRtbCQxID0gZ2V0QnVpbHRJbiQyKCdkb2N1bWVudCcsICdkb2N1bWVudEVsZW1lbnQnKTsKCgkvKiBnbG9iYWwgQWN0aXZlWE9iamVjdCAtLSBvbGQgSUUsIFdTSCAqLwoKCXZhciBhbk9iamVjdCQ2ID0gYW5PYmplY3QkOTsKCXZhciBkZWZpbmVQcm9wZXJ0aWVzID0gb2JqZWN0RGVmaW5lUHJvcGVydGllczsKCXZhciBlbnVtQnVnS2V5cyQxID0gZW51bUJ1Z0tleXMkMzsKCXZhciBoaWRkZW5LZXlzJDIgPSBoaWRkZW5LZXlzJDU7Cgl2YXIgaHRtbCA9IGh0bWwkMTsKCXZhciBkb2N1bWVudENyZWF0ZUVsZW1lbnQgPSBkb2N1bWVudENyZWF0ZUVsZW1lbnQkMTsKCXZhciBzaGFyZWRLZXkkMiA9IHNoYXJlZEtleSQ0OwoKCXZhciBHVCA9ICc+JzsKCXZhciBMVCA9ICc8JzsKCXZhciBQUk9UT1RZUEUkMSA9ICdwcm90b3R5cGUnOwoJdmFyIFNDUklQVCA9ICdzY3JpcHQnOwoJdmFyIElFX1BST1RPJDEgPSBzaGFyZWRLZXkkMignSUVfUFJPVE8nKTsKCgl2YXIgRW1wdHlDb25zdHJ1Y3RvciA9IGZ1bmN0aW9uICgpIHsgLyogZW1wdHkgKi8gfTsKCgl2YXIgc2NyaXB0VGFnID0gZnVuY3Rpb24gKGNvbnRlbnQpIHsKCSAgcmV0dXJuIExUICsgU0NSSVBUICsgR1QgKyBjb250ZW50ICsgTFQgKyAnLycgKyBTQ1JJUFQgKyBHVDsKCX07CgoJLy8gQ3JlYXRlIG9iamVjdCB3aXRoIGZha2UgYG51bGxgIHByb3RvdHlwZTogdXNlIEFjdGl2ZVggT2JqZWN0IHdpdGggY2xlYXJlZCBwcm90b3R5cGUKCXZhciBOdWxsUHJvdG9PYmplY3RWaWFBY3RpdmVYID0gZnVuY3Rpb24gKGFjdGl2ZVhEb2N1bWVudCkgewoJICBhY3RpdmVYRG9jdW1lbnQud3JpdGUoc2NyaXB0VGFnKCcnKSk7CgkgIGFjdGl2ZVhEb2N1bWVudC5jbG9zZSgpOwoJICB2YXIgdGVtcCA9IGFjdGl2ZVhEb2N1bWVudC5wYXJlbnRXaW5kb3cuT2JqZWN0OwoJICBhY3RpdmVYRG9jdW1lbnQgPSBudWxsOyAvLyBhdm9pZCBtZW1vcnkgbGVhawoJICByZXR1cm4gdGVtcDsKCX07CgoJLy8gQ3JlYXRlIG9iamVjdCB3aXRoIGZha2UgYG51bGxgIHByb3RvdHlwZTogdXNlIGlmcmFtZSBPYmplY3Qgd2l0aCBjbGVhcmVkIHByb3RvdHlwZQoJdmFyIE51bGxQcm90b09iamVjdFZpYUlGcmFtZSA9IGZ1bmN0aW9uICgpIHsKCSAgLy8gVGhyYXNoLCB3YXN0ZSBhbmQgc29kb215OiBJRSBHQyBidWcKCSAgdmFyIGlmcmFtZSA9IGRvY3VtZW50Q3JlYXRlRWxlbWVudCgnaWZyYW1lJyk7CgkgIHZhciBKUyA9ICdqYXZhJyArIFNDUklQVCArICc6JzsKCSAgdmFyIGlmcmFtZURvY3VtZW50OwoJICBpZnJhbWUuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKCSAgaHRtbC5hcHBlbmRDaGlsZChpZnJhbWUpOwoJICAvLyBodHRwczovL2dpdGh1Yi5jb20vemxvaXJvY2svY29yZS1qcy9pc3N1ZXMvNDc1CgkgIGlmcmFtZS5zcmMgPSBTdHJpbmcoSlMpOwoJICBpZnJhbWVEb2N1bWVudCA9IGlmcmFtZS5jb250ZW50V2luZG93LmRvY3VtZW50OwoJICBpZnJhbWVEb2N1bWVudC5vcGVuKCk7CgkgIGlmcmFtZURvY3VtZW50LndyaXRlKHNjcmlwdFRhZygnZG9jdW1lbnQuRj1PYmplY3QnKSk7CgkgIGlmcmFtZURvY3VtZW50LmNsb3NlKCk7CgkgIHJldHVybiBpZnJhbWVEb2N1bWVudC5GOwoJfTsKCgkvLyBDaGVjayBmb3IgZG9jdW1lbnQuZG9tYWluIGFuZCBhY3RpdmUgeCBzdXBwb3J0CgkvLyBObyBuZWVkIHRvIHVzZSBhY3RpdmUgeCBhcHByb2FjaCB3aGVuIGRvY3VtZW50LmRvbWFpbiBpcyBub3Qgc2V0CgkvLyBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2VzLXNoaW1zL2VzNS1zaGltL2lzc3Vlcy8xNTAKCS8vIHZhcmlhdGlvbiBvZiBodHRwczovL2dpdGh1Yi5jb20va2l0Y2FtYnJpZGdlL2VzNS1zaGltL2NvbW1pdC80ZjczOGFjMDY2MzQ2CgkvLyBhdm9pZCBJRSBHQyBidWcKCXZhciBhY3RpdmVYRG9jdW1lbnQ7Cgl2YXIgTnVsbFByb3RvT2JqZWN0ID0gZnVuY3Rpb24gKCkgewoJICB0cnkgewoJICAgIGFjdGl2ZVhEb2N1bWVudCA9IG5ldyBBY3RpdmVYT2JqZWN0KCdodG1sZmlsZScpOwoJICB9IGNhdGNoIChlcnJvcikgeyAvKiBpZ25vcmUgKi8gfQoJICBOdWxsUHJvdG9PYmplY3QgPSB0eXBlb2YgZG9jdW1lbnQgIT0gJ3VuZGVmaW5lZCcKCSAgICA/IGRvY3VtZW50LmRvbWFpbiAmJiBhY3RpdmVYRG9jdW1lbnQKCSAgICAgID8gTnVsbFByb3RvT2JqZWN0VmlhQWN0aXZlWChhY3RpdmVYRG9jdW1lbnQpIC8vIG9sZCBJRQoJICAgICAgOiBOdWxsUHJvdG9PYmplY3RWaWFJRnJhbWUoKQoJICAgIDogTnVsbFByb3RvT2JqZWN0VmlhQWN0aXZlWChhY3RpdmVYRG9jdW1lbnQpOyAvLyBXU0gKCSAgdmFyIGxlbmd0aCA9IGVudW1CdWdLZXlzJDEubGVuZ3RoOwoJICB3aGlsZSAobGVuZ3RoLS0pIGRlbGV0ZSBOdWxsUHJvdG9PYmplY3RbUFJPVE9UWVBFJDFdW2VudW1CdWdLZXlzJDFbbGVuZ3RoXV07CgkgIHJldHVybiBOdWxsUHJvdG9PYmplY3QoKTsKCX07CgoJaGlkZGVuS2V5cyQyW0lFX1BST1RPJDFdID0gdHJ1ZTsKCgkvLyBgT2JqZWN0LmNyZWF0ZWAgbWV0aG9kCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLW9iamVjdC5jcmVhdGUKCXZhciBvYmplY3RDcmVhdGUgPSBPYmplY3QuY3JlYXRlIHx8IGZ1bmN0aW9uIGNyZWF0ZShPLCBQcm9wZXJ0aWVzKSB7CgkgIHZhciByZXN1bHQ7CgkgIGlmIChPICE9PSBudWxsKSB7CgkgICAgRW1wdHlDb25zdHJ1Y3RvcltQUk9UT1RZUEUkMV0gPSBhbk9iamVjdCQ2KE8pOwoJICAgIHJlc3VsdCA9IG5ldyBFbXB0eUNvbnN0cnVjdG9yKCk7CgkgICAgRW1wdHlDb25zdHJ1Y3RvcltQUk9UT1RZUEUkMV0gPSBudWxsOwoJICAgIC8vIGFkZCAiX19wcm90b19fIiBmb3IgT2JqZWN0LmdldFByb3RvdHlwZU9mIHBvbHlmaWxsCgkgICAgcmVzdWx0W0lFX1BST1RPJDFdID0gTzsKCSAgfSBlbHNlIHJlc3VsdCA9IE51bGxQcm90b09iamVjdCgpOwoJICByZXR1cm4gUHJvcGVydGllcyA9PT0gdW5kZWZpbmVkID8gcmVzdWx0IDogZGVmaW5lUHJvcGVydGllcyhyZXN1bHQsIFByb3BlcnRpZXMpOwoJfTsKCgl2YXIgZmFpbHMkYSA9IGZhaWxzJGc7CgoJdmFyIGNvcnJlY3RQcm90b3R5cGVHZXR0ZXIgPSAhZmFpbHMkYShmdW5jdGlvbiAoKSB7CgkgIGZ1bmN0aW9uIEYoKSB7IC8qIGVtcHR5ICovIH0KCSAgRi5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBudWxsOwoJICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZXMvbm8tb2JqZWN0LWdldHByb3RvdHlwZW9mIC0tIHJlcXVpcmVkIGZvciB0ZXN0aW5nCgkgIHJldHVybiBPYmplY3QuZ2V0UHJvdG90eXBlT2YobmV3IEYoKSkgIT09IEYucHJvdG90eXBlOwoJfSk7CgoJdmFyIGdsb2JhbCRtID0gZ2xvYmFsJEc7Cgl2YXIgaGFzT3duJDUgPSBoYXNPd25Qcm9wZXJ0eV8xOwoJdmFyIGlzQ2FsbGFibGUkNyA9IGlzQ2FsbGFibGUkaDsKCXZhciB0b09iamVjdCQ3ID0gdG9PYmplY3QkOTsKCXZhciBzaGFyZWRLZXkkMSA9IHNoYXJlZEtleSQ0OwoJdmFyIENPUlJFQ1RfUFJPVE9UWVBFX0dFVFRFUiA9IGNvcnJlY3RQcm90b3R5cGVHZXR0ZXI7CgoJdmFyIElFX1BST1RPID0gc2hhcmVkS2V5JDEoJ0lFX1BST1RPJyk7Cgl2YXIgT2JqZWN0JDIgPSBnbG9iYWwkbS5PYmplY3Q7Cgl2YXIgT2JqZWN0UHJvdG90eXBlJDEgPSBPYmplY3QkMi5wcm90b3R5cGU7CgoJLy8gYE9iamVjdC5nZXRQcm90b3R5cGVPZmAgbWV0aG9kCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLW9iamVjdC5nZXRwcm90b3R5cGVvZgoJdmFyIG9iamVjdEdldFByb3RvdHlwZU9mID0gQ09SUkVDVF9QUk9UT1RZUEVfR0VUVEVSID8gT2JqZWN0JDIuZ2V0UHJvdG90eXBlT2YgOiBmdW5jdGlvbiAoTykgewoJICB2YXIgb2JqZWN0ID0gdG9PYmplY3QkNyhPKTsKCSAgaWYgKGhhc093biQ1KG9iamVjdCwgSUVfUFJPVE8pKSByZXR1cm4gb2JqZWN0W0lFX1BST1RPXTsKCSAgdmFyIGNvbnN0cnVjdG9yID0gb2JqZWN0LmNvbnN0cnVjdG9yOwoJICBpZiAoaXNDYWxsYWJsZSQ3KGNvbnN0cnVjdG9yKSAmJiBvYmplY3QgaW5zdGFuY2VvZiBjb25zdHJ1Y3RvcikgewoJICAgIHJldHVybiBjb25zdHJ1Y3Rvci5wcm90b3R5cGU7CgkgIH0gcmV0dXJuIG9iamVjdCBpbnN0YW5jZW9mIE9iamVjdCQyID8gT2JqZWN0UHJvdG90eXBlJDEgOiBudWxsOwoJfTsKCgl2YXIgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5JDIgPSBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkkNTsKCgl2YXIgcmVkZWZpbmUkNCA9IGZ1bmN0aW9uICh0YXJnZXQsIGtleSwgdmFsdWUsIG9wdGlvbnMpIHsKCSAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5lbnVtZXJhYmxlKSB0YXJnZXRba2V5XSA9IHZhbHVlOwoJICBlbHNlIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSQyKHRhcmdldCwga2V5LCB2YWx1ZSk7Cgl9OwoKCXZhciBmYWlscyQ5ID0gZmFpbHMkZzsKCXZhciBpc0NhbGxhYmxlJDYgPSBpc0NhbGxhYmxlJGg7Cgl2YXIgY3JlYXRlJDEgPSBvYmplY3RDcmVhdGU7Cgl2YXIgZ2V0UHJvdG90eXBlT2YkMSA9IG9iamVjdEdldFByb3RvdHlwZU9mOwoJdmFyIHJlZGVmaW5lJDMgPSByZWRlZmluZSQ0OwoJdmFyIHdlbGxLbm93blN5bWJvbCRlID0gd2VsbEtub3duU3ltYm9sJGc7CgoJdmFyIElURVJBVE9SJDYgPSB3ZWxsS25vd25TeW1ib2wkZSgnaXRlcmF0b3InKTsKCXZhciBCVUdHWV9TQUZBUklfSVRFUkFUT1JTJDEgPSBmYWxzZTsKCgkvLyBgJUl0ZXJhdG9yUHJvdG90eXBlJWAgb2JqZWN0CgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLSVpdGVyYXRvcnByb3RvdHlwZSUtb2JqZWN0Cgl2YXIgSXRlcmF0b3JQcm90b3R5cGUkMSwgUHJvdG90eXBlT2ZBcnJheUl0ZXJhdG9yUHJvdG90eXBlLCBhcnJheUl0ZXJhdG9yOwoKCS8qIGVzbGludC1kaXNhYmxlIGVzL25vLWFycmF5LXByb3RvdHlwZS1rZXlzIC0tIHNhZmUgKi8KCWlmIChbXS5rZXlzKSB7CgkgIGFycmF5SXRlcmF0b3IgPSBbXS5rZXlzKCk7CgkgIC8vIFNhZmFyaSA4IGhhcyBidWdneSBpdGVyYXRvcnMgdy9vIGBuZXh0YAoJICBpZiAoISgnbmV4dCcgaW4gYXJyYXlJdGVyYXRvcikpIEJVR0dZX1NBRkFSSV9JVEVSQVRPUlMkMSA9IHRydWU7CgkgIGVsc2UgewoJICAgIFByb3RvdHlwZU9mQXJyYXlJdGVyYXRvclByb3RvdHlwZSA9IGdldFByb3RvdHlwZU9mJDEoZ2V0UHJvdG90eXBlT2YkMShhcnJheUl0ZXJhdG9yKSk7CgkgICAgaWYgKFByb3RvdHlwZU9mQXJyYXlJdGVyYXRvclByb3RvdHlwZSAhPT0gT2JqZWN0LnByb3RvdHlwZSkgSXRlcmF0b3JQcm90b3R5cGUkMSA9IFByb3RvdHlwZU9mQXJyYXlJdGVyYXRvclByb3RvdHlwZTsKCSAgfQoJfQoKCXZhciBORVdfSVRFUkFUT1JfUFJPVE9UWVBFID0gSXRlcmF0b3JQcm90b3R5cGUkMSA9PSB1bmRlZmluZWQgfHwgZmFpbHMkOShmdW5jdGlvbiAoKSB7CgkgIHZhciB0ZXN0ID0ge307CgkgIC8vIEZGNDQtIGxlZ2FjeSBpdGVyYXRvcnMgY2FzZQoJICByZXR1cm4gSXRlcmF0b3JQcm90b3R5cGUkMVtJVEVSQVRPUiQ2XS5jYWxsKHRlc3QpICE9PSB0ZXN0OwoJfSk7CgoJaWYgKE5FV19JVEVSQVRPUl9QUk9UT1RZUEUpIEl0ZXJhdG9yUHJvdG90eXBlJDEgPSB7fTsKCWVsc2UgSXRlcmF0b3JQcm90b3R5cGUkMSA9IGNyZWF0ZSQxKEl0ZXJhdG9yUHJvdG90eXBlJDEpOwoKCS8vIGAlSXRlcmF0b3JQcm90b3R5cGUlW0BAaXRlcmF0b3JdKClgIG1ldGhvZAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy0laXRlcmF0b3Jwcm90b3R5cGUlLUBAaXRlcmF0b3IKCWlmICghaXNDYWxsYWJsZSQ2KEl0ZXJhdG9yUHJvdG90eXBlJDFbSVRFUkFUT1IkNl0pKSB7CgkgIHJlZGVmaW5lJDMoSXRlcmF0b3JQcm90b3R5cGUkMSwgSVRFUkFUT1IkNiwgZnVuY3Rpb24gKCkgewoJICAgIHJldHVybiB0aGlzOwoJICB9KTsKCX0KCgl2YXIgaXRlcmF0b3JzQ29yZSA9IHsKCSAgSXRlcmF0b3JQcm90b3R5cGU6IEl0ZXJhdG9yUHJvdG90eXBlJDEsCgkgIEJVR0dZX1NBRkFSSV9JVEVSQVRPUlM6IEJVR0dZX1NBRkFSSV9JVEVSQVRPUlMkMQoJfTsKCgl2YXIgd2VsbEtub3duU3ltYm9sJGQgPSB3ZWxsS25vd25TeW1ib2wkZzsKCgl2YXIgVE9fU1RSSU5HX1RBRyQzID0gd2VsbEtub3duU3ltYm9sJGQoJ3RvU3RyaW5nVGFnJyk7Cgl2YXIgdGVzdCQxID0ge307CgoJdGVzdCQxW1RPX1NUUklOR19UQUckM10gPSAneic7CgoJdmFyIHRvU3RyaW5nVGFnU3VwcG9ydCA9IFN0cmluZyh0ZXN0JDEpID09PSAnW29iamVjdCB6XSc7CgoJdmFyIGdsb2JhbCRsID0gZ2xvYmFsJEc7Cgl2YXIgVE9fU1RSSU5HX1RBR19TVVBQT1JUJDIgPSB0b1N0cmluZ1RhZ1N1cHBvcnQ7Cgl2YXIgaXNDYWxsYWJsZSQ1ID0gaXNDYWxsYWJsZSRoOwoJdmFyIGNsYXNzb2ZSYXcgPSBjbGFzc29mUmF3JDE7Cgl2YXIgd2VsbEtub3duU3ltYm9sJGMgPSB3ZWxsS25vd25TeW1ib2wkZzsKCgl2YXIgVE9fU1RSSU5HX1RBRyQyID0gd2VsbEtub3duU3ltYm9sJGMoJ3RvU3RyaW5nVGFnJyk7Cgl2YXIgT2JqZWN0JDEgPSBnbG9iYWwkbC5PYmplY3Q7CgoJLy8gRVMzIHdyb25nIGhlcmUKCXZhciBDT1JSRUNUX0FSR1VNRU5UUyA9IGNsYXNzb2ZSYXcoZnVuY3Rpb24gKCkgeyByZXR1cm4gYXJndW1lbnRzOyB9KCkpID09ICdBcmd1bWVudHMnOwoKCS8vIGZhbGxiYWNrIGZvciBJRTExIFNjcmlwdCBBY2Nlc3MgRGVuaWVkIGVycm9yCgl2YXIgdHJ5R2V0ID0gZnVuY3Rpb24gKGl0LCBrZXkpIHsKCSAgdHJ5IHsKCSAgICByZXR1cm4gaXRba2V5XTsKCSAgfSBjYXRjaCAoZXJyb3IpIHsgLyogZW1wdHkgKi8gfQoJfTsKCgkvLyBnZXR0aW5nIHRhZyBmcm9tIEVTNisgYE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmdgCgl2YXIgY2xhc3NvZiQ5ID0gVE9fU1RSSU5HX1RBR19TVVBQT1JUJDIgPyBjbGFzc29mUmF3IDogZnVuY3Rpb24gKGl0KSB7CgkgIHZhciBPLCB0YWcsIHJlc3VsdDsKCSAgcmV0dXJuIGl0ID09PSB1bmRlZmluZWQgPyAnVW5kZWZpbmVkJyA6IGl0ID09PSBudWxsID8gJ051bGwnCgkgICAgLy8gQEB0b1N0cmluZ1RhZyBjYXNlCgkgICAgOiB0eXBlb2YgKHRhZyA9IHRyeUdldChPID0gT2JqZWN0JDEoaXQpLCBUT19TVFJJTkdfVEFHJDIpKSA9PSAnc3RyaW5nJyA/IHRhZwoJICAgIC8vIGJ1aWx0aW5UYWcgY2FzZQoJICAgIDogQ09SUkVDVF9BUkdVTUVOVFMgPyBjbGFzc29mUmF3KE8pCgkgICAgLy8gRVMzIGFyZ3VtZW50cyBmYWxsYmFjawoJICAgIDogKHJlc3VsdCA9IGNsYXNzb2ZSYXcoTykpID09ICdPYmplY3QnICYmIGlzQ2FsbGFibGUkNShPLmNhbGxlZSkgPyAnQXJndW1lbnRzJyA6IHJlc3VsdDsKCX07CgoJdmFyIFRPX1NUUklOR19UQUdfU1VQUE9SVCQxID0gdG9TdHJpbmdUYWdTdXBwb3J0OwoJdmFyIGNsYXNzb2YkOCA9IGNsYXNzb2YkOTsKCgkvLyBgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZ2AgbWV0aG9kIGltcGxlbWVudGF0aW9uCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLW9iamVjdC5wcm90b3R5cGUudG9zdHJpbmcKCXZhciBvYmplY3RUb1N0cmluZyA9IFRPX1NUUklOR19UQUdfU1VQUE9SVCQxID8ge30udG9TdHJpbmcgOiBmdW5jdGlvbiB0b1N0cmluZygpIHsKCSAgcmV0dXJuICdbb2JqZWN0ICcgKyBjbGFzc29mJDgodGhpcykgKyAnXSc7Cgl9OwoKCXZhciBUT19TVFJJTkdfVEFHX1NVUFBPUlQgPSB0b1N0cmluZ1RhZ1N1cHBvcnQ7Cgl2YXIgZGVmaW5lUHJvcGVydHkkMiA9IG9iamVjdERlZmluZVByb3BlcnR5LmY7Cgl2YXIgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5JDEgPSBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkkNTsKCXZhciBoYXNPd24kNCA9IGhhc093blByb3BlcnR5XzE7Cgl2YXIgdG9TdHJpbmckOCA9IG9iamVjdFRvU3RyaW5nOwoJdmFyIHdlbGxLbm93blN5bWJvbCRiID0gd2VsbEtub3duU3ltYm9sJGc7CgoJdmFyIFRPX1NUUklOR19UQUckMSA9IHdlbGxLbm93blN5bWJvbCRiKCd0b1N0cmluZ1RhZycpOwoKCXZhciBzZXRUb1N0cmluZ1RhZyQ0ID0gZnVuY3Rpb24gKGl0LCBUQUcsIFNUQVRJQywgU0VUX01FVEhPRCkgewoJICBpZiAoaXQpIHsKCSAgICB2YXIgdGFyZ2V0ID0gU1RBVElDID8gaXQgOiBpdC5wcm90b3R5cGU7CgkgICAgaWYgKCFoYXNPd24kNCh0YXJnZXQsIFRPX1NUUklOR19UQUckMSkpIHsKCSAgICAgIGRlZmluZVByb3BlcnR5JDIodGFyZ2V0LCBUT19TVFJJTkdfVEFHJDEsIHsgY29uZmlndXJhYmxlOiB0cnVlLCB2YWx1ZTogVEFHIH0pOwoJICAgIH0KCSAgICBpZiAoU0VUX01FVEhPRCAmJiAhVE9fU1RSSU5HX1RBR19TVVBQT1JUKSB7CgkgICAgICBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkkMSh0YXJnZXQsICd0b1N0cmluZycsIHRvU3RyaW5nJDgpOwoJICAgIH0KCSAgfQoJfTsKCgl2YXIgSXRlcmF0b3JQcm90b3R5cGUgPSBpdGVyYXRvcnNDb3JlLkl0ZXJhdG9yUHJvdG90eXBlOwoJdmFyIGNyZWF0ZSA9IG9iamVjdENyZWF0ZTsKCXZhciBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IkMiA9IGNyZWF0ZVByb3BlcnR5RGVzY3JpcHRvciQ1OwoJdmFyIHNldFRvU3RyaW5nVGFnJDMgPSBzZXRUb1N0cmluZ1RhZyQ0OwoJdmFyIEl0ZXJhdG9ycyQ1ID0gaXRlcmF0b3JzOwoKCXZhciByZXR1cm5UaGlzJDEgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzOyB9OwoKCXZhciBjcmVhdGVJdGVyYXRvckNvbnN0cnVjdG9yJDEgPSBmdW5jdGlvbiAoSXRlcmF0b3JDb25zdHJ1Y3RvciwgTkFNRSwgbmV4dCkgewoJICB2YXIgVE9fU1RSSU5HX1RBRyA9IE5BTUUgKyAnIEl0ZXJhdG9yJzsKCSAgSXRlcmF0b3JDb25zdHJ1Y3Rvci5wcm90b3R5cGUgPSBjcmVhdGUoSXRlcmF0b3JQcm90b3R5cGUsIHsgbmV4dDogY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yJDIoMSwgbmV4dCkgfSk7CgkgIHNldFRvU3RyaW5nVGFnJDMoSXRlcmF0b3JDb25zdHJ1Y3RvciwgVE9fU1RSSU5HX1RBRywgZmFsc2UsIHRydWUpOwoJICBJdGVyYXRvcnMkNVtUT19TVFJJTkdfVEFHXSA9IHJldHVyblRoaXMkMTsKCSAgcmV0dXJuIEl0ZXJhdG9yQ29uc3RydWN0b3I7Cgl9OwoKCXZhciBnbG9iYWwkayA9IGdsb2JhbCRHOwoJdmFyIGlzQ2FsbGFibGUkNCA9IGlzQ2FsbGFibGUkaDsKCgl2YXIgU3RyaW5nJDQgPSBnbG9iYWwkay5TdHJpbmc7Cgl2YXIgVHlwZUVycm9yJDggPSBnbG9iYWwkay5UeXBlRXJyb3I7CgoJdmFyIGFQb3NzaWJsZVByb3RvdHlwZSQzID0gZnVuY3Rpb24gKGFyZ3VtZW50KSB7CgkgIGlmICh0eXBlb2YgYXJndW1lbnQgPT0gJ29iamVjdCcgfHwgaXNDYWxsYWJsZSQ0KGFyZ3VtZW50KSkgcmV0dXJuIGFyZ3VtZW50OwoJICB0aHJvdyBUeXBlRXJyb3IkOCgiQ2FuJ3Qgc2V0ICIgKyBTdHJpbmckNChhcmd1bWVudCkgKyAnIGFzIGEgcHJvdG90eXBlJyk7Cgl9OwoKCS8qIGVzbGludC1kaXNhYmxlIG5vLXByb3RvIC0tIHNhZmUgKi8KCgl2YXIgdW5jdXJyeVRoaXMkZSA9IGZ1bmN0aW9uVW5jdXJyeVRoaXM7Cgl2YXIgYW5PYmplY3QkNSA9IGFuT2JqZWN0JDk7Cgl2YXIgYVBvc3NpYmxlUHJvdG90eXBlJDIgPSBhUG9zc2libGVQcm90b3R5cGUkMzsKCgkvLyBgT2JqZWN0LnNldFByb3RvdHlwZU9mYCBtZXRob2QKCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtb2JqZWN0LnNldHByb3RvdHlwZW9mCgkvLyBXb3JrcyB3aXRoIF9fcHJvdG9fXyBvbmx5LiBPbGQgdjggY2FuJ3Qgd29yayB3aXRoIG51bGwgcHJvdG8gb2JqZWN0cy4KCS8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBlcy9uby1vYmplY3Qtc2V0cHJvdG90eXBlb2YgLS0gc2FmZQoJT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8ICgnX19wcm90b19fJyBpbiB7fSA/IGZ1bmN0aW9uICgpIHsKCSAgdmFyIENPUlJFQ1RfU0VUVEVSID0gZmFsc2U7CgkgIHZhciB0ZXN0ID0ge307CgkgIHZhciBzZXR0ZXI7CgkgIHRyeSB7CgkgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGVzL25vLW9iamVjdC1nZXRvd25wcm9wZXJ0eWRlc2NyaXB0b3IgLS0gc2FmZQoJICAgIHNldHRlciA9IHVuY3VycnlUaGlzJGUoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihPYmplY3QucHJvdG90eXBlLCAnX19wcm90b19fJykuc2V0KTsKCSAgICBzZXR0ZXIodGVzdCwgW10pOwoJICAgIENPUlJFQ1RfU0VUVEVSID0gdGVzdCBpbnN0YW5jZW9mIEFycmF5OwoJICB9IGNhdGNoIChlcnJvcikgeyAvKiBlbXB0eSAqLyB9CgkgIHJldHVybiBmdW5jdGlvbiBzZXRQcm90b3R5cGVPZihPLCBwcm90bykgewoJICAgIGFuT2JqZWN0JDUoTyk7CgkgICAgYVBvc3NpYmxlUHJvdG90eXBlJDIocHJvdG8pOwoJICAgIGlmIChDT1JSRUNUX1NFVFRFUikgc2V0dGVyKE8sIHByb3RvKTsKCSAgICBlbHNlIE8uX19wcm90b19fID0gcHJvdG87CgkgICAgcmV0dXJuIE87CgkgIH07Cgl9KCkgOiB1bmRlZmluZWQpOwoKCXZhciAkJGQgPSBfZXhwb3J0OwoJdmFyIGNhbGwkNCA9IGZ1bmN0aW9uQ2FsbDsKCXZhciBGdW5jdGlvbk5hbWUgPSBmdW5jdGlvbk5hbWU7Cgl2YXIgY3JlYXRlSXRlcmF0b3JDb25zdHJ1Y3RvciA9IGNyZWF0ZUl0ZXJhdG9yQ29uc3RydWN0b3IkMTsKCXZhciBnZXRQcm90b3R5cGVPZiA9IG9iamVjdEdldFByb3RvdHlwZU9mOwoJdmFyIHNldFRvU3RyaW5nVGFnJDIgPSBzZXRUb1N0cmluZ1RhZyQ0OwoJdmFyIHJlZGVmaW5lJDIgPSByZWRlZmluZSQ0OwoJdmFyIHdlbGxLbm93blN5bWJvbCRhID0gd2VsbEtub3duU3ltYm9sJGc7Cgl2YXIgSXRlcmF0b3JzJDQgPSBpdGVyYXRvcnM7Cgl2YXIgSXRlcmF0b3JzQ29yZSA9IGl0ZXJhdG9yc0NvcmU7CgoJdmFyIFBST1BFUl9GVU5DVElPTl9OQU1FID0gRnVuY3Rpb25OYW1lLlBST1BFUjsKCXZhciBCVUdHWV9TQUZBUklfSVRFUkFUT1JTID0gSXRlcmF0b3JzQ29yZS5CVUdHWV9TQUZBUklfSVRFUkFUT1JTOwoJdmFyIElURVJBVE9SJDUgPSB3ZWxsS25vd25TeW1ib2wkYSgnaXRlcmF0b3InKTsKCXZhciBLRVlTID0gJ2tleXMnOwoJdmFyIFZBTFVFUyA9ICd2YWx1ZXMnOwoJdmFyIEVOVFJJRVMgPSAnZW50cmllcyc7CgoJdmFyIHJldHVyblRoaXMgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzOyB9OwoKCXZhciBkZWZpbmVJdGVyYXRvciQyID0gZnVuY3Rpb24gKEl0ZXJhYmxlLCBOQU1FLCBJdGVyYXRvckNvbnN0cnVjdG9yLCBuZXh0LCBERUZBVUxULCBJU19TRVQsIEZPUkNFRCkgewoJICBjcmVhdGVJdGVyYXRvckNvbnN0cnVjdG9yKEl0ZXJhdG9yQ29uc3RydWN0b3IsIE5BTUUsIG5leHQpOwoKCSAgdmFyIGdldEl0ZXJhdGlvbk1ldGhvZCA9IGZ1bmN0aW9uIChLSU5EKSB7CgkgICAgaWYgKEtJTkQgPT09IERFRkFVTFQgJiYgZGVmYXVsdEl0ZXJhdG9yKSByZXR1cm4gZGVmYXVsdEl0ZXJhdG9yOwoJICAgIGlmICghQlVHR1lfU0FGQVJJX0lURVJBVE9SUyAmJiBLSU5EIGluIEl0ZXJhYmxlUHJvdG90eXBlKSByZXR1cm4gSXRlcmFibGVQcm90b3R5cGVbS0lORF07CgkgICAgc3dpdGNoIChLSU5EKSB7CgkgICAgICBjYXNlIEtFWVM6IHJldHVybiBmdW5jdGlvbiBrZXlzKCkgeyByZXR1cm4gbmV3IEl0ZXJhdG9yQ29uc3RydWN0b3IodGhpcywgS0lORCk7IH07CgkgICAgICBjYXNlIFZBTFVFUzogcmV0dXJuIGZ1bmN0aW9uIHZhbHVlcygpIHsgcmV0dXJuIG5ldyBJdGVyYXRvckNvbnN0cnVjdG9yKHRoaXMsIEtJTkQpOyB9OwoJICAgICAgY2FzZSBFTlRSSUVTOiByZXR1cm4gZnVuY3Rpb24gZW50cmllcygpIHsgcmV0dXJuIG5ldyBJdGVyYXRvckNvbnN0cnVjdG9yKHRoaXMsIEtJTkQpOyB9OwoJICAgIH0gcmV0dXJuIGZ1bmN0aW9uICgpIHsgcmV0dXJuIG5ldyBJdGVyYXRvckNvbnN0cnVjdG9yKHRoaXMpOyB9OwoJICB9OwoKCSAgdmFyIFRPX1NUUklOR19UQUcgPSBOQU1FICsgJyBJdGVyYXRvcic7CgkgIHZhciBJTkNPUlJFQ1RfVkFMVUVTX05BTUUgPSBmYWxzZTsKCSAgdmFyIEl0ZXJhYmxlUHJvdG90eXBlID0gSXRlcmFibGUucHJvdG90eXBlOwoJICB2YXIgbmF0aXZlSXRlcmF0b3IgPSBJdGVyYWJsZVByb3RvdHlwZVtJVEVSQVRPUiQ1XQoJICAgIHx8IEl0ZXJhYmxlUHJvdG90eXBlWydAQGl0ZXJhdG9yJ10KCSAgICB8fCBERUZBVUxUICYmIEl0ZXJhYmxlUHJvdG90eXBlW0RFRkFVTFRdOwoJICB2YXIgZGVmYXVsdEl0ZXJhdG9yID0gIUJVR0dZX1NBRkFSSV9JVEVSQVRPUlMgJiYgbmF0aXZlSXRlcmF0b3IgfHwgZ2V0SXRlcmF0aW9uTWV0aG9kKERFRkFVTFQpOwoJICB2YXIgYW55TmF0aXZlSXRlcmF0b3IgPSBOQU1FID09ICdBcnJheScgPyBJdGVyYWJsZVByb3RvdHlwZS5lbnRyaWVzIHx8IG5hdGl2ZUl0ZXJhdG9yIDogbmF0aXZlSXRlcmF0b3I7CgkgIHZhciBDdXJyZW50SXRlcmF0b3JQcm90b3R5cGUsIG1ldGhvZHMsIEtFWTsKCgkgIC8vIGZpeCBuYXRpdmUKCSAgaWYgKGFueU5hdGl2ZUl0ZXJhdG9yKSB7CgkgICAgQ3VycmVudEl0ZXJhdG9yUHJvdG90eXBlID0gZ2V0UHJvdG90eXBlT2YoYW55TmF0aXZlSXRlcmF0b3IuY2FsbChuZXcgSXRlcmFibGUoKSkpOwoJICAgIGlmIChDdXJyZW50SXRlcmF0b3JQcm90b3R5cGUgIT09IE9iamVjdC5wcm90b3R5cGUgJiYgQ3VycmVudEl0ZXJhdG9yUHJvdG90eXBlLm5leHQpIHsKCSAgICAgIC8vIFNldCBAQHRvU3RyaW5nVGFnIHRvIG5hdGl2ZSBpdGVyYXRvcnMKCSAgICAgIHNldFRvU3RyaW5nVGFnJDIoQ3VycmVudEl0ZXJhdG9yUHJvdG90eXBlLCBUT19TVFJJTkdfVEFHLCB0cnVlLCB0cnVlKTsKCSAgICAgIEl0ZXJhdG9ycyQ0W1RPX1NUUklOR19UQUddID0gcmV0dXJuVGhpczsKCSAgICB9CgkgIH0KCgkgIC8vIGZpeCBBcnJheS5wcm90b3R5cGUueyB2YWx1ZXMsIEBAaXRlcmF0b3IgfS5uYW1lIGluIFY4IC8gRkYKCSAgaWYgKFBST1BFUl9GVU5DVElPTl9OQU1FICYmIERFRkFVTFQgPT0gVkFMVUVTICYmIG5hdGl2ZUl0ZXJhdG9yICYmIG5hdGl2ZUl0ZXJhdG9yLm5hbWUgIT09IFZBTFVFUykgewoJICAgIHsKCSAgICAgIElOQ09SUkVDVF9WQUxVRVNfTkFNRSA9IHRydWU7CgkgICAgICBkZWZhdWx0SXRlcmF0b3IgPSBmdW5jdGlvbiB2YWx1ZXMoKSB7IHJldHVybiBjYWxsJDQobmF0aXZlSXRlcmF0b3IsIHRoaXMpOyB9OwoJICAgIH0KCSAgfQoKCSAgLy8gZXhwb3J0IGFkZGl0aW9uYWwgbWV0aG9kcwoJICBpZiAoREVGQVVMVCkgewoJICAgIG1ldGhvZHMgPSB7CgkgICAgICB2YWx1ZXM6IGdldEl0ZXJhdGlvbk1ldGhvZChWQUxVRVMpLAoJICAgICAga2V5czogSVNfU0VUID8gZGVmYXVsdEl0ZXJhdG9yIDogZ2V0SXRlcmF0aW9uTWV0aG9kKEtFWVMpLAoJICAgICAgZW50cmllczogZ2V0SXRlcmF0aW9uTWV0aG9kKEVOVFJJRVMpCgkgICAgfTsKCSAgICBpZiAoRk9SQ0VEKSBmb3IgKEtFWSBpbiBtZXRob2RzKSB7CgkgICAgICBpZiAoQlVHR1lfU0FGQVJJX0lURVJBVE9SUyB8fCBJTkNPUlJFQ1RfVkFMVUVTX05BTUUgfHwgIShLRVkgaW4gSXRlcmFibGVQcm90b3R5cGUpKSB7CgkgICAgICAgIHJlZGVmaW5lJDIoSXRlcmFibGVQcm90b3R5cGUsIEtFWSwgbWV0aG9kc1tLRVldKTsKCSAgICAgIH0KCSAgICB9IGVsc2UgJCRkKHsgdGFyZ2V0OiBOQU1FLCBwcm90bzogdHJ1ZSwgZm9yY2VkOiBCVUdHWV9TQUZBUklfSVRFUkFUT1JTIHx8IElOQ09SUkVDVF9WQUxVRVNfTkFNRSB9LCBtZXRob2RzKTsKCSAgfQoKCSAgLy8gZGVmaW5lIGl0ZXJhdG9yCgkgIGlmICgoRk9SQ0VEKSAmJiBJdGVyYWJsZVByb3RvdHlwZVtJVEVSQVRPUiQ1XSAhPT0gZGVmYXVsdEl0ZXJhdG9yKSB7CgkgICAgcmVkZWZpbmUkMihJdGVyYWJsZVByb3RvdHlwZSwgSVRFUkFUT1IkNSwgZGVmYXVsdEl0ZXJhdG9yLCB7IG5hbWU6IERFRkFVTFQgfSk7CgkgIH0KCSAgSXRlcmF0b3JzJDRbTkFNRV0gPSBkZWZhdWx0SXRlcmF0b3I7CgoJICByZXR1cm4gbWV0aG9kczsKCX07CgoJdmFyIHRvSW5kZXhlZE9iamVjdCQzID0gdG9JbmRleGVkT2JqZWN0JDg7Cgl2YXIgSXRlcmF0b3JzJDMgPSBpdGVyYXRvcnM7Cgl2YXIgSW50ZXJuYWxTdGF0ZU1vZHVsZSQyID0gaW50ZXJuYWxTdGF0ZTsKCXZhciBkZWZpbmVJdGVyYXRvciQxID0gZGVmaW5lSXRlcmF0b3IkMjsKCgl2YXIgQVJSQVlfSVRFUkFUT1IgPSAnQXJyYXkgSXRlcmF0b3InOwoJdmFyIHNldEludGVybmFsU3RhdGUkMiA9IEludGVybmFsU3RhdGVNb2R1bGUkMi5zZXQ7Cgl2YXIgZ2V0SW50ZXJuYWxTdGF0ZSQyID0gSW50ZXJuYWxTdGF0ZU1vZHVsZSQyLmdldHRlckZvcihBUlJBWV9JVEVSQVRPUik7CgoJLy8gYEFycmF5LnByb3RvdHlwZS5lbnRyaWVzYCBtZXRob2QKCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtYXJyYXkucHJvdG90eXBlLmVudHJpZXMKCS8vIGBBcnJheS5wcm90b3R5cGUua2V5c2AgbWV0aG9kCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLWFycmF5LnByb3RvdHlwZS5rZXlzCgkvLyBgQXJyYXkucHJvdG90eXBlLnZhbHVlc2AgbWV0aG9kCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLWFycmF5LnByb3RvdHlwZS52YWx1ZXMKCS8vIGBBcnJheS5wcm90b3R5cGVbQEBpdGVyYXRvcl1gIG1ldGhvZAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1hcnJheS5wcm90b3R5cGUtQEBpdGVyYXRvcgoJLy8gYENyZWF0ZUFycmF5SXRlcmF0b3JgIGludGVybmFsIG1ldGhvZAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1jcmVhdGVhcnJheWl0ZXJhdG9yCglkZWZpbmVJdGVyYXRvciQxKEFycmF5LCAnQXJyYXknLCBmdW5jdGlvbiAoaXRlcmF0ZWQsIGtpbmQpIHsKCSAgc2V0SW50ZXJuYWxTdGF0ZSQyKHRoaXMsIHsKCSAgICB0eXBlOiBBUlJBWV9JVEVSQVRPUiwKCSAgICB0YXJnZXQ6IHRvSW5kZXhlZE9iamVjdCQzKGl0ZXJhdGVkKSwgLy8gdGFyZ2V0CgkgICAgaW5kZXg6IDAsICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBuZXh0IGluZGV4CgkgICAga2luZDoga2luZCAgICAgICAgICAgICAgICAgICAgICAgICAvLyBraW5kCgkgIH0pOwoJLy8gYCVBcnJheUl0ZXJhdG9yUHJvdG90eXBlJS5uZXh0YCBtZXRob2QKCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtJWFycmF5aXRlcmF0b3Jwcm90b3R5cGUlLm5leHQKCX0sIGZ1bmN0aW9uICgpIHsKCSAgdmFyIHN0YXRlID0gZ2V0SW50ZXJuYWxTdGF0ZSQyKHRoaXMpOwoJICB2YXIgdGFyZ2V0ID0gc3RhdGUudGFyZ2V0OwoJICB2YXIga2luZCA9IHN0YXRlLmtpbmQ7CgkgIHZhciBpbmRleCA9IHN0YXRlLmluZGV4Kys7CgkgIGlmICghdGFyZ2V0IHx8IGluZGV4ID49IHRhcmdldC5sZW5ndGgpIHsKCSAgICBzdGF0ZS50YXJnZXQgPSB1bmRlZmluZWQ7CgkgICAgcmV0dXJuIHsgdmFsdWU6IHVuZGVmaW5lZCwgZG9uZTogdHJ1ZSB9OwoJICB9CgkgIGlmIChraW5kID09ICdrZXlzJykgcmV0dXJuIHsgdmFsdWU6IGluZGV4LCBkb25lOiBmYWxzZSB9OwoJICBpZiAoa2luZCA9PSAndmFsdWVzJykgcmV0dXJuIHsgdmFsdWU6IHRhcmdldFtpbmRleF0sIGRvbmU6IGZhbHNlIH07CgkgIHJldHVybiB7IHZhbHVlOiBbaW5kZXgsIHRhcmdldFtpbmRleF1dLCBkb25lOiBmYWxzZSB9OwoJfSwgJ3ZhbHVlcycpOwoKCS8vIGFyZ3VtZW50c0xpc3RbQEBpdGVyYXRvcl0gaXMgJUFycmF5UHJvdG9fdmFsdWVzJQoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1jcmVhdGV1bm1hcHBlZGFyZ3VtZW50c29iamVjdAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1jcmVhdGVtYXBwZWRhcmd1bWVudHNvYmplY3QKCUl0ZXJhdG9ycyQzLkFyZ3VtZW50cyA9IEl0ZXJhdG9ycyQzLkFycmF5OwoKCS8vIGl0ZXJhYmxlIERPTSBjb2xsZWN0aW9ucwoJLy8gZmxhZyAtIGBpdGVyYWJsZWAgaW50ZXJmYWNlIC0gJ2VudHJpZXMnLCAna2V5cycsICd2YWx1ZXMnLCAnZm9yRWFjaCcgbWV0aG9kcwoJdmFyIGRvbUl0ZXJhYmxlcyA9IHsKCSAgQ1NTUnVsZUxpc3Q6IDAsCgkgIENTU1N0eWxlRGVjbGFyYXRpb246IDAsCgkgIENTU1ZhbHVlTGlzdDogMCwKCSAgQ2xpZW50UmVjdExpc3Q6IDAsCgkgIERPTVJlY3RMaXN0OiAwLAoJICBET01TdHJpbmdMaXN0OiAwLAoJICBET01Ub2tlbkxpc3Q6IDEsCgkgIERhdGFUcmFuc2Zlckl0ZW1MaXN0OiAwLAoJICBGaWxlTGlzdDogMCwKCSAgSFRNTEFsbENvbGxlY3Rpb246IDAsCgkgIEhUTUxDb2xsZWN0aW9uOiAwLAoJICBIVE1MRm9ybUVsZW1lbnQ6IDAsCgkgIEhUTUxTZWxlY3RFbGVtZW50OiAwLAoJICBNZWRpYUxpc3Q6IDAsCgkgIE1pbWVUeXBlQXJyYXk6IDAsCgkgIE5hbWVkTm9kZU1hcDogMCwKCSAgTm9kZUxpc3Q6IDEsCgkgIFBhaW50UmVxdWVzdExpc3Q6IDAsCgkgIFBsdWdpbjogMCwKCSAgUGx1Z2luQXJyYXk6IDAsCgkgIFNWR0xlbmd0aExpc3Q6IDAsCgkgIFNWR051bWJlckxpc3Q6IDAsCgkgIFNWR1BhdGhTZWdMaXN0OiAwLAoJICBTVkdQb2ludExpc3Q6IDAsCgkgIFNWR1N0cmluZ0xpc3Q6IDAsCgkgIFNWR1RyYW5zZm9ybUxpc3Q6IDAsCgkgIFNvdXJjZUJ1ZmZlckxpc3Q6IDAsCgkgIFN0eWxlU2hlZXRMaXN0OiAwLAoJICBUZXh0VHJhY2tDdWVMaXN0OiAwLAoJICBUZXh0VHJhY2tMaXN0OiAwLAoJICBUb3VjaExpc3Q6IDAKCX07CgoJdmFyIERPTUl0ZXJhYmxlcyQxID0gZG9tSXRlcmFibGVzOwoJdmFyIGdsb2JhbCRqID0gZ2xvYmFsJEc7Cgl2YXIgY2xhc3NvZiQ3ID0gY2xhc3NvZiQ5OwoJdmFyIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSA9IGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSQ1OwoJdmFyIEl0ZXJhdG9ycyQyID0gaXRlcmF0b3JzOwoJdmFyIHdlbGxLbm93blN5bWJvbCQ5ID0gd2VsbEtub3duU3ltYm9sJGc7CgoJdmFyIFRPX1NUUklOR19UQUcgPSB3ZWxsS25vd25TeW1ib2wkOSgndG9TdHJpbmdUYWcnKTsKCglmb3IgKHZhciBDT0xMRUNUSU9OX05BTUUgaW4gRE9NSXRlcmFibGVzJDEpIHsKCSAgdmFyIENvbGxlY3Rpb24gPSBnbG9iYWwkaltDT0xMRUNUSU9OX05BTUVdOwoJICB2YXIgQ29sbGVjdGlvblByb3RvdHlwZSA9IENvbGxlY3Rpb24gJiYgQ29sbGVjdGlvbi5wcm90b3R5cGU7CgkgIGlmIChDb2xsZWN0aW9uUHJvdG90eXBlICYmIGNsYXNzb2YkNyhDb2xsZWN0aW9uUHJvdG90eXBlKSAhPT0gVE9fU1RSSU5HX1RBRykgewoJICAgIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eShDb2xsZWN0aW9uUHJvdG90eXBlLCBUT19TVFJJTkdfVEFHLCBDT0xMRUNUSU9OX05BTUUpOwoJICB9CgkgIEl0ZXJhdG9ycyQyW0NPTExFQ1RJT05fTkFNRV0gPSBJdGVyYXRvcnMkMi5BcnJheTsKCX0KCgl2YXIgY2xhc3NvZiQ2ID0gY2xhc3NvZlJhdyQxOwoKCS8vIGBJc0FycmF5YCBhYnN0cmFjdCBvcGVyYXRpb24KCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtaXNhcnJheQoJLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGVzL25vLWFycmF5LWlzYXJyYXkgLS0gc2FmZQoJdmFyIGlzQXJyYXkkNSA9IEFycmF5LmlzQXJyYXkgfHwgZnVuY3Rpb24gaXNBcnJheShhcmd1bWVudCkgewoJICByZXR1cm4gY2xhc3NvZiQ2KGFyZ3VtZW50KSA9PSAnQXJyYXknOwoJfTsKCgl2YXIgdW5jdXJyeVRoaXMkZCA9IGZ1bmN0aW9uVW5jdXJyeVRoaXM7Cgl2YXIgZmFpbHMkOCA9IGZhaWxzJGc7Cgl2YXIgaXNDYWxsYWJsZSQzID0gaXNDYWxsYWJsZSRoOwoJdmFyIGNsYXNzb2YkNSA9IGNsYXNzb2YkOTsKCXZhciBnZXRCdWlsdEluJDEgPSBnZXRCdWlsdEluJDU7Cgl2YXIgaW5zcGVjdFNvdXJjZSA9IGluc3BlY3RTb3VyY2UkMjsKCgl2YXIgbm9vcCA9IGZ1bmN0aW9uICgpIHsgLyogZW1wdHkgKi8gfTsKCXZhciBlbXB0eSA9IFtdOwoJdmFyIGNvbnN0cnVjdCA9IGdldEJ1aWx0SW4kMSgnUmVmbGVjdCcsICdjb25zdHJ1Y3QnKTsKCXZhciBjb25zdHJ1Y3RvclJlZ0V4cCA9IC9eXHMqKD86Y2xhc3N8ZnVuY3Rpb24pXGIvOwoJdmFyIGV4ZWMkMSA9IHVuY3VycnlUaGlzJGQoY29uc3RydWN0b3JSZWdFeHAuZXhlYyk7Cgl2YXIgSU5DT1JSRUNUX1RPX1NUUklORyA9ICFjb25zdHJ1Y3RvclJlZ0V4cC5leGVjKG5vb3ApOwoKCXZhciBpc0NvbnN0cnVjdG9yTW9kZXJuID0gZnVuY3Rpb24gKGFyZ3VtZW50KSB7CgkgIGlmICghaXNDYWxsYWJsZSQzKGFyZ3VtZW50KSkgcmV0dXJuIGZhbHNlOwoJICB0cnkgewoJICAgIGNvbnN0cnVjdChub29wLCBlbXB0eSwgYXJndW1lbnQpOwoJICAgIHJldHVybiB0cnVlOwoJICB9IGNhdGNoIChlcnJvcikgewoJICAgIHJldHVybiBmYWxzZTsKCSAgfQoJfTsKCgl2YXIgaXNDb25zdHJ1Y3RvckxlZ2FjeSA9IGZ1bmN0aW9uIChhcmd1bWVudCkgewoJICBpZiAoIWlzQ2FsbGFibGUkMyhhcmd1bWVudCkpIHJldHVybiBmYWxzZTsKCSAgc3dpdGNoIChjbGFzc29mJDUoYXJndW1lbnQpKSB7CgkgICAgY2FzZSAnQXN5bmNGdW5jdGlvbic6CgkgICAgY2FzZSAnR2VuZXJhdG9yRnVuY3Rpb24nOgoJICAgIGNhc2UgJ0FzeW5jR2VuZXJhdG9yRnVuY3Rpb24nOiByZXR1cm4gZmFsc2U7CgkgICAgLy8gd2UgY2FuJ3QgY2hlY2sgLnByb3RvdHlwZSBzaW5jZSBjb25zdHJ1Y3RvcnMgcHJvZHVjZWQgYnkgLmJpbmQgaGF2ZW4ndCBpdAoJICB9IHJldHVybiBJTkNPUlJFQ1RfVE9fU1RSSU5HIHx8ICEhZXhlYyQxKGNvbnN0cnVjdG9yUmVnRXhwLCBpbnNwZWN0U291cmNlKGFyZ3VtZW50KSk7Cgl9OwoKCS8vIGBJc0NvbnN0cnVjdG9yYCBhYnN0cmFjdCBvcGVyYXRpb24KCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtaXNjb25zdHJ1Y3RvcgoJdmFyIGlzQ29uc3RydWN0b3IkMyA9ICFjb25zdHJ1Y3QgfHwgZmFpbHMkOChmdW5jdGlvbiAoKSB7CgkgIHZhciBjYWxsZWQ7CgkgIHJldHVybiBpc0NvbnN0cnVjdG9yTW9kZXJuKGlzQ29uc3RydWN0b3JNb2Rlcm4uY2FsbCkKCSAgICB8fCAhaXNDb25zdHJ1Y3Rvck1vZGVybihPYmplY3QpCgkgICAgfHwgIWlzQ29uc3RydWN0b3JNb2Rlcm4oZnVuY3Rpb24gKCkgeyBjYWxsZWQgPSB0cnVlOyB9KQoJICAgIHx8IGNhbGxlZDsKCX0pID8gaXNDb25zdHJ1Y3RvckxlZ2FjeSA6IGlzQ29uc3RydWN0b3JNb2Rlcm47CgoJdmFyIGdsb2JhbCRpID0gZ2xvYmFsJEc7Cgl2YXIgaXNBcnJheSQ0ID0gaXNBcnJheSQ1OwoJdmFyIGlzQ29uc3RydWN0b3IkMiA9IGlzQ29uc3RydWN0b3IkMzsKCXZhciBpc09iamVjdCQ0ID0gaXNPYmplY3QkYTsKCXZhciB3ZWxsS25vd25TeW1ib2wkOCA9IHdlbGxLbm93blN5bWJvbCRnOwoKCXZhciBTUEVDSUVTJDIgPSB3ZWxsS25vd25TeW1ib2wkOCgnc3BlY2llcycpOwoJdmFyIEFycmF5JDQgPSBnbG9iYWwkaS5BcnJheTsKCgkvLyBhIHBhcnQgb2YgYEFycmF5U3BlY2llc0NyZWF0ZWAgYWJzdHJhY3Qgb3BlcmF0aW9uCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLWFycmF5c3BlY2llc2NyZWF0ZQoJdmFyIGFycmF5U3BlY2llc0NvbnN0cnVjdG9yJDEgPSBmdW5jdGlvbiAob3JpZ2luYWxBcnJheSkgewoJICB2YXIgQzsKCSAgaWYgKGlzQXJyYXkkNChvcmlnaW5hbEFycmF5KSkgewoJICAgIEMgPSBvcmlnaW5hbEFycmF5LmNvbnN0cnVjdG9yOwoJICAgIC8vIGNyb3NzLXJlYWxtIGZhbGxiYWNrCgkgICAgaWYgKGlzQ29uc3RydWN0b3IkMihDKSAmJiAoQyA9PT0gQXJyYXkkNCB8fCBpc0FycmF5JDQoQy5wcm90b3R5cGUpKSkgQyA9IHVuZGVmaW5lZDsKCSAgICBlbHNlIGlmIChpc09iamVjdCQ0KEMpKSB7CgkgICAgICBDID0gQ1tTUEVDSUVTJDJdOwoJICAgICAgaWYgKEMgPT09IG51bGwpIEMgPSB1bmRlZmluZWQ7CgkgICAgfQoJICB9IHJldHVybiBDID09PSB1bmRlZmluZWQgPyBBcnJheSQ0IDogQzsKCX07CgoJdmFyIGFycmF5U3BlY2llc0NvbnN0cnVjdG9yID0gYXJyYXlTcGVjaWVzQ29uc3RydWN0b3IkMTsKCgkvLyBgQXJyYXlTcGVjaWVzQ3JlYXRlYCBhYnN0cmFjdCBvcGVyYXRpb24KCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtYXJyYXlzcGVjaWVzY3JlYXRlCgl2YXIgYXJyYXlTcGVjaWVzQ3JlYXRlJDMgPSBmdW5jdGlvbiAob3JpZ2luYWxBcnJheSwgbGVuZ3RoKSB7CgkgIHJldHVybiBuZXcgKGFycmF5U3BlY2llc0NvbnN0cnVjdG9yKG9yaWdpbmFsQXJyYXkpKShsZW5ndGggPT09IDAgPyAwIDogbGVuZ3RoKTsKCX07CgoJdmFyIGJpbmQkMSA9IGZ1bmN0aW9uQmluZENvbnRleHQ7Cgl2YXIgdW5jdXJyeVRoaXMkYyA9IGZ1bmN0aW9uVW5jdXJyeVRoaXM7Cgl2YXIgSW5kZXhlZE9iamVjdCQxID0gaW5kZXhlZE9iamVjdDsKCXZhciB0b09iamVjdCQ2ID0gdG9PYmplY3QkOTsKCXZhciBsZW5ndGhPZkFycmF5TGlrZSQ3ID0gbGVuZ3RoT2ZBcnJheUxpa2UkOTsKCXZhciBhcnJheVNwZWNpZXNDcmVhdGUkMiA9IGFycmF5U3BlY2llc0NyZWF0ZSQzOwoKCXZhciBwdXNoJDEgPSB1bmN1cnJ5VGhpcyRjKFtdLnB1c2gpOwoKCS8vIGBBcnJheS5wcm90b3R5cGUueyBmb3JFYWNoLCBtYXAsIGZpbHRlciwgc29tZSwgZXZlcnksIGZpbmQsIGZpbmRJbmRleCwgZmlsdGVyUmVqZWN0IH1gIG1ldGhvZHMgaW1wbGVtZW50YXRpb24KCXZhciBjcmVhdGVNZXRob2QkNCA9IGZ1bmN0aW9uIChUWVBFKSB7CgkgIHZhciBJU19NQVAgPSBUWVBFID09IDE7CgkgIHZhciBJU19GSUxURVIgPSBUWVBFID09IDI7CgkgIHZhciBJU19TT01FID0gVFlQRSA9PSAzOwoJICB2YXIgSVNfRVZFUlkgPSBUWVBFID09IDQ7CgkgIHZhciBJU19GSU5EX0lOREVYID0gVFlQRSA9PSA2OwoJICB2YXIgSVNfRklMVEVSX1JFSkVDVCA9IFRZUEUgPT0gNzsKCSAgdmFyIE5PX0hPTEVTID0gVFlQRSA9PSA1IHx8IElTX0ZJTkRfSU5ERVg7CgkgIHJldHVybiBmdW5jdGlvbiAoJHRoaXMsIGNhbGxiYWNrZm4sIHRoYXQsIHNwZWNpZmljQ3JlYXRlKSB7CgkgICAgdmFyIE8gPSB0b09iamVjdCQ2KCR0aGlzKTsKCSAgICB2YXIgc2VsZiA9IEluZGV4ZWRPYmplY3QkMShPKTsKCSAgICB2YXIgYm91bmRGdW5jdGlvbiA9IGJpbmQkMShjYWxsYmFja2ZuLCB0aGF0KTsKCSAgICB2YXIgbGVuZ3RoID0gbGVuZ3RoT2ZBcnJheUxpa2UkNyhzZWxmKTsKCSAgICB2YXIgaW5kZXggPSAwOwoJICAgIHZhciBjcmVhdGUgPSBzcGVjaWZpY0NyZWF0ZSB8fCBhcnJheVNwZWNpZXNDcmVhdGUkMjsKCSAgICB2YXIgdGFyZ2V0ID0gSVNfTUFQID8gY3JlYXRlKCR0aGlzLCBsZW5ndGgpIDogSVNfRklMVEVSIHx8IElTX0ZJTFRFUl9SRUpFQ1QgPyBjcmVhdGUoJHRoaXMsIDApIDogdW5kZWZpbmVkOwoJICAgIHZhciB2YWx1ZSwgcmVzdWx0OwoJICAgIGZvciAoO2xlbmd0aCA+IGluZGV4OyBpbmRleCsrKSBpZiAoTk9fSE9MRVMgfHwgaW5kZXggaW4gc2VsZikgewoJICAgICAgdmFsdWUgPSBzZWxmW2luZGV4XTsKCSAgICAgIHJlc3VsdCA9IGJvdW5kRnVuY3Rpb24odmFsdWUsIGluZGV4LCBPKTsKCSAgICAgIGlmIChUWVBFKSB7CgkgICAgICAgIGlmIChJU19NQVApIHRhcmdldFtpbmRleF0gPSByZXN1bHQ7IC8vIG1hcAoJICAgICAgICBlbHNlIGlmIChyZXN1bHQpIHN3aXRjaCAoVFlQRSkgewoJICAgICAgICAgIGNhc2UgMzogcmV0dXJuIHRydWU7ICAgICAgICAgICAgICAvLyBzb21lCgkgICAgICAgICAgY2FzZSA1OiByZXR1cm4gdmFsdWU7ICAgICAgICAgICAgIC8vIGZpbmQKCSAgICAgICAgICBjYXNlIDY6IHJldHVybiBpbmRleDsgICAgICAgICAgICAgLy8gZmluZEluZGV4CgkgICAgICAgICAgY2FzZSAyOiBwdXNoJDEodGFyZ2V0LCB2YWx1ZSk7ICAgICAgLy8gZmlsdGVyCgkgICAgICAgIH0gZWxzZSBzd2l0Y2ggKFRZUEUpIHsKCSAgICAgICAgICBjYXNlIDQ6IHJldHVybiBmYWxzZTsgICAgICAgICAgICAgLy8gZXZlcnkKCSAgICAgICAgICBjYXNlIDc6IHB1c2gkMSh0YXJnZXQsIHZhbHVlKTsgICAgICAvLyBmaWx0ZXJSZWplY3QKCSAgICAgICAgfQoJICAgICAgfQoJICAgIH0KCSAgICByZXR1cm4gSVNfRklORF9JTkRFWCA/IC0xIDogSVNfU09NRSB8fCBJU19FVkVSWSA/IElTX0VWRVJZIDogdGFyZ2V0OwoJICB9OwoJfTsKCgl2YXIgYXJyYXlJdGVyYXRpb24gPSB7CgkgIC8vIGBBcnJheS5wcm90b3R5cGUuZm9yRWFjaGAgbWV0aG9kCgkgIC8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtYXJyYXkucHJvdG90eXBlLmZvcmVhY2gKCSAgZm9yRWFjaDogY3JlYXRlTWV0aG9kJDQoMCksCgkgIC8vIGBBcnJheS5wcm90b3R5cGUubWFwYCBtZXRob2QKCSAgLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1hcnJheS5wcm90b3R5cGUubWFwCgkgIG1hcDogY3JlYXRlTWV0aG9kJDQoMSksCgkgIC8vIGBBcnJheS5wcm90b3R5cGUuZmlsdGVyYCBtZXRob2QKCSAgLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1hcnJheS5wcm90b3R5cGUuZmlsdGVyCgkgIGZpbHRlcjogY3JlYXRlTWV0aG9kJDQoMiksCgkgIC8vIGBBcnJheS5wcm90b3R5cGUuc29tZWAgbWV0aG9kCgkgIC8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtYXJyYXkucHJvdG90eXBlLnNvbWUKCSAgc29tZTogY3JlYXRlTWV0aG9kJDQoMyksCgkgIC8vIGBBcnJheS5wcm90b3R5cGUuZXZlcnlgIG1ldGhvZAoJICAvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLWFycmF5LnByb3RvdHlwZS5ldmVyeQoJICBldmVyeTogY3JlYXRlTWV0aG9kJDQoNCksCgkgIC8vIGBBcnJheS5wcm90b3R5cGUuZmluZGAgbWV0aG9kCgkgIC8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtYXJyYXkucHJvdG90eXBlLmZpbmQKCSAgZmluZDogY3JlYXRlTWV0aG9kJDQoNSksCgkgIC8vIGBBcnJheS5wcm90b3R5cGUuZmluZEluZGV4YCBtZXRob2QKCSAgLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1hcnJheS5wcm90b3R5cGUuZmluZEluZGV4CgkgIGZpbmRJbmRleDogY3JlYXRlTWV0aG9kJDQoNiksCgkgIC8vIGBBcnJheS5wcm90b3R5cGUuZmlsdGVyUmVqZWN0YCBtZXRob2QKCSAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3RjMzkvcHJvcG9zYWwtYXJyYXktZmlsdGVyaW5nCgkgIGZpbHRlclJlamVjdDogY3JlYXRlTWV0aG9kJDQoNykKCX07CgoJdmFyIGZhaWxzJDcgPSBmYWlscyRnOwoKCXZhciBhcnJheU1ldGhvZElzU3RyaWN0JDIgPSBmdW5jdGlvbiAoTUVUSE9EX05BTUUsIGFyZ3VtZW50KSB7CgkgIHZhciBtZXRob2QgPSBbXVtNRVRIT0RfTkFNRV07CgkgIHJldHVybiAhIW1ldGhvZCAmJiBmYWlscyQ3KGZ1bmN0aW9uICgpIHsKCSAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdXNlbGVzcy1jYWxsLG5vLXRocm93LWxpdGVyYWwgLS0gcmVxdWlyZWQgZm9yIHRlc3RpbmcKCSAgICBtZXRob2QuY2FsbChudWxsLCBhcmd1bWVudCB8fCBmdW5jdGlvbiAoKSB7IHRocm93IDE7IH0sIDEpOwoJICB9KTsKCX07CgoJdmFyICRmb3JFYWNoJDEgPSBhcnJheUl0ZXJhdGlvbi5mb3JFYWNoOwoJdmFyIGFycmF5TWV0aG9kSXNTdHJpY3QkMSA9IGFycmF5TWV0aG9kSXNTdHJpY3QkMjsKCgl2YXIgU1RSSUNUX01FVEhPRCQxID0gYXJyYXlNZXRob2RJc1N0cmljdCQxKCdmb3JFYWNoJyk7CgoJLy8gYEFycmF5LnByb3RvdHlwZS5mb3JFYWNoYCBtZXRob2QgaW1wbGVtZW50YXRpb24KCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtYXJyYXkucHJvdG90eXBlLmZvcmVhY2gKCXZhciBhcnJheUZvckVhY2ggPSAhU1RSSUNUX01FVEhPRCQxID8gZnVuY3Rpb24gZm9yRWFjaChjYWxsYmFja2ZuIC8qICwgdGhpc0FyZyAqLykgewoJICByZXR1cm4gJGZvckVhY2gkMSh0aGlzLCBjYWxsYmFja2ZuLCBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZCk7CgkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZXMvbm8tYXJyYXktcHJvdG90eXBlLWZvcmVhY2ggLS0gc2FmZQoJfSA6IFtdLmZvckVhY2g7CgoJdmFyICQkYyA9IF9leHBvcnQ7Cgl2YXIgZm9yRWFjaCQ0ID0gYXJyYXlGb3JFYWNoOwoKCS8vIGBBcnJheS5wcm90b3R5cGUuZm9yRWFjaGAgbWV0aG9kCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLWFycmF5LnByb3RvdHlwZS5mb3JlYWNoCgkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZXMvbm8tYXJyYXktcHJvdG90eXBlLWZvcmVhY2ggLS0gc2FmZQoJJCRjKHsgdGFyZ2V0OiAnQXJyYXknLCBwcm90bzogdHJ1ZSwgZm9yY2VkOiBbXS5mb3JFYWNoICE9IGZvckVhY2gkNCB9LCB7CgkgIGZvckVhY2g6IGZvckVhY2gkNAoJfSk7CgoJdmFyIHBhdGgkNSA9IHBhdGgkODsKCgl2YXIgZW50cnlWaXJ0dWFsJDggPSBmdW5jdGlvbiAoQ09OU1RSVUNUT1IpIHsKCSAgcmV0dXJuIHBhdGgkNVtDT05TVFJVQ1RPUiArICdQcm90b3R5cGUnXTsKCX07CgoJdmFyIGVudHJ5VmlydHVhbCQ3ID0gZW50cnlWaXJ0dWFsJDg7CgoJdmFyIGZvckVhY2gkMyA9IGVudHJ5VmlydHVhbCQ3KCdBcnJheScpLmZvckVhY2g7CgoJdmFyIHBhcmVudCRkID0gZm9yRWFjaCQzOwoKCXZhciBmb3JFYWNoJDIgPSBwYXJlbnQkZDsKCgl2YXIgY2xhc3NvZiQ0ID0gY2xhc3NvZiQ5OwoJdmFyIGhhc093biQzID0gaGFzT3duUHJvcGVydHlfMTsKCXZhciBpc1Byb3RvdHlwZU9mJDkgPSBvYmplY3RJc1Byb3RvdHlwZU9mOwoJdmFyIG1ldGhvZCQ3ID0gZm9yRWFjaCQyOwoKCXZhciBBcnJheVByb3RvdHlwZSQ4ID0gQXJyYXkucHJvdG90eXBlOwoKCXZhciBET01JdGVyYWJsZXMgPSB7CgkgIERPTVRva2VuTGlzdDogdHJ1ZSwKCSAgTm9kZUxpc3Q6IHRydWUKCX07CgoJdmFyIGZvckVhY2gkMSA9IGZ1bmN0aW9uIChpdCkgewoJICB2YXIgb3duID0gaXQuZm9yRWFjaDsKCSAgcmV0dXJuIGl0ID09PSBBcnJheVByb3RvdHlwZSQ4IHx8IChpc1Byb3RvdHlwZU9mJDkoQXJyYXlQcm90b3R5cGUkOCwgaXQpICYmIG93biA9PT0gQXJyYXlQcm90b3R5cGUkOC5mb3JFYWNoKQoJICAgIHx8IGhhc093biQzKERPTUl0ZXJhYmxlcywgY2xhc3NvZiQ0KGl0KSkgPyBtZXRob2QkNyA6IG93bjsKCX07CgoJdmFyIGZvckVhY2ggPSBmb3JFYWNoJDE7CgoJdmFyIHRvUHJvcGVydHlLZXkkMSA9IHRvUHJvcGVydHlLZXkkNDsKCXZhciBkZWZpbmVQcm9wZXJ0eU1vZHVsZSQxID0gb2JqZWN0RGVmaW5lUHJvcGVydHk7Cgl2YXIgY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yJDEgPSBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IkNTsKCgl2YXIgY3JlYXRlUHJvcGVydHkkNSA9IGZ1bmN0aW9uIChvYmplY3QsIGtleSwgdmFsdWUpIHsKCSAgdmFyIHByb3BlcnR5S2V5ID0gdG9Qcm9wZXJ0eUtleSQxKGtleSk7CgkgIGlmIChwcm9wZXJ0eUtleSBpbiBvYmplY3QpIGRlZmluZVByb3BlcnR5TW9kdWxlJDEuZihvYmplY3QsIHByb3BlcnR5S2V5LCBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IkMSgwLCB2YWx1ZSkpOwoJICBlbHNlIG9iamVjdFtwcm9wZXJ0eUtleV0gPSB2YWx1ZTsKCX07CgoJdmFyIGZhaWxzJDYgPSBmYWlscyRnOwoJdmFyIHdlbGxLbm93blN5bWJvbCQ3ID0gd2VsbEtub3duU3ltYm9sJGc7Cgl2YXIgVjhfVkVSU0lPTiQxID0gZW5naW5lVjhWZXJzaW9uOwoKCXZhciBTUEVDSUVTJDEgPSB3ZWxsS25vd25TeW1ib2wkNygnc3BlY2llcycpOwoKCXZhciBhcnJheU1ldGhvZEhhc1NwZWNpZXNTdXBwb3J0JDQgPSBmdW5jdGlvbiAoTUVUSE9EX05BTUUpIHsKCSAgLy8gV2UgY2FuJ3QgdXNlIHRoaXMgZmVhdHVyZSBkZXRlY3Rpb24gaW4gVjggc2luY2UgaXQgY2F1c2VzCgkgIC8vIGRlb3B0aW1pemF0aW9uIGFuZCBzZXJpb3VzIHBlcmZvcm1hbmNlIGRlZ3JhZGF0aW9uCgkgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS96bG9pcm9jay9jb3JlLWpzL2lzc3Vlcy82NzcKCSAgcmV0dXJuIFY4X1ZFUlNJT04kMSA+PSA1MSB8fCAhZmFpbHMkNihmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGFycmF5ID0gW107CgkgICAgdmFyIGNvbnN0cnVjdG9yID0gYXJyYXkuY29uc3RydWN0b3IgPSB7fTsKCSAgICBjb25zdHJ1Y3RvcltTUEVDSUVTJDFdID0gZnVuY3Rpb24gKCkgewoJICAgICAgcmV0dXJuIHsgZm9vOiAxIH07CgkgICAgfTsKCSAgICByZXR1cm4gYXJyYXlbTUVUSE9EX05BTUVdKEJvb2xlYW4pLmZvbyAhPT0gMTsKCSAgfSk7Cgl9OwoKCXZhciAkJGIgPSBfZXhwb3J0OwoJdmFyIGdsb2JhbCRoID0gZ2xvYmFsJEc7Cgl2YXIgZmFpbHMkNSA9IGZhaWxzJGc7Cgl2YXIgaXNBcnJheSQzID0gaXNBcnJheSQ1OwoJdmFyIGlzT2JqZWN0JDMgPSBpc09iamVjdCRhOwoJdmFyIHRvT2JqZWN0JDUgPSB0b09iamVjdCQ5OwoJdmFyIGxlbmd0aE9mQXJyYXlMaWtlJDYgPSBsZW5ndGhPZkFycmF5TGlrZSQ5OwoJdmFyIGNyZWF0ZVByb3BlcnR5JDQgPSBjcmVhdGVQcm9wZXJ0eSQ1OwoJdmFyIGFycmF5U3BlY2llc0NyZWF0ZSQxID0gYXJyYXlTcGVjaWVzQ3JlYXRlJDM7Cgl2YXIgYXJyYXlNZXRob2RIYXNTcGVjaWVzU3VwcG9ydCQzID0gYXJyYXlNZXRob2RIYXNTcGVjaWVzU3VwcG9ydCQ0OwoJdmFyIHdlbGxLbm93blN5bWJvbCQ2ID0gd2VsbEtub3duU3ltYm9sJGc7Cgl2YXIgVjhfVkVSU0lPTiA9IGVuZ2luZVY4VmVyc2lvbjsKCgl2YXIgSVNfQ09OQ0FUX1NQUkVBREFCTEUgPSB3ZWxsS25vd25TeW1ib2wkNignaXNDb25jYXRTcHJlYWRhYmxlJyk7Cgl2YXIgTUFYX1NBRkVfSU5URUdFUiQxID0gMHgxRkZGRkZGRkZGRkZGRjsKCXZhciBNQVhJTVVNX0FMTE9XRURfSU5ERVhfRVhDRUVERUQgPSAnTWF4aW11bSBhbGxvd2VkIGluZGV4IGV4Y2VlZGVkJzsKCXZhciBUeXBlRXJyb3IkNyA9IGdsb2JhbCRoLlR5cGVFcnJvcjsKCgkvLyBXZSBjYW4ndCB1c2UgdGhpcyBmZWF0dXJlIGRldGVjdGlvbiBpbiBWOCBzaW5jZSBpdCBjYXVzZXMKCS8vIGRlb3B0aW1pemF0aW9uIGFuZCBzZXJpb3VzIHBlcmZvcm1hbmNlIGRlZ3JhZGF0aW9uCgkvLyBodHRwczovL2dpdGh1Yi5jb20vemxvaXJvY2svY29yZS1qcy9pc3N1ZXMvNjc5Cgl2YXIgSVNfQ09OQ0FUX1NQUkVBREFCTEVfU1VQUE9SVCA9IFY4X1ZFUlNJT04gPj0gNTEgfHwgIWZhaWxzJDUoZnVuY3Rpb24gKCkgewoJICB2YXIgYXJyYXkgPSBbXTsKCSAgYXJyYXlbSVNfQ09OQ0FUX1NQUkVBREFCTEVdID0gZmFsc2U7CgkgIHJldHVybiBhcnJheS5jb25jYXQoKVswXSAhPT0gYXJyYXk7Cgl9KTsKCgl2YXIgU1BFQ0lFU19TVVBQT1JUID0gYXJyYXlNZXRob2RIYXNTcGVjaWVzU3VwcG9ydCQzKCdjb25jYXQnKTsKCgl2YXIgaXNDb25jYXRTcHJlYWRhYmxlID0gZnVuY3Rpb24gKE8pIHsKCSAgaWYgKCFpc09iamVjdCQzKE8pKSByZXR1cm4gZmFsc2U7CgkgIHZhciBzcHJlYWRhYmxlID0gT1tJU19DT05DQVRfU1BSRUFEQUJMRV07CgkgIHJldHVybiBzcHJlYWRhYmxlICE9PSB1bmRlZmluZWQgPyAhIXNwcmVhZGFibGUgOiBpc0FycmF5JDMoTyk7Cgl9OwoKCXZhciBGT1JDRUQkMyA9ICFJU19DT05DQVRfU1BSRUFEQUJMRV9TVVBQT1JUIHx8ICFTUEVDSUVTX1NVUFBPUlQ7CgoJLy8gYEFycmF5LnByb3RvdHlwZS5jb25jYXRgIG1ldGhvZAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1hcnJheS5wcm90b3R5cGUuY29uY2F0CgkvLyB3aXRoIGFkZGluZyBzdXBwb3J0IG9mIEBAaXNDb25jYXRTcHJlYWRhYmxlIGFuZCBAQHNwZWNpZXMKCSQkYih7IHRhcmdldDogJ0FycmF5JywgcHJvdG86IHRydWUsIGZvcmNlZDogRk9SQ0VEJDMgfSwgewoJICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW51c2VkLXZhcnMgLS0gcmVxdWlyZWQgZm9yIGAubGVuZ3RoYAoJICBjb25jYXQ6IGZ1bmN0aW9uIGNvbmNhdChhcmcpIHsKCSAgICB2YXIgTyA9IHRvT2JqZWN0JDUodGhpcyk7CgkgICAgdmFyIEEgPSBhcnJheVNwZWNpZXNDcmVhdGUkMShPLCAwKTsKCSAgICB2YXIgbiA9IDA7CgkgICAgdmFyIGksIGssIGxlbmd0aCwgbGVuLCBFOwoJICAgIGZvciAoaSA9IC0xLCBsZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsKCSAgICAgIEUgPSBpID09PSAtMSA/IE8gOiBhcmd1bWVudHNbaV07CgkgICAgICBpZiAoaXNDb25jYXRTcHJlYWRhYmxlKEUpKSB7CgkgICAgICAgIGxlbiA9IGxlbmd0aE9mQXJyYXlMaWtlJDYoRSk7CgkgICAgICAgIGlmIChuICsgbGVuID4gTUFYX1NBRkVfSU5URUdFUiQxKSB0aHJvdyBUeXBlRXJyb3IkNyhNQVhJTVVNX0FMTE9XRURfSU5ERVhfRVhDRUVERUQpOwoJICAgICAgICBmb3IgKGsgPSAwOyBrIDwgbGVuOyBrKyssIG4rKykgaWYgKGsgaW4gRSkgY3JlYXRlUHJvcGVydHkkNChBLCBuLCBFW2tdKTsKCSAgICAgIH0gZWxzZSB7CgkgICAgICAgIGlmIChuID49IE1BWF9TQUZFX0lOVEVHRVIkMSkgdGhyb3cgVHlwZUVycm9yJDcoTUFYSU1VTV9BTExPV0VEX0lOREVYX0VYQ0VFREVEKTsKCSAgICAgICAgY3JlYXRlUHJvcGVydHkkNChBLCBuKyssIEUpOwoJICAgICAgfQoJICAgIH0KCSAgICBBLmxlbmd0aCA9IG47CgkgICAgcmV0dXJuIEE7CgkgIH0KCX0pOwoKCXZhciBlbnRyeVZpcnR1YWwkNiA9IGVudHJ5VmlydHVhbCQ4OwoKCXZhciBjb25jYXQkMyA9IGVudHJ5VmlydHVhbCQ2KCdBcnJheScpLmNvbmNhdDsKCgl2YXIgaXNQcm90b3R5cGVPZiQ4ID0gb2JqZWN0SXNQcm90b3R5cGVPZjsKCXZhciBtZXRob2QkNiA9IGNvbmNhdCQzOwoKCXZhciBBcnJheVByb3RvdHlwZSQ3ID0gQXJyYXkucHJvdG90eXBlOwoKCXZhciBjb25jYXQkMiA9IGZ1bmN0aW9uIChpdCkgewoJICB2YXIgb3duID0gaXQuY29uY2F0OwoJICByZXR1cm4gaXQgPT09IEFycmF5UHJvdG90eXBlJDcgfHwgKGlzUHJvdG90eXBlT2YkOChBcnJheVByb3RvdHlwZSQ3LCBpdCkgJiYgb3duID09PSBBcnJheVByb3RvdHlwZSQ3LmNvbmNhdCkgPyBtZXRob2QkNiA6IG93bjsKCX07CgoJdmFyIHBhcmVudCRjID0gY29uY2F0JDI7CgoJdmFyIGNvbmNhdCQxID0gcGFyZW50JGM7CgoJdmFyIGNvbmNhdCA9IGNvbmNhdCQxOwoKCXZhciB0b09iamVjdCQ0ID0gdG9PYmplY3QkOTsKCXZhciB0b0Fic29sdXRlSW5kZXgkMyA9IHRvQWJzb2x1dGVJbmRleCQ1OwoJdmFyIGxlbmd0aE9mQXJyYXlMaWtlJDUgPSBsZW5ndGhPZkFycmF5TGlrZSQ5OwoKCS8vIGBBcnJheS5wcm90b3R5cGUuZmlsbGAgbWV0aG9kIGltcGxlbWVudGF0aW9uCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLWFycmF5LnByb3RvdHlwZS5maWxsCgl2YXIgYXJyYXlGaWxsID0gZnVuY3Rpb24gZmlsbCh2YWx1ZSAvKiAsIHN0YXJ0ID0gMCwgZW5kID0gQGxlbmd0aCAqLykgewoJICB2YXIgTyA9IHRvT2JqZWN0JDQodGhpcyk7CgkgIHZhciBsZW5ndGggPSBsZW5ndGhPZkFycmF5TGlrZSQ1KE8pOwoJICB2YXIgYXJndW1lbnRzTGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aDsKCSAgdmFyIGluZGV4ID0gdG9BYnNvbHV0ZUluZGV4JDMoYXJndW1lbnRzTGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZCwgbGVuZ3RoKTsKCSAgdmFyIGVuZCA9IGFyZ3VtZW50c0xlbmd0aCA+IDIgPyBhcmd1bWVudHNbMl0gOiB1bmRlZmluZWQ7CgkgIHZhciBlbmRQb3MgPSBlbmQgPT09IHVuZGVmaW5lZCA/IGxlbmd0aCA6IHRvQWJzb2x1dGVJbmRleCQzKGVuZCwgbGVuZ3RoKTsKCSAgd2hpbGUgKGVuZFBvcyA+IGluZGV4KSBPW2luZGV4KytdID0gdmFsdWU7CgkgIHJldHVybiBPOwoJfTsKCgl2YXIgJCRhID0gX2V4cG9ydDsKCXZhciBmaWxsJDQgPSBhcnJheUZpbGw7CgoJLy8gYEFycmF5LnByb3RvdHlwZS5maWxsYCBtZXRob2QKCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtYXJyYXkucHJvdG90eXBlLmZpbGwKCSQkYSh7IHRhcmdldDogJ0FycmF5JywgcHJvdG86IHRydWUgfSwgewoJICBmaWxsOiBmaWxsJDQKCX0pOwoKCXZhciBlbnRyeVZpcnR1YWwkNSA9IGVudHJ5VmlydHVhbCQ4OwoKCXZhciBmaWxsJDMgPSBlbnRyeVZpcnR1YWwkNSgnQXJyYXknKS5maWxsOwoKCXZhciBpc1Byb3RvdHlwZU9mJDcgPSBvYmplY3RJc1Byb3RvdHlwZU9mOwoJdmFyIG1ldGhvZCQ1ID0gZmlsbCQzOwoKCXZhciBBcnJheVByb3RvdHlwZSQ2ID0gQXJyYXkucHJvdG90eXBlOwoKCXZhciBmaWxsJDIgPSBmdW5jdGlvbiAoaXQpIHsKCSAgdmFyIG93biA9IGl0LmZpbGw7CgkgIHJldHVybiBpdCA9PT0gQXJyYXlQcm90b3R5cGUkNiB8fCAoaXNQcm90b3R5cGVPZiQ3KEFycmF5UHJvdG90eXBlJDYsIGl0KSAmJiBvd24gPT09IEFycmF5UHJvdG90eXBlJDYuZmlsbCkgPyBtZXRob2QkNSA6IG93bjsKCX07CgoJdmFyIHBhcmVudCRiID0gZmlsbCQyOwoKCXZhciBmaWxsJDEgPSBwYXJlbnQkYjsKCgl2YXIgZmlsbCA9IGZpbGwkMTsKCgl2YXIgZ2xvYmFsJGcgPSBnbG9iYWwkRzsKCXZhciBhQ2FsbGFibGUkMSA9IGFDYWxsYWJsZSQ0OwoJdmFyIHRvT2JqZWN0JDMgPSB0b09iamVjdCQ5OwoJdmFyIEluZGV4ZWRPYmplY3QgPSBpbmRleGVkT2JqZWN0OwoJdmFyIGxlbmd0aE9mQXJyYXlMaWtlJDQgPSBsZW5ndGhPZkFycmF5TGlrZSQ5OwoKCXZhciBUeXBlRXJyb3IkNiA9IGdsb2JhbCRnLlR5cGVFcnJvcjsKCgkvLyBgQXJyYXkucHJvdG90eXBlLnsgcmVkdWNlLCByZWR1Y2VSaWdodCB9YCBtZXRob2RzIGltcGxlbWVudGF0aW9uCgl2YXIgY3JlYXRlTWV0aG9kJDMgPSBmdW5jdGlvbiAoSVNfUklHSFQpIHsKCSAgcmV0dXJuIGZ1bmN0aW9uICh0aGF0LCBjYWxsYmFja2ZuLCBhcmd1bWVudHNMZW5ndGgsIG1lbW8pIHsKCSAgICBhQ2FsbGFibGUkMShjYWxsYmFja2ZuKTsKCSAgICB2YXIgTyA9IHRvT2JqZWN0JDModGhhdCk7CgkgICAgdmFyIHNlbGYgPSBJbmRleGVkT2JqZWN0KE8pOwoJICAgIHZhciBsZW5ndGggPSBsZW5ndGhPZkFycmF5TGlrZSQ0KE8pOwoJICAgIHZhciBpbmRleCA9IElTX1JJR0hUID8gbGVuZ3RoIC0gMSA6IDA7CgkgICAgdmFyIGkgPSBJU19SSUdIVCA/IC0xIDogMTsKCSAgICBpZiAoYXJndW1lbnRzTGVuZ3RoIDwgMikgd2hpbGUgKHRydWUpIHsKCSAgICAgIGlmIChpbmRleCBpbiBzZWxmKSB7CgkgICAgICAgIG1lbW8gPSBzZWxmW2luZGV4XTsKCSAgICAgICAgaW5kZXggKz0gaTsKCSAgICAgICAgYnJlYWs7CgkgICAgICB9CgkgICAgICBpbmRleCArPSBpOwoJICAgICAgaWYgKElTX1JJR0hUID8gaW5kZXggPCAwIDogbGVuZ3RoIDw9IGluZGV4KSB7CgkgICAgICAgIHRocm93IFR5cGVFcnJvciQ2KCdSZWR1Y2Ugb2YgZW1wdHkgYXJyYXkgd2l0aCBubyBpbml0aWFsIHZhbHVlJyk7CgkgICAgICB9CgkgICAgfQoJICAgIGZvciAoO0lTX1JJR0hUID8gaW5kZXggPj0gMCA6IGxlbmd0aCA+IGluZGV4OyBpbmRleCArPSBpKSBpZiAoaW5kZXggaW4gc2VsZikgewoJICAgICAgbWVtbyA9IGNhbGxiYWNrZm4obWVtbywgc2VsZltpbmRleF0sIGluZGV4LCBPKTsKCSAgICB9CgkgICAgcmV0dXJuIG1lbW87CgkgIH07Cgl9OwoKCXZhciBhcnJheVJlZHVjZSA9IHsKCSAgLy8gYEFycmF5LnByb3RvdHlwZS5yZWR1Y2VgIG1ldGhvZAoJICAvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLWFycmF5LnByb3RvdHlwZS5yZWR1Y2UKCSAgbGVmdDogY3JlYXRlTWV0aG9kJDMoZmFsc2UpLAoJICAvLyBgQXJyYXkucHJvdG90eXBlLnJlZHVjZVJpZ2h0YCBtZXRob2QKCSAgLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1hcnJheS5wcm90b3R5cGUucmVkdWNlcmlnaHQKCSAgcmlnaHQ6IGNyZWF0ZU1ldGhvZCQzKHRydWUpCgl9OwoKCXZhciBjbGFzc29mJDMgPSBjbGFzc29mUmF3JDE7Cgl2YXIgZ2xvYmFsJGYgPSBnbG9iYWwkRzsKCgl2YXIgZW5naW5lSXNOb2RlID0gY2xhc3NvZiQzKGdsb2JhbCRmLnByb2Nlc3MpID09ICdwcm9jZXNzJzsKCgl2YXIgJCQ5ID0gX2V4cG9ydDsKCXZhciAkcmVkdWNlID0gYXJyYXlSZWR1Y2UubGVmdDsKCXZhciBhcnJheU1ldGhvZElzU3RyaWN0ID0gYXJyYXlNZXRob2RJc1N0cmljdCQyOwoJdmFyIENIUk9NRV9WRVJTSU9OID0gZW5naW5lVjhWZXJzaW9uOwoJdmFyIElTX05PREUgPSBlbmdpbmVJc05vZGU7CgoJdmFyIFNUUklDVF9NRVRIT0QgPSBhcnJheU1ldGhvZElzU3RyaWN0KCdyZWR1Y2UnKTsKCS8vIENocm9tZSA4MC04MiBoYXMgYSBjcml0aWNhbCBidWcKCS8vIGh0dHBzOi8vYnVncy5jaHJvbWl1bS5vcmcvcC9jaHJvbWl1bS9pc3N1ZXMvZGV0YWlsP2lkPTEwNDk5ODIKCXZhciBDSFJPTUVfQlVHID0gIUlTX05PREUgJiYgQ0hST01FX1ZFUlNJT04gPiA3OSAmJiBDSFJPTUVfVkVSU0lPTiA8IDgzOwoKCS8vIGBBcnJheS5wcm90b3R5cGUucmVkdWNlYCBtZXRob2QKCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtYXJyYXkucHJvdG90eXBlLnJlZHVjZQoJJCQ5KHsgdGFyZ2V0OiAnQXJyYXknLCBwcm90bzogdHJ1ZSwgZm9yY2VkOiAhU1RSSUNUX01FVEhPRCB8fCBDSFJPTUVfQlVHIH0sIHsKCSAgcmVkdWNlOiBmdW5jdGlvbiByZWR1Y2UoY2FsbGJhY2tmbiAvKiAsIGluaXRpYWxWYWx1ZSAqLykgewoJICAgIHZhciBsZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoOwoJICAgIHJldHVybiAkcmVkdWNlKHRoaXMsIGNhbGxiYWNrZm4sIGxlbmd0aCwgbGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZCk7CgkgIH0KCX0pOwoKCXZhciBlbnRyeVZpcnR1YWwkNCA9IGVudHJ5VmlydHVhbCQ4OwoKCXZhciByZWR1Y2UkMyA9IGVudHJ5VmlydHVhbCQ0KCdBcnJheScpLnJlZHVjZTsKCgl2YXIgaXNQcm90b3R5cGVPZiQ2ID0gb2JqZWN0SXNQcm90b3R5cGVPZjsKCXZhciBtZXRob2QkNCA9IHJlZHVjZSQzOwoKCXZhciBBcnJheVByb3RvdHlwZSQ1ID0gQXJyYXkucHJvdG90eXBlOwoKCXZhciByZWR1Y2UkMiA9IGZ1bmN0aW9uIChpdCkgewoJICB2YXIgb3duID0gaXQucmVkdWNlOwoJICByZXR1cm4gaXQgPT09IEFycmF5UHJvdG90eXBlJDUgfHwgKGlzUHJvdG90eXBlT2YkNihBcnJheVByb3RvdHlwZSQ1LCBpdCkgJiYgb3duID09PSBBcnJheVByb3RvdHlwZSQ1LnJlZHVjZSkgPyBtZXRob2QkNCA6IG93bjsKCX07CgoJdmFyIHBhcmVudCRhID0gcmVkdWNlJDI7CgoJdmFyIHJlZHVjZSQxID0gcGFyZW50JGE7CgoJdmFyIHJlZHVjZSA9IHJlZHVjZSQxOwoKCXZhciAkJDggPSBfZXhwb3J0OwoJdmFyICRtYXAgPSBhcnJheUl0ZXJhdGlvbi5tYXA7Cgl2YXIgYXJyYXlNZXRob2RIYXNTcGVjaWVzU3VwcG9ydCQyID0gYXJyYXlNZXRob2RIYXNTcGVjaWVzU3VwcG9ydCQ0OwoKCXZhciBIQVNfU1BFQ0lFU19TVVBQT1JUJDIgPSBhcnJheU1ldGhvZEhhc1NwZWNpZXNTdXBwb3J0JDIoJ21hcCcpOwoKCS8vIGBBcnJheS5wcm90b3R5cGUubWFwYCBtZXRob2QKCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtYXJyYXkucHJvdG90eXBlLm1hcAoJLy8gd2l0aCBhZGRpbmcgc3VwcG9ydCBvZiBAQHNwZWNpZXMKCSQkOCh7IHRhcmdldDogJ0FycmF5JywgcHJvdG86IHRydWUsIGZvcmNlZDogIUhBU19TUEVDSUVTX1NVUFBPUlQkMiB9LCB7CgkgIG1hcDogZnVuY3Rpb24gbWFwKGNhbGxiYWNrZm4gLyogLCB0aGlzQXJnICovKSB7CgkgICAgcmV0dXJuICRtYXAodGhpcywgY2FsbGJhY2tmbiwgYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQpOwoJICB9Cgl9KTsKCgl2YXIgZW50cnlWaXJ0dWFsJDMgPSBlbnRyeVZpcnR1YWwkODsKCgl2YXIgbWFwJDMgPSBlbnRyeVZpcnR1YWwkMygnQXJyYXknKS5tYXA7CgoJdmFyIGlzUHJvdG90eXBlT2YkNSA9IG9iamVjdElzUHJvdG90eXBlT2Y7Cgl2YXIgbWV0aG9kJDMgPSBtYXAkMzsKCgl2YXIgQXJyYXlQcm90b3R5cGUkNCA9IEFycmF5LnByb3RvdHlwZTsKCgl2YXIgbWFwJDIgPSBmdW5jdGlvbiAoaXQpIHsKCSAgdmFyIG93biA9IGl0Lm1hcDsKCSAgcmV0dXJuIGl0ID09PSBBcnJheVByb3RvdHlwZSQ0IHx8IChpc1Byb3RvdHlwZU9mJDUoQXJyYXlQcm90b3R5cGUkNCwgaXQpICYmIG93biA9PT0gQXJyYXlQcm90b3R5cGUkNC5tYXApID8gbWV0aG9kJDMgOiBvd247Cgl9OwoKCXZhciBwYXJlbnQkOSA9IG1hcCQyOwoKCXZhciBtYXAkMSA9IHBhcmVudCQ5OwoKCXZhciBtYXAgPSBtYXAkMTsKCgl2YXIgZ2xvYmFsJGUgPSBnbG9iYWwkRzsKCXZhciBjbGFzc29mJDIgPSBjbGFzc29mJDk7CgoJdmFyIFN0cmluZyQzID0gZ2xvYmFsJGUuU3RyaW5nOwoKCXZhciB0b1N0cmluZyQ3ID0gZnVuY3Rpb24gKGFyZ3VtZW50KSB7CgkgIGlmIChjbGFzc29mJDIoYXJndW1lbnQpID09PSAnU3ltYm9sJykgdGhyb3cgVHlwZUVycm9yKCdDYW5ub3QgY29udmVydCBhIFN5bWJvbCB2YWx1ZSB0byBhIHN0cmluZycpOwoJICByZXR1cm4gU3RyaW5nJDMoYXJndW1lbnQpOwoJfTsKCgkvLyBhIHN0cmluZyBvZiBhbGwgdmFsaWQgdW5pY29kZSB3aGl0ZXNwYWNlcwoJdmFyIHdoaXRlc3BhY2VzJDUgPSAnXHUwMDA5XHUwMDBBXHUwMDBCXHUwMDBDXHUwMDBEXHUwMDIwXHUwMEEwXHUxNjgwXHUyMDAwXHUyMDAxXHUyMDAyJyArCgkgICdcdTIwMDNcdTIwMDRcdTIwMDVcdTIwMDZcdTIwMDdcdTIwMDhcdTIwMDlcdTIwMEFcdTIwMkZcdTIwNUZcdTMwMDBcdTIwMjhcdTIwMjlcdUZFRkYnOwoKCXZhciB1bmN1cnJ5VGhpcyRiID0gZnVuY3Rpb25VbmN1cnJ5VGhpczsKCXZhciByZXF1aXJlT2JqZWN0Q29lcmNpYmxlJDMgPSByZXF1aXJlT2JqZWN0Q29lcmNpYmxlJDY7Cgl2YXIgdG9TdHJpbmckNiA9IHRvU3RyaW5nJDc7Cgl2YXIgd2hpdGVzcGFjZXMkNCA9IHdoaXRlc3BhY2VzJDU7CgoJdmFyIHJlcGxhY2UkMSA9IHVuY3VycnlUaGlzJGIoJycucmVwbGFjZSk7Cgl2YXIgd2hpdGVzcGFjZSQxID0gJ1snICsgd2hpdGVzcGFjZXMkNCArICddJzsKCXZhciBsdHJpbSQxID0gUmVnRXhwKCdeJyArIHdoaXRlc3BhY2UkMSArIHdoaXRlc3BhY2UkMSArICcqJyk7Cgl2YXIgcnRyaW0kMSA9IFJlZ0V4cCh3aGl0ZXNwYWNlJDEgKyB3aGl0ZXNwYWNlJDEgKyAnKiQnKTsKCgkvLyBgU3RyaW5nLnByb3RvdHlwZS57IHRyaW0sIHRyaW1TdGFydCwgdHJpbUVuZCwgdHJpbUxlZnQsIHRyaW1SaWdodCB9YCBtZXRob2RzIGltcGxlbWVudGF0aW9uCgl2YXIgY3JlYXRlTWV0aG9kJDIgPSBmdW5jdGlvbiAoVFlQRSkgewoJICByZXR1cm4gZnVuY3Rpb24gKCR0aGlzKSB7CgkgICAgdmFyIHN0cmluZyA9IHRvU3RyaW5nJDYocmVxdWlyZU9iamVjdENvZXJjaWJsZSQzKCR0aGlzKSk7CgkgICAgaWYgKFRZUEUgJiAxKSBzdHJpbmcgPSByZXBsYWNlJDEoc3RyaW5nLCBsdHJpbSQxLCAnJyk7CgkgICAgaWYgKFRZUEUgJiAyKSBzdHJpbmcgPSByZXBsYWNlJDEoc3RyaW5nLCBydHJpbSQxLCAnJyk7CgkgICAgcmV0dXJuIHN0cmluZzsKCSAgfTsKCX07CgoJdmFyIHN0cmluZ1RyaW0kMSA9IHsKCSAgLy8gYFN0cmluZy5wcm90b3R5cGUueyB0cmltTGVmdCwgdHJpbVN0YXJ0IH1gIG1ldGhvZHMKCSAgLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1zdHJpbmcucHJvdG90eXBlLnRyaW1zdGFydAoJICBzdGFydDogY3JlYXRlTWV0aG9kJDIoMSksCgkgIC8vIGBTdHJpbmcucHJvdG90eXBlLnsgdHJpbVJpZ2h0LCB0cmltRW5kIH1gIG1ldGhvZHMKCSAgLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1zdHJpbmcucHJvdG90eXBlLnRyaW1lbmQKCSAgZW5kOiBjcmVhdGVNZXRob2QkMigyKSwKCSAgLy8gYFN0cmluZy5wcm90b3R5cGUudHJpbWAgbWV0aG9kCgkgIC8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtc3RyaW5nLnByb3RvdHlwZS50cmltCgkgIHRyaW06IGNyZWF0ZU1ldGhvZCQyKDMpCgl9OwoKCXZhciBnbG9iYWwkZCA9IGdsb2JhbCRHOwoJdmFyIGZhaWxzJDQgPSBmYWlscyRnOwoJdmFyIHVuY3VycnlUaGlzJGEgPSBmdW5jdGlvblVuY3VycnlUaGlzOwoJdmFyIHRvU3RyaW5nJDUgPSB0b1N0cmluZyQ3OwoJdmFyIHRyaW0kMiA9IHN0cmluZ1RyaW0kMS50cmltOwoJdmFyIHdoaXRlc3BhY2VzJDMgPSB3aGl0ZXNwYWNlcyQ1OwoKCXZhciAkcGFyc2VJbnQkMSA9IGdsb2JhbCRkLnBhcnNlSW50OwoJdmFyIFN5bWJvbCQyID0gZ2xvYmFsJGQuU3ltYm9sOwoJdmFyIElURVJBVE9SJDQgPSBTeW1ib2wkMiAmJiBTeW1ib2wkMi5pdGVyYXRvcjsKCXZhciBoZXggPSAvXlsrLV0/MHgvaTsKCXZhciBleGVjID0gdW5jdXJyeVRoaXMkYShoZXguZXhlYyk7Cgl2YXIgRk9SQ0VEJDIgPSAkcGFyc2VJbnQkMSh3aGl0ZXNwYWNlcyQzICsgJzA4JykgIT09IDggfHwgJHBhcnNlSW50JDEod2hpdGVzcGFjZXMkMyArICcweDE2JykgIT09IDIyCgkgIC8vIE1TIEVkZ2UgMTgtIGJyb2tlbiB3aXRoIGJveGVkIHN5bWJvbHMKCSAgfHwgKElURVJBVE9SJDQgJiYgIWZhaWxzJDQoZnVuY3Rpb24gKCkgeyAkcGFyc2VJbnQkMShPYmplY3QoSVRFUkFUT1IkNCkpOyB9KSk7CgoJLy8gYHBhcnNlSW50YCBtZXRob2QKCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtcGFyc2VpbnQtc3RyaW5nLXJhZGl4Cgl2YXIgbnVtYmVyUGFyc2VJbnQgPSBGT1JDRUQkMiA/IGZ1bmN0aW9uIHBhcnNlSW50KHN0cmluZywgcmFkaXgpIHsKCSAgdmFyIFMgPSB0cmltJDIodG9TdHJpbmckNShzdHJpbmcpKTsKCSAgcmV0dXJuICRwYXJzZUludCQxKFMsIChyYWRpeCA+Pj4gMCkgfHwgKGV4ZWMoaGV4LCBTKSA/IDE2IDogMTApKTsKCX0gOiAkcGFyc2VJbnQkMTsKCgl2YXIgJCQ3ID0gX2V4cG9ydDsKCXZhciAkcGFyc2VJbnQgPSBudW1iZXJQYXJzZUludDsKCgkvLyBgcGFyc2VJbnRgIG1ldGhvZAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1wYXJzZWludC1zdHJpbmctcmFkaXgKCSQkNyh7IGdsb2JhbDogdHJ1ZSwgZm9yY2VkOiBwYXJzZUludCAhPSAkcGFyc2VJbnQgfSwgewoJICBwYXJzZUludDogJHBhcnNlSW50Cgl9KTsKCgl2YXIgcGF0aCQ0ID0gcGF0aCQ4OwoKCXZhciBfcGFyc2VJbnQkMiA9IHBhdGgkNC5wYXJzZUludDsKCgl2YXIgcGFyZW50JDggPSBfcGFyc2VJbnQkMjsKCgl2YXIgX3BhcnNlSW50JDEgPSBwYXJlbnQkODsKCgl2YXIgX3BhcnNlSW50ID0gX3BhcnNlSW50JDE7CgoJdmFyICQkNiA9IF9leHBvcnQ7Cgl2YXIgZ2xvYmFsJGMgPSBnbG9iYWwkRzsKCXZhciB0b0Fic29sdXRlSW5kZXgkMiA9IHRvQWJzb2x1dGVJbmRleCQ1OwoJdmFyIHRvSW50ZWdlck9ySW5maW5pdHkkMyA9IHRvSW50ZWdlck9ySW5maW5pdHkkNjsKCXZhciBsZW5ndGhPZkFycmF5TGlrZSQzID0gbGVuZ3RoT2ZBcnJheUxpa2UkOTsKCXZhciB0b09iamVjdCQyID0gdG9PYmplY3QkOTsKCXZhciBhcnJheVNwZWNpZXNDcmVhdGUgPSBhcnJheVNwZWNpZXNDcmVhdGUkMzsKCXZhciBjcmVhdGVQcm9wZXJ0eSQzID0gY3JlYXRlUHJvcGVydHkkNTsKCXZhciBhcnJheU1ldGhvZEhhc1NwZWNpZXNTdXBwb3J0JDEgPSBhcnJheU1ldGhvZEhhc1NwZWNpZXNTdXBwb3J0JDQ7CgoJdmFyIEhBU19TUEVDSUVTX1NVUFBPUlQkMSA9IGFycmF5TWV0aG9kSGFzU3BlY2llc1N1cHBvcnQkMSgnc3BsaWNlJyk7CgoJdmFyIFR5cGVFcnJvciQ1ID0gZ2xvYmFsJGMuVHlwZUVycm9yOwoJdmFyIG1heCQyID0gTWF0aC5tYXg7Cgl2YXIgbWluID0gTWF0aC5taW47Cgl2YXIgTUFYX1NBRkVfSU5URUdFUiA9IDB4MUZGRkZGRkZGRkZGRkY7Cgl2YXIgTUFYSU1VTV9BTExPV0VEX0xFTkdUSF9FWENFRURFRCA9ICdNYXhpbXVtIGFsbG93ZWQgbGVuZ3RoIGV4Y2VlZGVkJzsKCgkvLyBgQXJyYXkucHJvdG90eXBlLnNwbGljZWAgbWV0aG9kCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLWFycmF5LnByb3RvdHlwZS5zcGxpY2UKCS8vIHdpdGggYWRkaW5nIHN1cHBvcnQgb2YgQEBzcGVjaWVzCgkkJDYoeyB0YXJnZXQ6ICdBcnJheScsIHByb3RvOiB0cnVlLCBmb3JjZWQ6ICFIQVNfU1BFQ0lFU19TVVBQT1JUJDEgfSwgewoJICBzcGxpY2U6IGZ1bmN0aW9uIHNwbGljZShzdGFydCwgZGVsZXRlQ291bnQgLyogLCAuLi5pdGVtcyAqLykgewoJICAgIHZhciBPID0gdG9PYmplY3QkMih0aGlzKTsKCSAgICB2YXIgbGVuID0gbGVuZ3RoT2ZBcnJheUxpa2UkMyhPKTsKCSAgICB2YXIgYWN0dWFsU3RhcnQgPSB0b0Fic29sdXRlSW5kZXgkMihzdGFydCwgbGVuKTsKCSAgICB2YXIgYXJndW1lbnRzTGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aDsKCSAgICB2YXIgaW5zZXJ0Q291bnQsIGFjdHVhbERlbGV0ZUNvdW50LCBBLCBrLCBmcm9tLCB0bzsKCSAgICBpZiAoYXJndW1lbnRzTGVuZ3RoID09PSAwKSB7CgkgICAgICBpbnNlcnRDb3VudCA9IGFjdHVhbERlbGV0ZUNvdW50ID0gMDsKCSAgICB9IGVsc2UgaWYgKGFyZ3VtZW50c0xlbmd0aCA9PT0gMSkgewoJICAgICAgaW5zZXJ0Q291bnQgPSAwOwoJICAgICAgYWN0dWFsRGVsZXRlQ291bnQgPSBsZW4gLSBhY3R1YWxTdGFydDsKCSAgICB9IGVsc2UgewoJICAgICAgaW5zZXJ0Q291bnQgPSBhcmd1bWVudHNMZW5ndGggLSAyOwoJICAgICAgYWN0dWFsRGVsZXRlQ291bnQgPSBtaW4obWF4JDIodG9JbnRlZ2VyT3JJbmZpbml0eSQzKGRlbGV0ZUNvdW50KSwgMCksIGxlbiAtIGFjdHVhbFN0YXJ0KTsKCSAgICB9CgkgICAgaWYgKGxlbiArIGluc2VydENvdW50IC0gYWN0dWFsRGVsZXRlQ291bnQgPiBNQVhfU0FGRV9JTlRFR0VSKSB7CgkgICAgICB0aHJvdyBUeXBlRXJyb3IkNShNQVhJTVVNX0FMTE9XRURfTEVOR1RIX0VYQ0VFREVEKTsKCSAgICB9CgkgICAgQSA9IGFycmF5U3BlY2llc0NyZWF0ZShPLCBhY3R1YWxEZWxldGVDb3VudCk7CgkgICAgZm9yIChrID0gMDsgayA8IGFjdHVhbERlbGV0ZUNvdW50OyBrKyspIHsKCSAgICAgIGZyb20gPSBhY3R1YWxTdGFydCArIGs7CgkgICAgICBpZiAoZnJvbSBpbiBPKSBjcmVhdGVQcm9wZXJ0eSQzKEEsIGssIE9bZnJvbV0pOwoJICAgIH0KCSAgICBBLmxlbmd0aCA9IGFjdHVhbERlbGV0ZUNvdW50OwoJICAgIGlmIChpbnNlcnRDb3VudCA8IGFjdHVhbERlbGV0ZUNvdW50KSB7CgkgICAgICBmb3IgKGsgPSBhY3R1YWxTdGFydDsgayA8IGxlbiAtIGFjdHVhbERlbGV0ZUNvdW50OyBrKyspIHsKCSAgICAgICAgZnJvbSA9IGsgKyBhY3R1YWxEZWxldGVDb3VudDsKCSAgICAgICAgdG8gPSBrICsgaW5zZXJ0Q291bnQ7CgkgICAgICAgIGlmIChmcm9tIGluIE8pIE9bdG9dID0gT1tmcm9tXTsKCSAgICAgICAgZWxzZSBkZWxldGUgT1t0b107CgkgICAgICB9CgkgICAgICBmb3IgKGsgPSBsZW47IGsgPiBsZW4gLSBhY3R1YWxEZWxldGVDb3VudCArIGluc2VydENvdW50OyBrLS0pIGRlbGV0ZSBPW2sgLSAxXTsKCSAgICB9IGVsc2UgaWYgKGluc2VydENvdW50ID4gYWN0dWFsRGVsZXRlQ291bnQpIHsKCSAgICAgIGZvciAoayA9IGxlbiAtIGFjdHVhbERlbGV0ZUNvdW50OyBrID4gYWN0dWFsU3RhcnQ7IGstLSkgewoJICAgICAgICBmcm9tID0gayArIGFjdHVhbERlbGV0ZUNvdW50IC0gMTsKCSAgICAgICAgdG8gPSBrICsgaW5zZXJ0Q291bnQgLSAxOwoJICAgICAgICBpZiAoZnJvbSBpbiBPKSBPW3RvXSA9IE9bZnJvbV07CgkgICAgICAgIGVsc2UgZGVsZXRlIE9bdG9dOwoJICAgICAgfQoJICAgIH0KCSAgICBmb3IgKGsgPSAwOyBrIDwgaW5zZXJ0Q291bnQ7IGsrKykgewoJICAgICAgT1trICsgYWN0dWFsU3RhcnRdID0gYXJndW1lbnRzW2sgKyAyXTsKCSAgICB9CgkgICAgTy5sZW5ndGggPSBsZW4gLSBhY3R1YWxEZWxldGVDb3VudCArIGluc2VydENvdW50OwoJICAgIHJldHVybiBBOwoJICB9Cgl9KTsKCgl2YXIgZW50cnlWaXJ0dWFsJDIgPSBlbnRyeVZpcnR1YWwkODsKCgl2YXIgc3BsaWNlJDMgPSBlbnRyeVZpcnR1YWwkMignQXJyYXknKS5zcGxpY2U7CgoJdmFyIGlzUHJvdG90eXBlT2YkNCA9IG9iamVjdElzUHJvdG90eXBlT2Y7Cgl2YXIgbWV0aG9kJDIgPSBzcGxpY2UkMzsKCgl2YXIgQXJyYXlQcm90b3R5cGUkMyA9IEFycmF5LnByb3RvdHlwZTsKCgl2YXIgc3BsaWNlJDIgPSBmdW5jdGlvbiAoaXQpIHsKCSAgdmFyIG93biA9IGl0LnNwbGljZTsKCSAgcmV0dXJuIGl0ID09PSBBcnJheVByb3RvdHlwZSQzIHx8IChpc1Byb3RvdHlwZU9mJDQoQXJyYXlQcm90b3R5cGUkMywgaXQpICYmIG93biA9PT0gQXJyYXlQcm90b3R5cGUkMy5zcGxpY2UpID8gbWV0aG9kJDIgOiBvd247Cgl9OwoKCXZhciBwYXJlbnQkNyA9IHNwbGljZSQyOwoKCXZhciBzcGxpY2UkMSA9IHBhcmVudCQ3OwoKCXZhciBzcGxpY2UgPSBzcGxpY2UkMTsKCgl2YXIgdW5jdXJyeVRoaXMkOSA9IGZ1bmN0aW9uVW5jdXJyeVRoaXM7CgoJdmFyIGFycmF5U2xpY2UkMyA9IHVuY3VycnlUaGlzJDkoW10uc2xpY2UpOwoKCXZhciAkJDUgPSBfZXhwb3J0OwoJdmFyIGdsb2JhbCRiID0gZ2xvYmFsJEc7Cgl2YXIgaXNBcnJheSQyID0gaXNBcnJheSQ1OwoJdmFyIGlzQ29uc3RydWN0b3IkMSA9IGlzQ29uc3RydWN0b3IkMzsKCXZhciBpc09iamVjdCQyID0gaXNPYmplY3QkYTsKCXZhciB0b0Fic29sdXRlSW5kZXgkMSA9IHRvQWJzb2x1dGVJbmRleCQ1OwoJdmFyIGxlbmd0aE9mQXJyYXlMaWtlJDIgPSBsZW5ndGhPZkFycmF5TGlrZSQ5OwoJdmFyIHRvSW5kZXhlZE9iamVjdCQyID0gdG9JbmRleGVkT2JqZWN0JDg7Cgl2YXIgY3JlYXRlUHJvcGVydHkkMiA9IGNyZWF0ZVByb3BlcnR5JDU7Cgl2YXIgd2VsbEtub3duU3ltYm9sJDUgPSB3ZWxsS25vd25TeW1ib2wkZzsKCXZhciBhcnJheU1ldGhvZEhhc1NwZWNpZXNTdXBwb3J0ID0gYXJyYXlNZXRob2RIYXNTcGVjaWVzU3VwcG9ydCQ0OwoJdmFyIHVuJFNsaWNlID0gYXJyYXlTbGljZSQzOwoKCXZhciBIQVNfU1BFQ0lFU19TVVBQT1JUID0gYXJyYXlNZXRob2RIYXNTcGVjaWVzU3VwcG9ydCgnc2xpY2UnKTsKCgl2YXIgU1BFQ0lFUyA9IHdlbGxLbm93blN5bWJvbCQ1KCdzcGVjaWVzJyk7Cgl2YXIgQXJyYXkkMyA9IGdsb2JhbCRiLkFycmF5OwoJdmFyIG1heCQxID0gTWF0aC5tYXg7CgoJLy8gYEFycmF5LnByb3RvdHlwZS5zbGljZWAgbWV0aG9kCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLWFycmF5LnByb3RvdHlwZS5zbGljZQoJLy8gZmFsbGJhY2sgZm9yIG5vdCBhcnJheS1saWtlIEVTMyBzdHJpbmdzIGFuZCBET00gb2JqZWN0cwoJJCQ1KHsgdGFyZ2V0OiAnQXJyYXknLCBwcm90bzogdHJ1ZSwgZm9yY2VkOiAhSEFTX1NQRUNJRVNfU1VQUE9SVCB9LCB7CgkgIHNsaWNlOiBmdW5jdGlvbiBzbGljZShzdGFydCwgZW5kKSB7CgkgICAgdmFyIE8gPSB0b0luZGV4ZWRPYmplY3QkMih0aGlzKTsKCSAgICB2YXIgbGVuZ3RoID0gbGVuZ3RoT2ZBcnJheUxpa2UkMihPKTsKCSAgICB2YXIgayA9IHRvQWJzb2x1dGVJbmRleCQxKHN0YXJ0LCBsZW5ndGgpOwoJICAgIHZhciBmaW4gPSB0b0Fic29sdXRlSW5kZXgkMShlbmQgPT09IHVuZGVmaW5lZCA/IGxlbmd0aCA6IGVuZCwgbGVuZ3RoKTsKCSAgICAvLyBpbmxpbmUgYEFycmF5U3BlY2llc0NyZWF0ZWAgZm9yIHVzYWdlIG5hdGl2ZSBgQXJyYXkjc2xpY2VgIHdoZXJlIGl0J3MgcG9zc2libGUKCSAgICB2YXIgQ29uc3RydWN0b3IsIHJlc3VsdCwgbjsKCSAgICBpZiAoaXNBcnJheSQyKE8pKSB7CgkgICAgICBDb25zdHJ1Y3RvciA9IE8uY29uc3RydWN0b3I7CgkgICAgICAvLyBjcm9zcy1yZWFsbSBmYWxsYmFjawoJICAgICAgaWYgKGlzQ29uc3RydWN0b3IkMShDb25zdHJ1Y3RvcikgJiYgKENvbnN0cnVjdG9yID09PSBBcnJheSQzIHx8IGlzQXJyYXkkMihDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSkgewoJICAgICAgICBDb25zdHJ1Y3RvciA9IHVuZGVmaW5lZDsKCSAgICAgIH0gZWxzZSBpZiAoaXNPYmplY3QkMihDb25zdHJ1Y3RvcikpIHsKCSAgICAgICAgQ29uc3RydWN0b3IgPSBDb25zdHJ1Y3RvcltTUEVDSUVTXTsKCSAgICAgICAgaWYgKENvbnN0cnVjdG9yID09PSBudWxsKSBDb25zdHJ1Y3RvciA9IHVuZGVmaW5lZDsKCSAgICAgIH0KCSAgICAgIGlmIChDb25zdHJ1Y3RvciA9PT0gQXJyYXkkMyB8fCBDb25zdHJ1Y3RvciA9PT0gdW5kZWZpbmVkKSB7CgkgICAgICAgIHJldHVybiB1biRTbGljZShPLCBrLCBmaW4pOwoJICAgICAgfQoJICAgIH0KCSAgICByZXN1bHQgPSBuZXcgKENvbnN0cnVjdG9yID09PSB1bmRlZmluZWQgPyBBcnJheSQzIDogQ29uc3RydWN0b3IpKG1heCQxKGZpbiAtIGssIDApKTsKCSAgICBmb3IgKG4gPSAwOyBrIDwgZmluOyBrKyssIG4rKykgaWYgKGsgaW4gTykgY3JlYXRlUHJvcGVydHkkMihyZXN1bHQsIG4sIE9ba10pOwoJICAgIHJlc3VsdC5sZW5ndGggPSBuOwoJICAgIHJldHVybiByZXN1bHQ7CgkgIH0KCX0pOwoKCXZhciBlbnRyeVZpcnR1YWwkMSA9IGVudHJ5VmlydHVhbCQ4OwoKCXZhciBzbGljZSQzID0gZW50cnlWaXJ0dWFsJDEoJ0FycmF5Jykuc2xpY2U7CgoJdmFyIGlzUHJvdG90eXBlT2YkMyA9IG9iamVjdElzUHJvdG90eXBlT2Y7Cgl2YXIgbWV0aG9kJDEgPSBzbGljZSQzOwoKCXZhciBBcnJheVByb3RvdHlwZSQyID0gQXJyYXkucHJvdG90eXBlOwoKCXZhciBzbGljZSQyID0gZnVuY3Rpb24gKGl0KSB7CgkgIHZhciBvd24gPSBpdC5zbGljZTsKCSAgcmV0dXJuIGl0ID09PSBBcnJheVByb3RvdHlwZSQyIHx8IChpc1Byb3RvdHlwZU9mJDMoQXJyYXlQcm90b3R5cGUkMiwgaXQpICYmIG93biA9PT0gQXJyYXlQcm90b3R5cGUkMi5zbGljZSkgPyBtZXRob2QkMSA6IG93bjsKCX07CgoJdmFyIHBhcmVudCQ2ID0gc2xpY2UkMjsKCgl2YXIgc2xpY2UkMSA9IHBhcmVudCQ2OwoKCXZhciBzbGljZSA9IHNsaWNlJDE7CgoJdmFyIHVuY3VycnlUaGlzJDggPSBmdW5jdGlvblVuY3VycnlUaGlzOwoJdmFyIHRvSW50ZWdlck9ySW5maW5pdHkkMiA9IHRvSW50ZWdlck9ySW5maW5pdHkkNjsKCXZhciB0b1N0cmluZyQ0ID0gdG9TdHJpbmckNzsKCXZhciByZXF1aXJlT2JqZWN0Q29lcmNpYmxlJDIgPSByZXF1aXJlT2JqZWN0Q29lcmNpYmxlJDY7CgoJdmFyIGNoYXJBdCQyID0gdW5jdXJyeVRoaXMkOCgnJy5jaGFyQXQpOwoJdmFyIGNoYXJDb2RlQXQkMSA9IHVuY3VycnlUaGlzJDgoJycuY2hhckNvZGVBdCk7Cgl2YXIgc3RyaW5nU2xpY2UkMSA9IHVuY3VycnlUaGlzJDgoJycuc2xpY2UpOwoKCXZhciBjcmVhdGVNZXRob2QkMSA9IGZ1bmN0aW9uIChDT05WRVJUX1RPX1NUUklORykgewoJICByZXR1cm4gZnVuY3Rpb24gKCR0aGlzLCBwb3MpIHsKCSAgICB2YXIgUyA9IHRvU3RyaW5nJDQocmVxdWlyZU9iamVjdENvZXJjaWJsZSQyKCR0aGlzKSk7CgkgICAgdmFyIHBvc2l0aW9uID0gdG9JbnRlZ2VyT3JJbmZpbml0eSQyKHBvcyk7CgkgICAgdmFyIHNpemUgPSBTLmxlbmd0aDsKCSAgICB2YXIgZmlyc3QsIHNlY29uZDsKCSAgICBpZiAocG9zaXRpb24gPCAwIHx8IHBvc2l0aW9uID49IHNpemUpIHJldHVybiBDT05WRVJUX1RPX1NUUklORyA/ICcnIDogdW5kZWZpbmVkOwoJICAgIGZpcnN0ID0gY2hhckNvZGVBdCQxKFMsIHBvc2l0aW9uKTsKCSAgICByZXR1cm4gZmlyc3QgPCAweEQ4MDAgfHwgZmlyc3QgPiAweERCRkYgfHwgcG9zaXRpb24gKyAxID09PSBzaXplCgkgICAgICB8fCAoc2Vjb25kID0gY2hhckNvZGVBdCQxKFMsIHBvc2l0aW9uICsgMSkpIDwgMHhEQzAwIHx8IHNlY29uZCA+IDB4REZGRgoJICAgICAgICA/IENPTlZFUlRfVE9fU1RSSU5HCgkgICAgICAgICAgPyBjaGFyQXQkMihTLCBwb3NpdGlvbikKCSAgICAgICAgICA6IGZpcnN0CgkgICAgICAgIDogQ09OVkVSVF9UT19TVFJJTkcKCSAgICAgICAgICA/IHN0cmluZ1NsaWNlJDEoUywgcG9zaXRpb24sIHBvc2l0aW9uICsgMikKCSAgICAgICAgICA6IChmaXJzdCAtIDB4RDgwMCA8PCAxMCkgKyAoc2Vjb25kIC0gMHhEQzAwKSArIDB4MTAwMDA7CgkgIH07Cgl9OwoKCXZhciBzdHJpbmdNdWx0aWJ5dGUgPSB7CgkgIC8vIGBTdHJpbmcucHJvdG90eXBlLmNvZGVQb2ludEF0YCBtZXRob2QKCSAgLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1zdHJpbmcucHJvdG90eXBlLmNvZGVwb2ludGF0CgkgIGNvZGVBdDogY3JlYXRlTWV0aG9kJDEoZmFsc2UpLAoJICAvLyBgU3RyaW5nLnByb3RvdHlwZS5hdGAgbWV0aG9kCgkgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9tYXRoaWFzYnluZW5zL1N0cmluZy5wcm90b3R5cGUuYXQKCSAgY2hhckF0OiBjcmVhdGVNZXRob2QkMSh0cnVlKQoJfTsKCgl2YXIgY2hhckF0JDEgPSBzdHJpbmdNdWx0aWJ5dGUuY2hhckF0OwoJdmFyIHRvU3RyaW5nJDMgPSB0b1N0cmluZyQ3OwoJdmFyIEludGVybmFsU3RhdGVNb2R1bGUkMSA9IGludGVybmFsU3RhdGU7Cgl2YXIgZGVmaW5lSXRlcmF0b3IgPSBkZWZpbmVJdGVyYXRvciQyOwoKCXZhciBTVFJJTkdfSVRFUkFUT1IgPSAnU3RyaW5nIEl0ZXJhdG9yJzsKCXZhciBzZXRJbnRlcm5hbFN0YXRlJDEgPSBJbnRlcm5hbFN0YXRlTW9kdWxlJDEuc2V0OwoJdmFyIGdldEludGVybmFsU3RhdGUkMSA9IEludGVybmFsU3RhdGVNb2R1bGUkMS5nZXR0ZXJGb3IoU1RSSU5HX0lURVJBVE9SKTsKCgkvLyBgU3RyaW5nLnByb3RvdHlwZVtAQGl0ZXJhdG9yXWAgbWV0aG9kCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLXN0cmluZy5wcm90b3R5cGUtQEBpdGVyYXRvcgoJZGVmaW5lSXRlcmF0b3IoU3RyaW5nLCAnU3RyaW5nJywgZnVuY3Rpb24gKGl0ZXJhdGVkKSB7CgkgIHNldEludGVybmFsU3RhdGUkMSh0aGlzLCB7CgkgICAgdHlwZTogU1RSSU5HX0lURVJBVE9SLAoJICAgIHN0cmluZzogdG9TdHJpbmckMyhpdGVyYXRlZCksCgkgICAgaW5kZXg6IDAKCSAgfSk7CgkvLyBgJVN0cmluZ0l0ZXJhdG9yUHJvdG90eXBlJS5uZXh0YCBtZXRob2QKCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtJXN0cmluZ2l0ZXJhdG9ycHJvdG90eXBlJS5uZXh0Cgl9LCBmdW5jdGlvbiBuZXh0KCkgewoJICB2YXIgc3RhdGUgPSBnZXRJbnRlcm5hbFN0YXRlJDEodGhpcyk7CgkgIHZhciBzdHJpbmcgPSBzdGF0ZS5zdHJpbmc7CgkgIHZhciBpbmRleCA9IHN0YXRlLmluZGV4OwoJICB2YXIgcG9pbnQ7CgkgIGlmIChpbmRleCA+PSBzdHJpbmcubGVuZ3RoKSByZXR1cm4geyB2YWx1ZTogdW5kZWZpbmVkLCBkb25lOiB0cnVlIH07CgkgIHBvaW50ID0gY2hhckF0JDEoc3RyaW5nLCBpbmRleCk7CgkgIHN0YXRlLmluZGV4ICs9IHBvaW50Lmxlbmd0aDsKCSAgcmV0dXJuIHsgdmFsdWU6IHBvaW50LCBkb25lOiBmYWxzZSB9OwoJfSk7CgoJdmFyIGNhbGwkMyA9IGZ1bmN0aW9uQ2FsbDsKCXZhciBhbk9iamVjdCQ0ID0gYW5PYmplY3QkOTsKCXZhciBnZXRNZXRob2QkMSA9IGdldE1ldGhvZCQzOwoKCXZhciBpdGVyYXRvckNsb3NlJDEgPSBmdW5jdGlvbiAoaXRlcmF0b3IsIGtpbmQsIHZhbHVlKSB7CgkgIHZhciBpbm5lclJlc3VsdCwgaW5uZXJFcnJvcjsKCSAgYW5PYmplY3QkNChpdGVyYXRvcik7CgkgIHRyeSB7CgkgICAgaW5uZXJSZXN1bHQgPSBnZXRNZXRob2QkMShpdGVyYXRvciwgJ3JldHVybicpOwoJICAgIGlmICghaW5uZXJSZXN1bHQpIHsKCSAgICAgIGlmIChraW5kID09PSAndGhyb3cnKSB0aHJvdyB2YWx1ZTsKCSAgICAgIHJldHVybiB2YWx1ZTsKCSAgICB9CgkgICAgaW5uZXJSZXN1bHQgPSBjYWxsJDMoaW5uZXJSZXN1bHQsIGl0ZXJhdG9yKTsKCSAgfSBjYXRjaCAoZXJyb3IpIHsKCSAgICBpbm5lckVycm9yID0gdHJ1ZTsKCSAgICBpbm5lclJlc3VsdCA9IGVycm9yOwoJICB9CgkgIGlmIChraW5kID09PSAndGhyb3cnKSB0aHJvdyB2YWx1ZTsKCSAgaWYgKGlubmVyRXJyb3IpIHRocm93IGlubmVyUmVzdWx0OwoJICBhbk9iamVjdCQ0KGlubmVyUmVzdWx0KTsKCSAgcmV0dXJuIHZhbHVlOwoJfTsKCgl2YXIgYW5PYmplY3QkMyA9IGFuT2JqZWN0JDk7Cgl2YXIgaXRlcmF0b3JDbG9zZSA9IGl0ZXJhdG9yQ2xvc2UkMTsKCgkvLyBjYWxsIHNvbWV0aGluZyBvbiBpdGVyYXRvciBzdGVwIHdpdGggc2FmZSBjbG9zaW5nIG9uIGVycm9yCgl2YXIgY2FsbFdpdGhTYWZlSXRlcmF0aW9uQ2xvc2luZyQxID0gZnVuY3Rpb24gKGl0ZXJhdG9yLCBmbiwgdmFsdWUsIEVOVFJJRVMpIHsKCSAgdHJ5IHsKCSAgICByZXR1cm4gRU5UUklFUyA/IGZuKGFuT2JqZWN0JDModmFsdWUpWzBdLCB2YWx1ZVsxXSkgOiBmbih2YWx1ZSk7CgkgIH0gY2F0Y2ggKGVycm9yKSB7CgkgICAgaXRlcmF0b3JDbG9zZShpdGVyYXRvciwgJ3Rocm93JywgZXJyb3IpOwoJICB9Cgl9OwoKCXZhciB3ZWxsS25vd25TeW1ib2wkNCA9IHdlbGxLbm93blN5bWJvbCRnOwoJdmFyIEl0ZXJhdG9ycyQxID0gaXRlcmF0b3JzOwoKCXZhciBJVEVSQVRPUiQzID0gd2VsbEtub3duU3ltYm9sJDQoJ2l0ZXJhdG9yJyk7Cgl2YXIgQXJyYXlQcm90b3R5cGUkMSA9IEFycmF5LnByb3RvdHlwZTsKCgkvLyBjaGVjayBvbiBkZWZhdWx0IEFycmF5IGl0ZXJhdG9yCgl2YXIgaXNBcnJheUl0ZXJhdG9yTWV0aG9kJDEgPSBmdW5jdGlvbiAoaXQpIHsKCSAgcmV0dXJuIGl0ICE9PSB1bmRlZmluZWQgJiYgKEl0ZXJhdG9ycyQxLkFycmF5ID09PSBpdCB8fCBBcnJheVByb3RvdHlwZSQxW0lURVJBVE9SJDNdID09PSBpdCk7Cgl9OwoKCXZhciBjbGFzc29mJDEgPSBjbGFzc29mJDk7Cgl2YXIgZ2V0TWV0aG9kID0gZ2V0TWV0aG9kJDM7Cgl2YXIgSXRlcmF0b3JzID0gaXRlcmF0b3JzOwoJdmFyIHdlbGxLbm93blN5bWJvbCQzID0gd2VsbEtub3duU3ltYm9sJGc7CgoJdmFyIElURVJBVE9SJDIgPSB3ZWxsS25vd25TeW1ib2wkMygnaXRlcmF0b3InKTsKCgl2YXIgZ2V0SXRlcmF0b3JNZXRob2QkNiA9IGZ1bmN0aW9uIChpdCkgewoJICBpZiAoaXQgIT0gdW5kZWZpbmVkKSByZXR1cm4gZ2V0TWV0aG9kKGl0LCBJVEVSQVRPUiQyKQoJICAgIHx8IGdldE1ldGhvZChpdCwgJ0BAaXRlcmF0b3InKQoJICAgIHx8IEl0ZXJhdG9yc1tjbGFzc29mJDEoaXQpXTsKCX07CgoJdmFyIGdsb2JhbCRhID0gZ2xvYmFsJEc7Cgl2YXIgY2FsbCQyID0gZnVuY3Rpb25DYWxsOwoJdmFyIGFDYWxsYWJsZSA9IGFDYWxsYWJsZSQ0OwoJdmFyIGFuT2JqZWN0JDIgPSBhbk9iamVjdCQ5OwoJdmFyIHRyeVRvU3RyaW5nID0gdHJ5VG9TdHJpbmckMjsKCXZhciBnZXRJdGVyYXRvck1ldGhvZCQ1ID0gZ2V0SXRlcmF0b3JNZXRob2QkNjsKCgl2YXIgVHlwZUVycm9yJDQgPSBnbG9iYWwkYS5UeXBlRXJyb3I7CgoJdmFyIGdldEl0ZXJhdG9yJDEgPSBmdW5jdGlvbiAoYXJndW1lbnQsIHVzaW5nSXRlcmF0b3IpIHsKCSAgdmFyIGl0ZXJhdG9yTWV0aG9kID0gYXJndW1lbnRzLmxlbmd0aCA8IDIgPyBnZXRJdGVyYXRvck1ldGhvZCQ1KGFyZ3VtZW50KSA6IHVzaW5nSXRlcmF0b3I7CgkgIGlmIChhQ2FsbGFibGUoaXRlcmF0b3JNZXRob2QpKSByZXR1cm4gYW5PYmplY3QkMihjYWxsJDIoaXRlcmF0b3JNZXRob2QsIGFyZ3VtZW50KSk7CgkgIHRocm93IFR5cGVFcnJvciQ0KHRyeVRvU3RyaW5nKGFyZ3VtZW50KSArICcgaXMgbm90IGl0ZXJhYmxlJyk7Cgl9OwoKCXZhciBnbG9iYWwkOSA9IGdsb2JhbCRHOwoJdmFyIGJpbmQgPSBmdW5jdGlvbkJpbmRDb250ZXh0OwoJdmFyIGNhbGwkMSA9IGZ1bmN0aW9uQ2FsbDsKCXZhciB0b09iamVjdCQxID0gdG9PYmplY3QkOTsKCXZhciBjYWxsV2l0aFNhZmVJdGVyYXRpb25DbG9zaW5nID0gY2FsbFdpdGhTYWZlSXRlcmF0aW9uQ2xvc2luZyQxOwoJdmFyIGlzQXJyYXlJdGVyYXRvck1ldGhvZCA9IGlzQXJyYXlJdGVyYXRvck1ldGhvZCQxOwoJdmFyIGlzQ29uc3RydWN0b3IgPSBpc0NvbnN0cnVjdG9yJDM7Cgl2YXIgbGVuZ3RoT2ZBcnJheUxpa2UkMSA9IGxlbmd0aE9mQXJyYXlMaWtlJDk7Cgl2YXIgY3JlYXRlUHJvcGVydHkkMSA9IGNyZWF0ZVByb3BlcnR5JDU7Cgl2YXIgZ2V0SXRlcmF0b3IgPSBnZXRJdGVyYXRvciQxOwoJdmFyIGdldEl0ZXJhdG9yTWV0aG9kJDQgPSBnZXRJdGVyYXRvck1ldGhvZCQ2OwoKCXZhciBBcnJheSQyID0gZ2xvYmFsJDkuQXJyYXk7CgoJLy8gYEFycmF5LmZyb21gIG1ldGhvZCBpbXBsZW1lbnRhdGlvbgoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1hcnJheS5mcm9tCgl2YXIgYXJyYXlGcm9tID0gZnVuY3Rpb24gZnJvbShhcnJheUxpa2UgLyogLCBtYXBmbiA9IHVuZGVmaW5lZCwgdGhpc0FyZyA9IHVuZGVmaW5lZCAqLykgewoJICB2YXIgTyA9IHRvT2JqZWN0JDEoYXJyYXlMaWtlKTsKCSAgdmFyIElTX0NPTlNUUlVDVE9SID0gaXNDb25zdHJ1Y3Rvcih0aGlzKTsKCSAgdmFyIGFyZ3VtZW50c0xlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGg7CgkgIHZhciBtYXBmbiA9IGFyZ3VtZW50c0xlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQ7CgkgIHZhciBtYXBwaW5nID0gbWFwZm4gIT09IHVuZGVmaW5lZDsKCSAgaWYgKG1hcHBpbmcpIG1hcGZuID0gYmluZChtYXBmbiwgYXJndW1lbnRzTGVuZ3RoID4gMiA/IGFyZ3VtZW50c1syXSA6IHVuZGVmaW5lZCk7CgkgIHZhciBpdGVyYXRvck1ldGhvZCA9IGdldEl0ZXJhdG9yTWV0aG9kJDQoTyk7CgkgIHZhciBpbmRleCA9IDA7CgkgIHZhciBsZW5ndGgsIHJlc3VsdCwgc3RlcCwgaXRlcmF0b3IsIG5leHQsIHZhbHVlOwoJICAvLyBpZiB0aGUgdGFyZ2V0IGlzIG5vdCBpdGVyYWJsZSBvciBpdCdzIGFuIGFycmF5IHdpdGggdGhlIGRlZmF1bHQgaXRlcmF0b3IgLSB1c2UgYSBzaW1wbGUgY2FzZQoJICBpZiAoaXRlcmF0b3JNZXRob2QgJiYgISh0aGlzID09IEFycmF5JDIgJiYgaXNBcnJheUl0ZXJhdG9yTWV0aG9kKGl0ZXJhdG9yTWV0aG9kKSkpIHsKCSAgICBpdGVyYXRvciA9IGdldEl0ZXJhdG9yKE8sIGl0ZXJhdG9yTWV0aG9kKTsKCSAgICBuZXh0ID0gaXRlcmF0b3IubmV4dDsKCSAgICByZXN1bHQgPSBJU19DT05TVFJVQ1RPUiA/IG5ldyB0aGlzKCkgOiBbXTsKCSAgICBmb3IgKDshKHN0ZXAgPSBjYWxsJDEobmV4dCwgaXRlcmF0b3IpKS5kb25lOyBpbmRleCsrKSB7CgkgICAgICB2YWx1ZSA9IG1hcHBpbmcgPyBjYWxsV2l0aFNhZmVJdGVyYXRpb25DbG9zaW5nKGl0ZXJhdG9yLCBtYXBmbiwgW3N0ZXAudmFsdWUsIGluZGV4XSwgdHJ1ZSkgOiBzdGVwLnZhbHVlOwoJICAgICAgY3JlYXRlUHJvcGVydHkkMShyZXN1bHQsIGluZGV4LCB2YWx1ZSk7CgkgICAgfQoJICB9IGVsc2UgewoJICAgIGxlbmd0aCA9IGxlbmd0aE9mQXJyYXlMaWtlJDEoTyk7CgkgICAgcmVzdWx0ID0gSVNfQ09OU1RSVUNUT1IgPyBuZXcgdGhpcyhsZW5ndGgpIDogQXJyYXkkMihsZW5ndGgpOwoJICAgIGZvciAoO2xlbmd0aCA+IGluZGV4OyBpbmRleCsrKSB7CgkgICAgICB2YWx1ZSA9IG1hcHBpbmcgPyBtYXBmbihPW2luZGV4XSwgaW5kZXgpIDogT1tpbmRleF07CgkgICAgICBjcmVhdGVQcm9wZXJ0eSQxKHJlc3VsdCwgaW5kZXgsIHZhbHVlKTsKCSAgICB9CgkgIH0KCSAgcmVzdWx0Lmxlbmd0aCA9IGluZGV4OwoJICByZXR1cm4gcmVzdWx0OwoJfTsKCgl2YXIgd2VsbEtub3duU3ltYm9sJDIgPSB3ZWxsS25vd25TeW1ib2wkZzsKCgl2YXIgSVRFUkFUT1IkMSA9IHdlbGxLbm93blN5bWJvbCQyKCdpdGVyYXRvcicpOwoJdmFyIFNBRkVfQ0xPU0lORyA9IGZhbHNlOwoKCXRyeSB7CgkgIHZhciBjYWxsZWQgPSAwOwoJICB2YXIgaXRlcmF0b3JXaXRoUmV0dXJuID0gewoJICAgIG5leHQ6IGZ1bmN0aW9uICgpIHsKCSAgICAgIHJldHVybiB7IGRvbmU6ICEhY2FsbGVkKysgfTsKCSAgICB9LAoJICAgICdyZXR1cm4nOiBmdW5jdGlvbiAoKSB7CgkgICAgICBTQUZFX0NMT1NJTkcgPSB0cnVlOwoJICAgIH0KCSAgfTsKCSAgaXRlcmF0b3JXaXRoUmV0dXJuW0lURVJBVE9SJDFdID0gZnVuY3Rpb24gKCkgewoJICAgIHJldHVybiB0aGlzOwoJICB9OwoJICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZXMvbm8tYXJyYXktZnJvbSwgbm8tdGhyb3ctbGl0ZXJhbCAtLSByZXF1aXJlZCBmb3IgdGVzdGluZwoJICBBcnJheS5mcm9tKGl0ZXJhdG9yV2l0aFJldHVybiwgZnVuY3Rpb24gKCkgeyB0aHJvdyAyOyB9KTsKCX0gY2F0Y2ggKGVycm9yKSB7IC8qIGVtcHR5ICovIH0KCgl2YXIgY2hlY2tDb3JyZWN0bmVzc09mSXRlcmF0aW9uJDEgPSBmdW5jdGlvbiAoZXhlYywgU0tJUF9DTE9TSU5HKSB7CgkgIGlmICghU0tJUF9DTE9TSU5HICYmICFTQUZFX0NMT1NJTkcpIHJldHVybiBmYWxzZTsKCSAgdmFyIElURVJBVElPTl9TVVBQT1JUID0gZmFsc2U7CgkgIHRyeSB7CgkgICAgdmFyIG9iamVjdCA9IHt9OwoJICAgIG9iamVjdFtJVEVSQVRPUiQxXSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgIHJldHVybiB7CgkgICAgICAgIG5leHQ6IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICByZXR1cm4geyBkb25lOiBJVEVSQVRJT05fU1VQUE9SVCA9IHRydWUgfTsKCSAgICAgICAgfQoJICAgICAgfTsKCSAgICB9OwoJICAgIGV4ZWMob2JqZWN0KTsKCSAgfSBjYXRjaCAoZXJyb3IpIHsgLyogZW1wdHkgKi8gfQoJICByZXR1cm4gSVRFUkFUSU9OX1NVUFBPUlQ7Cgl9OwoKCXZhciAkJDQgPSBfZXhwb3J0OwoJdmFyIGZyb20kMyA9IGFycmF5RnJvbTsKCXZhciBjaGVja0NvcnJlY3RuZXNzT2ZJdGVyYXRpb24gPSBjaGVja0NvcnJlY3RuZXNzT2ZJdGVyYXRpb24kMTsKCgl2YXIgSU5DT1JSRUNUX0lURVJBVElPTiA9ICFjaGVja0NvcnJlY3RuZXNzT2ZJdGVyYXRpb24oZnVuY3Rpb24gKGl0ZXJhYmxlKSB7CgkgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBlcy9uby1hcnJheS1mcm9tIC0tIHJlcXVpcmVkIGZvciB0ZXN0aW5nCgkgIEFycmF5LmZyb20oaXRlcmFibGUpOwoJfSk7CgoJLy8gYEFycmF5LmZyb21gIG1ldGhvZAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1hcnJheS5mcm9tCgkkJDQoeyB0YXJnZXQ6ICdBcnJheScsIHN0YXQ6IHRydWUsIGZvcmNlZDogSU5DT1JSRUNUX0lURVJBVElPTiB9LCB7CgkgIGZyb206IGZyb20kMwoJfSk7CgoJdmFyIHBhdGgkMyA9IHBhdGgkODsKCgl2YXIgZnJvbSQyID0gcGF0aCQzLkFycmF5LmZyb207CgoJdmFyIHBhcmVudCQ1ID0gZnJvbSQyOwoKCXZhciBmcm9tJDEgPSBwYXJlbnQkNTsKCgl2YXIgZnJvbSA9IGZyb20kMTsKCgl2YXIgb2JqZWN0R2V0T3duUHJvcGVydHlOYW1lcyA9IHt9OwoKCXZhciBpbnRlcm5hbE9iamVjdEtleXMgPSBvYmplY3RLZXlzSW50ZXJuYWw7Cgl2YXIgZW51bUJ1Z0tleXMgPSBlbnVtQnVnS2V5cyQzOwoKCXZhciBoaWRkZW5LZXlzJDEgPSBlbnVtQnVnS2V5cy5jb25jYXQoJ2xlbmd0aCcsICdwcm90b3R5cGUnKTsKCgkvLyBgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXNgIG1ldGhvZAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1vYmplY3QuZ2V0b3ducHJvcGVydHluYW1lcwoJLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGVzL25vLW9iamVjdC1nZXRvd25wcm9wZXJ0eW5hbWVzIC0tIHNhZmUKCW9iamVjdEdldE93blByb3BlcnR5TmFtZXMuZiA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzIHx8IGZ1bmN0aW9uIGdldE93blByb3BlcnR5TmFtZXMoTykgewoJICByZXR1cm4gaW50ZXJuYWxPYmplY3RLZXlzKE8sIGhpZGRlbktleXMkMSk7Cgl9OwoKCXZhciBvYmplY3RHZXRPd25Qcm9wZXJ0eU5hbWVzRXh0ZXJuYWwgPSB7fTsKCgl2YXIgZ2xvYmFsJDggPSBnbG9iYWwkRzsKCXZhciB0b0Fic29sdXRlSW5kZXggPSB0b0Fic29sdXRlSW5kZXgkNTsKCXZhciBsZW5ndGhPZkFycmF5TGlrZSA9IGxlbmd0aE9mQXJyYXlMaWtlJDk7Cgl2YXIgY3JlYXRlUHJvcGVydHkgPSBjcmVhdGVQcm9wZXJ0eSQ1OwoKCXZhciBBcnJheSQxID0gZ2xvYmFsJDguQXJyYXk7Cgl2YXIgbWF4ID0gTWF0aC5tYXg7CgoJdmFyIGFycmF5U2xpY2VTaW1wbGUgPSBmdW5jdGlvbiAoTywgc3RhcnQsIGVuZCkgewoJICB2YXIgbGVuZ3RoID0gbGVuZ3RoT2ZBcnJheUxpa2UoTyk7CgkgIHZhciBrID0gdG9BYnNvbHV0ZUluZGV4KHN0YXJ0LCBsZW5ndGgpOwoJICB2YXIgZmluID0gdG9BYnNvbHV0ZUluZGV4KGVuZCA9PT0gdW5kZWZpbmVkID8gbGVuZ3RoIDogZW5kLCBsZW5ndGgpOwoJICB2YXIgcmVzdWx0ID0gQXJyYXkkMShtYXgoZmluIC0gaywgMCkpOwoJICBmb3IgKHZhciBuID0gMDsgayA8IGZpbjsgaysrLCBuKyspIGNyZWF0ZVByb3BlcnR5KHJlc3VsdCwgbiwgT1trXSk7CgkgIHJlc3VsdC5sZW5ndGggPSBuOwoJICByZXR1cm4gcmVzdWx0OwoJfTsKCgkvKiBlc2xpbnQtZGlzYWJsZSBlcy9uby1vYmplY3QtZ2V0b3ducHJvcGVydHluYW1lcyAtLSBzYWZlICovCgoJdmFyIGNsYXNzb2YgPSBjbGFzc29mUmF3JDE7Cgl2YXIgdG9JbmRleGVkT2JqZWN0JDEgPSB0b0luZGV4ZWRPYmplY3QkODsKCXZhciAkZ2V0T3duUHJvcGVydHlOYW1lcyQxID0gb2JqZWN0R2V0T3duUHJvcGVydHlOYW1lcy5mOwoJdmFyIGFycmF5U2xpY2UkMiA9IGFycmF5U2xpY2VTaW1wbGU7CgoJdmFyIHdpbmRvd05hbWVzID0gdHlwZW9mIHdpbmRvdyA9PSAnb2JqZWN0JyAmJiB3aW5kb3cgJiYgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMKCSAgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh3aW5kb3cpIDogW107CgoJdmFyIGdldFdpbmRvd05hbWVzID0gZnVuY3Rpb24gKGl0KSB7CgkgIHRyeSB7CgkgICAgcmV0dXJuICRnZXRPd25Qcm9wZXJ0eU5hbWVzJDEoaXQpOwoJICB9IGNhdGNoIChlcnJvcikgewoJICAgIHJldHVybiBhcnJheVNsaWNlJDIod2luZG93TmFtZXMpOwoJICB9Cgl9OwoKCS8vIGZhbGxiYWNrIGZvciBJRTExIGJ1Z2d5IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzIHdpdGggaWZyYW1lIGFuZCB3aW5kb3cKCW9iamVjdEdldE93blByb3BlcnR5TmFtZXNFeHRlcm5hbC5mID0gZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlOYW1lcyhpdCkgewoJICByZXR1cm4gd2luZG93TmFtZXMgJiYgY2xhc3NvZihpdCkgPT0gJ1dpbmRvdycKCSAgICA/IGdldFdpbmRvd05hbWVzKGl0KQoJICAgIDogJGdldE93blByb3BlcnR5TmFtZXMkMSh0b0luZGV4ZWRPYmplY3QkMShpdCkpOwoJfTsKCgl2YXIgb2JqZWN0R2V0T3duUHJvcGVydHlTeW1ib2xzID0ge307CgoJLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGVzL25vLW9iamVjdC1nZXRvd25wcm9wZXJ0eXN5bWJvbHMgLS0gc2FmZQoJb2JqZWN0R2V0T3duUHJvcGVydHlTeW1ib2xzLmYgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzOwoKCXZhciB3ZWxsS25vd25TeW1ib2xXcmFwcGVkID0ge307CgoJdmFyIHdlbGxLbm93blN5bWJvbCQxID0gd2VsbEtub3duU3ltYm9sJGc7CgoJd2VsbEtub3duU3ltYm9sV3JhcHBlZC5mID0gd2VsbEtub3duU3ltYm9sJDE7CgoJdmFyIHBhdGgkMiA9IHBhdGgkODsKCXZhciBoYXNPd24kMiA9IGhhc093blByb3BlcnR5XzE7Cgl2YXIgd3JhcHBlZFdlbGxLbm93blN5bWJvbE1vZHVsZSQxID0gd2VsbEtub3duU3ltYm9sV3JhcHBlZDsKCXZhciBkZWZpbmVQcm9wZXJ0eSQxID0gb2JqZWN0RGVmaW5lUHJvcGVydHkuZjsKCgl2YXIgZGVmaW5lV2VsbEtub3duU3ltYm9sJGUgPSBmdW5jdGlvbiAoTkFNRSkgewoJICB2YXIgU3ltYm9sID0gcGF0aCQyLlN5bWJvbCB8fCAocGF0aCQyLlN5bWJvbCA9IHt9KTsKCSAgaWYgKCFoYXNPd24kMihTeW1ib2wsIE5BTUUpKSBkZWZpbmVQcm9wZXJ0eSQxKFN5bWJvbCwgTkFNRSwgewoJICAgIHZhbHVlOiB3cmFwcGVkV2VsbEtub3duU3ltYm9sTW9kdWxlJDEuZihOQU1FKQoJICB9KTsKCX07CgoJdmFyICQkMyA9IF9leHBvcnQ7Cgl2YXIgZ2xvYmFsJDcgPSBnbG9iYWwkRzsKCXZhciBnZXRCdWlsdEluID0gZ2V0QnVpbHRJbiQ1OwoJdmFyIGFwcGx5ID0gZnVuY3Rpb25BcHBseTsKCXZhciBjYWxsID0gZnVuY3Rpb25DYWxsOwoJdmFyIHVuY3VycnlUaGlzJDcgPSBmdW5jdGlvblVuY3VycnlUaGlzOwoJdmFyIERFU0NSSVBUT1JTJDEgPSBkZXNjcmlwdG9yczsKCXZhciBOQVRJVkVfU1lNQk9MID0gbmF0aXZlU3ltYm9sOwoJdmFyIGZhaWxzJDMgPSBmYWlscyRnOwoJdmFyIGhhc093biQxID0gaGFzT3duUHJvcGVydHlfMTsKCXZhciBpc0FycmF5JDEgPSBpc0FycmF5JDU7Cgl2YXIgaXNDYWxsYWJsZSQyID0gaXNDYWxsYWJsZSRoOwoJdmFyIGlzT2JqZWN0JDEgPSBpc09iamVjdCRhOwoJdmFyIGlzUHJvdG90eXBlT2YkMiA9IG9iamVjdElzUHJvdG90eXBlT2Y7Cgl2YXIgaXNTeW1ib2wkMSA9IGlzU3ltYm9sJDQ7Cgl2YXIgYW5PYmplY3QkMSA9IGFuT2JqZWN0JDk7Cgl2YXIgdG9PYmplY3QgPSB0b09iamVjdCQ5OwoJdmFyIHRvSW5kZXhlZE9iamVjdCA9IHRvSW5kZXhlZE9iamVjdCQ4OwoJdmFyIHRvUHJvcGVydHlLZXkgPSB0b1Byb3BlcnR5S2V5JDQ7Cgl2YXIgJHRvU3RyaW5nID0gdG9TdHJpbmckNzsKCXZhciBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IgPSBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IkNTsKCXZhciBuYXRpdmVPYmplY3RDcmVhdGUgPSBvYmplY3RDcmVhdGU7Cgl2YXIgb2JqZWN0S2V5cyA9IG9iamVjdEtleXMkMjsKCXZhciBnZXRPd25Qcm9wZXJ0eU5hbWVzTW9kdWxlID0gb2JqZWN0R2V0T3duUHJvcGVydHlOYW1lczsKCXZhciBnZXRPd25Qcm9wZXJ0eU5hbWVzRXh0ZXJuYWwgPSBvYmplY3RHZXRPd25Qcm9wZXJ0eU5hbWVzRXh0ZXJuYWw7Cgl2YXIgZ2V0T3duUHJvcGVydHlTeW1ib2xzTW9kdWxlID0gb2JqZWN0R2V0T3duUHJvcGVydHlTeW1ib2xzOwoJdmFyIGdldE93blByb3BlcnR5RGVzY3JpcHRvck1vZHVsZSA9IG9iamVjdEdldE93blByb3BlcnR5RGVzY3JpcHRvcjsKCXZhciBkZWZpbmVQcm9wZXJ0eU1vZHVsZSA9IG9iamVjdERlZmluZVByb3BlcnR5OwoJdmFyIHByb3BlcnR5SXNFbnVtZXJhYmxlTW9kdWxlID0gb2JqZWN0UHJvcGVydHlJc0VudW1lcmFibGU7Cgl2YXIgYXJyYXlTbGljZSQxID0gYXJyYXlTbGljZSQzOwoJdmFyIHJlZGVmaW5lJDEgPSByZWRlZmluZSQ0OwoJdmFyIHNoYXJlZCA9IHNoYXJlZCQ0LmV4cG9ydHM7Cgl2YXIgc2hhcmVkS2V5ID0gc2hhcmVkS2V5JDQ7Cgl2YXIgaGlkZGVuS2V5cyA9IGhpZGRlbktleXMkNTsKCXZhciB1aWQgPSB1aWQkMzsKCXZhciB3ZWxsS25vd25TeW1ib2wgPSB3ZWxsS25vd25TeW1ib2wkZzsKCXZhciB3cmFwcGVkV2VsbEtub3duU3ltYm9sTW9kdWxlID0gd2VsbEtub3duU3ltYm9sV3JhcHBlZDsKCXZhciBkZWZpbmVXZWxsS25vd25TeW1ib2wkZCA9IGRlZmluZVdlbGxLbm93blN5bWJvbCRlOwoJdmFyIHNldFRvU3RyaW5nVGFnJDEgPSBzZXRUb1N0cmluZ1RhZyQ0OwoJdmFyIEludGVybmFsU3RhdGVNb2R1bGUgPSBpbnRlcm5hbFN0YXRlOwoJdmFyICRmb3JFYWNoID0gYXJyYXlJdGVyYXRpb24uZm9yRWFjaDsKCgl2YXIgSElEREVOID0gc2hhcmVkS2V5KCdoaWRkZW4nKTsKCXZhciBTWU1CT0wgPSAnU3ltYm9sJzsKCXZhciBQUk9UT1RZUEUgPSAncHJvdG90eXBlJzsKCXZhciBUT19QUklNSVRJVkUgPSB3ZWxsS25vd25TeW1ib2woJ3RvUHJpbWl0aXZlJyk7CgoJdmFyIHNldEludGVybmFsU3RhdGUgPSBJbnRlcm5hbFN0YXRlTW9kdWxlLnNldDsKCXZhciBnZXRJbnRlcm5hbFN0YXRlID0gSW50ZXJuYWxTdGF0ZU1vZHVsZS5nZXR0ZXJGb3IoU1lNQk9MKTsKCgl2YXIgT2JqZWN0UHJvdG90eXBlID0gT2JqZWN0W1BST1RPVFlQRV07Cgl2YXIgJFN5bWJvbCA9IGdsb2JhbCQ3LlN5bWJvbDsKCXZhciBTeW1ib2xQcm90b3R5cGUgPSAkU3ltYm9sICYmICRTeW1ib2xbUFJPVE9UWVBFXTsKCXZhciBUeXBlRXJyb3IkMyA9IGdsb2JhbCQ3LlR5cGVFcnJvcjsKCXZhciBRT2JqZWN0ID0gZ2xvYmFsJDcuUU9iamVjdDsKCXZhciAkc3RyaW5naWZ5ID0gZ2V0QnVpbHRJbignSlNPTicsICdzdHJpbmdpZnknKTsKCXZhciBuYXRpdmVHZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPSBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JNb2R1bGUuZjsKCXZhciBuYXRpdmVEZWZpbmVQcm9wZXJ0eSA9IGRlZmluZVByb3BlcnR5TW9kdWxlLmY7Cgl2YXIgbmF0aXZlR2V0T3duUHJvcGVydHlOYW1lcyA9IGdldE93blByb3BlcnR5TmFtZXNFeHRlcm5hbC5mOwoJdmFyIG5hdGl2ZVByb3BlcnR5SXNFbnVtZXJhYmxlID0gcHJvcGVydHlJc0VudW1lcmFibGVNb2R1bGUuZjsKCXZhciBwdXNoID0gdW5jdXJyeVRoaXMkNyhbXS5wdXNoKTsKCgl2YXIgQWxsU3ltYm9scyA9IHNoYXJlZCgnc3ltYm9scycpOwoJdmFyIE9iamVjdFByb3RvdHlwZVN5bWJvbHMgPSBzaGFyZWQoJ29wLXN5bWJvbHMnKTsKCXZhciBTdHJpbmdUb1N5bWJvbFJlZ2lzdHJ5ID0gc2hhcmVkKCdzdHJpbmctdG8tc3ltYm9sLXJlZ2lzdHJ5Jyk7Cgl2YXIgU3ltYm9sVG9TdHJpbmdSZWdpc3RyeSA9IHNoYXJlZCgnc3ltYm9sLXRvLXN0cmluZy1yZWdpc3RyeScpOwoJdmFyIFdlbGxLbm93blN5bWJvbHNTdG9yZSA9IHNoYXJlZCgnd2tzJyk7CgoJLy8gRG9uJ3QgdXNlIHNldHRlcnMgaW4gUXQgU2NyaXB0LCBodHRwczovL2dpdGh1Yi5jb20vemxvaXJvY2svY29yZS1qcy9pc3N1ZXMvMTczCgl2YXIgVVNFX1NFVFRFUiA9ICFRT2JqZWN0IHx8ICFRT2JqZWN0W1BST1RPVFlQRV0gfHwgIVFPYmplY3RbUFJPVE9UWVBFXS5maW5kQ2hpbGQ7CgoJLy8gZmFsbGJhY2sgZm9yIG9sZCBBbmRyb2lkLCBodHRwczovL2NvZGUuZ29vZ2xlLmNvbS9wL3Y4L2lzc3Vlcy9kZXRhaWw/aWQ9Njg3Cgl2YXIgc2V0U3ltYm9sRGVzY3JpcHRvciA9IERFU0NSSVBUT1JTJDEgJiYgZmFpbHMkMyhmdW5jdGlvbiAoKSB7CgkgIHJldHVybiBuYXRpdmVPYmplY3RDcmVhdGUobmF0aXZlRGVmaW5lUHJvcGVydHkoe30sICdhJywgewoJICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gbmF0aXZlRGVmaW5lUHJvcGVydHkodGhpcywgJ2EnLCB7IHZhbHVlOiA3IH0pLmE7IH0KCSAgfSkpLmEgIT0gNzsKCX0pID8gZnVuY3Rpb24gKE8sIFAsIEF0dHJpYnV0ZXMpIHsKCSAgdmFyIE9iamVjdFByb3RvdHlwZURlc2NyaXB0b3IgPSBuYXRpdmVHZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoT2JqZWN0UHJvdG90eXBlLCBQKTsKCSAgaWYgKE9iamVjdFByb3RvdHlwZURlc2NyaXB0b3IpIGRlbGV0ZSBPYmplY3RQcm90b3R5cGVbUF07CgkgIG5hdGl2ZURlZmluZVByb3BlcnR5KE8sIFAsIEF0dHJpYnV0ZXMpOwoJICBpZiAoT2JqZWN0UHJvdG90eXBlRGVzY3JpcHRvciAmJiBPICE9PSBPYmplY3RQcm90b3R5cGUpIHsKCSAgICBuYXRpdmVEZWZpbmVQcm9wZXJ0eShPYmplY3RQcm90b3R5cGUsIFAsIE9iamVjdFByb3RvdHlwZURlc2NyaXB0b3IpOwoJICB9Cgl9IDogbmF0aXZlRGVmaW5lUHJvcGVydHk7CgoJdmFyIHdyYXAgPSBmdW5jdGlvbiAodGFnLCBkZXNjcmlwdGlvbikgewoJICB2YXIgc3ltYm9sID0gQWxsU3ltYm9sc1t0YWddID0gbmF0aXZlT2JqZWN0Q3JlYXRlKFN5bWJvbFByb3RvdHlwZSk7CgkgIHNldEludGVybmFsU3RhdGUoc3ltYm9sLCB7CgkgICAgdHlwZTogU1lNQk9MLAoJICAgIHRhZzogdGFnLAoJICAgIGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbgoJICB9KTsKCSAgaWYgKCFERVNDUklQVE9SUyQxKSBzeW1ib2wuZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbjsKCSAgcmV0dXJuIHN5bWJvbDsKCX07CgoJdmFyICRkZWZpbmVQcm9wZXJ0eSA9IGZ1bmN0aW9uIGRlZmluZVByb3BlcnR5KE8sIFAsIEF0dHJpYnV0ZXMpIHsKCSAgaWYgKE8gPT09IE9iamVjdFByb3RvdHlwZSkgJGRlZmluZVByb3BlcnR5KE9iamVjdFByb3RvdHlwZVN5bWJvbHMsIFAsIEF0dHJpYnV0ZXMpOwoJICBhbk9iamVjdCQxKE8pOwoJICB2YXIga2V5ID0gdG9Qcm9wZXJ0eUtleShQKTsKCSAgYW5PYmplY3QkMShBdHRyaWJ1dGVzKTsKCSAgaWYgKGhhc093biQxKEFsbFN5bWJvbHMsIGtleSkpIHsKCSAgICBpZiAoIUF0dHJpYnV0ZXMuZW51bWVyYWJsZSkgewoJICAgICAgaWYgKCFoYXNPd24kMShPLCBISURERU4pKSBuYXRpdmVEZWZpbmVQcm9wZXJ0eShPLCBISURERU4sIGNyZWF0ZVByb3BlcnR5RGVzY3JpcHRvcigxLCB7fSkpOwoJICAgICAgT1tISURERU5dW2tleV0gPSB0cnVlOwoJICAgIH0gZWxzZSB7CgkgICAgICBpZiAoaGFzT3duJDEoTywgSElEREVOKSAmJiBPW0hJRERFTl1ba2V5XSkgT1tISURERU5dW2tleV0gPSBmYWxzZTsKCSAgICAgIEF0dHJpYnV0ZXMgPSBuYXRpdmVPYmplY3RDcmVhdGUoQXR0cmlidXRlcywgeyBlbnVtZXJhYmxlOiBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IoMCwgZmFsc2UpIH0pOwoJICAgIH0gcmV0dXJuIHNldFN5bWJvbERlc2NyaXB0b3IoTywga2V5LCBBdHRyaWJ1dGVzKTsKCSAgfSByZXR1cm4gbmF0aXZlRGVmaW5lUHJvcGVydHkoTywga2V5LCBBdHRyaWJ1dGVzKTsKCX07CgoJdmFyICRkZWZpbmVQcm9wZXJ0aWVzID0gZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyhPLCBQcm9wZXJ0aWVzKSB7CgkgIGFuT2JqZWN0JDEoTyk7CgkgIHZhciBwcm9wZXJ0aWVzID0gdG9JbmRleGVkT2JqZWN0KFByb3BlcnRpZXMpOwoJICB2YXIga2V5cyA9IG9iamVjdEtleXMocHJvcGVydGllcykuY29uY2F0KCRnZXRPd25Qcm9wZXJ0eVN5bWJvbHMocHJvcGVydGllcykpOwoJICAkZm9yRWFjaChrZXlzLCBmdW5jdGlvbiAoa2V5KSB7CgkgICAgaWYgKCFERVNDUklQVE9SUyQxIHx8IGNhbGwoJHByb3BlcnR5SXNFbnVtZXJhYmxlLCBwcm9wZXJ0aWVzLCBrZXkpKSAkZGVmaW5lUHJvcGVydHkoTywga2V5LCBwcm9wZXJ0aWVzW2tleV0pOwoJICB9KTsKCSAgcmV0dXJuIE87Cgl9OwoKCXZhciAkY3JlYXRlID0gZnVuY3Rpb24gY3JlYXRlKE8sIFByb3BlcnRpZXMpIHsKCSAgcmV0dXJuIFByb3BlcnRpZXMgPT09IHVuZGVmaW5lZCA/IG5hdGl2ZU9iamVjdENyZWF0ZShPKSA6ICRkZWZpbmVQcm9wZXJ0aWVzKG5hdGl2ZU9iamVjdENyZWF0ZShPKSwgUHJvcGVydGllcyk7Cgl9OwoKCXZhciAkcHJvcGVydHlJc0VudW1lcmFibGUgPSBmdW5jdGlvbiBwcm9wZXJ0eUlzRW51bWVyYWJsZShWKSB7CgkgIHZhciBQID0gdG9Qcm9wZXJ0eUtleShWKTsKCSAgdmFyIGVudW1lcmFibGUgPSBjYWxsKG5hdGl2ZVByb3BlcnR5SXNFbnVtZXJhYmxlLCB0aGlzLCBQKTsKCSAgaWYgKHRoaXMgPT09IE9iamVjdFByb3RvdHlwZSAmJiBoYXNPd24kMShBbGxTeW1ib2xzLCBQKSAmJiAhaGFzT3duJDEoT2JqZWN0UHJvdG90eXBlU3ltYm9scywgUCkpIHJldHVybiBmYWxzZTsKCSAgcmV0dXJuIGVudW1lcmFibGUgfHwgIWhhc093biQxKHRoaXMsIFApIHx8ICFoYXNPd24kMShBbGxTeW1ib2xzLCBQKSB8fCBoYXNPd24kMSh0aGlzLCBISURERU4pICYmIHRoaXNbSElEREVOXVtQXQoJICAgID8gZW51bWVyYWJsZSA6IHRydWU7Cgl9OwoKCXZhciAkZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID0gZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKE8sIFApIHsKCSAgdmFyIGl0ID0gdG9JbmRleGVkT2JqZWN0KE8pOwoJICB2YXIga2V5ID0gdG9Qcm9wZXJ0eUtleShQKTsKCSAgaWYgKGl0ID09PSBPYmplY3RQcm90b3R5cGUgJiYgaGFzT3duJDEoQWxsU3ltYm9scywga2V5KSAmJiAhaGFzT3duJDEoT2JqZWN0UHJvdG90eXBlU3ltYm9scywga2V5KSkgcmV0dXJuOwoJICB2YXIgZGVzY3JpcHRvciA9IG5hdGl2ZUdldE93blByb3BlcnR5RGVzY3JpcHRvcihpdCwga2V5KTsKCSAgaWYgKGRlc2NyaXB0b3IgJiYgaGFzT3duJDEoQWxsU3ltYm9scywga2V5KSAmJiAhKGhhc093biQxKGl0LCBISURERU4pICYmIGl0W0hJRERFTl1ba2V5XSkpIHsKCSAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSB0cnVlOwoJICB9CgkgIHJldHVybiBkZXNjcmlwdG9yOwoJfTsKCgl2YXIgJGdldE93blByb3BlcnR5TmFtZXMgPSBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eU5hbWVzKE8pIHsKCSAgdmFyIG5hbWVzID0gbmF0aXZlR2V0T3duUHJvcGVydHlOYW1lcyh0b0luZGV4ZWRPYmplY3QoTykpOwoJICB2YXIgcmVzdWx0ID0gW107CgkgICRmb3JFYWNoKG5hbWVzLCBmdW5jdGlvbiAoa2V5KSB7CgkgICAgaWYgKCFoYXNPd24kMShBbGxTeW1ib2xzLCBrZXkpICYmICFoYXNPd24kMShoaWRkZW5LZXlzLCBrZXkpKSBwdXNoKHJlc3VsdCwga2V5KTsKCSAgfSk7CgkgIHJldHVybiByZXN1bHQ7Cgl9OwoKCXZhciAkZ2V0T3duUHJvcGVydHlTeW1ib2xzID0gZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlTeW1ib2xzKE8pIHsKCSAgdmFyIElTX09CSkVDVF9QUk9UT1RZUEUgPSBPID09PSBPYmplY3RQcm90b3R5cGU7CgkgIHZhciBuYW1lcyA9IG5hdGl2ZUdldE93blByb3BlcnR5TmFtZXMoSVNfT0JKRUNUX1BST1RPVFlQRSA/IE9iamVjdFByb3RvdHlwZVN5bWJvbHMgOiB0b0luZGV4ZWRPYmplY3QoTykpOwoJICB2YXIgcmVzdWx0ID0gW107CgkgICRmb3JFYWNoKG5hbWVzLCBmdW5jdGlvbiAoa2V5KSB7CgkgICAgaWYgKGhhc093biQxKEFsbFN5bWJvbHMsIGtleSkgJiYgKCFJU19PQkpFQ1RfUFJPVE9UWVBFIHx8IGhhc093biQxKE9iamVjdFByb3RvdHlwZSwga2V5KSkpIHsKCSAgICAgIHB1c2gocmVzdWx0LCBBbGxTeW1ib2xzW2tleV0pOwoJICAgIH0KCSAgfSk7CgkgIHJldHVybiByZXN1bHQ7Cgl9OwoKCS8vIGBTeW1ib2xgIGNvbnN0cnVjdG9yCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLXN5bWJvbC1jb25zdHJ1Y3RvcgoJaWYgKCFOQVRJVkVfU1lNQk9MKSB7CgkgICRTeW1ib2wgPSBmdW5jdGlvbiBTeW1ib2woKSB7CgkgICAgaWYgKGlzUHJvdG90eXBlT2YkMihTeW1ib2xQcm90b3R5cGUsIHRoaXMpKSB0aHJvdyBUeXBlRXJyb3IkMygnU3ltYm9sIGlzIG5vdCBhIGNvbnN0cnVjdG9yJyk7CgkgICAgdmFyIGRlc2NyaXB0aW9uID0gIWFyZ3VtZW50cy5sZW5ndGggfHwgYXJndW1lbnRzWzBdID09PSB1bmRlZmluZWQgPyB1bmRlZmluZWQgOiAkdG9TdHJpbmcoYXJndW1lbnRzWzBdKTsKCSAgICB2YXIgdGFnID0gdWlkKGRlc2NyaXB0aW9uKTsKCSAgICB2YXIgc2V0dGVyID0gZnVuY3Rpb24gKHZhbHVlKSB7CgkgICAgICBpZiAodGhpcyA9PT0gT2JqZWN0UHJvdG90eXBlKSBjYWxsKHNldHRlciwgT2JqZWN0UHJvdG90eXBlU3ltYm9scywgdmFsdWUpOwoJICAgICAgaWYgKGhhc093biQxKHRoaXMsIEhJRERFTikgJiYgaGFzT3duJDEodGhpc1tISURERU5dLCB0YWcpKSB0aGlzW0hJRERFTl1bdGFnXSA9IGZhbHNlOwoJICAgICAgc2V0U3ltYm9sRGVzY3JpcHRvcih0aGlzLCB0YWcsIGNyZWF0ZVByb3BlcnR5RGVzY3JpcHRvcigxLCB2YWx1ZSkpOwoJICAgIH07CgkgICAgaWYgKERFU0NSSVBUT1JTJDEgJiYgVVNFX1NFVFRFUikgc2V0U3ltYm9sRGVzY3JpcHRvcihPYmplY3RQcm90b3R5cGUsIHRhZywgeyBjb25maWd1cmFibGU6IHRydWUsIHNldDogc2V0dGVyIH0pOwoJICAgIHJldHVybiB3cmFwKHRhZywgZGVzY3JpcHRpb24pOwoJICB9OwoKCSAgU3ltYm9sUHJvdG90eXBlID0gJFN5bWJvbFtQUk9UT1RZUEVdOwoKCSAgcmVkZWZpbmUkMShTeW1ib2xQcm90b3R5cGUsICd0b1N0cmluZycsIGZ1bmN0aW9uIHRvU3RyaW5nKCkgewoJICAgIHJldHVybiBnZXRJbnRlcm5hbFN0YXRlKHRoaXMpLnRhZzsKCSAgfSk7CgoJICByZWRlZmluZSQxKCRTeW1ib2wsICd3aXRob3V0U2V0dGVyJywgZnVuY3Rpb24gKGRlc2NyaXB0aW9uKSB7CgkgICAgcmV0dXJuIHdyYXAodWlkKGRlc2NyaXB0aW9uKSwgZGVzY3JpcHRpb24pOwoJICB9KTsKCgkgIHByb3BlcnR5SXNFbnVtZXJhYmxlTW9kdWxlLmYgPSAkcHJvcGVydHlJc0VudW1lcmFibGU7CgkgIGRlZmluZVByb3BlcnR5TW9kdWxlLmYgPSAkZGVmaW5lUHJvcGVydHk7CgkgIGdldE93blByb3BlcnR5RGVzY3JpcHRvck1vZHVsZS5mID0gJGdldE93blByb3BlcnR5RGVzY3JpcHRvcjsKCSAgZ2V0T3duUHJvcGVydHlOYW1lc01vZHVsZS5mID0gZ2V0T3duUHJvcGVydHlOYW1lc0V4dGVybmFsLmYgPSAkZ2V0T3duUHJvcGVydHlOYW1lczsKCSAgZ2V0T3duUHJvcGVydHlTeW1ib2xzTW9kdWxlLmYgPSAkZ2V0T3duUHJvcGVydHlTeW1ib2xzOwoKCSAgd3JhcHBlZFdlbGxLbm93blN5bWJvbE1vZHVsZS5mID0gZnVuY3Rpb24gKG5hbWUpIHsKCSAgICByZXR1cm4gd3JhcCh3ZWxsS25vd25TeW1ib2wobmFtZSksIG5hbWUpOwoJICB9OwoKCSAgaWYgKERFU0NSSVBUT1JTJDEpIHsKCSAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vdGMzOS9wcm9wb3NhbC1TeW1ib2wtZGVzY3JpcHRpb24KCSAgICBuYXRpdmVEZWZpbmVQcm9wZXJ0eShTeW1ib2xQcm90b3R5cGUsICdkZXNjcmlwdGlvbicsIHsKCSAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKCSAgICAgIGdldDogZnVuY3Rpb24gZGVzY3JpcHRpb24oKSB7CgkgICAgICAgIHJldHVybiBnZXRJbnRlcm5hbFN0YXRlKHRoaXMpLmRlc2NyaXB0aW9uOwoJICAgICAgfQoJICAgIH0pOwoJICB9Cgl9CgoJJCQzKHsgZ2xvYmFsOiB0cnVlLCB3cmFwOiB0cnVlLCBmb3JjZWQ6ICFOQVRJVkVfU1lNQk9MLCBzaGFtOiAhTkFUSVZFX1NZTUJPTCB9LCB7CgkgIFN5bWJvbDogJFN5bWJvbAoJfSk7CgoJJGZvckVhY2gob2JqZWN0S2V5cyhXZWxsS25vd25TeW1ib2xzU3RvcmUpLCBmdW5jdGlvbiAobmFtZSkgewoJICBkZWZpbmVXZWxsS25vd25TeW1ib2wkZChuYW1lKTsKCX0pOwoKCSQkMyh7IHRhcmdldDogU1lNQk9MLCBzdGF0OiB0cnVlLCBmb3JjZWQ6ICFOQVRJVkVfU1lNQk9MIH0sIHsKCSAgLy8gYFN5bWJvbC5mb3JgIG1ldGhvZAoJICAvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLXN5bWJvbC5mb3IKCSAgJ2Zvcic6IGZ1bmN0aW9uIChrZXkpIHsKCSAgICB2YXIgc3RyaW5nID0gJHRvU3RyaW5nKGtleSk7CgkgICAgaWYgKGhhc093biQxKFN0cmluZ1RvU3ltYm9sUmVnaXN0cnksIHN0cmluZykpIHJldHVybiBTdHJpbmdUb1N5bWJvbFJlZ2lzdHJ5W3N0cmluZ107CgkgICAgdmFyIHN5bWJvbCA9ICRTeW1ib2woc3RyaW5nKTsKCSAgICBTdHJpbmdUb1N5bWJvbFJlZ2lzdHJ5W3N0cmluZ10gPSBzeW1ib2w7CgkgICAgU3ltYm9sVG9TdHJpbmdSZWdpc3RyeVtzeW1ib2xdID0gc3RyaW5nOwoJICAgIHJldHVybiBzeW1ib2w7CgkgIH0sCgkgIC8vIGBTeW1ib2wua2V5Rm9yYCBtZXRob2QKCSAgLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1zeW1ib2wua2V5Zm9yCgkgIGtleUZvcjogZnVuY3Rpb24ga2V5Rm9yKHN5bSkgewoJICAgIGlmICghaXNTeW1ib2wkMShzeW0pKSB0aHJvdyBUeXBlRXJyb3IkMyhzeW0gKyAnIGlzIG5vdCBhIHN5bWJvbCcpOwoJICAgIGlmIChoYXNPd24kMShTeW1ib2xUb1N0cmluZ1JlZ2lzdHJ5LCBzeW0pKSByZXR1cm4gU3ltYm9sVG9TdHJpbmdSZWdpc3RyeVtzeW1dOwoJICB9LAoJICB1c2VTZXR0ZXI6IGZ1bmN0aW9uICgpIHsgVVNFX1NFVFRFUiA9IHRydWU7IH0sCgkgIHVzZVNpbXBsZTogZnVuY3Rpb24gKCkgeyBVU0VfU0VUVEVSID0gZmFsc2U7IH0KCX0pOwoKCSQkMyh7IHRhcmdldDogJ09iamVjdCcsIHN0YXQ6IHRydWUsIGZvcmNlZDogIU5BVElWRV9TWU1CT0wsIHNoYW06ICFERVNDUklQVE9SUyQxIH0sIHsKCSAgLy8gYE9iamVjdC5jcmVhdGVgIG1ldGhvZAoJICAvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLW9iamVjdC5jcmVhdGUKCSAgY3JlYXRlOiAkY3JlYXRlLAoJICAvLyBgT2JqZWN0LmRlZmluZVByb3BlcnR5YCBtZXRob2QKCSAgLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1vYmplY3QuZGVmaW5lcHJvcGVydHkKCSAgZGVmaW5lUHJvcGVydHk6ICRkZWZpbmVQcm9wZXJ0eSwKCSAgLy8gYE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzYCBtZXRob2QKCSAgLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1vYmplY3QuZGVmaW5lcHJvcGVydGllcwoJICBkZWZpbmVQcm9wZXJ0aWVzOiAkZGVmaW5lUHJvcGVydGllcywKCSAgLy8gYE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JgIG1ldGhvZAoJICAvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLW9iamVjdC5nZXRvd25wcm9wZXJ0eWRlc2NyaXB0b3JzCgkgIGdldE93blByb3BlcnR5RGVzY3JpcHRvcjogJGdldE93blByb3BlcnR5RGVzY3JpcHRvcgoJfSk7CgoJJCQzKHsgdGFyZ2V0OiAnT2JqZWN0Jywgc3RhdDogdHJ1ZSwgZm9yY2VkOiAhTkFUSVZFX1NZTUJPTCB9LCB7CgkgIC8vIGBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lc2AgbWV0aG9kCgkgIC8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtb2JqZWN0LmdldG93bnByb3BlcnR5bmFtZXMKCSAgZ2V0T3duUHJvcGVydHlOYW1lczogJGdldE93blByb3BlcnR5TmFtZXMsCgkgIC8vIGBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzYCBtZXRob2QKCSAgLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1vYmplY3QuZ2V0b3ducHJvcGVydHlzeW1ib2xzCgkgIGdldE93blByb3BlcnR5U3ltYm9sczogJGdldE93blByb3BlcnR5U3ltYm9scwoJfSk7CgoJLy8gQ2hyb21lIDM4IGFuZCAzOSBgT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9sc2AgZmFpbHMgb24gcHJpbWl0aXZlcwoJLy8gaHR0cHM6Ly9idWdzLmNocm9taXVtLm9yZy9wL3Y4L2lzc3Vlcy9kZXRhaWw/aWQ9MzQ0MwoJJCQzKHsgdGFyZ2V0OiAnT2JqZWN0Jywgc3RhdDogdHJ1ZSwgZm9yY2VkOiBmYWlscyQzKGZ1bmN0aW9uICgpIHsgZ2V0T3duUHJvcGVydHlTeW1ib2xzTW9kdWxlLmYoMSk7IH0pIH0sIHsKCSAgZ2V0T3duUHJvcGVydHlTeW1ib2xzOiBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eVN5bWJvbHMoaXQpIHsKCSAgICByZXR1cm4gZ2V0T3duUHJvcGVydHlTeW1ib2xzTW9kdWxlLmYodG9PYmplY3QoaXQpKTsKCSAgfQoJfSk7CgoJLy8gYEpTT04uc3RyaW5naWZ5YCBtZXRob2QgYmVoYXZpb3Igd2l0aCBzeW1ib2xzCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLWpzb24uc3RyaW5naWZ5CglpZiAoJHN0cmluZ2lmeSkgewoJICB2YXIgRk9SQ0VEX0pTT05fU1RSSU5HSUZZID0gIU5BVElWRV9TWU1CT0wgfHwgZmFpbHMkMyhmdW5jdGlvbiAoKSB7CgkgICAgdmFyIHN5bWJvbCA9ICRTeW1ib2woKTsKCSAgICAvLyBNUyBFZGdlIGNvbnZlcnRzIHN5bWJvbCB2YWx1ZXMgdG8gSlNPTiBhcyB7fQoJICAgIHJldHVybiAkc3RyaW5naWZ5KFtzeW1ib2xdKSAhPSAnW251bGxdJwoJICAgICAgLy8gV2ViS2l0IGNvbnZlcnRzIHN5bWJvbCB2YWx1ZXMgdG8gSlNPTiBhcyBudWxsCgkgICAgICB8fCAkc3RyaW5naWZ5KHsgYTogc3ltYm9sIH0pICE9ICd7fScKCSAgICAgIC8vIFY4IHRocm93cyBvbiBib3hlZCBzeW1ib2xzCgkgICAgICB8fCAkc3RyaW5naWZ5KE9iamVjdChzeW1ib2wpKSAhPSAne30nOwoJICB9KTsKCgkgICQkMyh7IHRhcmdldDogJ0pTT04nLCBzdGF0OiB0cnVlLCBmb3JjZWQ6IEZPUkNFRF9KU09OX1NUUklOR0lGWSB9LCB7CgkgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVudXNlZC12YXJzIC0tIHJlcXVpcmVkIGZvciBgLmxlbmd0aGAKCSAgICBzdHJpbmdpZnk6IGZ1bmN0aW9uIHN0cmluZ2lmeShpdCwgcmVwbGFjZXIsIHNwYWNlKSB7CgkgICAgICB2YXIgYXJncyA9IGFycmF5U2xpY2UkMShhcmd1bWVudHMpOwoJICAgICAgdmFyICRyZXBsYWNlciA9IHJlcGxhY2VyOwoJICAgICAgaWYgKCFpc09iamVjdCQxKHJlcGxhY2VyKSAmJiBpdCA9PT0gdW5kZWZpbmVkIHx8IGlzU3ltYm9sJDEoaXQpKSByZXR1cm47IC8vIElFOCByZXR1cm5zIHN0cmluZyBvbiB1bmRlZmluZWQKCSAgICAgIGlmICghaXNBcnJheSQxKHJlcGxhY2VyKSkgcmVwbGFjZXIgPSBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkgewoJICAgICAgICBpZiAoaXNDYWxsYWJsZSQyKCRyZXBsYWNlcikpIHZhbHVlID0gY2FsbCgkcmVwbGFjZXIsIHRoaXMsIGtleSwgdmFsdWUpOwoJICAgICAgICBpZiAoIWlzU3ltYm9sJDEodmFsdWUpKSByZXR1cm4gdmFsdWU7CgkgICAgICB9OwoJICAgICAgYXJnc1sxXSA9IHJlcGxhY2VyOwoJICAgICAgcmV0dXJuIGFwcGx5KCRzdHJpbmdpZnksIG51bGwsIGFyZ3MpOwoJICAgIH0KCSAgfSk7Cgl9CgoJLy8gYFN5bWJvbC5wcm90b3R5cGVbQEB0b1ByaW1pdGl2ZV1gIG1ldGhvZAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1zeW1ib2wucHJvdG90eXBlLUBAdG9wcmltaXRpdmUKCWlmICghU3ltYm9sUHJvdG90eXBlW1RPX1BSSU1JVElWRV0pIHsKCSAgdmFyIHZhbHVlT2YgPSBTeW1ib2xQcm90b3R5cGUudmFsdWVPZjsKCSAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVudXNlZC12YXJzIC0tIHJlcXVpcmVkIGZvciAubGVuZ3RoCgkgIHJlZGVmaW5lJDEoU3ltYm9sUHJvdG90eXBlLCBUT19QUklNSVRJVkUsIGZ1bmN0aW9uIChoaW50KSB7CgkgICAgLy8gVE9ETzogaW1wcm92ZSBoaW50IGxvZ2ljCgkgICAgcmV0dXJuIGNhbGwodmFsdWVPZiwgdGhpcyk7CgkgIH0pOwoJfQoJLy8gYFN5bWJvbC5wcm90b3R5cGVbQEB0b1N0cmluZ1RhZ11gIHByb3BlcnR5CgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLXN5bWJvbC5wcm90b3R5cGUtQEB0b3N0cmluZ3RhZwoJc2V0VG9TdHJpbmdUYWckMSgkU3ltYm9sLCBTWU1CT0wpOwoKCWhpZGRlbktleXNbSElEREVOXSA9IHRydWU7CgoJdmFyIGRlZmluZVdlbGxLbm93blN5bWJvbCRjID0gZGVmaW5lV2VsbEtub3duU3ltYm9sJGU7CgoJLy8gYFN5bWJvbC5hc3luY0l0ZXJhdG9yYCB3ZWxsLWtub3duIHN5bWJvbAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1zeW1ib2wuYXN5bmNpdGVyYXRvcgoJZGVmaW5lV2VsbEtub3duU3ltYm9sJGMoJ2FzeW5jSXRlcmF0b3InKTsKCgl2YXIgZGVmaW5lV2VsbEtub3duU3ltYm9sJGIgPSBkZWZpbmVXZWxsS25vd25TeW1ib2wkZTsKCgkvLyBgU3ltYm9sLmhhc0luc3RhbmNlYCB3ZWxsLWtub3duIHN5bWJvbAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1zeW1ib2wuaGFzaW5zdGFuY2UKCWRlZmluZVdlbGxLbm93blN5bWJvbCRiKCdoYXNJbnN0YW5jZScpOwoKCXZhciBkZWZpbmVXZWxsS25vd25TeW1ib2wkYSA9IGRlZmluZVdlbGxLbm93blN5bWJvbCRlOwoKCS8vIGBTeW1ib2wuaXNDb25jYXRTcHJlYWRhYmxlYCB3ZWxsLWtub3duIHN5bWJvbAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1zeW1ib2wuaXNjb25jYXRzcHJlYWRhYmxlCglkZWZpbmVXZWxsS25vd25TeW1ib2wkYSgnaXNDb25jYXRTcHJlYWRhYmxlJyk7CgoJdmFyIGRlZmluZVdlbGxLbm93blN5bWJvbCQ5ID0gZGVmaW5lV2VsbEtub3duU3ltYm9sJGU7CgoJLy8gYFN5bWJvbC5pdGVyYXRvcmAgd2VsbC1rbm93biBzeW1ib2wKCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtc3ltYm9sLml0ZXJhdG9yCglkZWZpbmVXZWxsS25vd25TeW1ib2wkOSgnaXRlcmF0b3InKTsKCgl2YXIgZGVmaW5lV2VsbEtub3duU3ltYm9sJDggPSBkZWZpbmVXZWxsS25vd25TeW1ib2wkZTsKCgkvLyBgU3ltYm9sLm1hdGNoYCB3ZWxsLWtub3duIHN5bWJvbAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1zeW1ib2wubWF0Y2gKCWRlZmluZVdlbGxLbm93blN5bWJvbCQ4KCdtYXRjaCcpOwoKCXZhciBkZWZpbmVXZWxsS25vd25TeW1ib2wkNyA9IGRlZmluZVdlbGxLbm93blN5bWJvbCRlOwoKCS8vIGBTeW1ib2wubWF0Y2hBbGxgIHdlbGwta25vd24gc3ltYm9sCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLXN5bWJvbC5tYXRjaGFsbAoJZGVmaW5lV2VsbEtub3duU3ltYm9sJDcoJ21hdGNoQWxsJyk7CgoJdmFyIGRlZmluZVdlbGxLbm93blN5bWJvbCQ2ID0gZGVmaW5lV2VsbEtub3duU3ltYm9sJGU7CgoJLy8gYFN5bWJvbC5yZXBsYWNlYCB3ZWxsLWtub3duIHN5bWJvbAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1zeW1ib2wucmVwbGFjZQoJZGVmaW5lV2VsbEtub3duU3ltYm9sJDYoJ3JlcGxhY2UnKTsKCgl2YXIgZGVmaW5lV2VsbEtub3duU3ltYm9sJDUgPSBkZWZpbmVXZWxsS25vd25TeW1ib2wkZTsKCgkvLyBgU3ltYm9sLnNlYXJjaGAgd2VsbC1rbm93biBzeW1ib2wKCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtc3ltYm9sLnNlYXJjaAoJZGVmaW5lV2VsbEtub3duU3ltYm9sJDUoJ3NlYXJjaCcpOwoKCXZhciBkZWZpbmVXZWxsS25vd25TeW1ib2wkNCA9IGRlZmluZVdlbGxLbm93blN5bWJvbCRlOwoKCS8vIGBTeW1ib2wuc3BlY2llc2Agd2VsbC1rbm93biBzeW1ib2wKCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtc3ltYm9sLnNwZWNpZXMKCWRlZmluZVdlbGxLbm93blN5bWJvbCQ0KCdzcGVjaWVzJyk7CgoJdmFyIGRlZmluZVdlbGxLbm93blN5bWJvbCQzID0gZGVmaW5lV2VsbEtub3duU3ltYm9sJGU7CgoJLy8gYFN5bWJvbC5zcGxpdGAgd2VsbC1rbm93biBzeW1ib2wKCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtc3ltYm9sLnNwbGl0CglkZWZpbmVXZWxsS25vd25TeW1ib2wkMygnc3BsaXQnKTsKCgl2YXIgZGVmaW5lV2VsbEtub3duU3ltYm9sJDIgPSBkZWZpbmVXZWxsS25vd25TeW1ib2wkZTsKCgkvLyBgU3ltYm9sLnRvUHJpbWl0aXZlYCB3ZWxsLWtub3duIHN5bWJvbAoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1zeW1ib2wudG9wcmltaXRpdmUKCWRlZmluZVdlbGxLbm93blN5bWJvbCQyKCd0b1ByaW1pdGl2ZScpOwoKCXZhciBkZWZpbmVXZWxsS25vd25TeW1ib2wkMSA9IGRlZmluZVdlbGxLbm93blN5bWJvbCRlOwoKCS8vIGBTeW1ib2wudG9TdHJpbmdUYWdgIHdlbGwta25vd24gc3ltYm9sCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLXN5bWJvbC50b3N0cmluZ3RhZwoJZGVmaW5lV2VsbEtub3duU3ltYm9sJDEoJ3RvU3RyaW5nVGFnJyk7CgoJdmFyIGRlZmluZVdlbGxLbm93blN5bWJvbCA9IGRlZmluZVdlbGxLbm93blN5bWJvbCRlOwoKCS8vIGBTeW1ib2wudW5zY29wYWJsZXNgIHdlbGwta25vd24gc3ltYm9sCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLXN5bWJvbC51bnNjb3BhYmxlcwoJZGVmaW5lV2VsbEtub3duU3ltYm9sKCd1bnNjb3BhYmxlcycpOwoKCXZhciBnbG9iYWwkNiA9IGdsb2JhbCRHOwoJdmFyIHNldFRvU3RyaW5nVGFnID0gc2V0VG9TdHJpbmdUYWckNDsKCgkvLyBKU09OW0BAdG9TdHJpbmdUYWddIHByb3BlcnR5CgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLWpzb24tQEB0b3N0cmluZ3RhZwoJc2V0VG9TdHJpbmdUYWcoZ2xvYmFsJDYuSlNPTiwgJ0pTT04nLCB0cnVlKTsKCgl2YXIgcGF0aCQxID0gcGF0aCQ4OwoKCXZhciBzeW1ib2wkMiA9IHBhdGgkMS5TeW1ib2w7CgoJdmFyIHBhcmVudCQ0ID0gc3ltYm9sJDI7CgoKCXZhciBzeW1ib2wkMSA9IHBhcmVudCQ0OwoKCXZhciBzeW1ib2wgPSBzeW1ib2wkMTsKCgl2YXIgZ2V0SXRlcmF0b3JNZXRob2QkMyA9IGdldEl0ZXJhdG9yTWV0aG9kJDY7CgoJdmFyIGdldEl0ZXJhdG9yTWV0aG9kXzEgPSBnZXRJdGVyYXRvck1ldGhvZCQzOwoKCXZhciBwYXJlbnQkMyA9IGdldEl0ZXJhdG9yTWV0aG9kXzE7CgoKCXZhciBnZXRJdGVyYXRvck1ldGhvZCQyID0gcGFyZW50JDM7CgoJdmFyIHBhcmVudCQyID0gZ2V0SXRlcmF0b3JNZXRob2QkMjsKCgl2YXIgZ2V0SXRlcmF0b3JNZXRob2QkMSA9IHBhcmVudCQyOwoKCXZhciBnZXRJdGVyYXRvck1ldGhvZCA9IGdldEl0ZXJhdG9yTWV0aG9kJDE7CgoJZnVuY3Rpb24gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXJMb29zZSQxKG8sIGFsbG93QXJyYXlMaWtlKSB7IHZhciBpdCA9IHR5cGVvZiBzeW1ib2wgIT09ICJ1bmRlZmluZWQiICYmIGdldEl0ZXJhdG9yTWV0aG9kKG8pIHx8IG9bIkBAaXRlcmF0b3IiXTsgaWYgKGl0KSByZXR1cm4gKGl0ID0gaXQuY2FsbChvKSkubmV4dC5iaW5kKGl0KTsgaWYgKEFycmF5LmlzQXJyYXkobykgfHwgKGl0ID0gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5JDEobykpIHx8IGFsbG93QXJyYXlMaWtlICYmIG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgeyBpZiAoaXQpIG8gPSBpdDsgdmFyIGkgPSAwOyByZXR1cm4gZnVuY3Rpb24gKCkgeyBpZiAoaSA+PSBvLmxlbmd0aCkgcmV0dXJuIHsgZG9uZTogdHJ1ZSB9OyByZXR1cm4geyBkb25lOiBmYWxzZSwgdmFsdWU6IG9baSsrXSB9OyB9OyB9IHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBpdGVyYXRlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKTsgfQoKCWZ1bmN0aW9uIF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheSQxKG8sIG1pbkxlbikgeyB2YXIgX2NvbnRleHQ7IGlmICghbykgcmV0dXJuOyBpZiAodHlwZW9mIG8gPT09ICJzdHJpbmciKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkkMShvLCBtaW5MZW4pOyB2YXIgbiA9IHNsaWNlKF9jb250ZXh0ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pKS5jYWxsKF9jb250ZXh0LCA4LCAtMSk7IGlmIChuID09PSAiT2JqZWN0IiAmJiBvLmNvbnN0cnVjdG9yKSBuID0gby5jb25zdHJ1Y3Rvci5uYW1lOyBpZiAobiA9PT0gIk1hcCIgfHwgbiA9PT0gIlNldCIpIHJldHVybiBmcm9tKG8pOyBpZiAobiA9PT0gIkFyZ3VtZW50cyIgfHwgL14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3QobikpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheSQxKG8sIG1pbkxlbik7IH0KCglmdW5jdGlvbiBfYXJyYXlMaWtlVG9BcnJheSQxKGFyciwgbGVuKSB7IGlmIChsZW4gPT0gbnVsbCB8fCBsZW4gPiBhcnIubGVuZ3RoKSBsZW4gPSBhcnIubGVuZ3RoOyBmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShsZW4pOyBpIDwgbGVuOyBpKyspIHsgYXJyMltpXSA9IGFycltpXTsgfSByZXR1cm4gYXJyMjsgfQoJZnVuY3Rpb24gemlwbGlzdChrZXlzLCB2YWxzKSB7CgkgIGlmIChrZXlzID09PSB2b2lkIDApIHsKCSAgICBrZXlzID0gW107CgkgIH0KCgkgIGlmICh2YWxzID09PSB2b2lkIDApIHsKCSAgICB2YWxzID0gW107CgkgIH0KCgkgIHZhciBsZW4gPSBNYXRoLm1pbihrZXlzLmxlbmd0aCwgdmFscy5sZW5ndGgpOwoJICB2YXIgcmVzdWx0ID0gW107CgoJICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CgkgICAgcmVzdWx0LnB1c2goW2tleXNbaV0sIHZhbHNbaV1dKTsKCSAgfQoKCSAgcmV0dXJuIHJlc3VsdDsKCX0KCglmdW5jdGlvbiBjb252ZXJ0X3N5bWJvbChzeW1ib2wpIHsKCSAgaWYgKHN5bWJvbCA9PT0gdm9pZCAwKSB7CgkgICAgc3ltYm9sID0gJyc7CgkgIH0KCgkgIGlmIChzeW1ib2wgJiYgc3ltYm9sLmxlbmd0aCkgewoJICAgIHZhciBsZW4gPSBzeW1ib2wubGVuZ3RoIC0gMTsKCSAgICB2YXIgY2hhckNvZGUgPSBzeW1ib2wuY2hhckNvZGVBdChsZW4pOwoJICAgIHN5bWJvbCA9IGNoYXJDb2RlID49IDQ4ICYmIGNoYXJDb2RlIDw9IDU3ID8gc3ltYm9sLnN1YnN0cmluZygwLCBsZW4pIDogc3ltYm9sOwoJICB9CgoJICBpZiAoc3ltYm9sID09PSAnU0lMJykgc3ltYm9sID0gJ3NpbCc7CgkgIHJldHVybiBzeW1ib2w7Cgl9CgoJZnVuY3Rpb24gcGlueWluX2Zyb21fanNvbl9saXN0KHNlcSkgewoJICBpZiAoc2VxID09PSB2b2lkIDApIHsKCSAgICBzZXEgPSBbXTsKCSAgfQoKCSAgdmFyIGVuZHMgPSBbXSwKCSAgICAgIHBob25lcyA9IFtdOwoKCSAgdmFyIGJlZyA9IF9wYXJzZUludChzZXFbMF1bJ3N0YXJ0VGltZSddICogMTAwMCk7CgoJICBpZiAoYmVnID4gMCkgewoJICAgIGVuZHMucHVzaChiZWcpOwoJICAgIHBob25lcy5wdXNoKGNvbnZlcnRfc3ltYm9sKCdTSUwnKSk7CgkgIH0KCgkgIGZvciAodmFyIF9pdGVyYXRvciA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyTG9vc2UkMShzZXEpLCBfc3RlcDsgIShfc3RlcCA9IF9pdGVyYXRvcigpKS5kb25lOykgewoJICAgIHZhciBpdGVtID0gX3N0ZXAudmFsdWU7CgkgICAgZW5kcy5wdXNoKF9wYXJzZUludChpdGVtWydlbmRUaW1lJ10gKiAxMDAwKSk7CgkgICAgcGhvbmVzLnB1c2goY29udmVydF9zeW1ib2woaXRlbVsndHh0J10pKTsKCSAgICBiZWcgPSBlbmRzW2VuZHMubGVuZ3RoIC0gMV07CgkgIH0KCgkgIHJldHVybiB6aXBsaXN0KGVuZHMsIHBob25lcyk7Cgl9CgoJdmFyIHVuY3VycnlUaGlzJDYgPSBmdW5jdGlvblVuY3VycnlUaGlzJDE7CgoJLy8gYHRoaXNOdW1iZXJWYWx1ZWAgYWJzdHJhY3Qgb3BlcmF0aW9uCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLXRoaXNudW1iZXJ2YWx1ZQoJdmFyIHRoaXNOdW1iZXJWYWx1ZSQyID0gdW5jdXJyeVRoaXMkNigxLjAudmFsdWVPZik7CgoJdmFyIGdsb2JhbCQ1ID0gZ2xvYmFsJDE4OwoJdmFyIHRvSW50ZWdlck9ySW5maW5pdHkkMSA9IHRvSW50ZWdlck9ySW5maW5pdHkkYTsKCXZhciB0b1N0cmluZyQyID0gdG9TdHJpbmckaDsKCXZhciByZXF1aXJlT2JqZWN0Q29lcmNpYmxlJDEgPSByZXF1aXJlT2JqZWN0Q29lcmNpYmxlJGQ7CgoJdmFyIFJhbmdlRXJyb3IkMSA9IGdsb2JhbCQ1LlJhbmdlRXJyb3I7CgoJLy8gYFN0cmluZy5wcm90b3R5cGUucmVwZWF0YCBtZXRob2QgaW1wbGVtZW50YXRpb24KCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtc3RyaW5nLnByb3RvdHlwZS5yZXBlYXQKCXZhciBzdHJpbmdSZXBlYXQgPSBmdW5jdGlvbiByZXBlYXQoY291bnQpIHsKCSAgdmFyIHN0ciA9IHRvU3RyaW5nJDIocmVxdWlyZU9iamVjdENvZXJjaWJsZSQxKHRoaXMpKTsKCSAgdmFyIHJlc3VsdCA9ICcnOwoJICB2YXIgbiA9IHRvSW50ZWdlck9ySW5maW5pdHkkMShjb3VudCk7CgkgIGlmIChuIDwgMCB8fCBuID09IEluZmluaXR5KSB0aHJvdyBSYW5nZUVycm9yJDEoJ1dyb25nIG51bWJlciBvZiByZXBldGl0aW9ucycpOwoJICBmb3IgKDtuID4gMDsgKG4gPj4+PSAxKSAmJiAoc3RyICs9IHN0cikpIGlmIChuICYgMSkgcmVzdWx0ICs9IHN0cjsKCSAgcmV0dXJuIHJlc3VsdDsKCX07CgoJdmFyICQkMiA9IF9leHBvcnQkMTsKCXZhciBnbG9iYWwkNCA9IGdsb2JhbCQxODsKCXZhciB1bmN1cnJ5VGhpcyQ1ID0gZnVuY3Rpb25VbmN1cnJ5VGhpcyQxOwoJdmFyIHRvSW50ZWdlck9ySW5maW5pdHkgPSB0b0ludGVnZXJPckluZmluaXR5JGE7Cgl2YXIgdGhpc051bWJlclZhbHVlJDEgPSB0aGlzTnVtYmVyVmFsdWUkMjsKCXZhciAkcmVwZWF0ID0gc3RyaW5nUmVwZWF0OwoJdmFyIGZhaWxzJDIgPSBmYWlscyR0OwoKCXZhciBSYW5nZUVycm9yID0gZ2xvYmFsJDQuUmFuZ2VFcnJvcjsKCXZhciBTdHJpbmckMiA9IGdsb2JhbCQ0LlN0cmluZzsKCXZhciBmbG9vciA9IE1hdGguZmxvb3I7Cgl2YXIgcmVwZWF0ID0gdW5jdXJyeVRoaXMkNSgkcmVwZWF0KTsKCXZhciBzdHJpbmdTbGljZSA9IHVuY3VycnlUaGlzJDUoJycuc2xpY2UpOwoJdmFyIHVuJFRvRml4ZWQgPSB1bmN1cnJ5VGhpcyQ1KDEuMC50b0ZpeGVkKTsKCgl2YXIgcG93ID0gZnVuY3Rpb24gKHgsIG4sIGFjYykgewoJICByZXR1cm4gbiA9PT0gMCA/IGFjYyA6IG4gJSAyID09PSAxID8gcG93KHgsIG4gLSAxLCBhY2MgKiB4KSA6IHBvdyh4ICogeCwgbiAvIDIsIGFjYyk7Cgl9OwoKCXZhciBsb2cgPSBmdW5jdGlvbiAoeCkgewoJICB2YXIgbiA9IDA7CgkgIHZhciB4MiA9IHg7CgkgIHdoaWxlICh4MiA+PSA0MDk2KSB7CgkgICAgbiArPSAxMjsKCSAgICB4MiAvPSA0MDk2OwoJICB9CgkgIHdoaWxlICh4MiA+PSAyKSB7CgkgICAgbiArPSAxOwoJICAgIHgyIC89IDI7CgkgIH0gcmV0dXJuIG47Cgl9OwoKCXZhciBtdWx0aXBseSA9IGZ1bmN0aW9uIChkYXRhLCBuLCBjKSB7CgkgIHZhciBpbmRleCA9IC0xOwoJICB2YXIgYzIgPSBjOwoJICB3aGlsZSAoKytpbmRleCA8IDYpIHsKCSAgICBjMiArPSBuICogZGF0YVtpbmRleF07CgkgICAgZGF0YVtpbmRleF0gPSBjMiAlIDFlNzsKCSAgICBjMiA9IGZsb29yKGMyIC8gMWU3KTsKCSAgfQoJfTsKCgl2YXIgZGl2aWRlID0gZnVuY3Rpb24gKGRhdGEsIG4pIHsKCSAgdmFyIGluZGV4ID0gNjsKCSAgdmFyIGMgPSAwOwoJICB3aGlsZSAoLS1pbmRleCA+PSAwKSB7CgkgICAgYyArPSBkYXRhW2luZGV4XTsKCSAgICBkYXRhW2luZGV4XSA9IGZsb29yKGMgLyBuKTsKCSAgICBjID0gKGMgJSBuKSAqIDFlNzsKCSAgfQoJfTsKCgl2YXIgZGF0YVRvU3RyaW5nID0gZnVuY3Rpb24gKGRhdGEpIHsKCSAgdmFyIGluZGV4ID0gNjsKCSAgdmFyIHMgPSAnJzsKCSAgd2hpbGUgKC0taW5kZXggPj0gMCkgewoJICAgIGlmIChzICE9PSAnJyB8fCBpbmRleCA9PT0gMCB8fCBkYXRhW2luZGV4XSAhPT0gMCkgewoJICAgICAgdmFyIHQgPSBTdHJpbmckMihkYXRhW2luZGV4XSk7CgkgICAgICBzID0gcyA9PT0gJycgPyB0IDogcyArIHJlcGVhdCgnMCcsIDcgLSB0Lmxlbmd0aCkgKyB0OwoJICAgIH0KCSAgfSByZXR1cm4gczsKCX07CgoJdmFyIEZPUkNFRCQxID0gZmFpbHMkMihmdW5jdGlvbiAoKSB7CgkgIHJldHVybiB1biRUb0ZpeGVkKDAuMDAwMDgsIDMpICE9PSAnMC4wMDAnIHx8CgkgICAgdW4kVG9GaXhlZCgwLjksIDApICE9PSAnMScgfHwKCSAgICB1biRUb0ZpeGVkKDEuMjU1LCAyKSAhPT0gJzEuMjUnIHx8CgkgICAgdW4kVG9GaXhlZCgxMDAwMDAwMDAwMDAwMDAwMTI4LjAsIDApICE9PSAnMTAwMDAwMDAwMDAwMDAwMDEyOCc7Cgl9KSB8fCAhZmFpbHMkMihmdW5jdGlvbiAoKSB7CgkgIC8vIFY4IH4gQW5kcm9pZCA0LjMtCgkgIHVuJFRvRml4ZWQoe30pOwoJfSk7CgoJLy8gYE51bWJlci5wcm90b3R5cGUudG9GaXhlZGAgbWV0aG9kCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLW51bWJlci5wcm90b3R5cGUudG9maXhlZAoJJCQyKHsgdGFyZ2V0OiAnTnVtYmVyJywgcHJvdG86IHRydWUsIGZvcmNlZDogRk9SQ0VEJDEgfSwgewoJICB0b0ZpeGVkOiBmdW5jdGlvbiB0b0ZpeGVkKGZyYWN0aW9uRGlnaXRzKSB7CgkgICAgdmFyIG51bWJlciA9IHRoaXNOdW1iZXJWYWx1ZSQxKHRoaXMpOwoJICAgIHZhciBmcmFjdERpZ2l0cyA9IHRvSW50ZWdlck9ySW5maW5pdHkoZnJhY3Rpb25EaWdpdHMpOwoJICAgIHZhciBkYXRhID0gWzAsIDAsIDAsIDAsIDAsIDBdOwoJICAgIHZhciBzaWduID0gJyc7CgkgICAgdmFyIHJlc3VsdCA9ICcwJzsKCSAgICB2YXIgZSwgeiwgaiwgazsKCgkgICAgaWYgKGZyYWN0RGlnaXRzIDwgMCB8fCBmcmFjdERpZ2l0cyA+IDIwKSB0aHJvdyBSYW5nZUVycm9yKCdJbmNvcnJlY3QgZnJhY3Rpb24gZGlnaXRzJyk7CgkgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXNlbGYtY29tcGFyZSAtLSBOYU4gY2hlY2sKCSAgICBpZiAobnVtYmVyICE9IG51bWJlcikgcmV0dXJuICdOYU4nOwoJICAgIGlmIChudW1iZXIgPD0gLTFlMjEgfHwgbnVtYmVyID49IDFlMjEpIHJldHVybiBTdHJpbmckMihudW1iZXIpOwoJICAgIGlmIChudW1iZXIgPCAwKSB7CgkgICAgICBzaWduID0gJy0nOwoJICAgICAgbnVtYmVyID0gLW51bWJlcjsKCSAgICB9CgkgICAgaWYgKG51bWJlciA+IDFlLTIxKSB7CgkgICAgICBlID0gbG9nKG51bWJlciAqIHBvdygyLCA2OSwgMSkpIC0gNjk7CgkgICAgICB6ID0gZSA8IDAgPyBudW1iZXIgKiBwb3coMiwgLWUsIDEpIDogbnVtYmVyIC8gcG93KDIsIGUsIDEpOwoJICAgICAgeiAqPSAweDEwMDAwMDAwMDAwMDAwOwoJICAgICAgZSA9IDUyIC0gZTsKCSAgICAgIGlmIChlID4gMCkgewoJICAgICAgICBtdWx0aXBseShkYXRhLCAwLCB6KTsKCSAgICAgICAgaiA9IGZyYWN0RGlnaXRzOwoJICAgICAgICB3aGlsZSAoaiA+PSA3KSB7CgkgICAgICAgICAgbXVsdGlwbHkoZGF0YSwgMWU3LCAwKTsKCSAgICAgICAgICBqIC09IDc7CgkgICAgICAgIH0KCSAgICAgICAgbXVsdGlwbHkoZGF0YSwgcG93KDEwLCBqLCAxKSwgMCk7CgkgICAgICAgIGogPSBlIC0gMTsKCSAgICAgICAgd2hpbGUgKGogPj0gMjMpIHsKCSAgICAgICAgICBkaXZpZGUoZGF0YSwgMSA8PCAyMyk7CgkgICAgICAgICAgaiAtPSAyMzsKCSAgICAgICAgfQoJICAgICAgICBkaXZpZGUoZGF0YSwgMSA8PCBqKTsKCSAgICAgICAgbXVsdGlwbHkoZGF0YSwgMSwgMSk7CgkgICAgICAgIGRpdmlkZShkYXRhLCAyKTsKCSAgICAgICAgcmVzdWx0ID0gZGF0YVRvU3RyaW5nKGRhdGEpOwoJICAgICAgfSBlbHNlIHsKCSAgICAgICAgbXVsdGlwbHkoZGF0YSwgMCwgeik7CgkgICAgICAgIG11bHRpcGx5KGRhdGEsIDEgPDwgLWUsIDApOwoJICAgICAgICByZXN1bHQgPSBkYXRhVG9TdHJpbmcoZGF0YSkgKyByZXBlYXQoJzAnLCBmcmFjdERpZ2l0cyk7CgkgICAgICB9CgkgICAgfQoJICAgIGlmIChmcmFjdERpZ2l0cyA+IDApIHsKCSAgICAgIGsgPSByZXN1bHQubGVuZ3RoOwoJICAgICAgcmVzdWx0ID0gc2lnbiArIChrIDw9IGZyYWN0RGlnaXRzCgkgICAgICAgID8gJzAuJyArIHJlcGVhdCgnMCcsIGZyYWN0RGlnaXRzIC0gaykgKyByZXN1bHQKCSAgICAgICAgOiBzdHJpbmdTbGljZShyZXN1bHQsIDAsIGsgLSBmcmFjdERpZ2l0cykgKyAnLicgKyBzdHJpbmdTbGljZShyZXN1bHQsIGsgLSBmcmFjdERpZ2l0cykpOwoJICAgIH0gZWxzZSB7CgkgICAgICByZXN1bHQgPSBzaWduICsgcmVzdWx0OwoJICAgIH0gcmV0dXJuIHJlc3VsdDsKCSAgfQoJfSk7CgoJdmFyIGdsb2JhbCQzID0gZ2xvYmFsJDE4OwoJdmFyIGlzQ2FsbGFibGUkMSA9IGlzQ2FsbGFibGUkdjsKCgl2YXIgU3RyaW5nJDEgPSBnbG9iYWwkMy5TdHJpbmc7Cgl2YXIgVHlwZUVycm9yJDIgPSBnbG9iYWwkMy5UeXBlRXJyb3I7CgoJdmFyIGFQb3NzaWJsZVByb3RvdHlwZSQxID0gZnVuY3Rpb24gKGFyZ3VtZW50KSB7CgkgIGlmICh0eXBlb2YgYXJndW1lbnQgPT0gJ29iamVjdCcgfHwgaXNDYWxsYWJsZSQxKGFyZ3VtZW50KSkgcmV0dXJuIGFyZ3VtZW50OwoJICB0aHJvdyBUeXBlRXJyb3IkMigiQ2FuJ3Qgc2V0ICIgKyBTdHJpbmckMShhcmd1bWVudCkgKyAnIGFzIGEgcHJvdG90eXBlJyk7Cgl9OwoKCS8qIGVzbGludC1kaXNhYmxlIG5vLXByb3RvIC0tIHNhZmUgKi8KCgl2YXIgdW5jdXJyeVRoaXMkNCA9IGZ1bmN0aW9uVW5jdXJyeVRoaXMkMTsKCXZhciBhbk9iamVjdCA9IGFuT2JqZWN0JGo7Cgl2YXIgYVBvc3NpYmxlUHJvdG90eXBlID0gYVBvc3NpYmxlUHJvdG90eXBlJDE7CgoJLy8gYE9iamVjdC5zZXRQcm90b3R5cGVPZmAgbWV0aG9kCgkvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLW9iamVjdC5zZXRwcm90b3R5cGVvZgoJLy8gV29ya3Mgd2l0aCBfX3Byb3RvX18gb25seS4gT2xkIHY4IGNhbid0IHdvcmsgd2l0aCBudWxsIHByb3RvIG9iamVjdHMuCgkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZXMvbm8tb2JqZWN0LXNldHByb3RvdHlwZW9mIC0tIHNhZmUKCXZhciBvYmplY3RTZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCAoJ19fcHJvdG9fXycgaW4ge30gPyBmdW5jdGlvbiAoKSB7CgkgIHZhciBDT1JSRUNUX1NFVFRFUiA9IGZhbHNlOwoJICB2YXIgdGVzdCA9IHt9OwoJICB2YXIgc2V0dGVyOwoJICB0cnkgewoJICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBlcy9uby1vYmplY3QtZ2V0b3ducHJvcGVydHlkZXNjcmlwdG9yIC0tIHNhZmUKCSAgICBzZXR0ZXIgPSB1bmN1cnJ5VGhpcyQ0KE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoT2JqZWN0LnByb3RvdHlwZSwgJ19fcHJvdG9fXycpLnNldCk7CgkgICAgc2V0dGVyKHRlc3QsIFtdKTsKCSAgICBDT1JSRUNUX1NFVFRFUiA9IHRlc3QgaW5zdGFuY2VvZiBBcnJheTsKCSAgfSBjYXRjaCAoZXJyb3IpIHsgLyogZW1wdHkgKi8gfQoJICByZXR1cm4gZnVuY3Rpb24gc2V0UHJvdG90eXBlT2YoTywgcHJvdG8pIHsKCSAgICBhbk9iamVjdChPKTsKCSAgICBhUG9zc2libGVQcm90b3R5cGUocHJvdG8pOwoJICAgIGlmIChDT1JSRUNUX1NFVFRFUikgc2V0dGVyKE8sIHByb3RvKTsKCSAgICBlbHNlIE8uX19wcm90b19fID0gcHJvdG87CgkgICAgcmV0dXJuIE87CgkgIH07Cgl9KCkgOiB1bmRlZmluZWQpOwoKCXZhciBpc0NhbGxhYmxlID0gaXNDYWxsYWJsZSR2OwoJdmFyIGlzT2JqZWN0ID0gaXNPYmplY3QkaTsKCXZhciBzZXRQcm90b3R5cGVPZiA9IG9iamVjdFNldFByb3RvdHlwZU9mOwoKCS8vIG1ha2VzIHN1YmNsYXNzaW5nIHdvcmsgY29ycmVjdCBmb3Igd3JhcHBlZCBidWlsdC1pbnMKCXZhciBpbmhlcml0SWZSZXF1aXJlZCQxID0gZnVuY3Rpb24gKCR0aGlzLCBkdW1teSwgV3JhcHBlcikgewoJICB2YXIgTmV3VGFyZ2V0LCBOZXdUYXJnZXRQcm90b3R5cGU7CgkgIGlmICgKCSAgICAvLyBpdCBjYW4gd29yayBvbmx5IHdpdGggbmF0aXZlIGBzZXRQcm90b3R5cGVPZmAKCSAgICBzZXRQcm90b3R5cGVPZiAmJgoJICAgIC8vIHdlIGhhdmVuJ3QgY29tcGxldGVseSBjb3JyZWN0IHByZS1FUzYgd2F5IGZvciBnZXR0aW5nIGBuZXcudGFyZ2V0YCwgc28gdXNlIHRoaXMKCSAgICBpc0NhbGxhYmxlKE5ld1RhcmdldCA9IGR1bW15LmNvbnN0cnVjdG9yKSAmJgoJICAgIE5ld1RhcmdldCAhPT0gV3JhcHBlciAmJgoJICAgIGlzT2JqZWN0KE5ld1RhcmdldFByb3RvdHlwZSA9IE5ld1RhcmdldC5wcm90b3R5cGUpICYmCgkgICAgTmV3VGFyZ2V0UHJvdG90eXBlICE9PSBXcmFwcGVyLnByb3RvdHlwZQoJICApIHNldFByb3RvdHlwZU9mKCR0aGlzLCBOZXdUYXJnZXRQcm90b3R5cGUpOwoJICByZXR1cm4gJHRoaXM7Cgl9OwoKCS8vIGEgc3RyaW5nIG9mIGFsbCB2YWxpZCB1bmljb2RlIHdoaXRlc3BhY2VzCgl2YXIgd2hpdGVzcGFjZXMkMiA9ICdcdTAwMDlcdTAwMEFcdTAwMEJcdTAwMENcdTAwMERcdTAwMjBcdTAwQTBcdTE2ODBcdTIwMDBcdTIwMDFcdTIwMDInICsKCSAgJ1x1MjAwM1x1MjAwNFx1MjAwNVx1MjAwNlx1MjAwN1x1MjAwOFx1MjAwOVx1MjAwQVx1MjAyRlx1MjA1Rlx1MzAwMFx1MjAyOFx1MjAyOVx1RkVGRic7CgoJdmFyIHVuY3VycnlUaGlzJDMgPSBmdW5jdGlvblVuY3VycnlUaGlzJDE7Cgl2YXIgcmVxdWlyZU9iamVjdENvZXJjaWJsZSA9IHJlcXVpcmVPYmplY3RDb2VyY2libGUkZDsKCXZhciB0b1N0cmluZyQxID0gdG9TdHJpbmckaDsKCXZhciB3aGl0ZXNwYWNlcyQxID0gd2hpdGVzcGFjZXMkMjsKCgl2YXIgcmVwbGFjZSA9IHVuY3VycnlUaGlzJDMoJycucmVwbGFjZSk7Cgl2YXIgd2hpdGVzcGFjZSA9ICdbJyArIHdoaXRlc3BhY2VzJDEgKyAnXSc7Cgl2YXIgbHRyaW0gPSBSZWdFeHAoJ14nICsgd2hpdGVzcGFjZSArIHdoaXRlc3BhY2UgKyAnKicpOwoJdmFyIHJ0cmltID0gUmVnRXhwKHdoaXRlc3BhY2UgKyB3aGl0ZXNwYWNlICsgJyokJyk7CgoJLy8gYFN0cmluZy5wcm90b3R5cGUueyB0cmltLCB0cmltU3RhcnQsIHRyaW1FbmQsIHRyaW1MZWZ0LCB0cmltUmlnaHQgfWAgbWV0aG9kcyBpbXBsZW1lbnRhdGlvbgoJdmFyIGNyZWF0ZU1ldGhvZCA9IGZ1bmN0aW9uIChUWVBFKSB7CgkgIHJldHVybiBmdW5jdGlvbiAoJHRoaXMpIHsKCSAgICB2YXIgc3RyaW5nID0gdG9TdHJpbmckMShyZXF1aXJlT2JqZWN0Q29lcmNpYmxlKCR0aGlzKSk7CgkgICAgaWYgKFRZUEUgJiAxKSBzdHJpbmcgPSByZXBsYWNlKHN0cmluZywgbHRyaW0sICcnKTsKCSAgICBpZiAoVFlQRSAmIDIpIHN0cmluZyA9IHJlcGxhY2Uoc3RyaW5nLCBydHJpbSwgJycpOwoJICAgIHJldHVybiBzdHJpbmc7CgkgIH07Cgl9OwoKCXZhciBzdHJpbmdUcmltID0gewoJICAvLyBgU3RyaW5nLnByb3RvdHlwZS57IHRyaW1MZWZ0LCB0cmltU3RhcnQgfWAgbWV0aG9kcwoJICAvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLXN0cmluZy5wcm90b3R5cGUudHJpbXN0YXJ0CgkgIHN0YXJ0OiBjcmVhdGVNZXRob2QoMSksCgkgIC8vIGBTdHJpbmcucHJvdG90eXBlLnsgdHJpbVJpZ2h0LCB0cmltRW5kIH1gIG1ldGhvZHMKCSAgLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1zdHJpbmcucHJvdG90eXBlLnRyaW1lbmQKCSAgZW5kOiBjcmVhdGVNZXRob2QoMiksCgkgIC8vIGBTdHJpbmcucHJvdG90eXBlLnRyaW1gIG1ldGhvZAoJICAvLyBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jc2VjLXN0cmluZy5wcm90b3R5cGUudHJpbQoJICB0cmltOiBjcmVhdGVNZXRob2QoMykKCX07CgoJdmFyIERFU0NSSVBUT1JTID0gZGVzY3JpcHRvcnMkMTsKCXZhciBnbG9iYWwkMiA9IGdsb2JhbCQxODsKCXZhciB1bmN1cnJ5VGhpcyQyID0gZnVuY3Rpb25VbmN1cnJ5VGhpcyQxOwoJdmFyIGlzRm9yY2VkID0gaXNGb3JjZWRfMSQxOwoJdmFyIHJlZGVmaW5lID0gcmVkZWZpbmUkOC5leHBvcnRzOwoJdmFyIGhhc093biA9IGhhc093blByb3BlcnR5XzEkMTsKCXZhciBpbmhlcml0SWZSZXF1aXJlZCA9IGluaGVyaXRJZlJlcXVpcmVkJDE7Cgl2YXIgaXNQcm90b3R5cGVPZiQxID0gb2JqZWN0SXNQcm90b3R5cGVPZiQxOwoJdmFyIGlzU3ltYm9sID0gaXNTeW1ib2wkNzsKCXZhciB0b1ByaW1pdGl2ZSA9IHRvUHJpbWl0aXZlJDQ7Cgl2YXIgZmFpbHMkMSA9IGZhaWxzJHQ7Cgl2YXIgZ2V0T3duUHJvcGVydHlOYW1lcyA9IG9iamVjdEdldE93blByb3BlcnR5TmFtZXMkMS5mOwoJdmFyIGdldE93blByb3BlcnR5RGVzY3JpcHRvciA9IG9iamVjdEdldE93blByb3BlcnR5RGVzY3JpcHRvciQxLmY7Cgl2YXIgZGVmaW5lUHJvcGVydHkgPSBvYmplY3REZWZpbmVQcm9wZXJ0eSQxLmY7Cgl2YXIgdGhpc051bWJlclZhbHVlID0gdGhpc051bWJlclZhbHVlJDI7Cgl2YXIgdHJpbSQxID0gc3RyaW5nVHJpbS50cmltOwoKCXZhciBOVU1CRVIgPSAnTnVtYmVyJzsKCXZhciBOYXRpdmVOdW1iZXIgPSBnbG9iYWwkMltOVU1CRVJdOwoJdmFyIE51bWJlclByb3RvdHlwZSA9IE5hdGl2ZU51bWJlci5wcm90b3R5cGU7Cgl2YXIgVHlwZUVycm9yJDEgPSBnbG9iYWwkMi5UeXBlRXJyb3I7Cgl2YXIgYXJyYXlTbGljZSA9IHVuY3VycnlUaGlzJDIoJycuc2xpY2UpOwoJdmFyIGNoYXJDb2RlQXQgPSB1bmN1cnJ5VGhpcyQyKCcnLmNoYXJDb2RlQXQpOwoKCS8vIGBUb051bWVyaWNgIGFic3RyYWN0IG9wZXJhdGlvbgoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy10b251bWVyaWMKCXZhciB0b051bWVyaWMgPSBmdW5jdGlvbiAodmFsdWUpIHsKCSAgdmFyIHByaW1WYWx1ZSA9IHRvUHJpbWl0aXZlKHZhbHVlLCAnbnVtYmVyJyk7CgkgIHJldHVybiB0eXBlb2YgcHJpbVZhbHVlID09ICdiaWdpbnQnID8gcHJpbVZhbHVlIDogdG9OdW1iZXIocHJpbVZhbHVlKTsKCX07CgoJLy8gYFRvTnVtYmVyYCBhYnN0cmFjdCBvcGVyYXRpb24KCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtdG9udW1iZXIKCXZhciB0b051bWJlciA9IGZ1bmN0aW9uIChhcmd1bWVudCkgewoJICB2YXIgaXQgPSB0b1ByaW1pdGl2ZShhcmd1bWVudCwgJ251bWJlcicpOwoJICB2YXIgZmlyc3QsIHRoaXJkLCByYWRpeCwgbWF4Q29kZSwgZGlnaXRzLCBsZW5ndGgsIGluZGV4LCBjb2RlOwoJICBpZiAoaXNTeW1ib2woaXQpKSB0aHJvdyBUeXBlRXJyb3IkMSgnQ2Fubm90IGNvbnZlcnQgYSBTeW1ib2wgdmFsdWUgdG8gYSBudW1iZXInKTsKCSAgaWYgKHR5cGVvZiBpdCA9PSAnc3RyaW5nJyAmJiBpdC5sZW5ndGggPiAyKSB7CgkgICAgaXQgPSB0cmltJDEoaXQpOwoJICAgIGZpcnN0ID0gY2hhckNvZGVBdChpdCwgMCk7CgkgICAgaWYgKGZpcnN0ID09PSA0MyB8fCBmaXJzdCA9PT0gNDUpIHsKCSAgICAgIHRoaXJkID0gY2hhckNvZGVBdChpdCwgMik7CgkgICAgICBpZiAodGhpcmQgPT09IDg4IHx8IHRoaXJkID09PSAxMjApIHJldHVybiBOYU47IC8vIE51bWJlcignKzB4MScpIHNob3VsZCBiZSBOYU4sIG9sZCBWOCBmaXgKCSAgICB9IGVsc2UgaWYgKGZpcnN0ID09PSA0OCkgewoJICAgICAgc3dpdGNoIChjaGFyQ29kZUF0KGl0LCAxKSkgewoJICAgICAgICBjYXNlIDY2OiBjYXNlIDk4OiByYWRpeCA9IDI7IG1heENvZGUgPSA0OTsgYnJlYWs7IC8vIGZhc3QgZXF1YWwgb2YgL14wYlswMV0rJC9pCgkgICAgICAgIGNhc2UgNzk6IGNhc2UgMTExOiByYWRpeCA9IDg7IG1heENvZGUgPSA1NTsgYnJlYWs7IC8vIGZhc3QgZXF1YWwgb2YgL14wb1swLTddKyQvaQoJICAgICAgICBkZWZhdWx0OiByZXR1cm4gK2l0OwoJICAgICAgfQoJICAgICAgZGlnaXRzID0gYXJyYXlTbGljZShpdCwgMik7CgkgICAgICBsZW5ndGggPSBkaWdpdHMubGVuZ3RoOwoJICAgICAgZm9yIChpbmRleCA9IDA7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrKSB7CgkgICAgICAgIGNvZGUgPSBjaGFyQ29kZUF0KGRpZ2l0cywgaW5kZXgpOwoJICAgICAgICAvLyBwYXJzZUludCBwYXJzZXMgYSBzdHJpbmcgdG8gYSBmaXJzdCB1bmF2YWlsYWJsZSBzeW1ib2wKCSAgICAgICAgLy8gYnV0IFRvTnVtYmVyIHNob3VsZCByZXR1cm4gTmFOIGlmIGEgc3RyaW5nIGNvbnRhaW5zIHVuYXZhaWxhYmxlIHN5bWJvbHMKCSAgICAgICAgaWYgKGNvZGUgPCA0OCB8fCBjb2RlID4gbWF4Q29kZSkgcmV0dXJuIE5hTjsKCSAgICAgIH0gcmV0dXJuIHBhcnNlSW50KGRpZ2l0cywgcmFkaXgpOwoJICAgIH0KCSAgfSByZXR1cm4gK2l0OwoJfTsKCgkvLyBgTnVtYmVyYCBjb25zdHJ1Y3RvcgoJLy8gaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvI3NlYy1udW1iZXItY29uc3RydWN0b3IKCWlmIChpc0ZvcmNlZChOVU1CRVIsICFOYXRpdmVOdW1iZXIoJyAwbzEnKSB8fCAhTmF0aXZlTnVtYmVyKCcwYjEnKSB8fCBOYXRpdmVOdW1iZXIoJysweDEnKSkpIHsKCSAgdmFyIE51bWJlcldyYXBwZXIgPSBmdW5jdGlvbiBOdW1iZXIodmFsdWUpIHsKCSAgICB2YXIgbiA9IGFyZ3VtZW50cy5sZW5ndGggPCAxID8gMCA6IE5hdGl2ZU51bWJlcih0b051bWVyaWModmFsdWUpKTsKCSAgICB2YXIgZHVtbXkgPSB0aGlzOwoJICAgIC8vIGNoZWNrIG9uIDEuLmNvbnN0cnVjdG9yKGZvbykgY2FzZQoJICAgIHJldHVybiBpc1Byb3RvdHlwZU9mJDEoTnVtYmVyUHJvdG90eXBlLCBkdW1teSkgJiYgZmFpbHMkMShmdW5jdGlvbiAoKSB7IHRoaXNOdW1iZXJWYWx1ZShkdW1teSk7IH0pCgkgICAgICA/IGluaGVyaXRJZlJlcXVpcmVkKE9iamVjdChuKSwgZHVtbXksIE51bWJlcldyYXBwZXIpIDogbjsKCSAgfTsKCSAgZm9yICh2YXIga2V5cyA9IERFU0NSSVBUT1JTID8gZ2V0T3duUHJvcGVydHlOYW1lcyhOYXRpdmVOdW1iZXIpIDogKAoJICAgIC8vIEVTMzoKCSAgICAnTUFYX1ZBTFVFLE1JTl9WQUxVRSxOYU4sTkVHQVRJVkVfSU5GSU5JVFksUE9TSVRJVkVfSU5GSU5JVFksJyArCgkgICAgLy8gRVMyMDE1IChpbiBjYXNlLCBpZiBtb2R1bGVzIHdpdGggRVMyMDE1IE51bWJlciBzdGF0aWNzIHJlcXVpcmVkIGJlZm9yZSk6CgkgICAgJ0VQU0lMT04sTUFYX1NBRkVfSU5URUdFUixNSU5fU0FGRV9JTlRFR0VSLGlzRmluaXRlLGlzSW50ZWdlcixpc05hTixpc1NhZmVJbnRlZ2VyLHBhcnNlRmxvYXQscGFyc2VJbnQsJyArCgkgICAgLy8gRVNOZXh0CgkgICAgJ2Zyb21TdHJpbmcscmFuZ2UnCgkgICkuc3BsaXQoJywnKSwgaiA9IDAsIGtleTsga2V5cy5sZW5ndGggPiBqOyBqKyspIHsKCSAgICBpZiAoaGFzT3duKE5hdGl2ZU51bWJlciwga2V5ID0ga2V5c1tqXSkgJiYgIWhhc093bihOdW1iZXJXcmFwcGVyLCBrZXkpKSB7CgkgICAgICBkZWZpbmVQcm9wZXJ0eShOdW1iZXJXcmFwcGVyLCBrZXksIGdldE93blByb3BlcnR5RGVzY3JpcHRvcihOYXRpdmVOdW1iZXIsIGtleSkpOwoJICAgIH0KCSAgfQoJICBOdW1iZXJXcmFwcGVyLnByb3RvdHlwZSA9IE51bWJlclByb3RvdHlwZTsKCSAgTnVtYmVyUHJvdG90eXBlLmNvbnN0cnVjdG9yID0gTnVtYmVyV3JhcHBlcjsKCSAgcmVkZWZpbmUoZ2xvYmFsJDIsIE5VTUJFUiwgTnVtYmVyV3JhcHBlcik7Cgl9CgoJdmFyIGdsb2JhbCQxID0gZ2xvYmFsJEc7Cgl2YXIgZmFpbHMgPSBmYWlscyRnOwoJdmFyIHVuY3VycnlUaGlzJDEgPSBmdW5jdGlvblVuY3VycnlUaGlzOwoJdmFyIHRvU3RyaW5nID0gdG9TdHJpbmckNzsKCXZhciB0cmltID0gc3RyaW5nVHJpbSQxLnRyaW07Cgl2YXIgd2hpdGVzcGFjZXMgPSB3aGl0ZXNwYWNlcyQ1OwoKCXZhciBjaGFyQXQgPSB1bmN1cnJ5VGhpcyQxKCcnLmNoYXJBdCk7Cgl2YXIgbiRQYXJzZUZsb2F0ID0gZ2xvYmFsJDEucGFyc2VGbG9hdDsKCXZhciBTeW1ib2wkMSA9IGdsb2JhbCQxLlN5bWJvbDsKCXZhciBJVEVSQVRPUiA9IFN5bWJvbCQxICYmIFN5bWJvbCQxLml0ZXJhdG9yOwoJdmFyIEZPUkNFRCA9IDEgLyBuJFBhcnNlRmxvYXQod2hpdGVzcGFjZXMgKyAnLTAnKSAhPT0gLUluZmluaXR5CgkgIC8vIE1TIEVkZ2UgMTgtIGJyb2tlbiB3aXRoIGJveGVkIHN5bWJvbHMKCSAgfHwgKElURVJBVE9SICYmICFmYWlscyhmdW5jdGlvbiAoKSB7IG4kUGFyc2VGbG9hdChPYmplY3QoSVRFUkFUT1IpKTsgfSkpOwoKCS8vIGBwYXJzZUZsb2F0YCBtZXRob2QKCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtcGFyc2VmbG9hdC1zdHJpbmcKCXZhciBudW1iZXJQYXJzZUZsb2F0ID0gRk9SQ0VEID8gZnVuY3Rpb24gcGFyc2VGbG9hdChzdHJpbmcpIHsKCSAgdmFyIHRyaW1tZWRTdHJpbmcgPSB0cmltKHRvU3RyaW5nKHN0cmluZykpOwoJICB2YXIgcmVzdWx0ID0gbiRQYXJzZUZsb2F0KHRyaW1tZWRTdHJpbmcpOwoJICByZXR1cm4gcmVzdWx0ID09PSAwICYmIGNoYXJBdCh0cmltbWVkU3RyaW5nLCAwKSA9PSAnLScgPyAtMCA6IHJlc3VsdDsKCX0gOiBuJFBhcnNlRmxvYXQ7CgoJdmFyICQkMSA9IF9leHBvcnQ7Cgl2YXIgJHBhcnNlRmxvYXQgPSBudW1iZXJQYXJzZUZsb2F0OwoKCS8vIGBwYXJzZUZsb2F0YCBtZXRob2QKCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtcGFyc2VmbG9hdC1zdHJpbmcKCSQkMSh7IGdsb2JhbDogdHJ1ZSwgZm9yY2VkOiBwYXJzZUZsb2F0ICE9ICRwYXJzZUZsb2F0IH0sIHsKCSAgcGFyc2VGbG9hdDogJHBhcnNlRmxvYXQKCX0pOwoKCXZhciBwYXRoID0gcGF0aCQ4OwoKCXZhciBfcGFyc2VGbG9hdCQyID0gcGF0aC5wYXJzZUZsb2F0OwoKCXZhciBwYXJlbnQkMSA9IF9wYXJzZUZsb2F0JDI7CgoJdmFyIF9wYXJzZUZsb2F0JDEgPSBwYXJlbnQkMTsKCgl2YXIgX3BhcnNlRmxvYXQgPSBfcGFyc2VGbG9hdCQxOwoKCXZhciAkID0gX2V4cG9ydDsKCXZhciB1bmN1cnJ5VGhpcyA9IGZ1bmN0aW9uVW5jdXJyeVRoaXM7Cgl2YXIgaXNBcnJheSA9IGlzQXJyYXkkNTsKCgl2YXIgdW4kUmV2ZXJzZSA9IHVuY3VycnlUaGlzKFtdLnJldmVyc2UpOwoJdmFyIHRlc3QgPSBbMSwgMl07CgoJLy8gYEFycmF5LnByb3RvdHlwZS5yZXZlcnNlYCBtZXRob2QKCS8vIGh0dHBzOi8vdGMzOS5lcy9lY21hMjYyLyNzZWMtYXJyYXkucHJvdG90eXBlLnJldmVyc2UKCS8vIGZpeCBmb3IgU2FmYXJpIDEyLjAgYnVnCgkvLyBodHRwczovL2J1Z3Mud2Via2l0Lm9yZy9zaG93X2J1Zy5jZ2k/aWQ9MTg4Nzk0CgkkKHsgdGFyZ2V0OiAnQXJyYXknLCBwcm90bzogdHJ1ZSwgZm9yY2VkOiBTdHJpbmcodGVzdCkgPT09IFN0cmluZyh0ZXN0LnJldmVyc2UoKSkgfSwgewoJICByZXZlcnNlOiBmdW5jdGlvbiByZXZlcnNlKCkgewoJICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1zZWxmLWFzc2lnbiAtLSBkaXJ0eSBoYWNrCgkgICAgaWYgKGlzQXJyYXkodGhpcykpIHRoaXMubGVuZ3RoID0gdGhpcy5sZW5ndGg7CgkgICAgcmV0dXJuIHVuJFJldmVyc2UodGhpcyk7CgkgIH0KCX0pOwoKCXZhciBlbnRyeVZpcnR1YWwgPSBlbnRyeVZpcnR1YWwkODsKCgl2YXIgcmV2ZXJzZSQzID0gZW50cnlWaXJ0dWFsKCdBcnJheScpLnJldmVyc2U7CgoJdmFyIGlzUHJvdG90eXBlT2YgPSBvYmplY3RJc1Byb3RvdHlwZU9mOwoJdmFyIG1ldGhvZCA9IHJldmVyc2UkMzsKCgl2YXIgQXJyYXlQcm90b3R5cGUgPSBBcnJheS5wcm90b3R5cGU7CgoJdmFyIHJldmVyc2UkMiA9IGZ1bmN0aW9uIChpdCkgewoJICB2YXIgb3duID0gaXQucmV2ZXJzZTsKCSAgcmV0dXJuIGl0ID09PSBBcnJheVByb3RvdHlwZSB8fCAoaXNQcm90b3R5cGVPZihBcnJheVByb3RvdHlwZSwgaXQpICYmIG93biA9PT0gQXJyYXlQcm90b3R5cGUucmV2ZXJzZSkgPyBtZXRob2QgOiBvd247Cgl9OwoKCXZhciBwYXJlbnQgPSByZXZlcnNlJDI7CgoJdmFyIHJldmVyc2UkMSA9IHBhcmVudDsKCgl2YXIgcmV2ZXJzZSA9IHJldmVyc2UkMTsKCglmdW5jdGlvbiBoYW1taW5nKE0pIHsKCSAgdmFyIGFyciA9IFtdOwoKCSAgZm9yICh2YXIgbiA9IDA7IG4gPCBNOyBuKyspIHsKCSAgICB2YXIgZm9ybXVsYSA9IDAuNTQgLSA0NiAqIE1hdGguY29zKDIgKiBNYXRoLlBJICogbiAvIChNIC0gMSkpIC8gMTAwOwoJICAgIGFyci5wdXNoKF9wYXJzZUZsb2F0KGZvcm11bGEudG9GaXhlZCg4KSkpOwoJICB9CgoJICByZXR1cm4gYXJyOwoJfSAvLyDnm67liY3lj6rmlK/mjIHkuIDnu7TjgIHkuoznu7TmlbDnu4Tovaznva7lpITnkIYKCglmdW5jdGlvbiB0cmFuc3Bvc2UyRChtYXRyaXgpIHsKCSAgaWYgKG1hdHJpeCA9PT0gdm9pZCAwKSB7CgkgICAgbWF0cml4ID0gW107CgkgIH0KCgkgIHZhciBtYXRyaXhUID0gW107CgoJICBpZiAobWF0cml4IGluc3RhbmNlb2YgQXJyYXkpIHsKCSAgICBpZiAobWF0cml4WzBdIGluc3RhbmNlb2YgQXJyYXkpIHsKCSAgICAgIGZvckVhY2gobWF0cml4KS5jYWxsKG1hdHJpeCwgZnVuY3Rpb24gKGl0ZW0sIHJvdykgewoJICAgICAgICBmb3JFYWNoKGl0ZW0pLmNhbGwoaXRlbSwgZnVuY3Rpb24gKGNlbGwsIGNvbCkgewoJICAgICAgICAgIGlmIChtYXRyaXhUW2NvbF0gPT09IHVuZGVmaW5lZCkgbWF0cml4VFtjb2xdID0gW107CgkgICAgICAgICAgbWF0cml4VFtjb2xdW3Jvd10gPSBjZWxsOwoJICAgICAgICB9KTsKCSAgICAgIH0pOwoJICAgIH0gZWxzZSB7CgkgICAgICByZXR1cm4gbWF0cml4OwoJICAgIH0KCSAgfSBlbHNlIHsKCSAgICByZXR1cm4gbWF0cml4OwoJICB9CgoJICByZXR1cm4gbWF0cml4VDsKCX0KCS8vIOWPqueUqOS6huWkhOeQhuS4gOe7tOaVsOe7hCzph4fnlKjlgoXph4zlj7blj5jmjaLvvIzljp/lm6BweXRob27nmoRjb252b2x2Zee7meWHugoJLy8gaW4xIOS4unNhbXBsZe+8jCBpbjIg5Li6a2VybmFsCgoJZnVuY3Rpb24gZmZ0Y29udm9sdmUoaW4xLCBpbjIpIHsKCSAgaWYgKGluMSA9PT0gdm9pZCAwKSB7CgkgICAgaW4xID0gW107CgkgIH0KCgkgIGlmIChpbjIgPT09IHZvaWQgMCkgewoJICAgIGluMiA9IFtdOwoJICB9CgoJICAvLywgbW9kZSA9ICJ2YWxpZCIsIGF4ZXMgPSBudWxsCgkgIC8vIOWboOS4uuWPquaYr+S4gOe7tO+8jOaJgOS7peS4jeS7v+eFp3B5dGhvbuS6hu+8jOebtOaOpeagueaNruS4gOe7tOefqemYteacieaViOWNt+enr+mAu+i+keW8gOWPkQoJICBpZiAoaW4yLmxlbmd0aCA+IGluMS5sZW5ndGgpIHsKCSAgICB2YXIgdGVtcCA9IGluMTsKCSAgICBpbjEgPSBpbjI7CgkgICAgaW4yID0gdGVtcDsKCSAgICB0ZW1wID0gbnVsbDsKCSAgfQoKCSAgdmFyIHNsID0gaW4xLmxlbmd0aCwKCSAgICAgIGtsID0gaW4yLmxlbmd0aCwKCSAgICAgIHRpbWVzID0gc2wgLSBrbCArIDEsCgkgICAgICByZXN1bHQgPSBbXTsKCSAgaW4yID0gcmV2ZXJzZShpbjIpLmNhbGwoaW4yKTsKCgkgIGZvciAodmFyIHNpID0gMDsgc2kgPCB0aW1lczsgc2krKykgewoJICAgIHZhciBfdGVtcCA9IDA7CgoJICAgIGZvciAodmFyIGtpID0gMDsga2kgPCBrbDsga2krKykgewoJICAgICAgX3RlbXAgKz0gaW4xW3NpICsga2ldICogaW4yW2tpXTsKCSAgICB9CgoJICAgIHJlc3VsdC5wdXNoKF90ZW1wKTsKCSAgfQoKCSAgcmV0dXJuIHJlc3VsdDsKCX0KCS8vICAgICBpZiAoIWF4ZXMubGVuZ3RoKSB7CgkvLyAgICAgICAgIHJldHVybjsKCS8vICAgICB9CgkvLyAgICAgbGV0IGZzaGFwZSA9IFtdOwoJLy8gICAgIGlmIChjYWxjX2Zhc3RfbGVuKSB7CgkvLyAgICAgICAgIGZzaGFwZSA9IFtdOwoJLy8gICAgIH0gZWxzZSB7CgkvLyAgICAgICAgIGZzaGFwZSA9IHNoYXBlOwoJLy8gICAgIH0KCS8vIH0KCS8vIOS4jiBweXRob24g6K6h566X57uT5p6c5LiN5LiA5qC3CgkvLyBmdW5jdGlvbiBibGFja21hbiAoTSkgewoJLy8gICAgIGNvbnN0IGFyciA9IFtdCgkvLyAJZm9yIChsZXQgbiA9IDA7IG4gPCBNOyBuKyspIHsKCS8vICAgICAgICAgY29uc3QgZm9ybXVsYSA9ICg0MiAtIDUwICogTWF0aC5jb3MoIDIgKiBNYXRoLlBJICogbiAvIE0pICsgOCAqIE1hdGguY29zKDQgKiBNYXRoLlBJICogbiAvIE0pICkgLyAxMDAKCS8vIAkJYXJyLnB1c2goZm9ybXVsYSkKCS8vIAl9CgkvLyAgICAgcmV0dXJuIGFycgoJLy8gfQoJLy8g5qih5oufIG5wLmhhbW1pbmcoMTIpLnN1bSgpCgkvLyBsZXQgc3VtID0gMAoJLy8gY29uc3QgaGFtbWluZ1N1bSA9IGhhbW1pbmcoMTIpCgkvLyBmb3IgKGxldCBpID0gMDsgaTwxMjsgaSsrKSB7CgkvLyAgICAgc3VtICs9aGFtbWluZ1N1bVtpXQoJLy8gfQoJLy8gY29uc29sZS5sb2coc3VtKQoJLy8gY29uc3QgW2EgLCB2ICwgYl0gPSBbWzEsMiwzXSwgWyAwLjAzNTcxNDI5ICwgMC4yNDEwNzE0MyAsIDAuNDQ2NDI4NTcgLCAwLjI0MTA3MTQzICwgMC4wMzU3MTQyOV0sIFsgMCwgMSwgMC41LCAyXV0KCS8vIGNvbnNvbGUubG9nKGZmdGNvbnZvbHZlKGEsIHYpKQoKCXZhciBwMnBfcGF0aCA9IHsKCSAgInNpbCI6IFsic2lsIl0sCgkgICJhIjogWyJhIl0sCgkgICJhaSI6IFsiYXkiXSwKCSAgImFuIjogWyJhIiwgIm50Il0sCgkgICJhbmciOiBbImEiLCAibmciXSwKCSAgImFvIjogWyJhdyJdLAoJICAiYmEiOiBbImIiLCAiYSJdLAoJICAiYmFpIjogWyJiIiwgImF5Il0sCgkgICJiYW4iOiBbImIiLCAiYSIsICJudCJdLAoJICAiYmFuZyI6IFsiYiIsICJhIiwgIm5nIl0sCgkgICJiYW8iOiBbImIiLCAiYXciXSwKCSAgImJlaSI6IFsiYiIsICJleSJdLAoJICAiYmVuIjogWyJiIiwgImUiLCAibnQiXSwKCSAgImJlbmciOiBbImIiLCAiZSIsICJuZyJdLAoJICAiYmkiOiBbImIiLCAiaSJdLAoJICAiYmlhbiI6IFsiYiIsICJ5IiwgImEiLCAibnQiXSwKCSAgImJpYW8iOiBbImIiLCAieSIsICJhdyJdLAoJICAiYmllIjogWyJiIiwgInkiLCAiaWUiXSwKCSAgImJpbiI6IFsiYiIsICJpIiwgIm50Il0sCgkgICJiaW5nIjogWyJiIiwgImkiLCAibmciXSwKCSAgImJvIjogWyJiIiwgIm8iXSwKCSAgImJ1IjogWyJiIiwgInUiXSwKCSAgImNhIjogWyJjIiwgImEiXSwKCSAgImNhaSI6IFsiYyIsICJheSJdLAoJICAiY2FuIjogWyJjIiwgImEiLCAibnQiXSwKCSAgImNhbmciOiBbImMiLCAiYSIsICJuZyJdLAoJICAiY2FvIjogWyJjIiwgImF3Il0sCgkgICJjZSI6IFsiYyIsICJlIl0sCgkgICJjZW4iOiBbImMiLCAiZSIsICJudCJdLAoJICAiY2VuZyI6IFsiYyIsICJlIiwgIm5nIl0sCgkgICJjaGEiOiBbImNoIiwgImEiXSwKCSAgImNoYWkiOiBbImNoIiwgImF5Il0sCgkgICJjaGFuIjogWyJjaCIsICJhIiwgIm50Il0sCgkgICJjaGFuZyI6IFsiY2giLCAiYSIsICJuZyJdLAoJICAiY2hhbyI6IFsiY2giLCAiYXciXSwKCSAgImNoZSI6IFsiY2giLCAiZSJdLAoJICAiY2hlbiI6IFsiY2giLCAiZSIsICJudCJdLAoJICAiY2hlbmciOiBbImNoIiwgImUiLCAibmciXSwKCSAgImNoaSI6IFsiY2giLCAiY2hpIl0sCgkgICJjaG9uZyI6IFsiY2giLCAibyIsICJuZyJdLAoJICAiY2hvdSI6IFsiY2giLCAib3ciXSwKCSAgImNodSI6IFsiY2giLCAidSJdLAoJICAiY2h1YSI6IFsiY2giLCAidyIsICJhIl0sCgkgICJjaHVhaSI6IFsiY2giLCAidyIsICJheSJdLAoJICAiY2h1YW4iOiBbImNoIiwgInciLCAiYSIsICJudCJdLAoJICAiY2h1YW5nIjogWyJjaCIsICJ3IiwgImEiLCAibmciXSwKCSAgImNodWkiOiBbImNoIiwgInciLCAiZXkiXSwKCSAgImNodW4iOiBbImNoIiwgInciLCAiZSIsICJudCJdLAoJICAiY2h1byI6IFsiY2giLCAidyIsICJvIl0sCgkgICJjaSI6IFsiYyIsICJjaSJdLAoJICAiY29uZyI6IFsiYyIsICJvIiwgIm5nIl0sCgkgICJjb3UiOiBbImMiLCAib3ciXSwKCSAgImN1IjogWyJjIiwgInUiXSwKCSAgImN1YW4iOiBbImMiLCAidyIsICJhIiwgIm50Il0sCgkgICJjdWkiOiBbImMiLCAidyIsICJleSJdLAoJICAiY3VuIjogWyJjIiwgInciLCAiZSIsICJudCJdLAoJICAiY3VvIjogWyJjIiwgInciLCAibyJdLAoJICAiZGEiOiBbImQiLCAiYSJdLAoJICAiZGFpIjogWyJkIiwgImF5Il0sCgkgICJkYW4iOiBbImQiLCAiYSIsICJudCJdLAoJICAiZGFuZyI6IFsiZCIsICJhIiwgIm5nIl0sCgkgICJkYW8iOiBbImQiLCAiYXciXSwKCSAgImRlIjogWyJkIiwgImUiXSwKCSAgImRlaSI6IFsiZCIsICJleSJdLAoJICAiZGVuIjogWyJkIiwgImUiLCAibnQiXSwKCSAgImRlbmciOiBbImQiLCAiZSIsICJuZyJdLAoJICAiZGkiOiBbImQiLCAiaSJdLAoJICAiZGlhIjogWyJkIiwgInkiLCAiYSJdLAoJICAiZGlhbiI6IFsiZCIsICJ5IiwgImEiLCAibnQiXSwKCSAgImRpYW8iOiBbImQiLCAieSIsICJhdyJdLAoJICAiZGllIjogWyJkIiwgInkiLCAiaWUiXSwKCSAgImRpbmciOiBbImQiLCAiaSIsICJuZyJdLAoJICAiZGl1IjogWyJkIiwgInkiLCAibyIsICJ3Il0sCgkgICJkb25nIjogWyJkIiwgIm8iLCAibmciXSwKCSAgImRvdSI6IFsiZCIsICJvdyJdLAoJICAiZHUiOiBbImQiLCAidSJdLAoJICAiZHVhbiI6IFsiZCIsICJ3IiwgImEiLCAibnQiXSwKCSAgImR1aSI6IFsiZCIsICJ3IiwgImV5Il0sCgkgICJkdW4iOiBbImQiLCAidyIsICJlIiwgIm50Il0sCgkgICJkdW8iOiBbImQiLCAidyIsICJvIl0sCgkgICJlIjogWyJlIl0sCgkgICJlaSI6IFsiZXkiXSwKCSAgImVuIjogWyJlIiwgIm50Il0sCgkgICJlbmciOiBbImUiLCAibmciXSwKCSAgImVyIjogWyJlciJdLAoJICAiZmEiOiBbImYiLCAiYSJdLAoJICAiZmFuIjogWyJmIiwgImEiLCAibnQiXSwKCSAgImZhbmciOiBbImYiLCAiYSIsICJuZyJdLAoJICAiZmVpIjogWyJmIiwgImV5Il0sCgkgICJmZW4iOiBbImYiLCAiZSIsICJudCJdLAoJICAiZmVuZyI6IFsiZiIsICJlIiwgIm5nIl0sCgkgICJmaWFvIjogWyJmIiwgInkiLCAiYXciXSwKCSAgImZvIjogWyJmIiwgIm8iXSwKCSAgImZvdSI6IFsiZiIsICJvdyJdLAoJICAiZnUiOiBbImYiLCAidSJdLAoJICAiZ2EiOiBbImciLCAiYSJdLAoJICAiZ2FpIjogWyJnIiwgImF5Il0sCgkgICJnYW4iOiBbImciLCAiYSIsICJudCJdLAoJICAiZ2FuZyI6IFsiZyIsICJhIiwgIm5nIl0sCgkgICJnYW8iOiBbImciLCAiYXciXSwKCSAgImdlIjogWyJnIiwgImUiXSwKCSAgImdlaSI6IFsiZyIsICJleSJdLAoJICAiZ2VuIjogWyJnIiwgImUiLCAibnQiXSwKCSAgImdlbmciOiBbImciLCAiZSIsICJuZyJdLAoJICAiZ29uZyI6IFsiZyIsICJvIiwgIm5nIl0sCgkgICJnb3UiOiBbImciLCAib3ciXSwKCSAgImd1IjogWyJnIiwgInUiXSwKCSAgImd1YSI6IFsiZyIsICJ3IiwgImEiXSwKCSAgImd1YWkiOiBbImciLCAidyIsICJheSJdLAoJICAiZ3VhbiI6IFsiZyIsICJ3IiwgImEiLCAibnQiXSwKCSAgImd1YW5nIjogWyJnIiwgInciLCAiYSIsICJuZyJdLAoJICAiZ3VpIjogWyJnIiwgInciLCAiZXkiXSwKCSAgImd1biI6IFsiZyIsICJ3IiwgImUiLCAibnQiXSwKCSAgImd1byI6IFsiZyIsICJ3IiwgIm8iXSwKCSAgImhhIjogWyJoIiwgImEiXSwKCSAgImhhaSI6IFsiaCIsICJheSJdLAoJICAiaGFuIjogWyJoIiwgImEiLCAibnQiXSwKCSAgImhhbmciOiBbImgiLCAiYSIsICJuZyJdLAoJICAiaGFvIjogWyJoIiwgImF3Il0sCgkgICJoZSI6IFsiaCIsICJlIl0sCgkgICJoZWkiOiBbImgiLCAiZXkiXSwKCSAgImhlbiI6IFsiaCIsICJlIiwgIm50Il0sCgkgICJoZW5nIjogWyJoIiwgImUiLCAibmciXSwKCSAgImhvbmciOiBbImgiLCAibyIsICJuZyJdLAoJICAiaG91IjogWyJoIiwgIm93Il0sCgkgICJodSI6IFsiaCIsICJ1Il0sCgkgICJodWEiOiBbImgiLCAidyIsICJhIl0sCgkgICJodWFpIjogWyJoIiwgInciLCAiYXkiXSwKCSAgImh1YW4iOiBbImgiLCAidyIsICJhIiwgIm50Il0sCgkgICJodWFuZyI6IFsiaCIsICJ3IiwgImEiLCAibmciXSwKCSAgImh1aSI6IFsiaCIsICJ3IiwgImV5Il0sCgkgICJodW4iOiBbImgiLCAidyIsICJlIiwgIm50Il0sCgkgICJodW8iOiBbImgiLCAidyIsICJvIl0sCgkgICJqaSI6IFsiaiIsICJpIl0sCgkgICJqaWEiOiBbImoiLCAieSIsICJhIl0sCgkgICJqaWFuIjogWyJqIiwgInkiLCAiYSIsICJudCJdLAoJICAiamlhbmciOiBbImoiLCAieSIsICJhIiwgIm5nIl0sCgkgICJqaWFvIjogWyJqIiwgInkiLCAiYXciXSwKCSAgImppZSI6IFsiaiIsICJ5IiwgImllIl0sCgkgICJqaW4iOiBbImoiLCAiaSIsICJudCJdLAoJICAiamluZyI6IFsiaiIsICJpIiwgIm5nIl0sCgkgICJqaW9uZyI6IFsiaiIsICJ5IiwgIm8iLCAibmciXSwKCSAgImppdSI6IFsiaiIsICJ5IiwgIm8iLCAidyJdLAoJICAianUiOiBbImoiLCAieXYiXSwKCSAgImp1YW4iOiBbImoiLCAidyIsICJhIiwgIm50Il0sCgkgICJqdWUiOiBbImoiLCAidyIsICJlIl0sCgkgICJqdW4iOiBbImoiLCAidyIsICJlIiwgIm50Il0sCgkgICJrYSI6IFsiayIsICJhIl0sCgkgICJrYWkiOiBbImsiLCAiYXkiXSwKCSAgImthbiI6IFsiayIsICJhIiwgIm50Il0sCgkgICJrYW5nIjogWyJrIiwgImEiLCAibmciXSwKCSAgImthbyI6IFsiayIsICJhdyJdLAoJICAia2UiOiBbImsiLCAiZSJdLAoJICAia2VpIjogWyJrIiwgImV5Il0sCgkgICJrZW4iOiBbImsiLCAiZSIsICJudCJdLAoJICAia2VuZyI6IFsiayIsICJlIiwgIm5nIl0sCgkgICJrb25nIjogWyJrIiwgIm8iLCAibmciXSwKCSAgImtvdSI6IFsiayIsICJvdyJdLAoJICAia3UiOiBbImsiLCAidSJdLAoJICAia3VhIjogWyJrIiwgInciLCAiYSJdLAoJICAia3VhaSI6IFsiayIsICJ3IiwgImF5Il0sCgkgICJrdWFuIjogWyJrIiwgInciLCAiYSIsICJudCJdLAoJICAia3VhbmciOiBbImsiLCAidyIsICJhIiwgIm5nIl0sCgkgICJrdWkiOiBbImsiLCAidyIsICJleSJdLAoJICAia3VuIjogWyJrIiwgInciLCAiZSIsICJudCJdLAoJICAia3VvIjogWyJrIiwgInciLCAibyJdLAoJICAibGEiOiBbImwiLCAiYSJdLAoJICAibGFpIjogWyJsIiwgImF5Il0sCgkgICJsYW4iOiBbImwiLCAiYSIsICJudCJdLAoJICAibGFuZyI6IFsibCIsICJhIiwgIm5nIl0sCgkgICJsYW8iOiBbImwiLCAiYXciXSwKCSAgImxlIjogWyJsIiwgImUiXSwKCSAgImxlaSI6IFsibCIsICJleSJdLAoJICAibGVuZyI6IFsibCIsICJlIiwgIm5nIl0sCgkgICJsaSI6IFsibCIsICJpIl0sCgkgICJsaWEiOiBbImwiLCAieSIsICJhIl0sCgkgICJsaWFuIjogWyJsIiwgInkiLCAiYSIsICJudCJdLAoJICAibGlhbmciOiBbImwiLCAieSIsICJhIiwgIm5nIl0sCgkgICJsaWFvIjogWyJsIiwgInkiLCAiYXciXSwKCSAgImxpZSI6IFsibCIsICJ5IiwgImllIl0sCgkgICJsaW4iOiBbImwiLCAiaSIsICJudCJdLAoJICAibGluZyI6IFsibCIsICJpIiwgIm5nIl0sCgkgICJsaXUiOiBbImwiLCAieSIsICJvIiwgInciXSwKCSAgImxvIjogWyJsIiwgIm8iXSwKCSAgImxvbmciOiBbImwiLCAibyIsICJuZyJdLAoJICAibG91IjogWyJsIiwgIm93Il0sCgkgICJsdSI6IFsibCIsICJ1Il0sCgkgICJsdWFuIjogWyJsIiwgInciLCAiYSIsICJudCJdLAoJICAibHVlIjogWyJsIiwgInYiLCAiaWUiXSwKCSAgImx1biI6IFsibCIsICJ3IiwgImUiLCAibnQiXSwKCSAgImx1byI6IFsibCIsICJ3IiwgIm8iXSwKCSAgImx2IjogWyJsIiwgInl2Il0sCgkgICJsdmUiOiBbImwiLCAidiIsICJpZSJdLAoJICAibWEiOiBbIm0iLCAiYSJdLAoJICAibWFpIjogWyJtIiwgImF5Il0sCgkgICJtYW4iOiBbIm0iLCAiYSIsICJudCJdLAoJICAibWFuZyI6IFsibSIsICJhIiwgIm5nIl0sCgkgICJtYW8iOiBbIm0iLCAiYXciXSwKCSAgIm1lIjogWyJtIiwgImUiXSwKCSAgIm1laSI6IFsibSIsICJleSJdLAoJICAibWVuIjogWyJtIiwgImUiLCAibnQiXSwKCSAgIm1lbmciOiBbIm0iLCAiZSIsICJuZyJdLAoJICAibWkiOiBbIm0iLCAiaSJdLAoJICAibWlhbiI6IFsibSIsICJ5IiwgImEiLCAibnQiXSwKCSAgIm1pYW8iOiBbIm0iLCAieSIsICJhdyJdLAoJICAibWllIjogWyJtIiwgInkiLCAiaWUiXSwKCSAgIm1pbiI6IFsibSIsICJpIiwgIm50Il0sCgkgICJtaW5nIjogWyJtIiwgImkiLCAibmciXSwKCSAgIm1pdSI6IFsibSIsICJ5IiwgIm8iLCAidyJdLAoJICAibW8iOiBbIm0iLCAibyJdLAoJICAibW91IjogWyJtIiwgIm93Il0sCgkgICJtdSI6IFsibSIsICJ1Il0sCgkgICJuYSI6IFsibiIsICJhIl0sCgkgICJuYWkiOiBbIm4iLCAiYXkiXSwKCSAgIm5hbiI6IFsibiIsICJhIiwgIm50Il0sCgkgICJuYW5nIjogWyJuIiwgImEiLCAibmciXSwKCSAgIm5hbyI6IFsibiIsICJhdyJdLAoJICAibmUiOiBbIm4iLCAiZSJdLAoJICAibmVpIjogWyJuIiwgImV5Il0sCgkgICJuZW4iOiBbIm4iLCAiZSIsICJudCJdLAoJICAibmVuZyI6IFsibiIsICJlIiwgIm5nIl0sCgkgICJuZyI6IFsiZSIsICJuZyJdLAoJICAibmkiOiBbIm4iLCAiaSJdLAoJICAibmlhbiI6IFsibiIsICJ5IiwgImEiLCAibnQiXSwKCSAgIm5pYW5nIjogWyJuIiwgInkiLCAiYSIsICJuZyJdLAoJICAibmlhbyI6IFsibiIsICJ5IiwgImF3Il0sCgkgICJuaWUiOiBbIm4iLCAieSIsICJpZSJdLAoJICAibmluIjogWyJuIiwgImkiLCAibnQiXSwKCSAgIm5pbmciOiBbIm4iLCAiaSIsICJuZyJdLAoJICAibml1IjogWyJuIiwgInkiLCAibyIsICJ3Il0sCgkgICJub25nIjogWyJuIiwgIm8iLCAibmciXSwKCSAgIm5vdSI6IFsibiIsICJvdyJdLAoJICAibnUiOiBbIm4iLCAidSJdLAoJICAibnVhbiI6IFsibiIsICJ3IiwgImEiLCAibnQiXSwKCSAgIm51biI6IFsibiIsICJ3IiwgImUiLCAibnQiXSwKCSAgIm51byI6IFsibiIsICJ3IiwgIm8iXSwKCSAgIm52IjogWyJuIiwgInl2Il0sCgkgICJudmUiOiBbIm4iLCAidiIsICJlIl0sCgkgICJvIjogWyJvIl0sCgkgICJvdSI6IFsib3ciXSwKCSAgInBhIjogWyJwIiwgImEiXSwKCSAgInBhaSI6IFsicCIsICJheSJdLAoJICAicGFuIjogWyJwIiwgImEiLCAibnQiXSwKCSAgInBhbmciOiBbInAiLCAiYSIsICJuZyJdLAoJICAicGFvIjogWyJwIiwgImF3Il0sCgkgICJwZWkiOiBbInAiLCAiZXkiXSwKCSAgInBlbiI6IFsicCIsICJlIiwgIm50Il0sCgkgICJwZW5nIjogWyJwIiwgImUiLCAibmciXSwKCSAgInBpIjogWyJwIiwgImkiXSwKCSAgInBpYW4iOiBbInAiLCAieSIsICJhIiwgIm50Il0sCgkgICJwaWFvIjogWyJwIiwgInkiLCAiYXciXSwKCSAgInBpZSI6IFsicCIsICJ5IiwgImllIl0sCgkgICJwaW4iOiBbInAiLCAiaSIsICJudCJdLAoJICAicGluZyI6IFsicCIsICJpIiwgIm5nIl0sCgkgICJwbyI6IFsicCIsICJvIl0sCgkgICJwb3UiOiBbInAiLCAib3ciXSwKCSAgInB1IjogWyJwIiwgInUiXSwKCSAgInFpIjogWyJxIiwgImkiXSwKCSAgInFpYSI6IFsicSIsICJ5IiwgImEiXSwKCSAgInFpYW4iOiBbInEiLCAieSIsICJhIiwgIm50Il0sCgkgICJxaWFuZyI6IFsicSIsICJ5IiwgImEiLCAibmciXSwKCSAgInFpYW8iOiBbInEiLCAieSIsICJhdyJdLAoJICAicWllIjogWyJxIiwgInkiLCAiaWUiXSwKCSAgInFpbiI6IFsicSIsICJpIiwgIm50Il0sCgkgICJxaW5nIjogWyJxIiwgImkiLCAibmciXSwKCSAgInFpb25nIjogWyJxIiwgInkiLCAibyIsICJuZyJdLAoJICAicWl1IjogWyJxIiwgInkiLCAibyIsICJ3Il0sCgkgICJxdSI6IFsicSIsICJ5diJdLAoJICAicXVhbiI6IFsicSIsICJ3IiwgImEiLCAibnQiXSwKCSAgInF1ZSI6IFsicSIsICJ3IiwgImUiXSwKCSAgInF1biI6IFsicSIsICJ3IiwgImUiLCAibnQiXSwKCSAgInJhbiI6IFsiciIsICJhIiwgIm50Il0sCgkgICJyYW5nIjogWyJyIiwgImEiLCAibmciXSwKCSAgInJhbyI6IFsiciIsICJhdyJdLAoJICAicmUiOiBbInIiLCAiZSJdLAoJICAicmVuIjogWyJyIiwgImUiLCAibnQiXSwKCSAgInJlbmciOiBbInIiLCAiZSIsICJuZyJdLAoJICAicmkiOiBbInIiLCAicmkiXSwKCSAgInJvbmciOiBbInIiLCAibyIsICJuZyJdLAoJICAicm91IjogWyJyIiwgIm93Il0sCgkgICJydSI6IFsiciIsICJ1Il0sCgkgICJydWFuIjogWyJyIiwgInciLCAiYSIsICJudCJdLAoJICAicnVpIjogWyJyIiwgInciLCAiZXkiXSwKCSAgInJ1biI6IFsiciIsICJ3IiwgImUiLCAibnQiXSwKCSAgInJ1byI6IFsiciIsICJ3IiwgIm8iXSwKCSAgInNhIjogWyJzIiwgImEiXSwKCSAgInNhaSI6IFsicyIsICJheSJdLAoJICAic2FuIjogWyJzIiwgImEiLCAibnQiXSwKCSAgInNhbmciOiBbInMiLCAiYSIsICJuZyJdLAoJICAic2FvIjogWyJzIiwgImF3Il0sCgkgICJzZSI6IFsicyIsICJlIl0sCgkgICJzZW4iOiBbInMiLCAiZSIsICJudCJdLAoJICAic2VuZyI6IFsicyIsICJlIiwgIm5nIl0sCgkgICJzaGEiOiBbInNoIiwgImEiXSwKCSAgInNoYWkiOiBbInNoIiwgImF5Il0sCgkgICJzaGFuIjogWyJzaCIsICJhIiwgIm50Il0sCgkgICJzaGFuZyI6IFsic2giLCAiYSIsICJuZyJdLAoJICAic2hhbyI6IFsic2giLCAiYXciXSwKCSAgInNoZSI6IFsic2giLCAiZSJdLAoJICAic2hlaSI6IFsic2giLCAiZXkiXSwKCSAgInNoZW4iOiBbInNoIiwgImUiLCAibnQiXSwKCSAgInNoZW5nIjogWyJzaCIsICJlIiwgIm5nIl0sCgkgICJzaGkiOiBbInNoIiwgImNoaSJdLAoJICAic2hvdSI6IFsic2giLCAib3ciXSwKCSAgInNodSI6IFsic2giLCAidSJdLAoJICAic2h1YSI6IFsic2giLCAidyIsICJhIl0sCgkgICJzaHVhaSI6IFsic2giLCAidyIsICJheSJdLAoJICAic2h1YW4iOiBbInNoIiwgInciLCAiYSIsICJudCJdLAoJICAic2h1YW5nIjogWyJzaCIsICJ3IiwgImEiLCAibmciXSwKCSAgInNodWkiOiBbInNoIiwgInciLCAiZXkiXSwKCSAgInNodW4iOiBbInNoIiwgInciLCAiZSIsICJudCJdLAoJICAic2h1byI6IFsic2giLCAidyIsICJvIl0sCgkgICJzaSI6IFsicyIsICJjaSJdLAoJICAic29uZyI6IFsicyIsICJvIiwgIm5nIl0sCgkgICJzb3UiOiBbInMiLCAib3ciXSwKCSAgInN1IjogWyJzIiwgInUiXSwKCSAgInN1YW4iOiBbInMiLCAidyIsICJhIiwgIm50Il0sCgkgICJzdWkiOiBbInMiLCAidyIsICJleSJdLAoJICAic3VuIjogWyJzIiwgInciLCAiZSIsICJudCJdLAoJICAic3VvIjogWyJzIiwgInciLCAibyJdLAoJICAidGEiOiBbInQiLCAiYSJdLAoJICAidGFpIjogWyJ0IiwgImF5Il0sCgkgICJ0YW4iOiBbInQiLCAiYSIsICJudCJdLAoJICAidGFuZyI6IFsidCIsICJhIiwgIm5nIl0sCgkgICJ0YW8iOiBbInQiLCAiYXciXSwKCSAgInRlIjogWyJ0IiwgImUiXSwKCSAgInRlaSI6IFsidCIsICJleSJdLAoJICAidGVuZyI6IFsidCIsICJlIiwgIm5nIl0sCgkgICJ0aSI6IFsidCIsICJpIl0sCgkgICJ0aWFuIjogWyJ0IiwgInkiLCAiYSIsICJudCJdLAoJICAidGlhbyI6IFsidCIsICJ5IiwgImF3Il0sCgkgICJ0aWUiOiBbInQiLCAieSIsICJpZSJdLAoJICAidGluZyI6IFsidCIsICJpIiwgIm5nIl0sCgkgICJ0b25nIjogWyJ0IiwgIm8iLCAibmciXSwKCSAgInRvdSI6IFsidCIsICJvdyJdLAoJICAidHUiOiBbInQiLCAidSJdLAoJICAidHVhbiI6IFsidCIsICJ3IiwgImEiLCAibnQiXSwKCSAgInR1aSI6IFsidCIsICJ3IiwgImV5Il0sCgkgICJ0dW4iOiBbInQiLCAidyIsICJlIiwgIm50Il0sCgkgICJ0dW8iOiBbInQiLCAidyIsICJvIl0sCgkgICJ3YSI6IFsidyIsICJhIl0sCgkgICJ3YWkiOiBbInciLCAiYXkiXSwKCSAgIndhbiI6IFsidyIsICJhIiwgIm50Il0sCgkgICJ3YW5nIjogWyJ3IiwgImEiLCAibmciXSwKCSAgIndlaSI6IFsidyIsICJleSJdLAoJICAid2VuIjogWyJ3IiwgImUiLCAibnQiXSwKCSAgIndlbmciOiBbInciLCAiZSIsICJuZyJdLAoJICAid28iOiBbInciLCAibyJdLAoJICAid3UiOiBbInciLCAidSJdLAoJICAieGkiOiBbIngiLCAiaSJdLAoJICAieGlhIjogWyJ4IiwgInkiLCAiYSJdLAoJICAieGlhbiI6IFsieCIsICJ5IiwgImEiLCAibnQiXSwKCSAgInhpYW5nIjogWyJ4IiwgInkiLCAiYSIsICJuZyJdLAoJICAieGlhbyI6IFsieCIsICJ5IiwgImF3Il0sCgkgICJ4aWUiOiBbIngiLCAieSIsICJpZSJdLAoJICAieGluIjogWyJ4IiwgImkiLCAibnQiXSwKCSAgInhpbmciOiBbIngiLCAiaSIsICJuZyJdLAoJICAieGlvbmciOiBbIngiLCAieSIsICJvIiwgIm5nIl0sCgkgICJ4aXUiOiBbIngiLCAieSIsICJvIiwgInciXSwKCSAgInh1IjogWyJ4IiwgInl2Il0sCgkgICJ4dWFuIjogWyJ4IiwgInciLCAiYSIsICJudCJdLAoJICAieHVlIjogWyJ4IiwgInciLCAiZSJdLAoJICAieHVuIjogWyJ4IiwgInYiLCAiZSIsICJudCJdLAoJICAieWEiOiBbInkiLCAiYSJdLAoJICAieWFuIjogWyJ5IiwgImEiLCAibnQiXSwKCSAgInlhbmciOiBbInkiLCAiYSIsICJuZyJdLAoJICAieWFvIjogWyJ5IiwgImF3Il0sCgkgICJ5ZSI6IFsieSIsICJpZSJdLAoJICAieWkiOiBbInkiLCAiaSJdLAoJICAieWluIjogWyJ5IiwgImkiLCAibnQiXSwKCSAgInlpbmciOiBbInkiLCAiaSIsICJuZyJdLAoJICAieW8iOiBbInkiLCAiYXciXSwKCSAgInlvbmciOiBbInkiLCAibyIsICJuZyJdLAoJICAieW91IjogWyJ5IiwgIm93Il0sCgkgICJ5dSI6IFsieXYiXSwKCSAgInl1YW4iOiBbInl2IiwgImEiLCAibnQiXSwKCSAgInl1ZSI6IFsieXYiLCAiZSJdLAoJICAieXVuIjogWyJ5diIsICJlIiwgIm50Il0sCgkgICJ6YSI6IFsieiIsICJhIl0sCgkgICJ6YWkiOiBbInoiLCAiYXkiXSwKCSAgInphbiI6IFsieiIsICJhIiwgIm50Il0sCgkgICJ6YW5nIjogWyJ6IiwgImEiLCAibmciXSwKCSAgInphbyI6IFsieiIsICJhdyJdLAoJICAiemUiOiBbInoiLCAiZSJdLAoJICAiemVpIjogWyJ6IiwgImV5Il0sCgkgICJ6ZW4iOiBbInoiLCAiZSIsICJudCJdLAoJICAiemVuZyI6IFsieiIsICJlIiwgIm5nIl0sCgkgICJ6aGEiOiBbInpoIiwgImEiXSwKCSAgInpoYWkiOiBbInpoIiwgImF5Il0sCgkgICJ6aGFuIjogWyJ6aCIsICJhIiwgIm50Il0sCgkgICJ6aGFuZyI6IFsiemgiLCAiYSIsICJuZyJdLAoJICAiemhhbyI6IFsiemgiLCAiYXciXSwKCSAgInpoZSI6IFsiemgiLCAiZSJdLAoJICAiemhlaSI6IFsiemgiLCAiZXkiXSwKCSAgInpoZW4iOiBbInpoIiwgImUiLCAibnQiXSwKCSAgInpoZW5nIjogWyJ6aCIsICJlIiwgIm5nIl0sCgkgICJ6aGkiOiBbInpoIiwgImNoaSJdLAoJICAiemhvbmciOiBbInpoIiwgIm8iLCAibmciXSwKCSAgInpob3UiOiBbInpoIiwgIm93Il0sCgkgICJ6aHUiOiBbInpoIiwgInUiXSwKCSAgInpodWEiOiBbInpoIiwgInciLCAiYSJdLAoJICAiemh1YWkiOiBbInpoIiwgInciLCAiYXkiXSwKCSAgInpodWFuIjogWyJ6aCIsICJ3IiwgImEiLCAibnQiXSwKCSAgInpodWFuZyI6IFsiemgiLCAidyIsICJhIiwgIm5nIl0sCgkgICJ6aHVpIjogWyJ6aCIsICJ3IiwgImV5Il0sCgkgICJ6aHVuIjogWyJ6aCIsICJ3IiwgImUiLCAibnQiXSwKCSAgInpodW8iOiBbInpoIiwgInciLCAibyJdLAoJICAiemkiOiBbInoiLCAiY2kiXSwKCSAgInpvbmciOiBbInoiLCAibyIsICJuZyJdLAoJICAiem91IjogWyJ6IiwgIm93Il0sCgkgICJ6dSI6IFsieiIsICJ1Il0sCgkgICJ6dWFuIjogWyJ6IiwgInciLCAiYSIsICJudCJdLAoJICAienVpIjogWyJ6IiwgInciLCAiZXkiXSwKCSAgInp1biI6IFsieiIsICJ3IiwgImUiLCAibnQiXSwKCSAgInp1byI6IFsieiIsICJ3IiwgIm8iXQoJfTsKCgl2YXIgcDJ2X3BhdGggPSB7CgkgICJzaWwiOiAic2lsIiwKCSAgImEiOiAiYSIsCgkgICJhdyI6ICJhIiwKCSAgImF5IjogImEiLAoJICAiYiI6ICJicG0iLAoJICAiYyI6ICJldGMiLAoJICAiY2giOiAiaSIsCgkgICJjaGkiOiAiaSIsCgkgICJjaSI6ICJpIiwKCSAgImQiOiAiZXRjIiwKCSAgImUiOiAiZSIsCgkgICJlciI6ICJlIiwKCSAgImV5IjogImUiLAoJICAiZiI6ICJmdiIsCgkgICJnIjogImV0YyIsCgkgICJoIjogImV0YyIsCgkgICJpIjogImkiLAoJICAiaWUiOiAiaSIsCgkgICJqIjogImV0YyIsCgkgICJrIjogImV0YyIsCgkgICJsIjogImV0YyIsCgkgICJtIjogImJwbSIsCgkgICJuIjogImV0YyIsCgkgICJuZyI6ICJldGMiLAoJICAibnQiOiAiZXRjIiwKCSAgIm8iOiAibyIsCgkgICJvdyI6ICJvIiwKCSAgInAiOiAiYnBtIiwKCSAgInEiOiAiZXRjIiwKCSAgInIiOiAiZSIsCgkgICJyaSI6ICJlIiwKCSAgInMiOiAiaSIsCgkgICJzaCI6ICJpIiwKCSAgInQiOiAiZXRjIiwKCSAgInUiOiAidSIsCgkgICJ2IjogInUiLAoJICAidyI6ICJ1IiwKCSAgIngiOiAiaSIsCgkgICJ5IjogImkiLAoJICAieXYiOiAidSIsCgkgICJ6IjogImkiLAoJICAiemgiOiAiaSIsCgkgICJBQSI6ICJhIiwKCSAgIkFFIjogImEiLAoJICAiQUgiOiAiZSIsCgkgICJBTyI6ICJhIiwKCSAgIkFXIjogImEiLAoJICAiQVkiOiAiZSIsCgkgICJCIjogImJwbSIsCgkgICJDSCI6ICJpIiwKCSAgIkQiOiAiZXRjIiwKCSAgIkRIIjogImkiLAoJICAiRUgiOiAiYSIsCgkgICJFUiI6ICJlIiwKCSAgIkVZIjogImUiLAoJICAiRiI6ICJmdiIsCgkgICJHIjogImV0YyIsCgkgICJISCI6ICJldGMiLAoJICAiSUgiOiAiZSIsCgkgICJJWSI6ICJpIiwKCSAgIkpIIjogImkiLAoJICAiSyI6ICJldGMiLAoJICAiTCI6ICJldGMiLAoJICAiTSI6ICJicG0iLAoJICAiTiI6ICJldGMiLAoJICAiTkciOiAiZXRjIiwKCSAgIk9XIjogIm8iLAoJICAiT1kiOiAidSIsCgkgICJQIjogImJwbSIsCgkgICJSIjogImUiLAoJICAiUyI6ICJpIiwKCSAgIlNIIjogImkiLAoJICAiVCI6ICJldGMiLAoJICAiVEgiOiAiaSIsCgkgICJVSCI6ICJ1IiwKCSAgIlVXIjogInUiLAoJICAiViI6ICJmdiIsCgkgICJXIjogInUiLAoJICAiWSI6ICJpIiwKCSAgIloiOiAiZXRjIiwKCSAgIlpIIjogImV0YyIKCX07CgoJdmFyIHYyY19wYXRoID0gewoJICAic2lsIjogWzAsIDAsIDAsIDAsIDBdLAoJICAiYSI6IFsxLCAwLCAwLCAwLCAwXSwKCSAgImkiOiBbMCwgMSwgMCwgMCwgMF0sCgkgICJ1IjogWzAsIDAsIDEsIDAsIDBdLAoJICAiZSI6IFswLCAwLCAwLCAxLCAwXSwKCSAgIm8iOiBbMCwgMCwgMCwgMCwgMV0sCgkgICJicG0iOiBbMCwgMCwgMCwgMCwgMF0sCgkgICJmdiI6IFswLCAwLCAwLCAwLCAwXSwKCSAgImV0YyI6IFswLCAwLjIsIDAuMiwgMCwgMF0KCX07CgoJZnVuY3Rpb24gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXJMb29zZShvLCBhbGxvd0FycmF5TGlrZSkgeyB2YXIgaXQgPSB0eXBlb2Ygc3ltYm9sICE9PSAidW5kZWZpbmVkIiAmJiBnZXRJdGVyYXRvck1ldGhvZChvKSB8fCBvWyJAQGl0ZXJhdG9yIl07IGlmIChpdCkgcmV0dXJuIChpdCA9IGl0LmNhbGwobykpLm5leHQuYmluZChpdCk7IGlmIChBcnJheS5pc0FycmF5KG8pIHx8IChpdCA9IF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvKSkgfHwgYWxsb3dBcnJheUxpa2UgJiYgbyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSB7IGlmIChpdCkgbyA9IGl0OyB2YXIgaSA9IDA7IHJldHVybiBmdW5jdGlvbiAoKSB7IGlmIChpID49IG8ubGVuZ3RoKSByZXR1cm4geyBkb25lOiB0cnVlIH07IHJldHVybiB7IGRvbmU6IGZhbHNlLCB2YWx1ZTogb1tpKytdIH07IH07IH0gdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGl0ZXJhdGUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpOyB9CgoJZnVuY3Rpb24gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8sIG1pbkxlbikgeyB2YXIgX2NvbnRleHQ3OyBpZiAoIW8pIHJldHVybjsgaWYgKHR5cGVvZiBvID09PSAic3RyaW5nIikgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7IHZhciBuID0gc2xpY2UoX2NvbnRleHQ3ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pKS5jYWxsKF9jb250ZXh0NywgOCwgLTEpOyBpZiAobiA9PT0gIk9iamVjdCIgJiYgby5jb25zdHJ1Y3RvcikgbiA9IG8uY29uc3RydWN0b3IubmFtZTsgaWYgKG4gPT09ICJNYXAiIHx8IG4gPT09ICJTZXQiKSByZXR1cm4gZnJvbShvKTsgaWYgKG4gPT09ICJBcmd1bWVudHMiIHx8IC9eKD86VWl8SSludCg/Ojh8MTZ8MzIpKD86Q2xhbXBlZCk/QXJyYXkkLy50ZXN0KG4pKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTsgfQoKCWZ1bmN0aW9uIF9hcnJheUxpa2VUb0FycmF5KGFyciwgbGVuKSB7IGlmIChsZW4gPT0gbnVsbCB8fCBsZW4gPiBhcnIubGVuZ3RoKSBsZW4gPSBhcnIubGVuZ3RoOyBmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShsZW4pOyBpIDwgbGVuOyBpKyspIHsgYXJyMltpXSA9IGFycltpXTsgfSByZXR1cm4gYXJyMjsgfQoKCXZhciBmbHRfc2l6ZSA9IDU7Cgl2YXIgZmx0X3R5cGUgPSAnaGFtbWluZyc7Cgl2YXIgbm9pc2VfbHZsID0gMC4wMTU7Cgl2YXIgYmxpbmsgPSBbMywgNywgMC4xXTsKCgl2YXIgUGlueWluMlBob25lID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKCSAgZnVuY3Rpb24gUGlueWluMlBob25lKHAycF9wYXRoKSB7CgkgICAgdGhpcy5wMnAgPSBwMnBfcGF0aDsKCSAgfQoKCSAgdmFyIF9wcm90byA9IFBpbnlpbjJQaG9uZS5wcm90b3R5cGU7CgoJICBfcHJvdG8uY29udmVydCA9IGZ1bmN0aW9uIGNvbnZlcnQoc2VxKSB7CgkgICAgdmFyIF90aGlzID0gdGhpczsKCgkgICAgaWYgKHNlcSA9PT0gdm9pZCAwKSB7CgkgICAgICBzZXEgPSBbXTsKCSAgICB9CgoJICAgIHZhciBiZWcgPSAwLAoJICAgICAgICBlbmRzID0gW10sCgkgICAgICAgIHBob25lcyA9IFtdLAoJICAgICAgICBwaG87CgoJICAgIGZvckVhY2goc2VxKS5jYWxsKHNlcSwgZnVuY3Rpb24gKF9yZWYpIHsKCSAgICAgIHZhciBfcmVmJCA9IF9yZWZbMF0sCgkgICAgICAgICAgZW5kID0gX3JlZiQgPT09IHZvaWQgMCA/IDAgOiBfcmVmJCwKCSAgICAgICAgICBwaW55aW4gPSBfcmVmWzFdOwoJICAgICAgdmFyIGR1ciA9IGVuZCAtIGJlZzsKCgkgICAgICBpZiAoIXBpbnlpbi5tYXRjaCgvW0EtWl0vKSkgewoJICAgICAgICBwaG8gPSBfdGhpcy5wMnBbcGlueWluXTsKCSAgICAgIH0gZWxzZSB7CgkgICAgICAgIHBobyA9IHBpbnlpbi5zcGxpdCgnXicpOwoJICAgICAgICB2YXIgcGhvX25ldyA9IFtdOwoKCSAgICAgICAgZm9yICh2YXIgX2l0ZXJhdG9yID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXJMb29zZShwaG8pLCBfc3RlcDsgIShfc3RlcCA9IF9pdGVyYXRvcigpKS5kb25lOykgewoJICAgICAgICAgIHZhciBzdWJfcGhvID0gX3N0ZXAudmFsdWU7CgoJICAgICAgICAgIGlmIChzdWJfcGhvID09PSAnJykgewoJICAgICAgICAgICAgY29udGludWU7CgkgICAgICAgICAgfQoKCSAgICAgICAgICB2YXIgbGVuID0gc3ViX3Boby5sZW5ndGg7CgkgICAgICAgICAgc3ViX3BobyA9IHN1Yl9waG8uc3Vic3RyaW5nKGxlbiAtIDEpLm1hdGNoKC9bMC05XS8pID8gc3ViX3Boby5zdWJzdHJpbmcoMCwgbGVuIC0gMSkgOiBzdWJfcGhvOwoJICAgICAgICAgIHBob19uZXcucHVzaChzdWJfcGhvKTsKCSAgICAgICAgfQoKCSAgICAgICAgcGhvID0gcGhvX25ldzsKCSAgICAgIH0KCgkgICAgICBpZiAoIXBobyB8fCBwaG8gaW5zdGFuY2VvZiBBcnJheSAmJiBwaG8ubGVuZ3RoID09PSAwKSB7CgkgICAgICAgIHRocm93IEVycm9yKCJ1bmtub3duIHBpbnlpbiBzeW1ib2wsIHBpbnlpbjogIiArIHBpbnlpbiArICIsIHN0YXJ0VGltZToiICsgYmVnIC8gMTAwMCArICIsIGVuZFRpbWU6ICIgKyBlbmQgLyAxMDAwKTsKCSAgICAgIH0KCgkgICAgICB2YXIgcGhvTGVuID0gcGhvLmxlbmd0aDsKCgkgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IHBob0xlbiArIDE7IGkrKykgewoJICAgICAgICBlbmRzLnB1c2goYmVnICsgTWF0aC5mbG9vcihpICogZHVyIC8gcGhvTGVuKSk7CgkgICAgICB9CgoJICAgICAgcGhvbmVzID0gY29uY2F0KHBob25lcykuY2FsbChwaG9uZXMsIHBobyk7CgkgICAgICBiZWcgPSBlbmQ7CgkgICAgfSk7CgoJICAgIHJldHVybiB6aXBsaXN0KGVuZHMsIHBob25lcyk7CgkgIH07CgoJICByZXR1cm4gUGlueWluMlBob25lOwoJfSgpOwoKCXZhciBQaG9uZTJDb2VmZiA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CgkgIGZ1bmN0aW9uIFBob25lMkNvZWZmKHAydl9wYXRoLCB2MmNfcGF0aCkgewoJICAgIHRoaXMucDJ2ID0gcDJ2X3BhdGg7CgkgICAgdGhpcy52MmMgPSB2MmNfcGF0aDsKCSAgfQoKCSAgdmFyIF9wcm90bzIgPSBQaG9uZTJDb2VmZi5wcm90b3R5cGU7CgoJICBfcHJvdG8yLmNvbnZlcnQgPSBmdW5jdGlvbiBjb252ZXJ0KHNlcSwgZnBzKSB7CgkgICAgdmFyIF90aGlzMiA9IHRoaXM7CgoJICAgIHZhciBiZWcgPSAwOwoJICAgIHZhciBfc2VxID0gW107CgoJICAgIGZvckVhY2goc2VxKS5jYWxsKHNlcSwgZnVuY3Rpb24gKF9yZWYyKSB7CgkgICAgICB2YXIgZW5kID0gX3JlZjJbMF0sCgkgICAgICAgICAgcGhvbmUgPSBfcmVmMlsxXTsKCSAgICAgIHZhciBuID0gTWF0aC5mbG9vcihlbmQgKiBmcHMgLyAxMDAwKTsKCSAgICAgIHZhciBpdGVtID0gX3RoaXMyLnYyY1tfdGhpczIucDJ2W3Bob25lXV07CgkgICAgICB2YXIgbGVuID0gbiAtIGJlZzsKCgkgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CgkgICAgICAgIF9zZXEucHVzaChpdGVtIGluc3RhbmNlb2YgQXJyYXkgPyBpdGVtIDogW2l0ZW1dKTsKCSAgICAgIH0gLy8gX3NlcS5wdXNoKHRlbXAgaW5zdGFuY2VvZiBBcnJheSA/IHRlbXAgOiBbaXRlbV0pCgoKCSAgICAgIGJlZyA9IG47CgkgICAgfSk7CgoJICAgIHJldHVybiBfc2VxOwoJICB9OwoKCSAgcmV0dXJuIFBob25lMkNvZWZmOwoJfSgpOwoKCXZhciBGaWx0ZXIgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewoJICAvLyDor6Xpg6jliIblj6rlrp7njrDkuoYgaGFtbWluZyDmlrnms5UKCSAgZnVuY3Rpb24gRmlsdGVyKHdpbl9sZW4sIHdpbl90eXBlKSB7CgkgICAgaWYgKHdpbl9sZW4gPT09IHZvaWQgMCkgewoJICAgICAgd2luX2xlbiA9IDU7CgkgICAgfQoKCSAgICBpZiAod2luX3R5cGUgPT09IHZvaWQgMCkgewoJICAgICAgd2luX3R5cGUgPSAnaGFtbWluZyc7CgkgICAgfQoKCSAgICB2YXIgdzsKCgkgICAgaWYgKHdpbl90eXBlID09PSAnZmxhdCcpIHsKCSAgICAgIHZhciBfY29udGV4dDsKCgkgICAgICB3ID0gZmlsbChfY29udGV4dCA9IG5ldyBBcnJheSh3aW5fbGVuKSkuY2FsbChfY29udGV4dCwgMSk7CgkgICAgfSBlbHNlIHsKCSAgICAgIHcgPSBoYW1taW5nKHdpbl9sZW4pOwoJICAgIH0KCgkgICAgdmFyIHN1bSA9IHJlZHVjZSh3KS5jYWxsKHcsIGZ1bmN0aW9uIChzdW0sIGl0ZW0pIHsKCSAgICAgIHJldHVybiBzdW0gKyBpdGVtOwoJICAgIH0pOwoKCSAgICB0aGlzLncgPSBtYXAodykuY2FsbCh3LCBmdW5jdGlvbiAoaXRlbSkgewoJICAgICAgcmV0dXJuIGl0ZW0gLyBzdW07CgkgICAgfSk7CgkgICAgdGhpcy5obCA9IE1hdGguZmxvb3Iody5sZW5ndGggLyAyKTsKCSAgfQoKCSAgdmFyIF9wcm90bzMgPSBGaWx0ZXIucHJvdG90eXBlOwoKCSAgX3Byb3RvMy5wcm9jZXNzID0gZnVuY3Rpb24gcHJvY2VzcyhzZXEpIHsKCSAgICB2YXIgX3RoaXMzID0gdGhpczsKCgkgICAgdmFyIHNtb290aCA9IGZ1bmN0aW9uIHNtb290aCh4KSB7CgkgICAgICB2YXIgX2NvbnRleHQyOwoKCSAgICAgIGlmICghKHggaW5zdGFuY2VvZiBBcnJheSkpIHsKCSAgICAgICAgeCA9IFt4XTsKCSAgICAgIH0KCgkgICAgICB2YXIgcGFkZGluZyA9IGZpbGwoX2NvbnRleHQyID0gbmV3IEFycmF5KF90aGlzMy5obCkpLmNhbGwoX2NvbnRleHQyLCAwKTsKCgkgICAgICB2YXIgcyA9IGNvbmNhdCh4KS5jYWxsKHgsIHBhZGRpbmcpOwoKCSAgICAgIEFycmF5LnByb3RvdHlwZS51bnNoaWZ0LmFwcGx5KHMsIHBhZGRpbmcpOwoJICAgICAgdmFyIHkgPSBmZnRjb252b2x2ZShfdGhpczMudywgcyk7CgkgICAgICByZXR1cm4geTsKCSAgICB9OwoKCSAgICB2YXIgc2VxVCA9IHRyYW5zcG9zZTJEKHNlcSk7CgoJICAgIHZhciByZXN1bHQgPSBtYXAoc2VxVCkuY2FsbChzZXFULCBzbW9vdGgpOwoKCSAgICByZXR1cm4gdHJhbnNwb3NlMkQocmVzdWx0KTsKCSAgfTsKCgkgIHJldHVybiBGaWx0ZXI7Cgl9KCk7CgoJdmFyIFBpbnlpblNlcXVlbmNlUHJvY2Vzc29yID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKCSAgZnVuY3Rpb24gUGlueWluU2VxdWVuY2VQcm9jZXNzb3IocDJwX3BhdGgsIHAydl9wYXRoLCB2MmNfcGF0aCwgZmx0X3NpemUsIGZsdF90eXBlKSB7CgkgICAgaWYgKGZsdF9zaXplID09PSB2b2lkIDApIHsKCSAgICAgIGZsdF9zaXplID0gNTsKCSAgICB9CgoJICAgIGlmIChmbHRfdHlwZSA9PT0gdm9pZCAwKSB7CgkgICAgICBmbHRfdHlwZSA9ICdmbGF0JzsKCSAgICB9CgoJICAgIHRoaXMucDJwID0gbmV3IFBpbnlpbjJQaG9uZShwMnBfcGF0aCk7CgkgICAgdGhpcy5wMmMgPSBuZXcgUGhvbmUyQ29lZmYocDJ2X3BhdGgsIHYyY19wYXRoKTsKCSAgICB0aGlzLmZsdCA9IG5ldyBGaWx0ZXIoZmx0X3NpemUsIGZsdF90eXBlKTsKCSAgfQoKCSAgdmFyIF9wcm90bzQgPSBQaW55aW5TZXF1ZW5jZVByb2Nlc3Nvci5wcm90b3R5cGU7CgoJICBfcHJvdG80LnByb2Nlc3MgPSBmdW5jdGlvbiBwcm9jZXNzKHNlcSwgZnBzKSB7CgkgICAgdmFyIHNlcV9waW55aW4gPSBwaW55aW5fZnJvbV9qc29uX2xpc3Qoc2VxKTsKCSAgICB2YXIgc2VxX3Bob25lID0gdGhpcy5wMnAuY29udmVydChzZXFfcGlueWluKTsKCSAgICB2YXIgY29lZmYgPSB0aGlzLnAyYy5jb252ZXJ0KHNlcV9waG9uZSwgZnBzKTsKCSAgICBjb2VmZiA9IHRoaXMuZmx0LnByb2Nlc3MoY29lZmYpOwoJICAgIHJldHVybiBjb2VmZjsKCSAgfTsKCgkgIHJldHVybiBQaW55aW5TZXF1ZW5jZVByb2Nlc3NvcjsKCX0oKTsKCgl2YXIgRXllQ29lZmZHZW5lcmF0b3IgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewoJICBmdW5jdGlvbiBFeWVDb2VmZkdlbmVyYXRvcihub2lzZV9sdmwsIGJsaW5rLCBmbHRfc2l6ZSwgZmx0X3R5cGUpIHsKCSAgICBpZiAoZmx0X3R5cGUgPT09IHZvaWQgMCkgewoJICAgICAgZmx0X3R5cGUgPSAnZmxhdCc7CgkgICAgfQoKCSAgICB0aGlzLm5vaXNlX2x2bCA9IG5vaXNlX2x2bDsKCSAgICB0aGlzLmJsaW5rID0gYmxpbms7CgkgICAgdGhpcy5mbHQgPSBuZXcgRmlsdGVyKGZsdF9zaXplLCBmbHRfdHlwZSk7CgkgIH0KCgkgIHZhciBfcHJvdG81ID0gRXllQ29lZmZHZW5lcmF0b3IucHJvdG90eXBlOwoKCSAgX3Byb3RvNS5wcm9jZXNzID0gZnVuY3Rpb24gcHJvY2VzcyhOLCBmcHMpIHsKCSAgICB2YXIgX2NvbnRleHQzLAoJICAgICAgICBfY29udGV4dDQsCgkgICAgICAgIF90aGlzNCA9IHRoaXM7CgoJICAgIHZhciBfcmVmMyA9IFtfcGFyc2VJbnQodGhpcy5ibGlua1swXSAqIGZwcyksIF9wYXJzZUludCh0aGlzLmJsaW5rWzFdICogZnBzKSwgX3BhcnNlSW50KHRoaXMuYmxpbmtbMl0gKiBmcHMpICsgMV0sCgkgICAgICAgIGxiID0gX3JlZjNbMF0sCgkgICAgICAgIHViID0gX3JlZjNbMV0sCgkgICAgICAgIGR1ciA9IF9yZWYzWzJdOwoKCSAgICB2YXIgY29lZmYgPSBtYXAoX2NvbnRleHQzID0gZmlsbChfY29udGV4dDQgPSBuZXcgQXJyYXkoTikpLmNhbGwoX2NvbnRleHQ0LCAxKSkuY2FsbChfY29udGV4dDMsIGZ1bmN0aW9uICgpIHsKCSAgICAgIHJldHVybiBib3hNdWxsZXIoKSAqIF90aGlzNC5ub2lzZV9sdmw7CgkgICAgfSk7CgoJICAgIHZhciBiZWcgPSAwOwoKCSAgICB3aGlsZSAodHJ1ZSkgewoJICAgICAgdmFyIF9jb250ZXh0NSwgX2NvbnRleHQ2OwoKCSAgICAgIGJlZyArPSBsYiArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICh1YiAtIGxiKSk7CgkgICAgICBpZiAoYmVnID4gTikgYnJlYWs7CgoJICAgICAgc3BsaWNlKEFycmF5LnByb3RvdHlwZSkuYXBwbHkoY29lZmYsIGNvbmNhdChfY29udGV4dDUgPSBbYmVnLCBkdXJdKS5jYWxsKF9jb250ZXh0NSwgZmlsbChfY29udGV4dDYgPSBuZXcgQXJyYXkoZHVyKSkuY2FsbChfY29udGV4dDYsIDEpKSk7CgkgICAgfQoKCSAgICB2YXIgcmVzdWx0ID0gdGhpcy5mbHQucHJvY2Vzcyhjb2VmZik7CgkgICAgcmV0dXJuIHJlc3VsdDsKCSAgfTsKCgkgIHJldHVybiBFeWVDb2VmZkdlbmVyYXRvcjsKCX0oKTsKCgl2YXIgQTJlX2NhcnRvb24gPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewoJICBmdW5jdGlvbiBBMmVfY2FydG9vbigpIHsKCSAgICB0aGlzLm1vdXRoX21vZGVsID0gbmV3IFBpbnlpblNlcXVlbmNlUHJvY2Vzc29yKHAycF9wYXRoLCBwMnZfcGF0aCwgdjJjX3BhdGgsIGZsdF9zaXplLCBmbHRfdHlwZSk7CgkgICAgdGhpcy5leWVfbW9kZWwgPSBuZXcgRXllQ29lZmZHZW5lcmF0b3Iobm9pc2VfbHZsLCBibGluaywgZmx0X3NpemUsIGZsdF90eXBlKTsKCSAgfQoKCSAgdmFyIF9wcm90bzYgPSBBMmVfY2FydG9vbi5wcm90b3R5cGU7CgoJICBfcHJvdG82LnByb2Nlc3MgPSBmdW5jdGlvbiBwcm9jZXNzKHJlcV9jb2RlLCBzZXEsIGZwcykgewoJICAgIGlmIChzZXEgPT09IHZvaWQgMCkgewoJICAgICAgc2VxID0gW107CgkgICAgfQoKCSAgICB2YXIgbW91dGggPSB0aGlzLm1vdXRoX21vZGVsLnByb2Nlc3Moc2VxLCBmcHMpOwoJICAgIHZhciBleWUgPSB0aGlzLmV5ZV9tb2RlbC5wcm9jZXNzKG1vdXRoLmxlbmd0aCwgZnBzKTsgLy8gY29uc3QgY29lZmYgPSBtb3V0aC5jb25jYXQoZXllKQoJICAgIC8vIGNvbnNvbGUubG9nKGV5ZSk7CgoJICAgIHJldHVybiBbbW91dGgsIGV5ZV07CgkgIH07CgoJICByZXR1cm4gQTJlX2NhcnRvb247Cgl9KCk7CgoJZnVuY3Rpb24gYm94TXVsbGVyKCkgewoJICB2YXIgdSA9IDAsCgkgICAgICB2ID0gMDsKCgkgIHdoaWxlICh1ID09PSAwKSB7CgkgICAgdSA9IE1hdGgucmFuZG9tKCk7CgkgIH0KCgkgIHdoaWxlICh2ID09PSAwKSB7CgkgICAgdiA9IE1hdGgucmFuZG9tKCk7CgkgIH0KCgkgIHZhciByID0gTWF0aC5zcXJ0KC0yICogTWF0aC5sb2codSkpICogTWF0aC5jb3MoMiAqIE1hdGguUEkgKiB2KTsKCSAgcmV0dXJuIHI7Cgl9CgoJc2VsZi5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAoZSkgewoJICB2YXIgX2UkZGF0YSA9IGUuZGF0YSwKCSAgICAgIHRyYWNlSWQgPSBfZSRkYXRhLnRyYWNlSWQsCgkgICAgICB0eXBlID0gX2UkZGF0YS50eXBlLAoJICAgICAgZnBzID0gX2UkZGF0YS5mcHMsCgkgICAgICB2b2ljZVRpbWVMaW5lID0gX2UkZGF0YS52b2ljZVRpbWVMaW5lOwoKCSAgaWYgKHR5cGUgPT09ICdpbml0JykgewoJICAgIHZhciBjYXJ0b29uID0gbmV3IEEyZV9jYXJ0b29uKCk7CgoJICAgIHZhciBfY2FydG9vbiRwcm9jZXNzID0gY2FydG9vbi5wcm9jZXNzKCdyZXFfY29kZScsIHZvaWNlVGltZUxpbmUsIGZwcyksCgkgICAgICAgIHBob25lbWUgPSBfY2FydG9vbiRwcm9jZXNzWzBdLAoJICAgICAgICBleWVEYXRhID0gX2NhcnRvb24kcHJvY2Vzc1sxXTsKCgkgICAgc2VsZi5wb3N0TWVzc2FnZSh7CgkgICAgICB0cmFjZUlkOiB0cmFjZUlkLAoJICAgICAgdHlwZTogJ2dldENhcnRvb25SZXN1bHQnLAoJICAgICAgcGhvbmVtZTogcGhvbmVtZSwKCSAgICAgIGV5ZURhdGE6IGV5ZURhdGEKCSAgICB9KTsKCSAgfQoJfTsKCglyZXR1cm4gQTJlX2NhcnRvb247Cgp9KSgpOwoK",null,!1),AL=function(){function t(t){this._init(t)}var e=t.prototype;return e._init=function(t){var e=t.mixer,n=t.mouthMesh;this._mixer=e,this._mouthMesh=n,this.voiceAnimationId=1,this.traceId=1,this._initWorker(t)},e._initWorker=function(t){this.actionHandlerMap={},this._cartoonModelWorker=new WL,this._cartoonModelWorker.onmessage=this.onmessage.bind(this)},e.initAudio=function(){},e.onmessage=function(t){var e=t.data,n=e.traceId,i=e.type,o=e.phoneme,s=e.eyeData;if("getCartoonResult"===i){if(!this.actionHandlerMap[n])return;var r=this.createVoiceAnimation(o,s);this.actionHandlerMap[n].call(this,{traceId:n,voiceAnimation:r}),delete this.actionHandlerMap[n]}},e.postMessage=function(t){var e=this,n=this.traceId++;return new nB((function(i,o){var s=Zs({traceId:n},t);e._cartoonModelWorker.postMessage(s),e.actionHandlerMap[n]=function(t){i(t)}}))},e.combine=function(){var t=lS(gS.mark((function t(e){var n,i,o,s,r,a,l,c,g;return gS.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.voiceData,i=e.voiceTimeLine,o=e.actionTimeLine,s=e.textTimeLine,r=e.audioPlayer,console.log("audioPlayer",r),r||(r=new XN).init({handleFinished:function(){console.log("audio destroy"),r.destroy()}}),t.next=5,nB.all([null!=n?r.feed(n,{beginTime:i[0].startTime,endTime:i[i.length-1].endTime},!0):nB.resolve(),this.postMessage({type:"init",fps:24,voiceTimeLine:i})]);case 5:return a=t.sent,l=a[1],c=l.traceId,g=l.voiceAnimation,t.abrupt("return",{traceId:c,voiceAnimation:g,audioPlayer:r,voiceData:n,voiceTimeLine:i,actionTimeLine:o,textTimeLine:s});case 11:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),e.createVoiceAnimation=function(t,e,n){var i=this.getVoiceAnimationStep(t.length,n),o=this._mouthMesh.morphTargetInfluences,s=this._mouthMesh.morphTargetDictionary,r=$E(t).call(t,(function(t,n){var i=yL(o).call(o);return Ol(JT).call(JT,(function(o,r){i[s[o]]=5===r?e[0][n]:t[r]})),i})),a=new PC("head.morphTargetInfluences",i,r,Bc).optimize(),l=new $C("voice_"+this.voiceAnimationId++,i[i.length-1],[a]).optimize(),c=this._mixer.clipAction(l);return c.setDuration(l.duration).setLoop(Vc),c},e.getVoiceAnimationStep=function(t){var e,n;return hT(e=RL(n=new Array(t)).call(n,0)).call(e,(function(t,e){return.041666666666666664*e}))},e.keyframeTrack=function(t,e,n,i){return new PC(t+".morphTargetInfluences["+e+"]",n,i)},t}(),wL=[],YL=function(){function t(t){this._init(t),this.updateFeed=VN(this.updateFeed.bind(this),500)}var e=t.prototype;return e._init=function(t){this._options=t;var e=this._options,n=e.scene,i=e.model;this._animations={},this._bodyAnimations={},this._id=1,this.taskQueue=[],this.taskLock=!1,this._initModel(n,i)},e._initModel=function(t,e){var n,i=this,o=e.scene;this._target=o,this._bodyAnimations={},this._openingSpeechAnimation=null,this.mouthMesh=o.getObjectByName("head"),t.add(o),this._clock=new Fb,this._mixer=new Ob(o),Ol(n=e.animations||[]).call(n,(function(t){var e=i._mixer.clipAction(t);if(e.time=0,e.duration=t.duration,e.loop=Vc,i._bodyAnimations[t.name]={clip:t,action:e},"goodbye"==t.name){var n=i._mixer.clipAction(t);n.time=0,n.duration=t.duration,n.clampWhenFinished=!1,n.loop=Vc,n.name=IT,i._openingSpeechAnimation={clip:t,action:n}}})),this._mixer.addEventListener("finished",(function(t){var e,n;(null==(e=t.action)?void 0:e.name)===IT&&(i._input._keys.openingSpeech=!1);var o=t.action.getClip();if(xN(n=o.name).call(n,"voice_")>-1){var s=t.action.getMixer();i._input._keys.broadcast=!1,s.uncacheAction(t.action),i._proxy.compositeAnimation=null,i._options.onAnimationCompleted&&i._options.onAnimationCompleted()}})),this._input=new VT({mouthMesh:this.mouthMesh}),this._proxy=new iM({animations:this._bodyAnimations,speechAnimation:this._openingSpeechAnimation,mouthMesh:this.mouthMesh,onSubtitleChange:this._options.onSubtitleChange,onBroadcastPre:this._options.onBroadcastPre,onReadyTask:this._options.onReadyTask}),this._stateMachine=new fM({proxy:this._proxy,onStateChange:this._options.onStateChange}),this._animationCombiner=new AL({mixer:this._mixer,mouthMesh:this.mouthMesh}),this._input._keys.openingSpeech=!0,this._stateMachine.SetState(ZT.INIT.name)},e.clearActionCache=function(){wL.length&&(Ol(wL).call(wL,(function(t){var e=t.getMixer(),n=t.getClip();e.uncacheAction(n),e.uncacheClip(n)})),rT(wL).call(wL,0))},e.clearCompositeAnimation=function(t){t.actionTimeLine=null,t.audioPlayer=null,t.voiceAnimation=null,t.voiceData=null,t.voiceTimeLine=null},e.feed=function(t){var e,n=t.voiceData,i=t.voiceTimeLine,o=t.actionTimeLine,s=t.textTimeLine,r=t.audioPlayer;i?this.taskQueue.push({audioPlayer:r,voiceData:n,voiceTimeLine:i,actionTimeLine:hT(e=o||[]).call(e,(function(t){return Zs({},t)})),textTimeLine:s}):console.warn("invalid argument",r,n,i,o,s)},e.updateFeed=function(){var t=lS(gS.mark((function t(){var e,n;return gS.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.taskLock||!(this.taskQueue.length>0)){t.next=9;break}return this.taskLock=!0,t.next=4,null==(e=this._animationCombiner)?void 0:e.combine(this.taskQueue.shift());case 4:n=t.sent,this.taskLock=!1,this._input._keys.feed,this._proxy.taskQueue.push(n),this._proxy.onReadyTask&&this._proxy.onReadyTask();case 9:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),e.setState=function(t){this._stateMachine.SetState(t)},e.startBroadcast=function(){this._input._keys.broadcast=!0,this.setState("BROADCAST")},e.testAnimation=function(t){this._input._keys.actionToTest=t},e.switchExpression=function(t,e){this._proxy.switchExpression(t,e)},e.update=function(t){var e;this._target&&(this.updateFeed(),null==(e=this._stateMachine)||e.Update(t,this._input),this._mixer&&this._mixer.update(t))},e.clearTaskQueue=function(){this.taskQueue=[],this._proxy.taskQueue=[]},t}(),kL={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-kL.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*kL.Bounce.In(2*t):.5*kL.Bounce.Out(2*t-1)+.5}}},FL="undefined"==typeof self&&"undefined"!=typeof process&&process.hrtime?function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?self.performance.now.bind(self.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()},HL=function(){function t(){this._tweens={},this._tweensAddedDuringUpdate={}}return t.prototype.getAll=function(){var t=this;return Object.keys(this._tweens).map((function(e){return t._tweens[e]}))},t.prototype.removeAll=function(){this._tweens={}},t.prototype.add=function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},t.prototype.remove=function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},t.prototype.update=function(t,e){void 0===t&&(t=FL()),void 0===e&&(e=!1);var n=Object.keys(this._tweens);if(0===n.length)return!1;for(;n.length>0;){this._tweensAddedDuringUpdate={};for(var i=0;i<n.length;i++){var o=this._tweens[n[i]],s=!e;o&&!1===o.update(t,s)&&!e&&delete this._tweens[n[i]]}n=Object.keys(this._tweensAddedDuringUpdate)}return!0},t}(),xL={Linear:function(t,e){var n=t.length-1,i=n*e,o=Math.floor(i),s=xL.Utils.Linear;return e<0?s(t[0],t[1],i):e>1?s(t[n],t[n-1],n-i):s(t[o],t[o+1>n?n:o+1],i-o)},Bezier:function(t,e){for(var n=0,i=t.length-1,o=Math.pow,s=xL.Utils.Bernstein,r=0;r<=i;r++)n+=o(1-e,i-r)*o(e,r)*t[r]*s(i,r);return n},CatmullRom:function(t,e){var n=t.length-1,i=n*e,o=Math.floor(i),s=xL.Utils.CatmullRom;return t[0]===t[n]?(e<0&&(o=Math.floor(i=n*(1+e))),s(t[(o-1+n)%n],t[o],t[(o+1)%n],t[(o+2)%n],i-o)):e<0?t[0]-(s(t[0],t[0],t[1],t[1],-i)-t[0]):e>1?t[n]-(s(t[n],t[n],t[n-1],t[n-1],i-n)-t[n]):s(t[o?o-1:0],t[o],t[n<o+1?n:o+1],t[n<o+2?n:o+2],i-o)},Utils:{Linear:function(t,e,n){return(e-t)*n+t},Bernstein:function(t,e){var n=xL.Utils.Factorial;return n(t)/n(e)/n(t-e)},Factorial:(SL=[1],function(t){var e=1;if(SL[t])return SL[t];for(var n=t;n>1;n--)e*=n;return SL[t]=e,e}),CatmullRom:function(t,e,n,i,o){var s=.5*(n-t),r=.5*(i-e),a=o*o;return(2*e-2*n+s+r)*(o*a)+(-3*e+3*n-2*s-r)*a+s*o+e}}},NL=function(){function t(){}return t.nextId=function(){return t._nextId++},t._nextId=0,t}(),TL=new HL,ML=function(){function t(t,e){void 0===e&&(e=TL),this._object=t,this._group=e,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=kL.Linear.None,this._interpolationFunction=xL.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._id=NL.nextId(),this._isChainStopped=!1,this._goToEnd=!1}return t.prototype.getId=function(){return this._id},t.prototype.isPlaying=function(){return this._isPlaying},t.prototype.isPaused=function(){return this._isPaused},t.prototype.to=function(t,e){return this._valuesEnd=Object.create(t),void 0!==e&&(this._duration=e),this},t.prototype.duration=function(t){return this._duration=t,this},t.prototype.start=function(t){if(this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed)for(var e in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(e),this._valuesStart[e]=this._valuesStartRepeat[e];return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=void 0!==t?"string"==typeof t?FL()+parseFloat(t):t:FL(),this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this},t.prototype._setupProperties=function(t,e,n,i){for(var o in n){var s=t[o],r=Array.isArray(s),a=r?"array":typeof s,l=!r&&Array.isArray(n[o]);if("undefined"!==a&&"function"!==a){if(l){var c=n[o];if(0===c.length)continue;c=c.map(this._handleRelativeValue.bind(this,s)),n[o]=[s].concat(c)}if("object"!==a&&!r||!s||l)void 0===e[o]&&(e[o]=s),r||(e[o]*=1),i[o]=l?n[o].slice().reverse():e[o]||0;else{for(var g in e[o]=r?[]:{},s)e[o][g]=s[g];i[o]=r?[]:{},this._setupProperties(s,e[o],n[o],i[o])}}}},t.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},t.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},t.prototype.pause=function(t){return void 0===t&&(t=FL()),this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=t,this._group&&this._group.remove(this)),this},t.prototype.resume=function(t){return void 0===t&&(t=FL()),this._isPaused&&this._isPlaying?(this._isPaused=!1,this._startTime+=t-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this):this},t.prototype.stopChainedTweens=function(){for(var t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop();return this},t.prototype.group=function(t){return this._group=t,this},t.prototype.delay=function(t){return this._delayTime=t,this},t.prototype.repeat=function(t){return this._initialRepeat=t,this._repeat=t,this},t.prototype.repeatDelay=function(t){return this._repeatDelayTime=t,this},t.prototype.yoyo=function(t){return this._yoyo=t,this},t.prototype.easing=function(t){return this._easingFunction=t,this},t.prototype.interpolation=function(t){return this._interpolationFunction=t,this},t.prototype.chain=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._chainedTweens=t,this},t.prototype.onStart=function(t){return this._onStartCallback=t,this},t.prototype.onUpdate=function(t){return this._onUpdateCallback=t,this},t.prototype.onRepeat=function(t){return this._onRepeatCallback=t,this},t.prototype.onComplete=function(t){return this._onCompleteCallback=t,this},t.prototype.onStop=function(t){return this._onStopCallback=t,this},t.prototype.update=function(t,e){if(void 0===t&&(t=FL()),void 0===e&&(e=!0),this._isPaused)return!0;var n,i,o=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(t>o)return!1;e&&this.start(t)}if(this._goToEnd=!1,t<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),i=(t-this._startTime)/this._duration,i=0===this._duration||i>1?1:i;var s=this._easingFunction(i);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,s),this._onUpdateCallback&&this._onUpdateCallback(this._object,i),1===i){if(this._repeat>0){for(n in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat)this._yoyo||"string"!=typeof this._valuesEnd[n]||(this._valuesStartRepeat[n]=this._valuesStartRepeat[n]+parseFloat(this._valuesEnd[n])),this._yoyo&&this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n];return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=t+this._repeatDelayTime:this._startTime=t+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var r=0,a=this._chainedTweens.length;r<a;r++)this._chainedTweens[r].start(this._startTime+this._duration);return this._isPlaying=!1,!1}return!0},t.prototype._updateProperties=function(t,e,n,i){for(var o in n)if(void 0!==e[o]){var s=e[o]||0,r=n[o],a=Array.isArray(t[o]),l=Array.isArray(r);!a&&l?t[o]=this._interpolationFunction(r,i):"object"==typeof r&&r?this._updateProperties(t[o],s,r,i):"number"==typeof(r=this._handleRelativeValue(s,r))&&(t[o]=s+(r-s)*i)}},t.prototype._handleRelativeValue=function(t,e){return"string"!=typeof e?e:"+"===e.charAt(0)||"-"===e.charAt(0)?t+parseFloat(e):parseFloat(e)},t.prototype._swapEndStartRepeatValues=function(t){var e=this._valuesStartRepeat[t],n=this._valuesEnd[t];this._valuesStartRepeat[t]="string"==typeof n?this._valuesStartRepeat[t]+parseFloat(n):this._valuesEnd[t],this._valuesEnd[t]=e},t}(),UL=NL.nextId,KL=TL,EL=KL.getAll.bind(KL),LL=KL.removeAll.bind(KL),DL=KL.add.bind(KL),QL=KL.remove.bind(KL),zL=KL.update.bind(KL),PL={Easing:kL,Group:HL,Interpolation:xL,now:FL,Sequence:NL,nextId:UL,Tween:ML,VERSION:"18.6.4",getAll:EL,removeAll:LL,add:DL,remove:QL,update:zL},_L={useControls:!1,useDebug:!1},OL=function(){function t(){this.handleResize=this.handleResize.bind(this)}var e=t.prototype;return e.init=function(t){var e=this;if(void 0===t&&(t={}),this.inited)console.error("\u8bf7\u4e0d\u8981\u91cd\u590d\u521d\u59cb\u5316!",this);else if(this.destroyed)console.error("\u8be5\u5b9e\u4f8b\u5df2\u9500\u6bc1!",this);else{this.offsetStart=0,this.modelController={},this.inited=!0,this.running=!0,this.option=Zs({},_L,t),this.characterController=null,this.option.useDebug&&console.log("this.option",this.option);var n=this.option;n.useControls;var i=n.container,o=n.camera,s=void 0===o?{}:o,r=n.model,a=void 0===r?{}:r,l=n.renderer,c=void 0===l?{}:l,g=n.textWsUrl,d=n.voiceWsUrl,h={width:i.offsetWidth,height:i.offsetHeight},m=function(t,e,n,i){return new bh(t,e,n,i)}(s.fov,s.aspect,s.near,s.far);m.position.set(CT.x,CT.y,CT.z),m.lookAt(bT.x,bT.y,bT.z),this.camera=m;var I=new LI;this.scene=I;var u=function(t){var e=new EI(t);return e.setPixelRatio(window.devicePixelRatio),e.outputEncoding=wc,e.shadowMap.enabled=!0,e}(c);u.setSize(h.width,h.height),this.renderer=u,this.meshList=[],this.domElement=u.domElement,this.option.useControls&&(this.controls=new ey(m,u.domElement));var C=new mb(16777215,4473924);C.position.set(0,20,0),I.add(C),this.light=C,this.loadModel(a.url,(function(t){JN(a.onLoad)&&a.onLoad(t),t.scene,e.clock=new Fb,e.option.useDebug&&console.log("model",t),e.characterController=new YL(Zs({useDebug:e.option.useDebug,scene:e.scene,model:t,textWsUrl:g,voiceWsUrl:d},e.option.controller)),JN(e.option.onInitSuccess)&&e.option.onInitSuccess(e)}),(function(t){JN(a.onProgress)&&a.onProgress(t,t.loaded,a.size)}),a.onError),this.tickId=null,this.renderScene(),window.addEventListener("resize",this.handleResize),i.appendChild(this.domElement)}},e.updateVoiceText=function(t){var e;null==(e=this.characterController)||e.updateVoiceText(t)},e.websocketText=function(t){var e;null==(e=this.characterController)||e.websocketText(t)},e.websocketVoice=function(t){var e;null==(e=this.characterController)||e.websocketVoice(t)},e.setState=function(t){var e;null==(e=this.characterController)||e.setState(t)},e.testAnimation=function(t){var e;null==(e=this.characterController)||e.testAnimation(t)},e.handleToolBarVisible=function(t){var e=this;this.characterController._input._keys.toolBarVisible!==t&&(t?(this.handleCameraMove(CT,bT,pT,yT,(function(){e.option.useDebug&&console.log("\u5df2\u62c9\u8fd1\u955c\u5934")})),this.setState(ZT.TEST.name)):(this.handleCameraMove(pT,yT,CT,bT,(function(){e.option.useDebug&&console.log("\u5df2\u62c9\u8fdc\u955c\u5934")})),this.setState(ZT.IDLE.name))),this.characterController._input._keys.toolBarVisible=t},e.handleListen=function(t){t?this.setState(ZT.LISTEN.name):this.setState(ZT.IDLE.name)},e.handleCameraMove=function(t,e,n,i,o){var s=this,r=new PL.Tween(Zs({},t,{lx:e.x,ly:e.y,lz:e.z}));r.to(Zs({},n,{lx:i.x,ly:i.y,lz:i.z}),500),r.onUpdate((function(t){s.option.useDebug&&console.log("pos",t),s.camera.position.set(t.x,t.y,t.z),s.camera.lookAt(t.lx,t.ly,t.lz)})),r.onComplete((function(){s.option.useControls&&(s.controls.enabled=!0),o&&o()})),r.easing(PL.Easing.Cubic.InOut),r.start()},e.renderScene=function(){var t=this;return this.tickId=window.requestAnimationFrame((function(e){t.animate(e),t.option.onUpdate&&t.option.onUpdate(e),t.renderScene()})),this.tickId},e.animate=function(t){this.option.useControls&&this.controls.update(),null===this._previousRAF&&(this._previousRAF=t),null!==this.renderer&&this.renderer.render(this.scene,this.camera),this._Step(t-this._previousRAF),this._previousRAF=t},e._Step=function(t){var e,n=.001*t;null==(e=this.characterController)||e.update(n),PL.update()},e.loadModel=function(t,e,n,i){!function(t,e,n,i){(new op).load(t,e,n,i)}(t,e,n,i)},e.switchExpression=function(t,e){void 0===e&&(e=.99),this.characterController.switchExpression(t,e)},e.handleResize=function(){var t=this.option.container,e=t.offsetWidth,n=t.offsetHeight;console.log("this.handleResize",this),this.camera.aspect=e/n,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,n)},e.changeResize=function(t,e){this.camera.aspect=t/e,this.camera.updateProjectionMatrix(),this.renderer.setSize(t,e)},e.isAvailable=function(){return this.inited&&!this.destroyed},e.destroy=function(){var t,e=this;Ol(t=this.meshList).call(t,(function(t){e.scene.remove(t),t.geometry.dispose(),t.material.dispose()})),this.renderer.dispose(),this.renderer=null,this.scene=null,this.meshList=[],window.removeEventListener("resize",this.handleResize),this.option.container.removeChild(this.domElement),this.destroyed=!0},t}();return OL.AudioPlayer=XN,OL}();